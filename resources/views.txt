
--- Contents of dashboard.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'ERP Dashboard')
@section('page_title', 'Dashboard')

@section('header_actions')
    <div class="time-filter">
        <form action="{{ route('dashboard') }}" method="GET" class="form-inline">
            <select name="time_filter" class="form-control modern-select mr-2" onchange="toggleCustomDateInputs(this.value)">
                <option value="month" {{ request('time_filter', 'month') == 'month' ? 'selected' : '' }}>This Month</option>
                <option value="year" {{ request('time_filter') == 'year' ? 'selected' : '' }}>This Year</option>
                <option value="custom" {{ request('time_filter') == 'custom' ? 'selected' : '' }}>Custom Range</option>
            </select>
            <div id="custom-date-inputs" style="{{ request('time_filter') == 'custom' ? '' : 'display: none;' }}">
                <input type="date" name="start_date" class="form-control modern-input mr-2" value="{{ request('start_date', now()->startOfMonth()->format('Y-m-d')) }}">
                <input type="date" name="end_date" class="form-control modern-input mr-2" value="{{ request('end_date', now()->format('Y-m-d')) }}">
            </div>
            <button type="submit" class="btn modern-btn modern-btn-primary">
                <i class="fas fa-chart-line"></i> Apply
            </button>
        </form>
    </div>
@stop

@section('page_content')
    <!-- Modern Stats Cards Row -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-primary">
                <div class="stats-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number">{{ $totalInvoices }}</h3>
                    <p class="stats-label">Total Invoices</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 12% from last month
                    </div>
                </div>
                <a href="{{ route('invoices.index') }}" class="stats-link">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-success">
                <div class="stats-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number">{{ number_format($totalInvoiceAmount, 2) }}</h3>
                    <p class="stats-label">Total Sales</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 8% from last month
                    </div>
                </div>
                <a href="{{ route('invoices.index') }}" class="stats-link">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-warning">
                <div class="stats-icon">
                    <i class="fas fa-credit-card"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number">{{ number_format($totalBalanceDue, 2) }}</h3>
                    <p class="stats-label">Total Due Balance</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-down"></i> 5% from last month
                    </div>
                </div>
                <a href="{{ route('customers.index') }}" class="stats-link">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-info">
                <div class="stats-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number">{{ $totalProductQuantity }}</h3>
                    <p class="stats-label">Total Product Stock</p>
                    <div class="stats-trend">
                        <i class="fas fa-minus"></i> No change
                    </div>
                </div>
                <a href="{{ route('products.index') }}" class="stats-link">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Modern Data Tables Row -->
    <div class="row">
        <div class="col-md-6">
            <div class="card modern-card">
                <div class="card-header modern-header">
                    <h3 class="card-title">
                        <i class="fas fa-file-invoice"></i> Latest Invoices
                    </h3>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table modern-table mb-0">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                @forelse($latestInvoices as $invoice)
                                <tr>
                                    <td>
                                        <strong class="text-primary">{{ $invoice->invoice_number }}</strong>
                                    </td>
                                    <td>{{ $invoice->customer->name }}</td>
                                    <td>
                                        <small class="text-muted">{{ $invoice->invoice_date->format('d M Y') }}</small>
                                    </td>
                                    <td>
                                        @if($invoice->payment_status == 'paid')
                                            <span class="badge badge-success">
                                                <i class="fas fa-check"></i> Paid
                                            </span>
                                        @elseif($invoice->payment_status == 'partial')
                                            <span class="badge badge-warning">
                                                <i class="fas fa-clock"></i> Partial
                                            </span>
                                        @else
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times"></i> Unpaid
                                            </span>
                                        @endif
                                    </td>
                                    <td>
                                        <strong>{{ number_format($invoice->total, 2) }}</strong>
                                    </td>
                                </tr>
                                @empty
                                <tr>
                                    <td colspan="5" class="text-center py-4">
                                        <div class="empty-state">
                                            <i class="fas fa-file-invoice fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No invoices found</p>
                                        </div>
                                    </td>
                                </tr>
                                @endforelse
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a href="{{ route('invoices.index') }}" class="btn modern-btn modern-btn-primary btn-sm">
                        <i class="fas fa-list"></i> View All Invoices
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card modern-card">
                <div class="card-header modern-header success-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar"></i> Top 10 Most Stocked Items
                    </h3>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table modern-table mb-0">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @forelse($topStockItems as $product)
                                <tr>
                                    <td>
                                        <strong>{{ $product->name }}</strong>
                                    </td>
                                    <td>
                                        <span class="text-muted">{{ $product->category->name ?? 'N/A' }}</span>
                                    </td>
                                    <td>
                                        <span class="stock-quantity">{{ $product->current_stock }}</span>
                                    </td>
                                    <td>
                                        @if($product->current_stock > 20)
                                            <span class="badge badge-success">
                                                <i class="fas fa-check-circle"></i> In Stock
                                            </span>
                                        @elseif($product->current_stock > 5)
                                            <span class="badge badge-warning">
                                                <i class="fas fa-exclamation-triangle"></i> Low Stock
                                            </span>
                                        @else
                                            <span class="badge badge-danger">
                                                <i class="fas fa-exclamation-circle"></i> Critical
                                            </span>
                                        @endif
                                    </td>
                                </tr>
                                @empty
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <div class="empty-state">
                                            <i class="fas fa-boxes fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No products found</p>
                                        </div>
                                    </td>
                                </tr>
                                @endforelse
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a href="{{ route('products.index') }}" class="btn modern-btn modern-btn-success btn-sm">
                        <i class="fas fa-boxes"></i> View All Products
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header modern-header info-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('invoices.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-primary">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Create Invoice</h5>
                                    <p>Generate new invoice</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('customers.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-success">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Customer</h5>
                                    <p>Register new customer</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('products.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-warning">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Product</h5>
                                    <p>Add new product</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('transactions.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-info">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Transaction</h5>
                                    <p>Record payment</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('additional_css')
<style>
/* Modern Stats Cards */
.stats-card {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: none;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
}

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-primary::before {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-success::before {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.stats-card-warning::before {
    background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
}

.stats-card-info::before {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
}

.stats-icon {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    font-size: 1.5rem;
}

.stats-card-success .stats-icon {
    background: rgba(17, 153, 142, 0.1);
    color: #11998e;
}

.stats-card-warning .stats-icon {
    background: rgba(252, 70, 107, 0.1);
    color: #fc466b;
}

.stats-card-info .stats-icon {
    background: rgba(255, 154, 158, 0.1);
    color: #ff9a9e;
}

.stats-content {
    padding-right: 80px;
}

.stats-number {
    font-size: 2rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 0.5rem;
    line-height: 1;
}

.stats-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.stats-trend {
    font-size: 0.75rem;
    color: #28a745;
    font-weight: 500;
}

.stats-trend .fa-arrow-down {
    color: #dc3545;
}

.stats-trend .fa-minus {
    color: var(--text-muted);
}

.stats-link {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0.75rem 1.5rem;
    background: rgba(0, 0, 0, 0.03);
    color: #667eea;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.stats-link:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    text-decoration: none;
}

/* Enhanced Badges */
.badge {
    font-size: 0.75rem;
    padding: 0.375rem 0.75rem;
    border-radius: var(--border-radius);
    font-weight: 500;
}

.badge i {
    margin-right: 0.25rem;
}

/* Empty State */
.empty-state {
    padding: 2rem;
}

.empty-state i {
    opacity: 0.3;
}

/* Stock Quantity Styling */
.stock-quantity {
    font-weight: 600;
    font-size: 1.1rem;
    color: #333;
}

/* Quick Action Cards */
.quick-action-card {
    display: block;
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    text-decoration: none;
    color: inherit;
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
    height: 100%;
}

.quick-action-card:hover {
    text-decoration: none;
    color: inherit;
    border-color: #667eea;
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.quick-action-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    color: white;
    font-size: 1.25rem;
}

.quick-action-content h5 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.quick-action-content p {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin: 0;
}

/* Time Filter Styling */
.time-filter .form-inline {
    align-items: center;
}

.time-filter .modern-select,
.time-filter .modern-input {
    min-width: 120px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .stats-content {
        padding-right: 0;
    }
    
    .stats-icon {
        position: static;
        margin-bottom: 1rem;
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
    
    .stats-number {
        font-size: 1.5rem;
    }
    
    .time-filter .form-inline {
        flex-direction: column;
        align-items: stretch;
    }
    
    .time-filter .form-control {
        margin-bottom: 0.5rem;
        margin-right: 0 !important;
    }
}
</style>
@stop
@section('js')
    <script>
        function toggleCustomDateInputs(value) {
            const customDateInputs = document.getElementById('custom-date-inputs');
            if (value === 'custom') {
                customDateInputs.style.display = 'inline-flex';
            } else {
                customDateInputs.style.display = 'none';
            }
        }
        // Add smooth animations on page load
$(document).ready(function() {
    $('.stats-card').each(function(index) {
        $(this).delay(index * 100).animate({
            opacity: 1
        }, 500);
    });
});
    </script>
@stop


--- Contents of home.blade.php ---
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">{{ __('Dashboard') }}</div>

                <div class="card-body">
                    @if (session('status'))
                        <div class="alert alert-success" role="alert">
                            {{ session('status') }}
                        </div>
                    @endif

                    {{ __('You are logged in!') }}
                </div>
            </div>
        </div>
    </div>
</div>
@endsection


--- Contents of welcome.blade.php ---
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Laravel</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=instrument-sans:400,500,600" rel="stylesheet" />

        <!-- Styles / Scripts -->
        @if (file_exists(public_path('build/manifest.json')) || file_exists(public_path('hot')))
            @vite(['resources/css/app.css', 'resources/js/app.js'])
        @else
            <style>
                /*! tailwindcss v4.0.7 | MIT License | https://tailwindcss.com */@layer theme{:root,:host{--font-sans:'Instrument Sans',ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-serif:ui-serif,Georgia,Cambria,"Times New Roman",Times,serif;--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-50:oklch(.971 .013 17.38);--color-red-100:oklch(.936 .032 17.717);--color-red-200:oklch(.885 .062 18.334);--color-red-300:oklch(.808 .114 19.571);--color-red-400:oklch(.704 .191 22.216);--color-red-500:oklch(.637 .237 25.331);--color-red-600:oklch(.577 .245 27.325);--color-red-700:oklch(.505 .213 27.518);--color-red-800:oklch(.444 .177 26.899);--color-red-900:oklch(.396 .141 25.723);--color-red-950:oklch(.258 .092 26.042);--color-orange-50:oklch(.98 .016 73.684);--color-orange-100:oklch(.954 .038 75.164);--color-orange-200:oklch(.901 .076 70.697);--color-orange-300:oklch(.837 .128 66.29);--color-orange-400:oklch(.75 .183 55.934);--color-orange-500:oklch(.705 .213 47.604);--color-orange-600:oklch(.646 .222 41.116);--color-orange-700:oklch(.553 .195 38.402);--color-orange-800:oklch(.47 .157 37.304);--color-orange-900:oklch(.408 .123 38.172);--color-orange-950:oklch(.266 .079 36.259);--color-amber-50:oklch(.987 .022 95.277);--color-amber-100:oklch(.962 .059 95.617);--color-amber-200:oklch(.924 .12 95.746);--color-amber-300:oklch(.879 .169 91.605);--color-amber-400:oklch(.828 .189 84.429);--color-amber-500:oklch(.769 .188 70.08);--color-amber-600:oklch(.666 .179 58.318);--color-amber-700:oklch(.555 .163 48.998);--color-amber-800:oklch(.473 .137 46.201);--color-amber-900:oklch(.414 .112 45.904);--color-amber-950:oklch(.279 .077 45.635);--color-yellow-50:oklch(.987 .026 102.212);--color-yellow-100:oklch(.973 .071 103.193);--color-yellow-200:oklch(.945 .129 101.54);--color-yellow-300:oklch(.905 .182 98.111);--color-yellow-400:oklch(.852 .199 91.936);--color-yellow-500:oklch(.795 .184 86.047);--color-yellow-600:oklch(.681 .162 75.834);--color-yellow-700:oklch(.554 .135 66.442);--color-yellow-800:oklch(.476 .114 61.907);--color-yellow-900:oklch(.421 .095 57.708);--color-yellow-950:oklch(.286 .066 53.813);--color-lime-50:oklch(.986 .031 120.757);--color-lime-100:oklch(.967 .067 122.328);--color-lime-200:oklch(.938 .127 124.321);--color-lime-300:oklch(.897 .196 126.665);--color-lime-400:oklch(.841 .238 128.85);--color-lime-500:oklch(.768 .233 130.85);--color-lime-600:oklch(.648 .2 131.684);--color-lime-700:oklch(.532 .157 131.589);--color-lime-800:oklch(.453 .124 130.933);--color-lime-900:oklch(.405 .101 131.063);--color-lime-950:oklch(.274 .072 132.109);--color-green-50:oklch(.982 .018 155.826);--color-green-100:oklch(.962 .044 156.743);--color-green-200:oklch(.925 .084 155.995);--color-green-300:oklch(.871 .15 154.449);--color-green-400:oklch(.792 .209 151.711);--color-green-500:oklch(.723 .219 149.579);--color-green-600:oklch(.627 .194 149.214);--color-green-700:oklch(.527 .154 150.069);--color-green-800:oklch(.448 .119 151.328);--color-green-900:oklch(.393 .095 152.535);--color-green-950:oklch(.266 .065 152.934);--color-emerald-50:oklch(.979 .021 166.113);--color-emerald-100:oklch(.95 .052 163.051);--color-emerald-200:oklch(.905 .093 164.15);--color-emerald-300:oklch(.845 .143 164.978);--color-emerald-400:oklch(.765 .177 163.223);--color-emerald-500:oklch(.696 .17 162.48);--color-emerald-600:oklch(.596 .145 163.225);--color-emerald-700:oklch(.508 .118 165.612);--color-emerald-800:oklch(.432 .095 166.913);--color-emerald-900:oklch(.378 .077 168.94);--color-emerald-950:oklch(.262 .051 172.552);--color-teal-50:oklch(.984 .014 180.72);--color-teal-100:oklch(.953 .051 180.801);--color-teal-200:oklch(.91 .096 180.426);--color-teal-300:oklch(.855 .138 181.071);--color-teal-400:oklch(.777 .152 181.912);--color-teal-500:oklch(.704 .14 182.503);--color-teal-600:oklch(.6 .118 184.704);--color-teal-700:oklch(.511 .096 186.391);--color-teal-800:oklch(.437 .078 188.216);--color-teal-900:oklch(.386 .063 188.416);--color-teal-950:oklch(.277 .046 192.524);--color-cyan-50:oklch(.984 .019 200.873);--color-cyan-100:oklch(.956 .045 203.388);--color-cyan-200:oklch(.917 .08 205.041);--color-cyan-300:oklch(.865 .127 207.078);--color-cyan-400:oklch(.789 .154 211.53);--color-cyan-500:oklch(.715 .143 215.221);--color-cyan-600:oklch(.609 .126 221.723);--color-cyan-700:oklch(.52 .105 223.128);--color-cyan-800:oklch(.45 .085 224.283);--color-cyan-900:oklch(.398 .07 227.392);--color-cyan-950:oklch(.302 .056 229.695);--color-sky-50:oklch(.977 .013 236.62);--color-sky-100:oklch(.951 .026 236.824);--color-sky-200:oklch(.901 .058 230.902);--color-sky-300:oklch(.828 .111 230.318);--color-sky-400:oklch(.746 .16 232.661);--color-sky-500:oklch(.685 .169 237.323);--color-sky-600:oklch(.588 .158 241.966);--color-sky-700:oklch(.5 .134 242.749);--color-sky-800:oklch(.443 .11 240.79);--color-sky-900:oklch(.391 .09 240.876);--color-sky-950:oklch(.293 .066 243.157);--color-blue-50:oklch(.97 .014 254.604);--color-blue-100:oklch(.932 .032 255.585);--color-blue-200:oklch(.882 .059 254.128);--color-blue-300:oklch(.809 .105 251.813);--color-blue-400:oklch(.707 .165 254.624);--color-blue-500:oklch(.623 .214 259.815);--color-blue-600:oklch(.546 .245 262.881);--color-blue-700:oklch(.488 .243 264.376);--color-blue-800:oklch(.424 .199 265.638);--color-blue-900:oklch(.379 .146 265.522);--color-blue-950:oklch(.282 .091 267.935);--color-indigo-50:oklch(.962 .018 272.314);--color-indigo-100:oklch(.93 .034 272.788);--color-indigo-200:oklch(.87 .065 274.039);--color-indigo-300:oklch(.785 .115 274.713);--color-indigo-400:oklch(.673 .182 276.935);--color-indigo-500:oklch(.585 .233 277.117);--color-indigo-600:oklch(.511 .262 276.966);--color-indigo-700:oklch(.457 .24 277.023);--color-indigo-800:oklch(.398 .195 277.366);--color-indigo-900:oklch(.359 .144 278.697);--color-indigo-950:oklch(.257 .09 281.288);--color-violet-50:oklch(.969 .016 293.756);--color-violet-100:oklch(.943 .029 294.588);--color-violet-200:oklch(.894 .057 293.283);--color-violet-300:oklch(.811 .111 293.571);--color-violet-400:oklch(.702 .183 293.541);--color-violet-500:oklch(.606 .25 292.717);--color-violet-600:oklch(.541 .281 293.009);--color-violet-700:oklch(.491 .27 292.581);--color-violet-800:oklch(.432 .232 292.759);--color-violet-900:oklch(.38 .189 293.745);--color-violet-950:oklch(.283 .141 291.089);--color-purple-50:oklch(.977 .014 308.299);--color-purple-100:oklch(.946 .033 307.174);--color-purple-200:oklch(.902 .063 306.703);--color-purple-300:oklch(.827 .119 306.383);--color-purple-400:oklch(.714 .203 305.504);--color-purple-500:oklch(.627 .265 303.9);--color-purple-600:oklch(.558 .288 302.321);--color-purple-700:oklch(.496 .265 301.924);--color-purple-800:oklch(.438 .218 303.724);--color-purple-900:oklch(.381 .176 304.987);--color-purple-950:oklch(.291 .149 302.717);--color-fuchsia-50:oklch(.977 .017 320.058);--color-fuchsia-100:oklch(.952 .037 318.852);--color-fuchsia-200:oklch(.903 .076 319.62);--color-fuchsia-300:oklch(.833 .145 321.434);--color-fuchsia-400:oklch(.74 .238 322.16);--color-fuchsia-500:oklch(.667 .295 322.15);--color-fuchsia-600:oklch(.591 .293 322.896);--color-fuchsia-700:oklch(.518 .253 323.949);--color-fuchsia-800:oklch(.452 .211 324.591);--color-fuchsia-900:oklch(.401 .17 325.612);--color-fuchsia-950:oklch(.293 .136 325.661);--color-pink-50:oklch(.971 .014 343.198);--color-pink-100:oklch(.948 .028 342.258);--color-pink-200:oklch(.899 .061 343.231);--color-pink-300:oklch(.823 .12 346.018);--color-pink-400:oklch(.718 .202 349.761);--color-pink-500:oklch(.656 .241 354.308);--color-pink-600:oklch(.592 .249 .584);--color-pink-700:oklch(.525 .223 3.958);--color-pink-800:oklch(.459 .187 3.815);--color-pink-900:oklch(.408 .153 2.432);--color-pink-950:oklch(.284 .109 3.907);--color-rose-50:oklch(.969 .015 12.422);--color-rose-100:oklch(.941 .03 12.58);--color-rose-200:oklch(.892 .058 10.001);--color-rose-300:oklch(.81 .117 11.638);--color-rose-400:oklch(.712 .194 13.428);--color-rose-500:oklch(.645 .246 16.439);--color-rose-600:oklch(.586 .253 17.585);--color-rose-700:oklch(.514 .222 16.935);--color-rose-800:oklch(.455 .188 13.697);--color-rose-900:oklch(.41 .159 10.272);--color-rose-950:oklch(.271 .105 12.094);--color-slate-50:oklch(.984 .003 247.858);--color-slate-100:oklch(.968 .007 247.896);--color-slate-200:oklch(.929 .013 255.508);--color-slate-300:oklch(.869 .022 252.894);--color-slate-400:oklch(.704 .04 256.788);--color-slate-500:oklch(.554 .046 257.417);--color-slate-600:oklch(.446 .043 257.281);--color-slate-700:oklch(.372 .044 257.287);--color-slate-800:oklch(.279 .041 260.031);--color-slate-900:oklch(.208 .042 265.755);--color-slate-950:oklch(.129 .042 264.695);--color-gray-50:oklch(.985 .002 247.839);--color-gray-100:oklch(.967 .003 264.542);--color-gray-200:oklch(.928 .006 264.531);--color-gray-300:oklch(.872 .01 258.338);--color-gray-400:oklch(.707 .022 261.325);--color-gray-500:oklch(.551 .027 264.364);--color-gray-600:oklch(.446 .03 256.802);--color-gray-700:oklch(.373 .034 259.733);--color-gray-800:oklch(.278 .033 256.848);--color-gray-900:oklch(.21 .034 264.665);--color-gray-950:oklch(.13 .028 261.692);--color-zinc-50:oklch(.985 0 0);--color-zinc-100:oklch(.967 .001 286.375);--color-zinc-200:oklch(.92 .004 286.32);--color-zinc-300:oklch(.871 .006 286.286);--color-zinc-400:oklch(.705 .015 286.067);--color-zinc-500:oklch(.552 .016 285.938);--color-zinc-600:oklch(.442 .017 285.786);--color-zinc-700:oklch(.37 .013 285.805);--color-zinc-800:oklch(.274 .006 286.033);--color-zinc-900:oklch(.21 .006 285.885);--color-zinc-950:oklch(.141 .005 285.823);--color-neutral-50:oklch(.985 0 0);--color-neutral-100:oklch(.97 0 0);--color-neutral-200:oklch(.922 0 0);--color-neutral-300:oklch(.87 0 0);--color-neutral-400:oklch(.708 0 0);--color-neutral-500:oklch(.556 0 0);--color-neutral-600:oklch(.439 0 0);--color-neutral-700:oklch(.371 0 0);--color-neutral-800:oklch(.269 0 0);--color-neutral-900:oklch(.205 0 0);--color-neutral-950:oklch(.145 0 0);--color-stone-50:oklch(.985 .001 106.423);--color-stone-100:oklch(.97 .001 106.424);--color-stone-200:oklch(.923 .003 48.717);--color-stone-300:oklch(.869 .005 56.366);--color-stone-400:oklch(.709 .01 56.259);--color-stone-500:oklch(.553 .013 58.071);--color-stone-600:oklch(.444 .011 73.639);--color-stone-700:oklch(.374 .01 67.558);--color-stone-800:oklch(.268 .007 34.298);--color-stone-900:oklch(.216 .006 56.043);--color-stone-950:oklch(.147 .004 49.25);--color-black:#000;--color-white:#fff;--spacing:.25rem;--breakpoint-sm:40rem;--breakpoint-md:48rem;--breakpoint-lg:64rem;--breakpoint-xl:80rem;--breakpoint-2xl:96rem;--container-3xs:16rem;--container-2xs:18rem;--container-xs:20rem;--container-sm:24rem;--container-md:28rem;--container-lg:32rem;--container-xl:36rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--container-5xl:64rem;--container-6xl:72rem;--container-7xl:80rem;--text-xs:.75rem;--text-xs--line-height:calc(1/.75);--text-sm:.875rem;--text-sm--line-height:calc(1.25/.875);--text-base:1rem;--text-base--line-height: 1.5 ;--text-lg:1.125rem;--text-lg--line-height:calc(1.75/1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75/1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2/1.5);--text-3xl:1.875rem;--text-3xl--line-height: 1.2 ;--text-4xl:2.25rem;--text-4xl--line-height:calc(2.5/2.25);--text-5xl:3rem;--text-5xl--line-height:1;--text-6xl:3.75rem;--text-6xl--line-height:1;--text-7xl:4.5rem;--text-7xl--line-height:1;--text-8xl:6rem;--text-8xl--line-height:1;--text-9xl:8rem;--text-9xl--line-height:1;--font-weight-thin:100;--font-weight-extralight:200;--font-weight-light:300;--font-weight-normal:400;--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--font-weight-extrabold:800;--font-weight-black:900;--tracking-tighter:-.05em;--tracking-tight:-.025em;--tracking-normal:0em;--tracking-wide:.025em;--tracking-wider:.05em;--tracking-widest:.1em;--leading-tight:1.25;--leading-snug:1.375;--leading-normal:1.5;--leading-relaxed:1.625;--leading-loose:2;--radius-xs:.125rem;--radius-sm:.25rem;--radius-md:.375rem;--radius-lg:.5rem;--radius-xl:.75rem;--radius-2xl:1rem;--radius-3xl:1.5rem;--radius-4xl:2rem;--shadow-2xs:0 1px #0000000d;--shadow-xs:0 1px 2px 0 #0000000d;--shadow-sm:0 1px 3px 0 #0000001a,0 1px 2px -1px #0000001a;--shadow-md:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a;--shadow-lg:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;--shadow-xl:0 20px 25px -5px #0000001a,0 8px 10px -6px #0000001a;--shadow-2xl:0 25px 50px -12px #00000040;--inset-shadow-2xs:inset 0 1px #0000000d;--inset-shadow-xs:inset 0 1px 1px #0000000d;--inset-shadow-sm:inset 0 2px 4px #0000000d;--drop-shadow-xs:0 1px 1px #0000000d;--drop-shadow-sm:0 1px 2px #00000026;--drop-shadow-md:0 3px 3px #0000001f;--drop-shadow-lg:0 4px 4px #00000026;--drop-shadow-xl:0 9px 7px #0000001a;--drop-shadow-2xl:0 25px 25px #00000026;--ease-in:cubic-bezier(.4,0,1,1);--ease-out:cubic-bezier(0,0,.2,1);--ease-in-out:cubic-bezier(.4,0,.2,1);--animate-spin:spin 1s linear infinite;--animate-ping:ping 1s cubic-bezier(0,0,.2,1)infinite;--animate-pulse:pulse 2s cubic-bezier(.4,0,.6,1)infinite;--animate-bounce:bounce 1s infinite;--blur-xs:4px;--blur-sm:8px;--blur-md:12px;--blur-lg:16px;--blur-xl:24px;--blur-2xl:40px;--blur-3xl:64px;--perspective-dramatic:100px;--perspective-near:300px;--perspective-normal:500px;--perspective-midrange:800px;--perspective-distant:1200px;--aspect-video:16/9;--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-font-feature-settings:var(--font-sans--font-feature-settings);--default-font-variation-settings:var(--font-sans--font-variation-settings);--default-mono-font-family:var(--font-mono);--default-mono-font-feature-settings:var(--font-mono--font-feature-settings);--default-mono-font-variation-settings:var(--font-mono--font-variation-settings)}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}body{line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1;color:color-mix(in oklab,currentColor 50%,transparent)}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){-webkit-appearance:button;-moz-appearance:button;appearance:button}::file-selector-button{-webkit-appearance:button;-moz-appearance:button;appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.absolute{position:absolute}.relative{position:relative}.static{position:static}.inset-0{inset:calc(var(--spacing)*0)}.-mt-\[4\.9rem\]{margin-top:-4.9rem}.-mb-px{margin-bottom:-1px}.mb-1{margin-bottom:calc(var(--spacing)*1)}.mb-2{margin-bottom:calc(var(--spacing)*2)}.mb-4{margin-bottom:calc(var(--spacing)*4)}.mb-6{margin-bottom:calc(var(--spacing)*6)}.-ml-8{margin-left:calc(var(--spacing)*-8)}.flex{display:flex}.hidden{display:none}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.table{display:table}.aspect-\[335\/376\]{aspect-ratio:335/376}.h-1{height:calc(var(--spacing)*1)}.h-1\.5{height:calc(var(--spacing)*1.5)}.h-2{height:calc(var(--spacing)*2)}.h-2\.5{height:calc(var(--spacing)*2.5)}.h-3{height:calc(var(--spacing)*3)}.h-3\.5{height:calc(var(--spacing)*3.5)}.h-14{height:calc(var(--spacing)*14)}.h-14\.5{height:calc(var(--spacing)*14.5)}.min-h-screen{min-height:100vh}.w-1{width:calc(var(--spacing)*1)}.w-1\.5{width:calc(var(--spacing)*1.5)}.w-2{width:calc(var(--spacing)*2)}.w-2\.5{width:calc(var(--spacing)*2.5)}.w-3{width:calc(var(--spacing)*3)}.w-3\.5{width:calc(var(--spacing)*3.5)}.w-\[448px\]{width:448px}.w-full{width:100%}.max-w-\[335px\]{max-width:335px}.max-w-none{max-width:none}.flex-1{flex:1}.shrink-0{flex-shrink:0}.translate-y-0{--tw-translate-y:calc(var(--spacing)*0);translate:var(--tw-translate-x)var(--tw-translate-y)}.transform{transform:var(--tw-rotate-x)var(--tw-rotate-y)var(--tw-rotate-z)var(--tw-skew-x)var(--tw-skew-y)}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.items-center{align-items:center}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.gap-3{gap:calc(var(--spacing)*3)}.gap-4{gap:calc(var(--spacing)*4)}:where(.space-x-1>:not(:last-child)){--tw-space-x-reverse:0;margin-inline-start:calc(calc(var(--spacing)*1)*var(--tw-space-x-reverse));margin-inline-end:calc(calc(var(--spacing)*1)*calc(1 - var(--tw-space-x-reverse)))}.overflow-hidden{overflow:hidden}.rounded-full{border-radius:3.40282e38px}.rounded-sm{border-radius:var(--radius-sm)}.rounded-t-lg{border-top-left-radius:var(--radius-lg);border-top-right-radius:var(--radius-lg)}.rounded-br-lg{border-bottom-right-radius:var(--radius-lg)}.rounded-bl-lg{border-bottom-left-radius:var(--radius-lg)}.border{border-style:var(--tw-border-style);border-width:1px}.border-\[\#19140035\]{border-color:#19140035}.border-\[\#e3e3e0\]{border-color:#e3e3e0}.border-black{border-color:var(--color-black)}.border-transparent{border-color:#0000}.bg-\[\#1b1b18\]{background-color:#1b1b18}.bg-\[\#FDFDFC\]{background-color:#fdfdfc}.bg-\[\#dbdbd7\]{background-color:#dbdbd7}.bg-\[\#fff2f2\]{background-color:#fff2f2}.bg-white{background-color:var(--color-white)}.p-6{padding:calc(var(--spacing)*6)}.px-5{padding-inline:calc(var(--spacing)*5)}.py-1{padding-block:calc(var(--spacing)*1)}.py-1\.5{padding-block:calc(var(--spacing)*1.5)}.py-2{padding-block:calc(var(--spacing)*2)}.pb-12{padding-bottom:calc(var(--spacing)*12)}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-\[13px\]{font-size:13px}.leading-\[20px\]{--tw-leading:20px;line-height:20px}.leading-normal{--tw-leading:var(--leading-normal);line-height:var(--leading-normal)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.text-\[\#1b1b18\]{color:#1b1b18}.text-\[\#706f6c\]{color:#706f6c}.text-\[\#F53003\],.text-\[\#f53003\]{color:#f53003}.text-white{color:var(--color-white)}.underline{text-decoration-line:underline}.underline-offset-4{text-underline-offset:4px}.opacity-100{opacity:1}.shadow-\[0px_0px_1px_0px_rgba\(0\,0\,0\,0\.03\)\,0px_1px_2px_0px_rgba\(0\,0\,0\,0\.06\)\]{--tw-shadow:0px 0px 1px 0px var(--tw-shadow-color,#00000008),0px 1px 2px 0px var(--tw-shadow-color,#0000000f);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-\[inset_0px_0px_0px_1px_rgba\(26\,26\,0\,0\.16\)\]{--tw-shadow:inset 0px 0px 0px 1px var(--tw-shadow-color,#1a1a0029);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.\!filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)!important}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.delay-300{transition-delay:.3s}.duration-750{--tw-duration:.75s;transition-duration:.75s}.not-has-\[nav\]\:hidden:not(:has(:is(nav))){display:none}.before\:absolute:before{content:var(--tw-content);position:absolute}.before\:top-0:before{content:var(--tw-content);top:calc(var(--spacing)*0)}.before\:top-1\/2:before{content:var(--tw-content);top:50%}.before\:bottom-0:before{content:var(--tw-content);bottom:calc(var(--spacing)*0)}.before\:bottom-1\/2:before{content:var(--tw-content);bottom:50%}.before\:left-\[0\.4rem\]:before{content:var(--tw-content);left:.4rem}.before\:border-l:before{content:var(--tw-content);border-left-style:var(--tw-border-style);border-left-width:1px}.before\:border-\[\#e3e3e0\]:before{content:var(--tw-content);border-color:#e3e3e0}@media (hover:hover){.hover\:border-\[\#1915014a\]:hover{border-color:#1915014a}.hover\:border-\[\#19140035\]:hover{border-color:#19140035}.hover\:border-black:hover{border-color:var(--color-black)}.hover\:bg-black:hover{background-color:var(--color-black)}}@media (width>=64rem){.lg\:-mt-\[6\.6rem\]{margin-top:-6.6rem}.lg\:mb-0{margin-bottom:calc(var(--spacing)*0)}.lg\:mb-6{margin-bottom:calc(var(--spacing)*6)}.lg\:-ml-px{margin-left:-1px}.lg\:ml-0{margin-left:calc(var(--spacing)*0)}.lg\:block{display:block}.lg\:aspect-auto{aspect-ratio:auto}.lg\:w-\[438px\]{width:438px}.lg\:max-w-4xl{max-width:var(--container-4xl)}.lg\:grow{flex-grow:1}.lg\:flex-row{flex-direction:row}.lg\:justify-center{justify-content:center}.lg\:rounded-t-none{border-top-left-radius:0;border-top-right-radius:0}.lg\:rounded-tl-lg{border-top-left-radius:var(--radius-lg)}.lg\:rounded-r-lg{border-top-right-radius:var(--radius-lg);border-bottom-right-radius:var(--radius-lg)}.lg\:rounded-br-none{border-bottom-right-radius:0}.lg\:p-8{padding:calc(var(--spacing)*8)}.lg\:p-20{padding:calc(var(--spacing)*20)}}@media (prefers-color-scheme:dark){.dark\:block{display:block}.dark\:hidden{display:none}.dark\:border-\[\#3E3E3A\]{border-color:#3e3e3a}.dark\:border-\[\#eeeeec\]{border-color:#eeeeec}.dark\:bg-\[\#0a0a0a\]{background-color:#0a0a0a}.dark\:bg-\[\#1D0002\]{background-color:#1d0002}.dark\:bg-\[\#3E3E3A\]{background-color:#3e3e3a}.dark\:bg-\[\#161615\]{background-color:#161615}.dark\:bg-\[\#eeeeec\]{background-color:#eeeeec}.dark\:text-\[\#1C1C1A\]{color:#1c1c1a}.dark\:text-\[\#A1A09A\]{color:#a1a09a}.dark\:text-\[\#EDEDEC\]{color:#ededec}.dark\:text-\[\#F61500\]{color:#f61500}.dark\:text-\[\#FF4433\]{color:#f43}.dark\:shadow-\[inset_0px_0px_0px_1px_\#fffaed2d\]{--tw-shadow:inset 0px 0px 0px 1px var(--tw-shadow-color,#fffaed2d);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.dark\:before\:border-\[\#3E3E3A\]:before{content:var(--tw-content);border-color:#3e3e3a}@media (hover:hover){.dark\:hover\:border-\[\#3E3E3A\]:hover{border-color:#3e3e3a}.dark\:hover\:border-\[\#62605b\]:hover{border-color:#62605b}.dark\:hover\:border-white:hover{border-color:var(--color-white)}.dark\:hover\:bg-white:hover{background-color:var(--color-white)}}}@starting-style{.starting\:translate-y-4{--tw-translate-y:calc(var(--spacing)*4);translate:var(--tw-translate-x)var(--tw-translate-y)}}@starting-style{.starting\:translate-y-6{--tw-translate-y:calc(var(--spacing)*6);translate:var(--tw-translate-x)var(--tw-translate-y)}}@starting-style{.starting\:opacity-0{opacity:0}}}@keyframes spin{to{transform:rotate(360deg)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes pulse{50%{opacity:.5}}@keyframes bounce{0%,to{animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false;initial-value:rotateX(0)}@property --tw-rotate-y{syntax:"*";inherits:false;initial-value:rotateY(0)}@property --tw-rotate-z{syntax:"*";inherits:false;initial-value:rotateZ(0)}@property --tw-skew-x{syntax:"*";inherits:false;initial-value:skewX(0)}@property --tw-skew-y{syntax:"*";inherits:false;initial-value:skewY(0)}@property --tw-space-x-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-content{syntax:"*";inherits:false;initial-value:""}
            </style>
        @endif
    </head>
    <body class="bg-[#FDFDFC] dark:bg-[#0a0a0a] text-[#1b1b18] flex p-6 lg:p-8 items-center lg:justify-center min-h-screen flex-col">
        <header class="w-full lg:max-w-4xl max-w-[335px] text-sm mb-6 not-has-[nav]:hidden">
            @if (Route::has('login'))
                <nav class="flex items-center justify-end gap-4">
                    @auth
                        <a
                            href="{{ url('/dashboard') }}"
                            class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] border-[#19140035] hover:border-[#1915014a] border text-[#1b1b18] dark:border-[#3E3E3A] dark:hover:border-[#62605b] rounded-sm text-sm leading-normal"
                        >
                            Dashboard
                        </a>
                    @else
                        <a
                            href="{{ route('login') }}"
                            class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] text-[#1b1b18] border border-transparent hover:border-[#19140035] dark:hover:border-[#3E3E3A] rounded-sm text-sm leading-normal"
                        >
                            Log in
                        </a>

                        @if (Route::has('register'))
                            <a
                                href="{{ route('register') }}"
                                class="inline-block px-5 py-1.5 dark:text-[#EDEDEC] border-[#19140035] hover:border-[#1915014a] border text-[#1b1b18] dark:border-[#3E3E3A] dark:hover:border-[#62605b] rounded-sm text-sm leading-normal">
                                Register
                            </a>
                        @endif
                    @endauth
                </nav>
            @endif
        </header>
        <div class="flex items-center justify-center w-full transition-opacity opacity-100 duration-750 lg:grow starting:opacity-0">
            <main class="flex max-w-[335px] w-full flex-col-reverse lg:max-w-4xl lg:flex-row">
                <div class="text-[13px] leading-[20px] flex-1 p-6 pb-12 lg:p-20 bg-white dark:bg-[#161615] dark:text-[#EDEDEC] shadow-[inset_0px_0px_0px_1px_rgba(26,26,0,0.16)] dark:shadow-[inset_0px_0px_0px_1px_#fffaed2d] rounded-bl-lg rounded-br-lg lg:rounded-tl-lg lg:rounded-br-none">
                    <h1 class="mb-1 font-medium">Let's get started</h1>
                    <p class="mb-2 text-[#706f6c] dark:text-[#A1A09A]">Laravel has an incredibly rich ecosystem. <br>We suggest starting with the following.</p>
                    <ul class="flex flex-col mb-4 lg:mb-6">
                        <li class="flex items-center gap-4 py-2 relative before:border-l before:border-[#e3e3e0] dark:before:border-[#3E3E3A] before:top-1/2 before:bottom-0 before:left-[0.4rem] before:absolute">
                            <span class="relative py-1 bg-white dark:bg-[#161615]">
                                <span class="flex items-center justify-center rounded-full bg-[#FDFDFC] dark:bg-[#161615] shadow-[0px_0px_1px_0px_rgba(0,0,0,0.03),0px_1px_2px_0px_rgba(0,0,0,0.06)] w-3.5 h-3.5 border dark:border-[#3E3E3A] border-[#e3e3e0]">
                                    <span class="rounded-full bg-[#dbdbd7] dark:bg-[#3E3E3A] w-1.5 h-1.5"></span>
                                </span>
                            </span>
                            <span>
                                Read the
                                <a href="https://laravel.com/docs" target="_blank" class="inline-flex items-center space-x-1 font-medium underline underline-offset-4 text-[#f53003] dark:text-[#FF4433] ml-1">
                                    <span>Documentation</span>
                                    <svg
                                        width="10"
                                        height="11"
                                        viewBox="0 0 10 11"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="w-2.5 h-2.5"
                                    >
                                        <path
                                            d="M7.70833 6.95834V2.79167H3.54167M2.5 8L7.5 3.00001"
                                            stroke="currentColor"
                                            stroke-linecap="square"
                                        />
                                    </svg>
                                </a>
                            </span>
                        </li>
                        <li class="flex items-center gap-4 py-2 relative before:border-l before:border-[#e3e3e0] dark:before:border-[#3E3E3A] before:bottom-1/2 before:top-0 before:left-[0.4rem] before:absolute">
                            <span class="relative py-1 bg-white dark:bg-[#161615]">
                                <span class="flex items-center justify-center rounded-full bg-[#FDFDFC] dark:bg-[#161615] shadow-[0px_0px_1px_0px_rgba(0,0,0,0.03),0px_1px_2px_0px_rgba(0,0,0,0.06)] w-3.5 h-3.5 border dark:border-[#3E3E3A] border-[#e3e3e0]">
                                    <span class="rounded-full bg-[#dbdbd7] dark:bg-[#3E3E3A] w-1.5 h-1.5"></span>
                                </span>
                            </span>
                            <span>
                                Watch video tutorials at
                                <a href="https://laracasts.com" target="_blank" class="inline-flex items-center space-x-1 font-medium underline underline-offset-4 text-[#f53003] dark:text-[#FF4433] ml-1">
                                    <span>Laracasts</span>
                                    <svg
                                        width="10"
                                        height="11"
                                        viewBox="0 0 10 11"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="w-2.5 h-2.5"
                                    >
                                        <path
                                            d="M7.70833 6.95834V2.79167H3.54167M2.5 8L7.5 3.00001"
                                            stroke="currentColor"
                                            stroke-linecap="square"
                                        />
                                    </svg>
                                </a>
                            </span>
                        </li>
                    </ul>
                    <ul class="flex gap-3 text-sm leading-normal">
                        <li>
                            <a href="https://cloud.laravel.com" target="_blank" class="inline-block dark:bg-[#eeeeec] dark:border-[#eeeeec] dark:text-[#1C1C1A] dark:hover:bg-white dark:hover:border-white hover:bg-black hover:border-black px-5 py-1.5 bg-[#1b1b18] rounded-sm border border-black text-white text-sm leading-normal">
                                Deploy now
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="bg-[#fff2f2] dark:bg-[#1D0002] relative lg:-ml-px -mb-px lg:mb-0 rounded-t-lg lg:rounded-t-none lg:rounded-r-lg aspect-[335/376] lg:aspect-auto w-full lg:w-[438px] shrink-0 overflow-hidden">
                    {{-- Laravel Logo --}}
                    <svg class="w-full text-[#F53003] dark:text-[#F61500] transition-all translate-y-0 opacity-100 max-w-none duration-750 starting:opacity-0 starting:translate-y-6" viewBox="0 0 438 104" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.2036 -3H0V102.197H49.5189V86.7187H17.2036V-3Z" fill="currentColor" />
                        <path d="M110.256 41.6337C108.061 38.1275 104.945 35.3731 100.905 33.3681C96.8667 31.3647 92.8016 30.3618 88.7131 30.3618C83.4247 30.3618 78.5885 31.3389 74.201 33.2923C69.8111 35.2456 66.0474 37.928 62.9059 41.3333C59.7643 44.7401 57.3198 48.6726 55.5754 53.1293C53.8287 57.589 52.9572 62.274 52.9572 67.1813C52.9572 72.1925 53.8287 76.8995 55.5754 81.3069C57.3191 85.7173 59.7636 89.6241 62.9059 93.0293C66.0474 96.4361 69.8119 99.1155 74.201 101.069C78.5885 103.022 83.4247 103.999 88.7131 103.999C92.8016 103.999 96.8667 102.997 100.905 100.994C104.945 98.9911 108.061 96.2359 110.256 92.7282V102.195H126.563V32.1642H110.256V41.6337ZM108.76 75.7472C107.762 78.4531 106.366 80.8078 104.572 82.8112C102.776 84.8161 100.606 86.4183 98.0637 87.6206C95.5202 88.823 92.7004 89.4238 89.6103 89.4238C86.5178 89.4238 83.7252 88.823 81.2324 87.6206C78.7388 86.4183 76.5949 84.8161 74.7998 82.8112C73.004 80.8078 71.6319 78.4531 70.6856 75.7472C69.7356 73.0421 69.2644 70.1868 69.2644 67.1821C69.2644 64.1758 69.7356 61.3205 70.6856 58.6154C71.6319 55.9102 73.004 53.5571 74.7998 51.5522C76.5949 49.5495 78.738 47.9451 81.2324 46.7427C83.7252 45.5404 86.5178 44.9396 89.6103 44.9396C92.7012 44.9396 95.5202 45.5404 98.0637 46.7427C100.606 47.9451 102.776 49.5487 104.572 51.5522C106.367 53.5571 107.762 55.9102 108.76 58.6154C109.756 61.3205 110.256 64.1758 110.256 67.1821C110.256 70.1868 109.756 73.0421 108.76 75.7472Z" fill="currentColor" />
                        <path d="M242.805 41.6337C240.611 38.1275 237.494 35.3731 233.455 33.3681C229.416 31.3647 225.351 30.3618 221.262 30.3618C215.974 30.3618 211.138 31.3389 206.75 33.2923C202.36 35.2456 198.597 37.928 195.455 41.3333C192.314 44.7401 189.869 48.6726 188.125 53.1293C186.378 57.589 185.507 62.274 185.507 67.1813C185.507 72.1925 186.378 76.8995 188.125 81.3069C189.868 85.7173 192.313 89.6241 195.455 93.0293C198.597 96.4361 202.361 99.1155 206.75 101.069C211.138 103.022 215.974 103.999 221.262 103.999C225.351 103.999 229.416 102.997 233.455 100.994C237.494 98.9911 240.611 96.2359 242.805 92.7282V102.195H259.112V32.1642H242.805V41.6337ZM241.31 75.7472C240.312 78.4531 238.916 80.8078 237.122 82.8112C235.326 84.8161 233.156 86.4183 230.614 87.6206C228.07 88.823 225.251 89.4238 222.16 89.4238C219.068 89.4238 216.275 88.823 213.782 87.6206C211.289 86.4183 209.145 84.8161 207.35 82.8112C205.554 80.8078 204.182 78.4531 203.236 75.7472C202.286 73.0421 201.814 70.1868 201.814 67.1821C201.814 64.1758 202.286 61.3205 203.236 58.6154C204.182 55.9102 205.554 53.5571 207.35 51.5522C209.145 49.5495 211.288 47.9451 213.782 46.7427C216.275 45.5404 219.068 44.9396 222.16 44.9396C225.251 44.9396 228.07 45.5404 230.614 46.7427C233.156 47.9451 235.326 49.5487 237.122 51.5522C238.917 53.5571 240.312 55.9102 241.31 58.6154C242.306 61.3205 242.806 64.1758 242.806 67.1821C242.805 70.1868 242.305 73.0421 241.31 75.7472Z" fill="currentColor" />
                        <path d="M438 -3H421.694V102.197H438V-3Z" fill="currentColor" />
                        <path d="M139.43 102.197H155.735V48.2834H183.712V32.1665H139.43V102.197Z" fill="currentColor" />
                        <path d="M324.49 32.1665L303.995 85.794L283.498 32.1665H266.983L293.748 102.197H314.242L341.006 32.1665H324.49Z" fill="currentColor" />
                        <path d="M376.571 30.3656C356.603 30.3656 340.797 46.8497 340.797 67.1828C340.797 89.6597 356.094 104 378.661 104C391.29 104 399.354 99.1488 409.206 88.5848L398.189 80.0226C398.183 80.031 389.874 90.9895 377.468 90.9895C363.048 90.9895 356.977 79.3111 356.977 73.269H411.075C413.917 50.1328 398.775 30.3656 376.571 30.3656ZM357.02 61.0967C357.145 59.7487 359.023 43.3761 376.442 43.3761C393.861 43.3761 395.978 59.7464 396.099 61.0967H357.02Z" fill="currentColor" />
                    </svg>

                    {{-- Light Mode 12 SVG --}}
                    <svg class="w-[448px] max-w-none relative -mt-[4.9rem] -ml-8 lg:ml-0 lg:-mt-[6.6rem] dark:hidden" viewBox="0 0 440 376" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" fill="black" />
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" fill="black" />
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" fill="#F8B803" />
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" fill="#F8B803" />
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" fill="#F0ACB8" />
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" fill="#F0ACB8" />
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g style="mix-blend-mode: plus-darker" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M230.951 281.792L231.282 281.793C238.128 274.907 248.453 265.823 262.256 254.539C275.617 243.256 285.666 234.267 292.402 227.573C299.027 220.688 303.554 213.421 305.983 205.771C308.412 198.12 307.253 190.183 302.504 181.959C297.203 172.778 289.749 165.415 280.142 159.868C270.645 154.13 260.596 151.26 249.995 151.26C239.615 151.26 232.823 154.033 229.621 159.579C226.309 164.934 227.413 172.393 232.935 181.956L168.335 181.954C159.058 165.888 155.082 151.543 156.407 138.92C157.953 126.298 164.247 116.544 175.289 109.659C186.442 102.583 201.294 99.045 219.846 99.0457C239.281 99.0464 258.551 102.585 277.655 109.663C296.649 116.549 313.986 126.303 329.667 138.927C345.349 151.551 357.827 165.895 367.104 181.961C375.718 196.88 379.528 209.981 378.535 221.265C377.762 232.549 374.063 242.399 367.438 250.814C361.033 259.229 351.095 269.557 337.624 281.796L419.782 281.8L448.605 331.719L259.774 331.712L230.951 281.792Z" fill="#F3BEC7" />
                            <path d="M51.8063 152.402L28.9479 152.401L-0.0411453 102.195L85.7608 102.198L218.282 331.711L155.339 331.709L51.8063 152.402Z" fill="#F3BEC7" />
                            <path d="M230.951 281.792L231.282 281.793C238.128 274.907 248.453 265.823 262.256 254.539C275.617 243.256 285.666 234.267 292.402 227.573C299.027 220.688 303.554 213.421 305.983 205.771C308.412 198.12 307.253 190.183 302.504 181.959C297.203 172.778 289.749 165.415 280.142 159.868C270.645 154.13 260.596 151.26 249.995 151.26C239.615 151.26 232.823 154.033 229.621 159.579C226.309 164.934 227.413 172.393 232.935 181.956L168.335 181.954C159.058 165.888 155.082 151.543 156.407 138.92C157.953 126.298 164.247 116.544 175.289 109.659C186.442 102.583 201.294 99.045 219.846 99.0457C239.281 99.0464 258.551 102.585 277.655 109.663C296.649 116.549 313.986 126.303 329.667 138.927C345.349 151.551 357.827 165.895 367.104 181.961C375.718 196.88 379.528 209.981 378.535 221.265C377.762 232.549 374.063 242.399 367.438 250.814C361.033 259.229 351.095 269.557 337.624 281.796L419.782 281.8L448.605 331.719L259.774 331.712L230.951 281.792Z" stroke="#1B1B18" stroke-width="1" />
                            <path d="M51.8063 152.402L28.9479 152.401L-0.0411453 102.195L85.7608 102.198L218.282 331.711L155.339 331.709L51.8063 152.402Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.467 355.363L188.798 355.363C195.644 348.478 205.969 339.393 219.772 328.11C233.133 316.826 243.181 307.837 249.917 301.144C253.696 297.217 256.792 293.166 259.205 288.991C261.024 285.845 262.455 282.628 263.499 279.341C265.928 271.691 264.768 263.753 260.02 255.529C254.719 246.349 247.265 238.985 237.657 233.438C228.16 227.7 218.111 224.831 207.51 224.83C197.13 224.83 190.339 227.603 187.137 233.149C183.824 238.504 184.929 245.963 190.45 255.527L125.851 255.524C116.574 239.458 112.598 225.114 113.923 212.491C114.615 206.836 116.261 201.756 118.859 197.253C122.061 191.704 126.709 187.03 132.805 183.229C143.958 176.153 158.81 172.615 177.362 172.616C196.797 172.617 216.067 176.156 235.171 183.233C254.164 190.119 271.502 199.874 287.183 212.497C302.864 225.121 315.343 239.466 324.62 255.532C333.233 270.45 337.044 283.551 336.05 294.835C335.46 303.459 333.16 311.245 329.151 318.194C327.915 320.337 326.515 322.4 324.953 324.384C318.549 332.799 308.611 343.127 295.139 355.367L377.297 355.37L406.121 405.289L217.29 405.282L188.467 355.363Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M9.32197 225.972L-13.5365 225.971L-42.5255 175.765L43.2765 175.768L175.798 405.282L112.854 405.279L9.32197 225.972Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M345.247 111.915C329.566 99.2919 312.229 89.5371 293.235 82.6512L235.167 183.228C254.161 190.114 271.498 199.869 287.179 212.492L345.247 111.915Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M382.686 154.964C373.41 138.898 360.931 124.553 345.25 111.93L287.182 212.506C302.863 225.13 315.342 239.475 324.618 255.541L382.686 154.964Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M293.243 82.6472C274.139 75.57 254.869 72.031 235.434 72.0303L177.366 172.607C196.801 172.608 216.071 176.147 235.175 183.224L293.243 82.6472Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M394.118 194.257C395.112 182.973 391.301 169.872 382.688 154.953L324.619 255.53C333.233 270.448 337.044 283.55 336.05 294.834L394.118 194.257Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M235.432 72.0311C216.88 72.0304 202.027 75.5681 190.875 82.6442L132.806 183.221C143.959 176.145 158.812 172.607 177.363 172.608L235.432 72.0311Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M265.59 124.25C276.191 124.251 286.24 127.12 295.737 132.858L237.669 233.435C228.172 227.697 218.123 224.828 207.522 224.827L265.59 124.25Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M295.719 132.859C305.326 138.406 312.78 145.77 318.081 154.95L260.013 255.527C254.712 246.347 247.258 238.983 237.651 233.436L295.719 132.859Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M387.218 217.608C391.227 210.66 393.527 202.874 394.117 194.25L336.049 294.827C335.459 303.451 333.159 311.237 329.15 318.185L387.218 217.608Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M245.211 132.577C248.413 127.03 255.204 124.257 265.584 124.258L207.516 224.835C197.136 224.834 190.345 227.607 187.143 233.154L245.211 132.577Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M318.094 154.945C322.842 163.17 324.002 171.107 321.573 178.757L263.505 279.334C265.934 271.684 264.774 263.746 260.026 255.522L318.094 154.945Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M176.925 96.6737C180.127 91.1249 184.776 86.4503 190.871 82.6499L132.803 183.227C126.708 187.027 122.059 191.702 118.857 197.25L176.925 96.6737Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M387.226 217.606C385.989 219.749 384.59 221.813 383.028 223.797L324.96 324.373C326.522 322.39 327.921 320.326 329.157 318.183L387.226 217.606Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M317.269 188.408C319.087 185.262 320.519 182.045 321.562 178.758L263.494 279.335C262.451 282.622 261.019 285.839 259.201 288.985L317.269 188.408Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M245.208 132.573C241.895 137.928 243 145.387 248.522 154.95L190.454 255.527C184.932 245.964 183.827 238.505 187.14 233.15L245.208 132.573Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M176.93 96.6719C174.331 101.175 172.686 106.255 171.993 111.91L113.925 212.487C114.618 206.831 116.263 201.752 118.862 197.249L176.93 96.6719Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M317.266 188.413C314.853 192.589 311.757 196.64 307.978 200.566L249.91 301.143C253.689 297.216 256.785 293.166 259.198 288.99L317.266 188.413Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M464.198 304.708L435.375 254.789L377.307 355.366L406.13 405.285L464.198 304.708Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M353.209 254.787C366.68 242.548 376.618 232.22 383.023 223.805L324.955 324.382C318.55 332.797 308.612 343.124 295.141 355.364L353.209 254.787Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M435.37 254.787L353.212 254.784L295.144 355.361L377.302 355.364L435.37 254.787Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M183.921 154.947L248.521 154.95L190.453 255.527L125.853 255.524L183.921 154.947Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M171.992 111.914C170.668 124.537 174.643 138.881 183.92 154.947L125.852 255.524C116.575 239.458 112.599 225.114 113.924 212.491L171.992 111.914Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M307.987 200.562C301.251 207.256 291.203 216.244 277.842 227.528L219.774 328.105C233.135 316.821 243.183 307.832 249.919 301.139L307.987 200.562Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M15.5469 75.1797L44.5359 125.386L-13.5321 225.963L-42.5212 175.756L15.5469 75.1797Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M277.836 227.536C264.033 238.82 253.708 247.904 246.862 254.789L188.794 355.366C195.64 348.481 205.965 339.397 219.768 328.113L277.836 227.536Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M275.358 304.706L464.189 304.713L406.12 405.29L217.29 405.283L275.358 304.706Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M44.5279 125.39L67.3864 125.39L9.31834 225.967L-13.5401 225.966L44.5279 125.39Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M101.341 75.1911L233.863 304.705L175.795 405.282L43.2733 175.768L101.341 75.1911ZM15.5431 75.19L-42.525 175.767L43.277 175.77L101.345 75.1932L15.5431 75.19Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M246.866 254.784L246.534 254.784L188.466 355.361L188.798 355.361L246.866 254.784Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M246.539 254.781L275.362 304.701L217.294 405.277L188.471 355.358L246.539 254.781Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M67.3906 125.391L170.923 304.698L112.855 405.275L9.32257 225.967L67.3906 125.391Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                            <path d="M170.921 304.699L233.865 304.701L175.797 405.278L112.853 405.276L170.921 304.699Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="bevel" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" fill="#F0ACB8" />
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" stroke="#1B1B18" stroke-width="1" stroke-linejoin="round" />
                        </g>
                        <g style="mix-blend-mode: hard-light" class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" fill="#F0ACB8" />
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" stroke="#1B1B18" stroke-width="1" />
                        </g>
                    </svg>

                    {{-- Dark Mode 12 SVG --}}
                    <svg class="w-[448px] max-w-none relative -mt-[4.9rem] -ml-8 lg:ml-0 lg:-mt-[6.6rem] hidden dark:block" viewBox="0 0 440 376" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" fill="black"/>
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" fill="black"/>
                            <path d="M188.263 355.73L188.595 355.73C195.441 348.845 205.766 339.761 219.569 328.477C232.93 317.193 242.978 308.205 249.714 301.511C256.34 294.626 260.867 287.358 263.296 279.708C265.725 272.058 264.565 264.121 259.816 255.896C254.516 246.716 247.062 239.352 237.454 233.805C227.957 228.067 217.908 225.198 207.307 225.198C196.927 225.197 190.136 227.97 186.934 233.516C183.621 238.872 184.726 246.331 190.247 255.894L125.647 255.891C116.371 239.825 112.395 225.481 113.72 212.858C115.265 200.235 121.559 190.481 132.602 183.596C143.754 176.52 158.607 172.982 177.159 172.983C196.594 172.984 215.863 176.523 234.968 183.6C253.961 190.486 271.299 200.241 286.98 212.864C302.661 225.488 315.14 239.833 324.416 255.899C333.03 270.817 336.841 283.918 335.847 295.203C335.075 306.487 331.376 316.336 324.75 324.751C318.346 333.167 308.408 343.494 294.936 355.734L377.094 355.737L405.917 405.656L217.087 405.649L188.263 355.73Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M9.11884 226.339L-13.7396 226.338L-42.7286 176.132L43.0733 176.135L175.595 405.649L112.651 405.647L9.11884 226.339Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" fill="#391800"/>
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" fill="#391800"/>
                            <path d="M204.592 327.449L204.923 327.449C211.769 320.564 222.094 311.479 235.897 300.196C249.258 288.912 259.306 279.923 266.042 273.23C272.668 266.345 277.195 259.077 279.624 251.427C282.053 243.777 280.893 235.839 276.145 227.615C270.844 218.435 263.39 211.071 253.782 205.524C244.285 199.786 234.236 196.917 223.635 196.916C213.255 196.916 206.464 199.689 203.262 205.235C199.949 210.59 201.054 218.049 206.575 227.612L141.975 227.61C132.699 211.544 128.723 197.2 130.048 184.577C131.593 171.954 137.887 162.2 148.93 155.315C160.083 148.239 174.935 144.701 193.487 144.702C212.922 144.703 232.192 148.242 251.296 155.319C270.289 162.205 287.627 171.96 303.308 184.583C318.989 197.207 331.468 211.552 340.745 227.618C349.358 242.536 353.169 255.637 352.175 266.921C351.403 278.205 347.704 288.055 341.078 296.47C334.674 304.885 324.736 315.213 311.264 327.453L393.422 327.456L422.246 377.375L233.415 377.368L204.592 327.449Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M25.447 198.058L2.58852 198.057L-26.4005 147.851L59.4015 147.854L191.923 377.368L128.979 377.365L25.447 198.058Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" fill="#733000"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" fill="#733000"/>
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.725 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M217.342 305.363L217.673 305.363C224.519 298.478 234.844 289.393 248.647 278.11C262.008 266.826 272.056 257.837 278.792 251.144C285.418 244.259 289.945 236.991 292.374 229.341C294.803 221.691 293.643 213.753 288.895 205.529C283.594 196.349 276.14 188.985 266.532 183.438C257.035 177.7 246.986 174.831 236.385 174.83C226.005 174.83 219.214 177.603 216.012 183.149C212.699 188.504 213.804 195.963 219.325 205.527L154.726 205.524C145.449 189.458 141.473 175.114 142.798 162.491C144.343 149.868 150.637 140.114 161.68 133.229C172.833 126.153 187.685 122.615 206.237 122.616C225.672 122.617 244.942 126.156 264.046 133.233C283.039 140.119 300.377 149.874 316.058 162.497C331.739 175.121 344.218 189.466 353.495 205.532C362.108 220.45 365.919 233.551 364.925 244.835C364.153 256.12 360.454 265.969 353.828 274.384C347.424 282.799 337.486 293.127 324.014 305.367L406.172 305.37L434.996 355.289L246.165 355.282L217.342 305.363Z" stroke="#FF750F" stroke-width="1"/>
                            <path d="M38.197 175.972L15.3385 175.971L-13.6505 125.765L72.1515 125.768L204.673 355.282L141.729 355.279L38.197 175.972Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4">
                            <path d="M188.467 355.363L188.798 355.363C195.644 348.478 205.969 339.393 219.772 328.11C233.133 316.826 243.181 307.837 249.917 301.144C253.696 297.217 256.792 293.166 259.205 288.991C261.024 285.845 262.455 282.628 263.499 279.341C265.928 271.691 264.768 263.753 260.02 255.529C254.719 246.349 247.265 238.985 237.657 233.438C228.16 227.7 218.111 224.831 207.51 224.83C197.13 224.83 190.339 227.603 187.137 233.149C183.824 238.504 184.929 245.963 190.45 255.527L125.851 255.524C116.574 239.458 112.598 225.114 113.923 212.491C114.615 206.836 116.261 201.756 118.859 197.253C122.061 191.704 126.709 187.03 132.805 183.229C143.958 176.153 158.81 172.615 177.362 172.616C196.797 172.617 216.067 176.156 235.171 183.233C254.164 190.119 271.502 199.874 287.183 212.497C302.864 225.121 315.343 239.466 324.62 255.532C333.233 270.45 337.044 283.551 336.05 294.835C335.46 303.459 333.16 311.245 329.151 318.194C327.915 320.337 326.515 322.4 324.953 324.384C318.549 332.799 308.611 343.127 295.139 355.367L377.297 355.37L406.121 405.289L217.29 405.282L188.467 355.363Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M9.32197 225.972L-13.5365 225.971L-42.5255 175.765L43.2765 175.768L175.798 405.282L112.854 405.279L9.32197 225.972Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M345.247 111.915C329.566 99.2919 312.229 89.5371 293.235 82.6512L235.167 183.228C254.161 190.114 271.498 199.869 287.179 212.492L345.247 111.915Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M382.686 154.964C373.41 138.898 360.931 124.553 345.25 111.93L287.182 212.506C302.863 225.13 315.342 239.475 324.618 255.541L382.686 154.964Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M293.243 82.6472C274.139 75.57 254.869 72.031 235.434 72.0303L177.366 172.607C196.801 172.608 216.071 176.147 235.175 183.224L293.243 82.6472Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M394.118 194.257C395.112 182.973 391.301 169.872 382.688 154.953L324.619 255.53C333.233 270.448 337.044 283.55 336.05 294.834L394.118 194.257Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M235.432 72.0311C216.88 72.0304 202.027 75.5681 190.875 82.6442L132.806 183.221C143.959 176.145 158.812 172.607 177.363 172.608L235.432 72.0311Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M265.59 124.25C276.191 124.251 286.24 127.12 295.737 132.858L237.669 233.435C228.172 227.697 218.123 224.828 207.522 224.827L265.59 124.25Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M295.719 132.859C305.326 138.406 312.78 145.77 318.081 154.95L260.013 255.527C254.712 246.347 247.258 238.983 237.651 233.436L295.719 132.859Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M387.218 217.608C391.227 210.66 393.527 202.874 394.117 194.25L336.049 294.827C335.459 303.451 333.159 311.237 329.15 318.185L387.218 217.608Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M245.211 132.577C248.413 127.03 255.204 124.257 265.584 124.258L207.516 224.835C197.136 224.834 190.345 227.607 187.143 233.154L245.211 132.577Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M318.094 154.945C322.842 163.17 324.002 171.107 321.573 178.757L263.505 279.334C265.934 271.684 264.774 263.746 260.026 255.522L318.094 154.945Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M176.925 96.6737C180.127 91.1249 184.776 86.4503 190.871 82.6499L132.803 183.227C126.708 187.027 122.059 191.702 118.857 197.25L176.925 96.6737Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M387.226 217.606C385.989 219.749 384.59 221.813 383.028 223.797L324.96 324.373C326.522 322.39 327.921 320.326 329.157 318.183L387.226 217.606Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M317.269 188.408C319.087 185.262 320.519 182.045 321.562 178.758L263.494 279.335C262.451 282.622 261.019 285.839 259.201 288.985L317.269 188.408Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M245.208 132.573C241.895 137.928 243 145.387 248.522 154.95L190.454 255.527C184.932 245.964 183.827 238.505 187.14 233.15L245.208 132.573Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M176.93 96.6719C174.331 101.175 172.686 106.255 171.993 111.91L113.925 212.487C114.618 206.831 116.263 201.752 118.862 197.249L176.93 96.6719Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M317.266 188.413C314.853 192.589 311.757 196.64 307.978 200.566L249.91 301.143C253.689 297.216 256.785 293.166 259.198 288.99L317.266 188.413Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M464.198 304.708L435.375 254.789L377.307 355.366L406.13 405.285L464.198 304.708Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M353.209 254.787C366.68 242.548 376.618 232.22 383.023 223.805L324.955 324.382C318.55 332.797 308.612 343.124 295.141 355.364L353.209 254.787Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M435.37 254.787L353.212 254.784L295.144 355.361L377.302 355.364L435.37 254.787Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M183.921 154.947L248.521 154.95L190.453 255.527L125.853 255.524L183.921 154.947Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M171.992 111.914C170.668 124.537 174.643 138.881 183.92 154.947L125.852 255.524C116.575 239.458 112.599 225.114 113.924 212.491L171.992 111.914Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M307.987 200.562C301.251 207.256 291.203 216.244 277.842 227.528L219.774 328.105C233.135 316.821 243.183 307.832 249.919 301.139L307.987 200.562Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M15.5469 75.1797L44.5359 125.386L-13.5321 225.963L-42.5212 175.756L15.5469 75.1797Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M277.836 227.536C264.033 238.82 253.708 247.904 246.862 254.789L188.794 355.366C195.64 348.481 205.965 339.397 219.768 328.113L277.836 227.536Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M275.358 304.706L464.189 304.713L406.12 405.29L217.29 405.283L275.358 304.706Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M44.5279 125.39L67.3864 125.39L9.31834 225.967L-13.5401 225.966L44.5279 125.39Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M101.341 75.1911L233.863 304.705L175.795 405.282L43.2733 175.768L101.341 75.1911ZM15.5431 75.19L-42.525 175.767L43.277 175.77L101.345 75.1932L15.5431 75.19Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M246.866 254.784L246.534 254.784L188.466 355.361L188.798 355.361L246.866 254.784Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M246.539 254.781L275.362 304.701L217.294 405.277L188.471 355.358L246.539 254.781Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M67.3906 125.391L170.923 304.698L112.855 405.275L9.32257 225.967L67.3906 125.391Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                            <path d="M170.921 304.699L233.865 304.701L175.797 405.278L112.853 405.276L170.921 304.699Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="bevel"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" fill="#4B0600"/>
                            <path d="M246.544 254.79L246.875 254.79C253.722 247.905 264.046 238.82 277.849 227.537C291.21 216.253 301.259 207.264 307.995 200.57C314.62 193.685 319.147 186.418 321.577 178.768C324.006 171.117 322.846 163.18 318.097 154.956C312.796 145.775 305.342 138.412 295.735 132.865C286.238 127.127 276.189 124.258 265.588 124.257C255.208 124.257 248.416 127.03 245.214 132.576C241.902 137.931 243.006 145.39 248.528 154.953L183.928 154.951C174.652 138.885 170.676 124.541 172 111.918C173.546 99.2946 179.84 89.5408 190.882 82.6559C202.035 75.5798 216.887 72.0421 235.439 72.0428C254.874 72.0435 274.144 75.5825 293.248 82.6598C312.242 89.5457 329.579 99.3005 345.261 111.924C360.942 124.548 373.421 138.892 382.697 154.958C391.311 169.877 395.121 182.978 394.128 194.262C393.355 205.546 389.656 215.396 383.031 223.811C376.627 232.226 366.688 242.554 353.217 254.794L435.375 254.797L464.198 304.716L275.367 304.709L246.544 254.79Z" stroke="#FF750F" stroke-width="1" stroke-linejoin="round"/>
                        </g>
                        <g class="transition-all delay-300 translate-y-0 opacity-100 duration-750 starting:opacity-0 starting:translate-y-4" style="mix-blend-mode:hard-light">
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" fill="#4B0600"/>
                            <path d="M67.41 125.402L44.5515 125.401L15.5625 75.1953L101.364 75.1985L233.886 304.712L170.942 304.71L67.41 125.402Z" stroke="#FF750F" stroke-width="1"/>
                        </g>
                    </svg>
                    <div class="absolute inset-0 rounded-t-lg lg:rounded-t-none lg:rounded-r-lg shadow-[inset_0px_0px_0px_1px_rgba(26,26,0,0.16)] dark:shadow-[inset_0px_0px_0px_1px_#fffaed2d]"></div>
                </div>
            </main>
        </div>

        @if (Route::has('login'))
            <div class="h-14.5 hidden lg:block"></div>
        @endif
    </body>
</html>


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Decor Calculator')

@section('content_header')
    <h1>Decor Calculator</h1>
@stop

@section('content')
<div class="row">
    <div class="col-md-6">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Calculator</h3>
            </div>
            <div class="card-body">
                <form id="calculatorForm">
                    <!-- Category select -->
                    <div class="form-group">
                        <label for="tilesCategory">Tiles Category</label>
                        <select class="form-control select2" id="tilesCategory" style="width: 100%;">
                            <option value="">Select category</option>
                            @foreach($categories as $category)
                                <option value="{{ $category->id }}" 
                                        data-height="{{ $category->height }}" 
                                        data-width="{{ $category->width }}">
                                    {{ $category->name }} ({{ $category->height }}x{{ $category->width }})
                                </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <!-- Main inputs -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="quantity">Total Area</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="quantity" value="100">
                                    <div class="input-group-append">
                                        <span class="input-group-text">sq ft</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="height">Wall Height</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="height" value="7">
                                    <div class="input-group-append">
                                        <span class="input-group-text">feet</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Times inputs -->
                    <div class="card card-info">
                        <div class="card-header">
                            <h3 class="card-title">Times Settings</h3>
                            <div class="card-tools">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="excludeDeep">
                                    <label class="custom-control-label" for="excludeDeep">Exclude Deep</label>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-2">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="lightTimes">Light Times</label>
                                        <input type="number" class="form-control" id="lightTimes" value="4" step="0.1">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="decoTimes">Deco Times</label>
                                        <input type="number" class="form-control" id="decoTimes" value="1" step="0.1">
                                    </div>
                                </div>
                                <div class="col-md-4" id="deepSection">
                                    <div class="form-group">
                                        <label for="deepTimes">Deep Times</label>
                                        <input type="number" class="form-control" id="deepTimes" value="1" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn btn-primary btn-lg btn-block" id="calculateBtn">
                            <i class="fas fa-calculator mr-2"></i>Calculate
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card card-success" id="resultCard" style="display: none;">
            <div class="card-header">
                <h3 class="card-title">Results</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="fas fa-tint"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Light</span>
                                <span class="info-box-number" id="lightResult">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-warning"><i class="fas fa-palette"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Deco</span>
                                <span class="info-box-number" id="decoResult">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4" id="deepResultContainer">
                        <div class="info-box">
                            <span class="info-box-icon bg-danger"><i class="fas fa-layer-group"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Deep</span>
                                <span class="info-box-number" id="deepResult">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="callout callout-success">
                    <h5>Total</h5>
                    <p id="totalResult">0 pcs (0 sq ft)</p>
                </div>
                
                <div class="callout callout-info">
                    <h5>Calculation Details</h5>
                    <div id="calculationDetails">
                        <p>No calculation performed yet.</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-outline card-primary">
                            <div class="card-header">
                                <h3 class="card-title">Distribution</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="chart">
                                    <canvas id="distributionChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    $(function() {
        $('.select2').select2({
            theme: 'bootstrap4'
        });
        
        let distributionChart = null;
        
        // Handle category change
        $('#tilesCategory').on('change', function() {
            const categoryId = this.value;
            if (categoryId) {
                // Load settings from database via AJAX
                fetch(`/admin/decor-calculator/settings/${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            document.getElementById('lightTimes').value = data.light_times || 4;
                            document.getElementById('decoTimes').value = data.deco_times || 1;
                            document.getElementById('deepTimes').value = data.deep_times || 1;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading settings:', error);
                    });
            }
        });
        
        // Handle exclude deep checkbox
        $('#excludeDeep').on('change', function() {
            if (this.checked) {
                $('#deepSection').hide();
                $('#deepResultContainer').hide();
            } else {
                $('#deepSection').show();
                $('#deepResultContainer').show();
            }
        });
        
        // Calculate button click
        $('#calculateBtn').on('click', function() {
            const categoryId = $('#tilesCategory').val();
            if (!categoryId) {
                toastr.error('Please select a tiles category');
                return;
            }
            
            const data = {
                category_id: categoryId,
                quantity: $('#quantity').val(),
                height: $('#height').val(),
                light_times: $('#lightTimes').val(),
                light_qty: 1,
                deco_times: $('#decoTimes').val(),
                deco_qty: 1,
                deep_times: $('#deepTimes').val(),
                deep_qty: 1,
                exclude_deep: $('#excludeDeep').prop('checked')
            };
            
            fetch('/admin/decor-calculator/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(response => {
                // Display results
                $('#lightResult').text(`${Math.round(response.light_quantity)} pcs (${response.light_sqft.toFixed(2)} sq ft)`);
                $('#decoResult').text(`${Math.round(response.deco_quantity)} pcs (${response.deco_sqft.toFixed(2)} sq ft)`);
                $('#deepResult').text(`${Math.round(response.deep_quantity)} pcs (${response.deep_sqft.toFixed(2)} sq ft)`);
                
                // Show total
                $('#totalResult').text(`${Math.round(response.total_tiles)} pcs (${response.total_sqft.toFixed(2)} sq ft)`);
                
                // Show calculation details
                $('#calculationDetails').html(`
                    <table class="table table-sm">
                        <tr>
                            <td>Vertical Tiles:</td>
                            <td>${response.total_vertical_tiles.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Horizontal Tiles:</td>
                            <td>${response.horizontal_tiles.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Distribution:</td>
                            <td>${response.light_rows.toFixed(1)} Light, ${response.deco_rows} Deco, ${response.deep_rows.toFixed(1)} Deep</td>
                        </tr>
                    </table>
                `);
                
                // Show the result card
                $('#resultCard').show();
                
                // Update chart
                updateDistributionChart(response);
            })
            .catch(error => {
                toastr.error('Error in calculation. Please check your inputs.');
                console.error('Calculation error:', error);
            });
        });
        
        function updateDistributionChart(data) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            // Create new chart
            distributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Light', 'Deco', 'Deep'],
                    datasets: [{
                        data: [
                            Math.round(data.light_quantity), 
                            Math.round(data.deco_quantity), 
                            Math.round(data.deep_quantity)
                        ],
                        backgroundColor: [
                            'rgba(60, 141, 188, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgba(60, 141, 188, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} pcs (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
    });
</script>
@stop


--- Contents of business.blade.php ---
@extends('adminlte::page')

@section('title', 'Business Settings')

@section('content_header')
    <h1>Business Settings</h1>
@stop

@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Customize Your Business Information</h3>
    </div>
    <div class="card-body">
        @if (session('success'))
            <div class="alert alert-success">{{ session('success') }}</div>
        @endif

        <form action="{{ route('business-settings.update') }}" method="POST" enctype="multipart/form-data">
            @csrf
            @method('PUT')
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="business_name">Business Name</label>
                        <input type="text" name="business_name" class="form-control" value="{{ old('business_name', $settings->business_name) }}" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" name="email" class="form-control" value="{{ old('email', $settings->email) }}">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="text" name="phone" class="form-control" value="{{ old('phone', $settings->phone) }}" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bin_number">BIN Number</label>
                        <input type="text" name="bin_number" class="form-control" value="{{ old('bin_number', $settings->bin_number) }}">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="address">Address</label>
                <input type="text" name="address" class="form-control" value="{{ old('address', $settings->address) }}">
            </div>

            <div class="form-group">
                <label for="logo">Company Logo</label>
                @if($settings->logo)
                    <div class="mb-2">
                        <img src="{{ Storage::url($settings->logo) }}" style="max-height: 100px;">
                    </div>
                @endif
                <div class="input-group">
                    <div class="custom-file">
                        <input type="file" name="logo" class="custom-file-input" id="logo">
                        <label class="custom-file-label" for="logo">Choose file</label>
                    </div>
                </div>
                <small class="form-text text-muted">Recommended size: 200x200px</small>
            </div>

            <div class="form-group">
                <label for="bank_details">Bank Details</label>
                <textarea name="bank_details" class="form-control" rows="4">{{ old('bank_details', $settings->bank_details) }}</textarea>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="return_policy_days">Return Policy Days</label>
                        <input type="number" name="return_policy_days" class="form-control" value="{{ old('return_policy_days', $settings->return_policy_days) }}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="return_policy_message">Return Policy Message</label>
                        <input type="text" name="return_policy_message" class="form-control" value="{{ old('return_policy_message', $settings->return_policy_message) }}">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="footer_message">Footer Message</label>
                <input type="text" name="footer_message" class="form-control" value="{{ old('footer_message', $settings->footer_message) }}">
            </div>

            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>
</div>
@stop

@section('js')
<script>
    $(document).ready(function() {
        // Show filename in custom file input
        $(".custom-file-input").on("change", function() {
            var fileName = $(this).val().split("\\").pop();
            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
        });
    });
</script>
@stop

--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Add Tiles Category')

@section('content_header')
    <h1>Add New Tiles Category</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            <form action="{{ route('admin.tiles-categories.store') }}" method="POST">
                @csrf
                
                <div class="form-group">
                    <label for="name">Category Name</label>
                    <input type="text" name="name" id="name" class="form-control @error('name') is-invalid @enderror" 
                           value="{{ old('name') }}" placeholder="e.g. 12x24" required>
                    <small class="form-text text-muted">You can use format like 12x24 to auto-fill dimensions</small>
                    @error('name')
                        <div class="invalid-feedback">{{ $message }}</div>
                    @enderror
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="height">Height (inches)</label>
                            <input type="number" name="height" id="height" step="0.01" 
                                   class="form-control @error('height') is-invalid @enderror" 
                                   value="{{ old('height') }}">
                            @error('height')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="width">Width (inches)</label>
                            <input type="number" name="width" id="width" step="0.01" 
                                   class="form-control @error('width') is-invalid @enderror" 
                                   value="{{ old('width') }}">
                            @error('width')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Category</button>
                    <a href="{{ route('admin.tiles-categories.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('js')
    <script>
        // Auto-extract dimensions from name
        document.getElementById('name').addEventListener('blur', function() {
            const name = this.value;
            const match = name.match(/(\d+)x(\d+)/i);
            
            if (match && match.length === 3) {
                document.getElementById('height').value = match[1];
                document.getElementById('width').value = match[2];
            }
        });
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Tiles Category')

@section('content_header')
    <h1>Edit Tiles Category</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            <form action="{{ route('admin.tiles-categories.update', $category) }}" method="POST">
                @csrf
                @method('PUT')
                
                <div class="form-group">
                    <label for="name">Category Name</label>
                    <input type="text" name="name" id="name" class="form-control @error('name') is-invalid @enderror" 
                           value="{{ old('name', $category->name) }}" required>
                    <small class="form-text text-muted">You can use format like 12x24 to auto-fill dimensions</small>
                    @error('name')
                        <div class="invalid-feedback">{{ $message }}</div>
                    @enderror
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="height">Height (inches)</label>
                            <input type="number" name="height" id="height" step="0.01" 
                                   class="form-control @error('height') is-invalid @enderror" 
                                   value="{{ old('height', $category->height) }}">
                            @error('height')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="width">Width (inches)</label>
                            <input type="number" name="width" id="width" step="0.01" 
                                   class="form-control @error('width') is-invalid @enderror" 
                                   value="{{ old('width', $category->width) }}">
                            @error('width')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update Category</button>
                    <a href="{{ route('admin.tiles-categories.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
    
    <div class="card mt-4">
        <div class="card-header">
            <h3 class="card-title">Calculation Settings</h3>
        </div>
        <div class="card-body">
            <form action="{{ route('admin.tiles-categories.settings', $category) }}" method="POST">
                @csrf
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="light_times">Light Times</label>
                            <input type="number" name="light_times" id="light_times" step="0.01" 
                                   class="form-control" 
                                   value="{{ $settings->light_times ?? 4 }}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="deco_times">Deco Times</label>
                            <input type="number" name="deco_times" id="deco_times" step="0.01" 
                                   class="form-control" 
                                   value="{{ $settings->deco_times ?? 1 }}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="deep_times">Deep Times</label>
                            <input type="number" name="deep_times" id="deep_times" step="0.01" 
                                   class="form-control" 
                                   value="{{ $settings->deep_times ?? 1 }}">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-success">Save Settings</button>
                </div>
            </form>
        </div>
    </div>
@stop

@section('js')
    <script>
        // Auto-extract dimensions from name
        document.getElementById('name').addEventListener('blur', function() {
            const name = this.value;
            const match = name.match(/(\d+)x(\d+)/i);
            
            if (match && match.length === 3) {
                document.getElementById('height').value = match[1];
                document.getElementById('width').value = match[2];
            }
        });
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Tiles Categories')

@section('content_header')
    <h1>Tiles Categories</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <a href="{{ route('admin.tiles-categories.create') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add New Category
            </a>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Height</th>
                        <th>Width</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($categories as $category)
                    <tr>
                        <td>{{ $category->id }}</td>
                        <td>{{ $category->name }}</td>
                        <td>{{ $category->height }}</td>
                        <td>{{ $category->width }}</td>
                        <td>{{ $category->created_at->format('Y-m-d H:i') }}</td>
                        <td>
                            <a href="{{ route('admin.tiles-categories.edit', $category) }}" class="btn btn-sm btn-info">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <form action="{{ route('admin.tiles-categories.destroy', $category) }}" method="POST" style="display: inline-block;">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this category?')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script>
        $(document).ready(function() {
            $('.table').DataTable({
                "responsive": true,
                "autoWidth": false,
            });
        });
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Tiles Calculation Settings')

@section('content_header')
    <h1>Tiles Calculation Settings</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createSettingsModal">
                <i class="fas fa-plus"></i> Add New Settings
            </button>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped datatable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Category</th>
                        <th>Light Times</th>
                        <th>Deco Times</th>
                        <th>Deep Times</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($settings as $setting)
                    <tr>
                        <td>{{ $setting->id }}</td>
                        <td>{{ $setting->category->name }}</td>
                        <td>{{ $setting->light_times }}</td>
                        <td>{{ $setting->deco_times }}</td>
                        <td>{{ $setting->deep_times }}</td>
                        <td>
                            <button type="button" class="btn btn-sm btn-info edit-btn" 
                                data-id="{{ $setting->id }}"
                                data-category="{{ $setting->tiles_category_id }}"
                                data-light="{{ $setting->light_times }}"
                                data-deco="{{ $setting->deco_times }}"
                                data-deep="{{ $setting->deep_times }}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <form action="{{ route('admin.tiles-settings.destroy', $setting->id) }}" method="POST" style="display: inline-block;">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete these settings?')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create Settings Modal -->
    <div class="modal fade" id="createSettingsModal" tabindex="-1" role="dialog" aria-labelledby="createSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createSettingsModalLabel">Add New Calculation Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="{{ route('admin.tiles-settings.store') }}" method="POST">
                    @csrf
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="tiles_category_id">Tiles Category</label>
                            <select name="tiles_category_id" id="tiles_category_id" class="form-control" required>
                                <option value="">Select Category</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}">{{ $category->name }} ({{ $category->height }}x{{ $category->width }})</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="light_times">Light Times</label>
                                    <input type="number" step="0.01" name="light_times" id="light_times" class="form-control" value="4" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="deco_times">Deco Times</label>
                                    <input type="number" step="0.01" name="deco_times" id="deco_times" class="form-control" value="1" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="deep_times">Deep Times</label>
                                    <input type="number" step="0.01" name="deep_times" id="deep_times" class="form-control" value="1" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Settings Modal -->
    <div class="modal fade" id="editSettingsModal" tabindex="-1" role="dialog" aria-labelledby="editSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSettingsModalLabel">Edit Calculation Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="editSettingsForm" method="POST">
                    @csrf
                    @method('PUT')
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit_tiles_category_id">Tiles Category</label>
                            <select name="tiles_category_id" id="edit_tiles_category_id" class="form-control" required>
                                <option value="">Select Category</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}">{{ $category->name }} ({{ $category->height }}x{{ $category->width }})</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="edit_light_times">Light Times</label>
                                    <input type="number" step="0.01" name="light_times" id="edit_light_times" class="form-control" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="edit_deco_times">Deco Times</label>
                                    <input type="number" step="0.01" name="deco_times" id="edit_deco_times" class="form-control" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="edit_deep_times">Deep Times</label>
                                    <input type="number" step="0.01" name="deep_times" id="edit_deep_times" class="form-control" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Update Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.datatable').DataTable({
                "responsive": true,
                "autoWidth": false,
            });
            
            // Handle edit button click
            $('.edit-btn').click(function() {
                const id = $(this).data('id');
                const categoryId = $(this).data('category');
                const lightTimes = $(this).data('light');
                const decoTimes = $(this).data('deco');
                const deepTimes = $(this).data('deep');
                
                $('#edit_tiles_category_id').val(categoryId);
                $('#edit_light_times').val(lightTimes);
                $('#edit_deco_times').val(decoTimes);
                $('#edit_deep_times').val(deepTimes);
                
                $('#editSettingsForm').attr('action', `/admin/tiles-settings/${id}`);
                $('#editSettingsModal').modal('show');
            });
        });
    </script>
@stop


--- Contents of confirm-password.blade.php ---
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('This is a secure area of the application. Please confirm your password before continuing.') }}
    </div>

    <form method="POST" action="{{ route('password.confirm') }}">
        @csrf

        <!-- Password -->
        <div>
            <x-input-label for="password" :value="__('Password')" />

            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="current-password" />

            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="flex justify-end mt-4">
            <x-primary-button>
                {{ __('Confirm') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


--- Contents of forgot-password.blade.php ---
@extends('adminlte::auth.auth-page', ['auth_type' => 'login'])

@section('title', 'Password Reset - ERP System')

@section('auth_header', 'Reset Password')

@section('auth_body')
    @if (session('status'))
        <div class="alert alert-success" role="alert">
            {{ session('status') }}
        </div>
    @endif

    <p class="login-box-msg">Enter your email to receive a password reset link.</p>

    <form method="POST" action="{{ route('password.email') }}">
        @csrf

        {{-- Email field --}}
        <div class="input-group mb-3">
            <input type="email" name="email" class="form-control @error('email') is-invalid @enderror"
                   value="{{ old('email') }}" placeholder="Email" autofocus>
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-envelope"></span>
                </div>
            </div>
            @error('email')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Send reset link button --}}
        <button type="submit" class="btn btn-primary btn-block">
            Send Password Reset Link
        </button>
    </form>
@stop

@section('auth_footer')
    <p class="my-0">
        <a href="{{ route('login') }}">
            Back to login
        </a>
    </p>
@stop


--- Contents of login.blade.php ---
@extends('adminlte::auth.login')

@section('title', 'Login - ERP System')

@section('auth_header', 'Sign in to your account')

@section('auth_body')
    <form method="POST" action="{{ route('login') }}">
        @csrf

        {{-- Email field --}}
        <div class="input-group mb-3">
            <input type="email" name="email" class="form-control @error('email') is-invalid @enderror"
                   value="{{ old('email') }}" placeholder="Email" autofocus>
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-envelope"></span>
                </div>
            </div>
            @error('email')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Password field --}}
        <div class="input-group mb-3">
            <input type="password" name="password" class="form-control @error('password') is-invalid @enderror"
                   placeholder="Password">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
            @error('password')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Remember Me --}}
        <div class="row">
            <div class="col-8">
                <div class="icheck-primary">
                    <input type="checkbox" name="remember" id="remember" {{ old('remember') ? 'checked' : '' }}>
                    <label for="remember">Remember Me</label>
                </div>
            </div>
            <div class="col-4">
                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
            </div>
        </div>
    </form>
@stop

@section('auth_footer')
    <p class="my-0">
        <a href="{{ route('password.request') }}">
            Forgot your password?
        </a>
    </p>
    {{-- <p class="my-0">
        <a href="{{ route('register') }}">
            Register a new account
        </a>
    </p> --}}
@stop


--- Contents of register.blade.php ---
@extends('adminlte::auth.register')

@section('title', 'Register - ERP System')

@section('auth_header', 'Register a new account')

@section('auth_body')
    <form method="POST" action="{{ route('register') }}">
        @csrf

        {{-- Name field --}}
        <div class="input-group mb-3">
            <input type="text" name="name" class="form-control @error('name') is-invalid @enderror"
                   value="{{ old('name') }}" placeholder="Full name" autofocus>
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-user"></span>
                </div>
            </div>
            @error('name')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Email field --}}
        <div class="input-group mb-3">
            <input type="email" name="email" class="form-control @error('email') is-invalid @enderror"
                   value="{{ old('email') }}" placeholder="Email">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-envelope"></span>
                </div>
            </div>
            @error('email')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Password field --}}
        <div class="input-group mb-3">
            <input type="password" name="password" class="form-control @error('password') is-invalid @enderror"
                   placeholder="Password">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
            @error('password')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Confirm password field --}}
        <div class="input-group mb-3">
            <input type="password" name="password_confirmation" class="form-control"
                   placeholder="Confirm password">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
        </div>

        {{-- Register button --}}
        <button type="submit" class="btn btn-primary btn-block">
            Register
        </button>
    </form>
@stop

@section('auth_footer')
    <p class="my-0">
        <a href="{{ route('login') }}">
            I already have an account
        </a>
    </p>
@stop


--- Contents of reset-password.blade.php ---
@extends('adminlte::auth.auth-page', ['auth_type' => 'login'])

@section('title', 'Reset Password - ERP System')

@section('auth_header', 'Reset Password')

@section('auth_body')
    <form method="POST" action="{{ route('password.update') }}">
        @csrf

        {{-- Hidden Token field --}}
        <input type="hidden" name="token" value="{{ $request->route('token') }}">

        {{-- Email field --}}
        <div class="input-group mb-3">
            <input type="email" name="email" class="form-control @error('email') is-invalid @enderror"
                   value="{{ $request->email ?? old('email') }}" placeholder="Email" readonly>
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-envelope"></span>
                </div>
            </div>
            @error('email')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Password field --}}
        <div class="input-group mb-3">
            <input type="password" name="password" class="form-control @error('password') is-invalid @enderror"
                   placeholder="New Password" autofocus>
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
            @error('password')
                <span class="invalid-feedback" role="alert">
                    <strong>{{ $message }}</strong>
                </span>
            @enderror
        </div>

        {{-- Confirm password field --}}
        <div class="input-group mb-3">
            <input type="password" name="password_confirmation" class="form-control"
                   placeholder="Confirm New Password">
            <div class="input-group-append">
                <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                </div>
            </div>
        </div>

        {{-- Reset password button --}}
        <button type="submit" class="btn btn-primary btn-block">
            Reset Password
        </button>
    </form>
@stop

@section('auth_footer')
    <p class="my-0">
        <a href="{{ route('login') }}">
            Back to login
        </a>
    </p>
@stop


--- Contents of verify-email.blade.php ---
@extends('adminlte::page')

@section('title', 'Verify Email - ERP System')

@section('content_header')
    <h1>Verify Your Email Address</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if (session('status') == 'verification-link-sent')
                <div class="alert alert-success" role="alert">
                    A new verification link has been sent to the email address you provided during registration.
                </div>
            @endif

            <p>Before proceeding, please check your email for a verification link. If you did not receive the email, click the button below to request another.</p>

            <form method="POST" action="{{ route('verification.send') }}">
                @csrf
                <button type="submit" class="btn btn-primary">
                    Resend Verification Email
                </button>
            </form>

            <form method="POST" action="{{ route('logout') }}" class="mt-3">
                @csrf
                <button type="submit" class="btn btn-link">
                    Log Out
                </button>
            </form>
        </div>
    </div>
@stop


--- Contents of verify.blade.php ---
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">{{ __('Verify Your Email Address') }}</div>

                <div class="card-body">
                    @if (session('resent'))
                        <div class="alert alert-success" role="alert">
                            {{ __('A fresh verification link has been sent to your email address.') }}
                        </div>
                    @endif

                    {{ __('Before proceeding, please check your email for a verification link.') }}
                    {{ __('If you did not receive the email') }},
                    <form class="d-inline" method="POST" action="{{ route('verification.resend') }}">
                        @csrf
                        <button type="submit" class="btn btn-link p-0 m-0 align-baseline">{{ __('click here to request another') }}</button>.
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection


--- Contents of confirm.blade.php ---
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">{{ __('Confirm Password') }}</div>

                <div class="card-body">
                    {{ __('Please confirm your password before continuing.') }}

                    <form method="POST" action="{{ route('password.confirm') }}">
                        @csrf

                        <div class="row mb-3">
                            <label for="password" class="col-md-4 col-form-label text-md-end">{{ __('Password') }}</label>

                            <div class="col-md-6">
                                <input id="password" type="password" class="form-control @error('password') is-invalid @enderror" name="password" required autocomplete="current-password">

                                @error('password')
                                    <span class="invalid-feedback" role="alert">
                                        <strong>{{ $message }}</strong>
                                    </span>
                                @enderror
                            </div>
                        </div>

                        <div class="row mb-0">
                            <div class="col-md-8 offset-md-4">
                                <button type="submit" class="btn btn-primary">
                                    {{ __('Confirm Password') }}
                                </button>

                                @if (Route::has('password.request'))
                                    <a class="btn btn-link" href="{{ route('password.request') }}">
                                        {{ __('Forgot Your Password?') }}
                                    </a>
                                @endif
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection


--- Contents of email.blade.php ---
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">{{ __('Reset Password') }}</div>

                <div class="card-body">
                    @if (session('status'))
                        <div class="alert alert-success" role="alert">
                            {{ session('status') }}
                        </div>
                    @endif

                    <form method="POST" action="{{ route('password.email') }}">
                        @csrf

                        <div class="row mb-3">
                            <label for="email" class="col-md-4 col-form-label text-md-end">{{ __('Email Address') }}</label>

                            <div class="col-md-6">
                                <input id="email" type="email" class="form-control @error('email') is-invalid @enderror" name="email" value="{{ old('email') }}" required autocomplete="email" autofocus>

                                @error('email')
                                    <span class="invalid-feedback" role="alert">
                                        <strong>{{ $message }}</strong>
                                    </span>
                                @enderror
                            </div>
                        </div>

                        <div class="row mb-0">
                            <div class="col-md-6 offset-md-4">
                                <button type="submit" class="btn btn-primary">
                                    {{ __('Send Password Reset Link') }}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection


--- Contents of reset.blade.php ---
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">{{ __('Reset Password') }}</div>

                <div class="card-body">
                    <form method="POST" action="{{ route('password.update') }}">
                        @csrf

                        <input type="hidden" name="token" value="{{ $token }}">

                        <div class="row mb-3">
                            <label for="email" class="col-md-4 col-form-label text-md-end">{{ __('Email Address') }}</label>

                            <div class="col-md-6">
                                <input id="email" type="email" class="form-control @error('email') is-invalid @enderror" name="email" value="{{ $email ?? old('email') }}" required autocomplete="email" autofocus>

                                @error('email')
                                    <span class="invalid-feedback" role="alert">
                                        <strong>{{ $message }}</strong>
                                    </span>
                                @enderror
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="password" class="col-md-4 col-form-label text-md-end">{{ __('Password') }}</label>

                            <div class="col-md-6">
                                <input id="password" type="password" class="form-control @error('password') is-invalid @enderror" name="password" required autocomplete="new-password">

                                @error('password')
                                    <span class="invalid-feedback" role="alert">
                                        <strong>{{ $message }}</strong>
                                    </span>
                                @enderror
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="password-confirm" class="col-md-4 col-form-label text-md-end">{{ __('Confirm Password') }}</label>

                            <div class="col-md-6">
                                <input id="password-confirm" type="password" class="form-control" name="password_confirmation" required autocomplete="new-password">
                            </div>
                        </div>

                        <div class="row mb-0">
                            <div class="col-md-6 offset-md-4">
                                <button type="submit" class="btn btn-primary">
                                    {{ __('Reset Password') }}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection


--- Contents of close.blade.php ---
@extends('adminlte::page')

@section('title', 'Close Cash Register')

@section('content_header')
    <h1>Close Cash Register #{{ $cashRegister->id }}</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Close Cash Register</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon bg-info"><i class="fas fa-money-bill-wave"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Opening Balance</span>
                                    <span class="info-box-number">{{ number_format($cashRegister->opening_balance, 2) }} Tk</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon bg-success"><i class="fas fa-calculator"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Expected Closing Balance</span>
                                    <span class="info-box-number">{{ number_format($cashRegister->expected_closing_balance, 2) }} Tk</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form action="{{ route('cash-registers.process-close', $cashRegister->id) }}" method="POST">
                        @csrf
                        <div class="form-group">
                            <label for="actual_closing_balance">Actual Closing Balance (Taka)</label>
                            <input type="number" step="0.01" class="form-control @error('actual_closing_balance') is-invalid @enderror" 
                                id="actual_closing_balance" name="actual_closing_balance" value="{{ old('actual_closing_balance') }}" required>
                            <small class="form-text text-muted">Enter the actual amount of cash in the register.</small>
                            @error('actual_closing_balance')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                        <div class="form-group">
                            <label for="closing_notes">Closing Notes</label>
                            <textarea class="form-control @error('closing_notes') is-invalid @enderror" 
                                id="closing_notes" name="closing_notes" rows="3">{{ old('closing_notes') }}</textarea>
                            <small class="form-text text-muted">Please explain any discrepancies between expected and actual balances.</small>
                            @error('closing_notes')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-lock"></i> Close Register
                        </button>
                        <a href="{{ route('cash-registers.show', $cashRegister->id) }}" class="btn btn-default">
                            <i class="fas fa-arrow-left"></i> Back
                        </a>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Transaction Summary</h3>
                </div>
                <div class="card-body p-0">
                    <table class="table">
                        <tr>
                            <td>Sales</td>
                            <td class="text-right">{{ number_format($cashRegister->transactions->where('transaction_type', 'sale')->sum('amount'), 2) }}</td>
                        </tr>
                        <tr>
                            <td>Returns</td>
                            <td class="text-right">{{ number_format($cashRegister->transactions->where('transaction_type', 'return')->sum('amount'), 2) }}</td>
                        </tr>
                        <tr>
                            <td>Expenses</td>
                            <td class="text-right">{{ number_format($cashRegister->transactions->where('transaction_type', 'expense')->sum('amount'), 2) }}</td>
                        </tr>
                        <tr>
                            <td>Deposits</td>
                            <td class="text-right">{{ number_format($cashRegister->transactions->where('transaction_type', 'deposit')->sum('amount'), 2) }}</td>
                        </tr>
                        <tr>
                            <td>Withdrawals</td>
                            <td class="text-right">{{ number_format($cashRegister->transactions->where('transaction_type', 'withdrawal')->sum('amount'), 2) }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Instructions</h3>
                </div>
                <div class="card-body">
                    <ol>
                        <li>Count all cash in the register</li>
                        <li>Enter the total as the actual closing balance</li>
                        <li>Provide notes for any discrepancies</li>
                        <li>Click "Close Register" to finalize</li>
                    </ol>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> This action cannot be undone.
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Cash Registers')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Cash Registers</h1>
        <a href="{{ route('cash-registers.open') }}" class="btn btn-primary">
            <i class="fas fa-cash-register"></i> Open New Register
        </a>
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Cash Registers</h3>
            <div class="card-tools">
                <form action="{{ route('cash-registers.index') }}" method="GET" class="form-inline">
                    <div class="input-group input-group-sm mr-2">
                        <input type="date" name="date_from" class="form-control" value="{{ request('date_from') }}">
                        <div class="input-group-append">
                            <span class="input-group-text">to</span>
                        </div>
                        <input type="date" name="date_to" class="form-control" value="{{ request('date_to') }}">
                    </div>
                    
                    <div class="input-group input-group-sm mr-2">
                        <select name="user_id" class="form-control">
                            <option value="">All Users</option>
                            @foreach($users as $user)
                                <option value="{{ $user->id }}" {{ request('user_id') == $user->id ? 'selected' : '' }}>
                                    {{ $user->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="input-group input-group-sm mr-2">
                        <select name="status" class="form-control">
                            <option value="">All Statuses</option>
                            <option value="open" {{ request('status') == 'open' ? 'selected' : '' }}>Open</option>
                            <option value="closed" {{ request('status') == 'closed' ? 'selected' : '' }}>Closed</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-sm btn-default">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                </form>
            </div>
        </div>
        <div class="card-body">
            <table id="cash-registers-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Opened At</th>
                        <th>Closed At</th>
                        <th>Opening Balance</th>
                        <th>Expected Closing</th>
                        <th>Actual Closing</th>
                        <th>Variance</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- DataTables will fill this -->
                </tbody>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#cash-registers-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{{ route('cash-registers.index') }}",
                    data: function(d) {
                        d.date_from = $('input[name="date_from"]').val();
                        d.date_to = $('input[name="date_to"]').val();
                        d.user_id = $('select[name="user_id"]').val();
                        d.status = $('select[name="status"]').val();
                    }
                },
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'user_name', name: 'user_name' },
                    { data: 'opened_at', name: 'opened_at' },
                    { data: 'closed_at', name: 'closed_at' },
                    { data: 'opening_balance', name: 'opening_balance' },
                    { data: 'expected_closing_balance', name: 'expected_closing_balance' },
                    { data: 'actual_closing_balance', name: 'actual_closing_balance' },
                    { data: 'variance', name: 'variance' },
                    { data: 'status', name: 'status' },
                    { data: 'action', name: 'action', orderable: false, searchable: false }
                ],
                order: [[2, 'desc']]
            });
        });
    </script>
@stop


--- Contents of open.blade.php ---
@extends('adminlte::page')

@section('title', 'Open Cash Register')

@section('content_header')
    <h1>Open Cash Register</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Open Cash Register</h3>
                </div>
                <div class="card-body">
                    <form action="{{ route('cash-registers.store') }}" method="POST">
                        @csrf
                        <div class="form-group">
                            <label for="opening_balance">Opening Balance (Taka)</label>
                            <input type="number" step="0.01" class="form-control @error('opening_balance') is-invalid @enderror" 
                                id="opening_balance" name="opening_balance" value="{{ old('opening_balance') }}" required>
                            @error('opening_balance')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea class="form-control @error('notes') is-invalid @enderror" 
                                id="notes" name="notes" rows="3">{{ old('notes') }}</textarea>
                            @error('notes')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-cash-register"></i> Open Register
                        </button>
                        <a href="{{ route('cash-registers.index') }}" class="btn btn-default">
                            <i class="fas fa-arrow-left"></i> Back
                        </a>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Instructions</h3>
                </div>
                <div class="card-body">
                    <p>Please follow these steps to open a cash register:</p>
                    <ol>
                        <li>Count the physical cash in your drawer</li>
                        <li>Enter the total amount as the opening balance</li>
                        <li>Add any relevant notes about the cash condition</li>
                        <li>Click "Open Register" to start your session</li>
                    </ol>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> You can only have one open register at a time.
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop


--- Contents of report.blade.php ---
@extends('adminlte::page')

@section('title', 'Cash Register Reports')

@section('content_header')
    <h1>Cash Register Reports</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Daily Report</h3>
                    <div class="card-tools">
                        <form action="{{ route('cash-registers.report') }}" method="GET" class="form-inline">
                            <div class="input-group input-group-sm">
                                <input type="date" name="date" class="form-control" value="{{ $date }}">
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-default">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon bg-info"><i class="fas fa-door-open"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Opened</span>
                                    <span class="info-box-number">{{ $summary['total_opened'] }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon bg-warning"><i class="fas fa-door-closed"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Closed</span>
                                    <span class="info-box-number">{{ $summary['total_closed'] }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon bg-success"><i class="fas fa-money-bill-wave"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Opening</span>
                                    <span class="info-box-number">{{ number_format($summary['total_opening_balance'], 2) }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon bg-primary"><i class="fas fa-calculator"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Expected</span>
                                    <span class="info-box-number">{{ number_format($summary['total_expected_closing'], 2) }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon bg-secondary"><i class="fas fa-cash-register"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Actual</span>
                                    <span class="info-box-number">{{ number_format($summary['total_actual_closing'], 2) }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="info-box">
                                <span class="info-box-icon {{ $summary['total_variance'] >= 0 ? 'bg-success' : 'bg-danger' }}">
                                    <i class="fas fa-balance-scale"></i>
                                </span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Variance</span>
                                    <span class="info-box-number">{{ number_format($summary['total_variance'], 2) }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Transaction Summary</h3>
                                </div>
                                <div class="card-body p-0">
                                    <table class="table">
                                        <tr>
                                            <td>Sales</td>
                                            <td class="text-right">{{ number_format($transactionTotals['sale'] ?? 0, 2) }}</td>
                                        </tr>
                                        <tr>
                                            <td>Returns</td>
                                            <td class="text-right">{{ number_format($transactionTotals['return'] ?? 0, 2) }}</td>
                                        </tr>
                                        <tr>
                                            <td>Expenses</td>
                                            <td class="text-right">{{ number_format($transactionTotals['expense'] ?? 0, 2) }}</td>
                                        </tr>
                                        <tr>
                                            <td>Deposits</td>
                                            <td class="text-right">{{ number_format($transactionTotals['deposit'] ?? 0, 2) }}</td>
                                        </tr>
                                        <tr>
                                            <td>Withdrawals</td>
                                            <td class="text-right">{{ number_format($transactionTotals['withdrawal'] ?? 0, 2) }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <canvas id="transactionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Register Details</h3>
                </div>
                <div class="card-body">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Opening Balance</th>
                                <th>Expected Closing</th>
                                <th>Actual Closing</th>
                                <th>Variance</th>
                                <th>Opened At</th>
                                <th>Closed At</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($registers as $register)
                            <tr>
                                <td>{{ $register->id }}</td>
                                <td>{{ $register->user->name }}</td>
                                <td>{{ number_format($register->opening_balance, 2) }}</td>
                                <td>{{ number_format($register->expected_closing_balance, 2) }}</td>
                                <td>{{ $register->actual_closing_balance ? number_format($register->actual_closing_balance, 2) : '-' }}</td>
                                <td class="{{ $register->variance > 0 ? 'text-success' : ($register->variance < 0 ? 'text-danger' : '') }}">
                                    {{ $register->variance ? number_format($register->variance, 2) : '-' }}
                                </td>
                                <td>{{ $register->opened_at->format('H:i:s') }}</td>
                                <td>{{ $register->closed_at ? $register->closed_at->format('H:i:s') : '-' }}</td>
                                <td>
                                    <span class="badge {{ $register->status === 'open' ? 'badge-success' : 'badge-secondary' }}">
                                        {{ ucfirst($register->status) }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{{ route('cash-registers.show', $register->id) }}" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('transactionChart').getContext('2d');
            
            // Get transaction data from PHP
            const transactionData = {
                'sale': {{ $transactionTotals['sale'] ?? 0 }},
                'return': {{ $transactionTotals['return'] ?? 0 }},
                'expense': {{ $transactionTotals['expense'] ?? 0 }},
                'deposit': {{ $transactionTotals['deposit'] ?? 0 }},
                'withdrawal': {{ $transactionTotals['withdrawal'] ?? 0 }}
            };
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(transactionData).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                    datasets: [{
                        label: 'Transaction Amounts (Taka)',
                        data: Object.values(transactionData),
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(153, 102, 255, 0.6)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Transaction Distribution'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Cash Register Details')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Cash Register #{{ $cashRegister->id }}</h1>
        @if($cashRegister->status === 'open')
            <a href="{{ route('cash-registers.close', $cashRegister->id) }}" class="btn btn-warning">
                <i class="fas fa-lock"></i> Close Register
            </a>
        @endif
    </div>
@stop

@section('content')
    <div class="row">
        <div class="col-md-4">
            <div class="info-box">
                <span class="info-box-icon bg-info"><i class="fas fa-money-bill-wave"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Opening Balance</span>
                    <span class="info-box-number">{{ number_format($cashRegister->opening_balance, 2) }} Tk</span>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="info-box">
                <span class="info-box-icon bg-success"><i class="fas fa-cash-register"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Current Balance</span>
                    <span class="info-box-number">{{ number_format($currentBalance, 2) }} Tk</span>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="info-box">
                <span class="info-box-icon bg-warning"><i class="fas fa-clock"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Opened At</span>
                    <span class="info-box-number">{{ $cashRegister->opened_at->format('d M Y, h:i A') }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Transactions</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#addTransactionModal">
                            <i class="fas fa-plus"></i> Add Transaction
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Type</th>
                                <th>Method</th>
                                <th>Amount</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($cashRegister->transactions as $transaction)
                            <tr>
                                <td>{{ $transaction->created_at->format('H:i:s') }}</td>
                                <td>
                                    <span class="badge {{ in_array($transaction->transaction_type, ['sale', 'deposit']) ? 'badge-success' : 'badge-danger' }}">
                                        {{ ucfirst($transaction->transaction_type) }}
                                    </span>
                                </td>
                                <td>{{ ucfirst($transaction->payment_method) }}</td>
                                <td class="text-right">{{ number_format($transaction->amount, 2) }}</td>
                                <td>{{ $transaction->notes }}</td>
                            </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Summary</h3>
                </div>
                <div class="card-body p-0">
                    <table class="table">
                        <tr>
                            <td>Sales</td>
                            <td class="text-right">{{ number_format($totals['sale'] ?? 0, 2) }}</td>
                        </tr>
                        <tr>
                            <td>Returns</td>
                            <td class="text-right">{{ number_format($totals['return'] ?? 0, 2) }}</td>
                        </tr>
                        <tr>
                            <td>Expenses</td>
                            <td class="text-right">{{ number_format($totals['expense'] ?? 0, 2) }}</td>
                        </tr>
                        <tr>
                            <td>Deposits</td>
                            <td class="text-right">{{ number_format($totals['deposit'] ?? 0, 2) }}</td>
                        </tr>
                        <tr>
                            <td>Withdrawals</td>
                            <td class="text-right">{{ number_format($totals['withdrawal'] ?? 0, 2) }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Pending Transactions</h3>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        @forelse($pendingTransactions as $transaction)
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            #{{ $transaction->id }} - {{ $transaction->purpose }}
                            <form action="{{ route('cash-registers.add-transaction', $cashRegister->id) }}" method="POST" class="d-inline">
                                @csrf
                                <input type="hidden" name="transaction_id" value="{{ $transaction->id }}">
                                <input type="hidden" name="transaction_type" value="{{ $transaction->type == 'debit' ? 'sale' : 'return' }}">
                                <input type="hidden" name="payment_method" value="{{ $transaction->method }}">
                                <input type="hidden" name="amount" value="{{ $transaction->amount }}">
                                <input type="hidden" name="notes" value="Auto-added from transaction #{{ $transaction->id }}">
                                <button type="submit" class="btn btn-sm btn-success">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </form>
                        </li>
                        @empty
                        <li class="list-group-item">No pending transactions</li>
                        @endforelse
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal fade" id="addTransactionModal" tabindex="-1" role="dialog" aria-labelledby="addTransactionModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form action="{{ route('cash-registers.add-transaction', $cashRegister->id) }}" method="POST">
                    @csrf
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTransactionModalLabel">Add Transaction</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="transaction_type">Transaction Type</label>
                            <select class="form-control" id="transaction_type" name="transaction_type" required>
                                <option value="sale">Sale</option>
                                <option value="return">Return</option>
                                <option value="expense">Expense</option>
                                <option value="deposit">Deposit</option>
                                <option value="withdrawal">Withdrawal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="payment_method">Payment Method</label>
                            <select class="form-control" id="payment_method" name="payment_method" required>
                                <option value="cash">Cash</option>
                                <option value="bank">Bank</option>
                                <option value="mobile_bank">Mobile Banking</option>
                                <option value="cheque">Cheque</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount</label>
                            <input type="number" step="0.01" class="form-control" id="amount" name="amount" required>
                        </div>
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Transaction</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Add Category')

@section('content_header')
    <h1>Add New Category</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if ($errors->any())
                <div class="alert alert-danger">
                    <strong>Whoops!</strong> There were some problems with your input.<br><br>
                    <ul>
                        @foreach ($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('categories.store') }}" method="POST">
                @csrf

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12">
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" name="name" id="name" class="form-control" placeholder="Category Name" value="{{ old('name') }}" required>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="box_pcs">Box (PCS):</label>
                            <input type="number" name="box_pcs" id="box_pcs" class="form-control" placeholder="0" min="0" value="{{ old('box_pcs', 0) }}">
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="pieces_feet">Pieces (Feet):</label>
                            <input type="number" name="pieces_feet" id="pieces_feet" class="form-control" placeholder="0.00" step="0.0001" min="0" value="{{ old('pieces_feet', 0) }}">
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 text-center">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <a class="btn btn-secondary" href="{{ route('categories.index') }}">Cancel</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <style>
        /* Disable all animations */
        * {
            animation: none !important;
            transition: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -o-animation: none !important;
        }
        
        /* Specifically target AdminLTE animations */
        .preloader, .layout-navbar-fixed .wrapper .content-wrapper, 
        .layout-fixed .wrapper .sidebar, .sidebar-mini.sidebar-collapse .main-sidebar {
            animation: none !important;
            transition: none !important;
        }
    </style>
@stop

@section('js')
    <script>
        // Disable sidebar transitions
        $('body').addClass('sidebar-no-animation');
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Category')

@section('content_header')
    <h1>Edit Category</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if ($errors->any())
                <div class="alert alert-danger">
                    <strong>Whoops!</strong> There were some problems with your input.<br><br>
                    <ul>
                        @foreach ($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('categories.update', $category->id) }}" method="POST">
                @csrf
                @method('PUT')

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12">
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" name="name" id="name" value="{{ $category->name }}" class="form-control" placeholder="Category Name" required>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="box_pcs">Box (PCS):</label>
                            <input type="number" name="box_pcs" id="box_pcs" value="{{ $category->box_pcs }}" class="form-control" placeholder="0" min="0">
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="pieces_feet">Pieces (Feet):</label>
                            <input type="number" name="pieces_feet" id="pieces_feet" value="{{ $category->pieces_feet }}" class="form-control" placeholder="0.00" step="0.0001" min="0">
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 text-center">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <a class="btn btn-secondary" href="{{ route('categories.index') }}">Cancel</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <style>
        /* Disable all animations */
        * {
            animation: none !important;
            transition: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -o-animation: none !important;
        }
        
        /* Specifically target AdminLTE animations */
        .preloader, .layout-navbar-fixed .wrapper .content-wrapper, 
        .layout-fixed .wrapper .sidebar, .sidebar-mini.sidebar-collapse .main-sidebar {
            animation: none !important;
            transition: none !important;
        }
    </style>
@stop

@section('js')
    <script>
        // Disable sidebar transitions
        $('body').addClass('sidebar-no-animation');
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Categories')

@section('content_header')
    <h1>Categories</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <div class="float-right">
                <a class="btn btn-success" href="{{ route('categories.create') }}">Add New Category</a>
            </div>
        </div>
        <div class="card-body">
            @if ($message = Session::get('success'))
                <div class="alert alert-success">
                    <p>{{ $message }}</p>
                </div>
            @endif

            <table id="categories-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Box (PCS)</th>
                        <th>Pieces (Feet)</th>
                        <th width="280px">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach ($categories as $category)
                    <tr>
                        <td>{{ $category->id }}</td>
                        <td>{{ $category->name }}</td>
                        <td>{{ $category->box_pcs }}</td>
                        <td>{{ $category->pieces_feet }}</td>
                        <td>
                            <form action="{{ route('categories.destroy',$category->id) }}" method="POST">
                                <a class="btn btn-info btn-sm" href="{{ route('categories.show',$category->id) }}">Show</a>
                                <a class="btn btn-primary btn-sm" href="{{ route('categories.edit',$category->id) }}">Edit</a>
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="btn btn-danger delete-btn">Delete</button>
</form>
                            </form>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>

            {{-- {!! $categories->links() !!} --}}
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <style>
        /* Disable all animations */
        * {
            animation: none !important;
            transition: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -o-animation: none !important;
        }
        
        /* Specifically target AdminLTE animations */
        .preloader, .layout-navbar-fixed .wrapper .content-wrapper, 
        .layout-fixed .wrapper .sidebar, .sidebar-mini.sidebar-collapse .main-sidebar {
            animation: none !important;
            transition: none !important;
        }
    </style>
@stop

@section('js')
    <script>
        // Disable sidebar transitions
        $('body').addClass('sidebar-no-animation');
    </script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            // Initialize DataTable without AJAX
            const table = $('#categories-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Use event delegation to handle delete button clicks
            $('#categories-table').on('click', '.delete-btn', function(e) {
                e.preventDefault();
                
                // Find the closest form (the delete form)
                const form = $(this).closest('form');
                
                // Get the category ID from the form action URL
                const actionUrl = form.attr('action');
                
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Submit the form via AJAX
                        $.ajax({
                            url: actionUrl,
                            type: 'POST',
                            data: form.serialize(),
                            success: function(response) {
                                Swal.fire(
                                    'Deleted!',
                                    'Category has been deleted successfully.',
                                    'success'
                                );
                                // Reload the page instead of just the table
                                window.location.reload();
                            },
                            error: function(xhr) {
                                Swal.fire(
                                    'Error!',
                                    'Something went wrong.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
            
            // Show SweetAlert for flash messages
            @if(session('success'))
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: "{{ session('success') }}",
                });
            @endif
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Category Details')

@section('content_header')
    <h1>Category Details</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <div class="float-right">
                <a class="btn btn-secondary" href="{{ route('categories.index') }}">Back</a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <div class="form-group">
                        <strong>Name:</strong>
                        {{ $category->name }}
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6">
                    <div class="form-group">
                        <strong>Box (PCS):</strong>
                        {{ $category->box_pcs }}
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6">
                    <div class="form-group">
                        <strong>Pieces (Feet):</strong>
                        {{ $category->pieces_feet }}
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <style>
        /* Disable all animations */
        * {
            animation: none !important;
            transition: none !important;
            -webkit-animation: none !important;
            -moz-animation: none !important;
            -o-animation: none !important;
        }
        
        /* Specifically target AdminLTE animations */
        .preloader, .layout-navbar-fixed .wrapper .content-wrapper, 
        .layout-fixed .wrapper .sidebar, .sidebar-mini.sidebar-collapse .main-sidebar {
            animation: none !important;
            transition: none !important;
        }
    </style>
@stop

@section('js')
    <script>
        // Disable sidebar transitions
        $('body').addClass('sidebar-no-animation');
    </script>
@stop


--- Contents of create.blade.php ---

@extends('adminlte::page')

@section('title', 'Create Challan')

@section('content_header')
    <h1>Create New Delivery Challan</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Challan Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('challans.store') }}" method="POST" id="challan-form">
                @csrf
                
                <div class="row">
                    <!-- Challan Info Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Challan Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="challan_number">Challan Number <span class="text-danger">*</span></label>
                                    <input type="text" name="challan_number" id="challan_number" class="form-control" value="{{ $challan_number }}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="challan_date">Challan Date <span class="text-danger">*</span></label>
                                    <input type="date" name="challan_date" id="challan_date" class="form-control" value="{{ $challan_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Invoice Selection Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Invoice Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="invoice_id">Select Invoice <span class="text-danger">*</span></label>
                                    <select name="invoice_id" id="invoice_id" class="form-control select2" required>
                                        <option value="">Select Invoice</option>
                                        @foreach($invoices as $invoice)
                                            <option value="{{ $invoice->id }}" {{ $invoice_id == $invoice->id ? 'selected' : '' }}>
                                                {{ $invoice->invoice_number }} - {{ $invoice->customer->name }} ({{ $invoice->invoice_date->format('d-m-Y') }})
                                            </option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Information -->
                <div class="card mt-4">
                    <div class="card-header bg-warning">
                        <h3 class="card-title">Delivery Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="shipping_address">Shipping Address <span class="text-danger">*</span></label>
                                    <textarea name="shipping_address" id="shipping_address" class="form-control" rows="3" required></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="receiver_name">Receiver Name <span class="text-danger">*</span></label>
                                    <input type="text" name="receiver_name" id="receiver_name" class="form-control" value="" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="receiver_phone">Receiver Phone</label>
                                    <input type="text" name="receiver_phone" id="receiver_phone" class="form-control" value="">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="vehicle_number">Vehicle Number</label>
                                    <input type="text" name="vehicle_number" id="vehicle_number" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="driver_name">Driver Name</label>
                                    <input type="text" name="driver_name" id="driver_name" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="driver_phone">Driver Phone</label>
                                    <input type="text" name="driver_phone" id="driver_phone" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea name="notes" id="notes" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Items Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Items for Delivery</h3>
                    </div>
                    <div class="card-body">
                        @if(!$invoiceItems || $invoiceItems->isEmpty())
                            <div class="alert alert-info" id="no-items-alert">
                                <i class="icon fas fa-info-circle"></i> Select an invoice to view available items for delivery.
                            </div>
                        @endif
                        
                        <div id="invoice-items-container" class="{{ !$invoiceItems || $invoiceItems->isEmpty() ? 'd-none' : '' }}">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="items-table">
                                    <thead>
                                        <tr>
                                            <th width="3%"></th>
                                            <th width="20%">Product</th>
                                            <th width="20%">Description</th>
                                            <th width="10%">Available</th>
                                            <th width="10%">Quantity</th>
                                            <th width="10%">Unit</th>
                                            <th width="10%">Boxes</th>
                                            <th width="10%">Pieces</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if($invoiceItems && $invoiceItems->isNotEmpty())
                                            @foreach($invoiceItems as $index => $item)
                                                <tr class="item-row">
                                                    <td>
                                                        <div class="icheck-primary">
                                                            <input type="checkbox" name="item_selected[]" id="item{{ $index }}" value="1" checked class="item-checkbox">
                                                            <label for="item{{ $index }}"></label>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <input type="hidden" name="invoice_item_id[]" value="{{ $item->id }}">
                                                        <input type="hidden" name="product_id[]" value="{{ $item->product_id }}">
                                                        {{ $item->product->name }}
                                                    </td>
                                                    <td>
                                                        <input type="text" name="description[]" class="form-control form-control-sm" value="{{ $item->description }}" >
                                                    </td>
                                                    <td>
                                                        {{ $item->remaining_quantity }}
                                                        <input type="hidden" class="remaining-quantity" value="{{ $item->remaining_quantity }}">
                                                        
                                                        @if($item->product->category)
                                                            <input type="hidden" class="box-pcs" value="{{ $item->product->category->box_pcs }}">
                                                            <input type="hidden" class="pieces-feet" value="{{ $item->product->category->pieces_feet }}">
                                                        @else
                                                            <input type="hidden" class="box-pcs" value="0">
                                                            <input type="hidden" class="pieces-feet" value="0">
                                                        @endif
                                                    </td>
                                                    <td>
                                                        <input type="number" name="quantity[]" class="form-control form-control-sm quantity-field" min="0.01" max="{{ $item->remaining_quantity }}" step="0.01" value="{{ $item->remaining_quantity }}" required>
                                                    </td>
                                                    <td>
                                                        <select class="form-control form-control-sm quantity-type">
                                                            <option value="quantity">Quantity</option>
                                                            <option value="box_pieces">Box/Pieces</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input type="number" name="boxes[]" class="form-control form-control-sm box-field" min="0" readonly>
                                                    </td>
                                                    <td>
                                                        <input type="number" name="pieces[]" class="form-control form-control-sm pieces-field" min="0" readonly>
                                                    </td>
                                                </tr>
                                            @endforeach
                                        @endif
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                        <i class="fas fa-save"></i> Create Challan
                    </button>
                    <a href="{{ route('challans.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/icheck-bootstrap/3.0.1/icheck-bootstrap.min.css">
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
        
        .quantity-type-container.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            $('.select2').select2({
                width: '100%'
            });
            
              // Get the pre-selected invoice ID
    const selectedInvoiceId = $('#invoice_id').val();
    
    if (selectedInvoiceId) {
        // Show loading indicator
        $('#no-items-alert').html('<i class="icon fas fa-spinner fa-spin"></i> Loading invoice items...');
        $('#no-items-alert').removeClass('d-none').show();
        
        // Fetch invoice data immediately
        $.ajax({
            url: '/get-invoice-items/' + selectedInvoiceId,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                const invoice = response.invoice;
                
                // Set the customer fields immediately
                $('#shipping_address').val(invoice.customer.address);
                $('#receiver_name').val(invoice.customer.name);
                $('#receiver_phone').val(invoice.customer.phone);
                
                // Handle the rest of your response data...
            },
            error: function(xhr) {
                // Error handling...
            }
        });
    }
            // When invoice selection changes
            $('#invoice_id').change(function() {
                const invoiceId = $(this).val();
                
                if (invoiceId) {
                    // Show loading
                    $('#no-items-alert').html('<i class="icon fas fa-spinner fa-spin"></i> Loading invoice items...');
                    $('#no-items-alert').removeClass('d-none').show();
                    $('#invoice-items-container').addClass('d-none');
                    
                    // Get invoice details with AJAX
                    $.ajax({
                        url: '/get-invoice-items/' + invoiceId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(response) {
                            const invoice = response.invoice;
                            const items = response.items;
                            
                            // Update shipping info
                            $('#shipping_address').val(invoice.customer.address);
                            $('#receiver_name').val(invoice.customer.name);
                            $('#receiver_phone').val(invoice.customer.phone);
                            
                            // Clear existing items
                            $('#items-table tbody').empty();
                            
                            if (items.length > 0) {
                                // Add new items
                                $.each(items, function(index, item) {
                                    let boxPcs = item.category ? item.category.box_pcs : 0;
                                    let piecesFeet = item.category ? item.category.pieces_feet : 0;
                                    
                                    const row = `
                                        <tr class="item-row">
                                            <td>
                                                <div class="icheck-primary">
                                                    <input type="checkbox" name="item_selected[]" id="item${index}" value="1" checked class="item-checkbox">
                                                    <label for="item${index}"></label>
                                                </div>
                                            </td>
                                            <td>
                                                <input type="hidden" name="invoice_item_id[]" value="${item.id}">
                                                <input type="hidden" name="product_id[]" value="${item.product_id}">
                                                ${item.product_name}
                                            </td>
                                            <td>
                                                <input type="text" name="description[]" class="form-control form-control-sm" value="${item.description}" required>
                                            </td>
                                            <td>
                                                ${item.remaining_quantity}
                                                <input type="hidden" class="remaining-quantity" value="${item.remaining_quantity}">
                                                <input type="hidden" class="box-pcs" value="${boxPcs}">
                                                <input type="hidden" class="pieces-feet" value="${piecesFeet}">
                                            </td>
                                            <td>
                                                <input type="number" name="quantity[]" class="form-control form-control-sm quantity-field" min="0.01" max="${item.remaining_quantity}" step="0.01" value="${item.remaining_quantity}" required>
                                            </td>
                                            <td>
                                                <select class="form-control form-control-sm quantity-type">
                                                    <option value="quantity">Quantity</option>
                                                    <option value="box_pieces">Box/Pieces</option>
                                                </select>
                                            </td>
                                            <td>
                                                <input type="number" name="boxes[]" class="form-control form-control-sm box-field" min="0" readonly>
                                            </td>
                                            <td>
                                                <input type="number" name="pieces[]" class="form-control form-control-sm pieces-field" min="0" readonly>
                                            </td>
                                        </tr>
                                    `;
                                    
                                    $('#items-table tbody').append(row);
                                });
                                
                                // Show items table
                                $('#no-items-alert').hide();
                                $('#invoice-items-container').removeClass('d-none');
                                
                                // Recalculate boxes and pieces for each row
                                $('.item-row').each(function() {
                                    calculateBoxesAndPieces($(this));
                                });
                                
                                // Initialize box/pieces for each row
                                initializeQuantityTypes();
                            } else {
                                $('#no-items-alert').html('<i class="icon fas fa-info-circle"></i> No items available for delivery in this invoice.');
                                $('#no-items-alert').removeClass('d-none').show();
                                $('#invoice-items-container').addClass('d-none');
                            }
                        },
                        error: function() {
                            $('#no-items-alert').html('<i class="icon fas fa-exclamation-triangle"></i> Error loading invoice items.');
                            $('#no-items-alert').removeClass('d-none').show();
                            $('#invoice-items-container').addClass('d-none');
                        }
                    });
                } else {
                    // Clear and hide invoice items
                    $('#no-items-alert').html('<i class="icon fas fa-info-circle"></i> Select an invoice to view available items for delivery.');
                    $('#no-items-alert').removeClass('d-none').show();
                    $('#invoice-items-container').addClass('d-none');
                    $('.customer-info').hide();
                    
                    // Clear shipping info
                    $('#shipping_address').val('');
                    $('#receiver_name').val('');
                    $('#receiver_phone').val('');
                }
            });
            
            // Initialize quantity type handling
            initializeQuantityTypes();
            
            // Item checkbox change
            $(document).on('change', '.item-checkbox', function() {
                const row = $(this).closest('tr');
                const isChecked = $(this).prop('checked');
                
                if (isChecked) {
                    // Enable fields
                    row.find('input, select').not('.item-checkbox').prop('disabled', false);
                } else {
                    // Disable fields
                    row.find('input, select').not('.item-checkbox').prop('disabled', true);
                }
            });
            
            // Form submission validation
            $('#challan-form').submit(function(e) {
                let valid = false;
                
                // Check if at least one item is selected
                $('.item-checkbox').each(function() {
                    if ($(this).prop('checked')) {
                        valid = true;
                        return false; // Break the each loop
                    }
                });
                
                if (!valid) {
                    e.preventDefault();
                    alert('Please select at least one item for delivery.');
                    return false;
                }
                
                // Check if quantities are valid
                let quantityError = false;
                $('.item-row').each(function() {
                    if (!$(this).find('.item-checkbox').prop('checked')) {
                        return true; // Skip unchecked rows
                    }
                    
                    const quantityField = $(this).find('.quantity-field');
                    const quantity = parseFloat(quantityField.val());
                    const maxQuantity = parseFloat($(this).find('.remaining-quantity').val());
                    
                    if (isNaN(quantity) || quantity <= 0 || quantity > maxQuantity) {
                        quantityError = true;
                        quantityField.addClass('is-invalid');
                        return false; // Break the each loop
                    } else {
                        quantityField.removeClass('is-invalid');
                    }
                });
                
                if (quantityError) {
                    e.preventDefault();
                    alert('Please enter valid quantities for all selected items.');
                    return false;
                }
                
                return true;
            });
            
            // Calculate boxes and pieces on quantity change
            $(document).on('input', '.quantity-field', function() {
                calculateBoxesAndPieces($(this).closest('tr'));
            });
            
            // Calculate quantity based on boxes and pieces
            $(document).on('input', '.box-field, .pieces-field', function() {
                calculateQuantityFromBoxPieces($(this).closest('tr'));
            });
            
            // Calculate initial values
            $('.item-row').each(function() {
                calculateBoxesAndPieces($(this));
            });
        });
        
        // Initialize quantity type handling
        function initializeQuantityTypes() {
            $(document).on('change', '.quantity-type', function() {
                const row = $(this).closest('tr');
                const value = $(this).val();
                
                if (value === 'quantity') {
                    // Quantity mode
                    row.find('.box-field, .pieces-field').prop('readonly', true);
                    row.find('.quantity-field').prop('readonly', false);
                    
                    // Recalculate boxes and pieces
                    calculateBoxesAndPieces(row);
                } else {
                    // Box/Pieces mode
                    row.find('.box-field, .pieces-field').prop('readonly', false);
                    row.find('.quantity-field').prop('readonly', true);
                    
                    // Initialize box/pieces fields if empty
                    if (!row.find('.box-field').val() && !row.find('.pieces-field').val()) {
                        calculateBoxesAndPieces(row);
                    }
                }
            });
            
            // Initialize existing rows
            $('.quantity-type').trigger('change');
        }
        
        // Calculate boxes and pieces based on quantity
        function calculateBoxesAndPieces(row) {
            const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = Math.round(quantity / piecesFeet);
                
                // Calculate boxes (whole number)
                const boxes = Math.floor(totalPieces / boxPcs);
                
                // Calculate remaining pieces
                const pieces = totalPieces - (boxes * boxPcs);
                
                row.find('.box-field').val(boxes);
                row.find('.pieces-field').val(pieces);
            } else {
                row.find('.box-field').val('');
                row.find('.pieces-field').val('');
            }
        }
        
        // Calculate quantity based on boxes and pieces
        function calculateQuantityFromBoxPieces(row) {
            const boxes = parseInt(row.find('.box-field').val()) || 0;
            const pieces = parseInt(row.find('.pieces-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = (boxes * boxPcs) + pieces;
                
                // Calculate quantity
                const quantity = (totalPieces * piecesFeet).toFixed(2);
                
                // Check if quantity exceeds maximum
                const maxQuantity = parseFloat(row.find('.remaining-quantity').val());
                if (quantity > maxQuantity) {
                    alert('Quantity exceeds available amount. Adjusting to maximum.');
                    calculateBoxesAndPieces(row);
                } else {
                    row.find('.quantity-field').val(quantity);
                }
            }
        }
    </script>
@stop

--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Challans')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Delivery Challans</h1>
        <a href="{{ route('challans.create') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create New Challan
        </a>
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Challans</h3>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif
            
            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="challans-table">
                    <thead>
                        <tr>
                            <th>Challan Number</th>
                            <th>Date</th>
                            <th>Invoice Number</th>
                            <th>Customer</th>
                            <th>Receiver</th>
                            <th>Delivery Status</th>
                            <th width="15%">Actions</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    
    <style>
        .delivery-status-container {
            display: flex;
            align-items: center;
        }
        
        .status-badge {
            min-width: 80px;
            text-align: center;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
        }
        
        .dropdown-item .badge {
            width: 80px;
            text-align: center;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize DataTable with server-side processing
            var table = $('#challans-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: "{{ route('challans.index') }}",
                columns: [
                    {data: 'challan_number', name: 'challan_number'},
                    {data: 'formatted_date', name: 'challan_date'},
                    {data: 'invoice_number', name: 'invoice.invoice_number'},
                    {data: 'customer_name', name: 'invoice.customer.name'},
                    {data: 'receiver_name', name: 'receiver_name'},
                    {data: 'status_badge', name: 'status', orderable: true, searchable: true},
                    {data: 'action', name: 'action', orderable: false, searchable: false}
                ],
                order: [[0, 'desc']]
            });

            // Handle status change via dropdown using event delegation
            $(document).on('click', '.delivery-status-dropdown .dropdown-item', function(e) {
                e.preventDefault();
                
                const container = $(this).closest('.delivery-status-container');
                const challanId = container.data('challan-id');
                const currentStatus = container.find('.status-badge').data('status');
                const newStatus = $(this).data('status');
                
                // Skip if status isn't changing
                if (currentStatus === newStatus) return;
                
                // Store original status for reverting if needed
                const originalStatusText = container.find('.status-badge').text();
                const originalStatusClass = container.find('.status-badge').attr('class');
                
                // Show loading indicator
                container.find('.status-badge').html('<i class="fas fa-spinner fa-spin"></i> Updating...');
                
                // Disable dropdown during processing
                container.find('.dropdown-toggle').addClass('disabled');
                
               $.ajax({
    url: '/challans/' + challanId + '/update-status',
    type: 'POST',
    data: {
        status: newStatus,
        _token: $('meta[name="csrf-token"]').attr('content')
    },
    success: function(response) {
        if (response.success) {
            // Update the displayed status
            container.find('.status-badge').remove();
            
            let newBadge;
            if (newStatus === 'pending') {
                newBadge = $('<span class="badge badge-warning status-badge" data-status="pending">Pending</span>');
            } else if (newStatus === 'delivered') {
                newBadge = $('<span class="badge badge-success status-badge" data-status="delivered">Delivered</span>');
            } else {
                newBadge = $('<span class="badge badge-danger status-badge" data-status="cancelled">Cancelled</span>');
            }
            
            container.prepend(newBadge);
            container.data('current-status', newStatus);
            container.find('.status-options').addClass('d-none');
            
            // Show success message
            toastr.success('Challan status updated successfully');
            
            // If we're setting to delivered, refresh the page to show updated stock
            if (newStatus === 'delivered') {
                setTimeout(function() {
                    location.reload();
                }, 1000);
            }
        } else {
            toastr.error(response.message || 'Failed to update challan status');
        }
    },
    error: function(xhr) {
        let errorMessage = 'Failed to update challan status';
        if (xhr.responseJSON && xhr.responseJSON.message) {
            errorMessage = xhr.responseJSON.message;
        }
        toastr.error(errorMessage);
    }
});
            });
        });
    </script>
@stop


--- Contents of print.blade.php ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challan #{{ $challan->challan_number }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        
        .challan-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .challan-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo-container {
            width: 80px;
            margin-right: 10px;
        }
        
        .logo-container img {
            width: 100%;
            height: auto;
        }
        
        .company-info {
            text-align: center;
            flex-grow: 1;
        }
        
        .company-info h1 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .bill-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .bill-to {
            width: 50%;
            text-align: left;
        }
        
        .bill-to h3 {
            margin: 0 0 3px 0;
            font-size: 12px;
        }
        
        .bill-to p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .challan-title {
            width: 50%;
            text-align: right;
        }
        
        .challan-title h2 {
            margin: 0;
            color: blue;
            font-size: 16px;
        }
        
        .challan-title p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .challan-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }
        
        .challan-table th, .challan-table td {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
            font-size: 11px;
        }
        
        .challan-table th {
            background-color: #f2f2f2;
        }
        
        .words-total {
            text-align: left;
            font-style: italic;
            margin: 3px 0;
            font-size: 11px;
        }
        
        .words-total p {
            margin: 0;
        }
        
        .disclaimer {
            clear: both;
            text-align: center;
            margin: 15px 0 10px 0;
            font-weight: bold;
            font-size: 11px;
        }
        
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-box {
            width: 45%;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 2px;
        }
        
        .signature-box p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        .footer-text {
            text-align: center;
            font-size: 10px;
            margin-top: 5px;
        }
        
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="challan-container">
        <div class="challan-header">
                <div class="logo-container">
                    @if($businessSettings->logo)
                        <img src="{{ Storage::url($businessSettings->logo) }}" alt="{{ $businessSettings->business_name }} Logo">
                    @else
                        <img src="{{ asset('logo/logo.png') }}" alt="RTS Logo">
                    @endif
                </div>
                <div class="company-info">
                    <h1>{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</h1>
                    <p>Phone: {{ $businessSettings->phone ?? '01970-598 449 (Bikash),01795-833 166 (Bikash, Nagad)' }}</p>
                    <p>Email: {{ $businessSettings->email ?? 'rahmantilesbd@gmail.com' }}</p>
                    <p>{{ $businessSettings->address ?? 'Model Town, Sadar, Shariatpur' }} 
                    @if($businessSettings->bin_number) 
                        (BIN: {{ $businessSettings->bin_number }})
                    @else
                        (BIN: 004975254-0811)
                    @endif
                    </p>
                </div>
        </div>
        
        <div class="bill-section">
            <div class="bill-to">
                <h3>Deliver To</h3>
                @if($challan->invoice && $challan->invoice->customer)
                <p><strong>{{ $challan->invoice->customer->name }}</strong></p>
                <p>Address: {{ $challan->invoice->customer->address }}</p>
                <p>Phone: {{ $challan->invoice->customer->phone }}</p>
                @if($challan->invoice->customer->email)
                <p>Email: {{ $challan->invoice->customer->email }}</p>
                @endif
                @else
                <p><strong>{{ $challan->customer_name ?? 'N/A' }}</strong></p>
                <p>Address: {{ $challan->address ?? 'N/A' }}</p>
                <p>Phone: {{ $challan->phone ?? 'N/A' }}</p>
                @endif
            </div>
            <div class="challan-title">
                <h2>DELIVERY CHALLAN</h2>
                <p>Date: {{ $challan->challan_date->format('Y-m-d') }}</p>
                <p>Challan ID: #{{ $challan->challan_number }}</p>
                @if($challan->invoice)
                <p>Invoice ID: #{{ $challan->invoice->invoice_number }}</p>
                @endif
            </div>
        </div>
        
        <table class="challan-table">
            <thead>
                <tr>
                    <th>SL</th>
                    <th>Product Description</th>
                    <th>Category</th>
                    @if($challan->invoice && $challan->invoice->invoice_type != 'other')
                    <th>Box</th>
                    <th>Piece</th>
                    @endif
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                @foreach($challan->items as $index => $item)
                <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ $item->description ?? ($item->product->name ?? 'N/A') }}
                        @if(isset($item->code) && $item->code)
                        <br><small>{{ $item->code }}</small>
                        @endif
                    </td>
                    <td>{{ $item->product->category->name ?? 'N/A' }}</td>
                    @if($challan->invoice && $challan->invoice->invoice_type != 'other')
                    <td>{{ $item->boxes ?? 0 }}</td>
                    <td>{{ $item->pieces ?? 0 }}</td>
                    @endif
                    <td>{{ number_format($item->quantity, 2) }}</td>
                </tr>
                @endforeach
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="{{ ($challan->invoice && $challan->invoice->invoice_type != 'other') ? 5 : 3 }}" style="text-align: right;"><strong>Total:</strong></td>
                    <td>{{ number_format($challan->items->sum('quantity'), 2) }}</td>
                </tr>
            </tfoot>
        </table>
        
        @if(isset($challan->notes) && $challan->notes)
        <div class="words-total">
            <p>Notes: {{ $challan->notes }}</p>
        </div>
        @endif
        
        <div class="disclaimer">
            This is a delivery challan only, not an invoice.
        </div>
        
        <div class="signatures">
            <div class="signature-box">
                <p>Received By: </p>
                <p>Signature and Date</p>
            </div>
                <div class="signature-box">
                    <p>Issued By: {{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</p>
                    <p>Signature and Date</p>
                </div>
        </div>
        
        <div class="footer-text">
            Thanks for being with us.
        </div>
        
        <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px;">
                Print Challan
            </button>
            <button onclick="window.close()" style="padding: 8px 16px; background-color: #f44336; color: white; border: none; cursor: pointer; font-size: 14px; margin-left: 10px; border-radius: 4px;">
                Close
            </button>
        </div>
    </div>
    
    <script>
        window.onload = function() {
            // Uncomment to automatically print when the page loads
            window.print();
        };
    </script>
</body>
</html>


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'View Challan')

@section('content_header')
    <h1>Challan: {{ $challan->challan_number }}</h1>
@stop

@section('content')
<div class="card">
    <div class="card-body">
        <p><strong>Customer:</strong> {{ $challan->invoice->customer->name }}</p>
        <p><strong>Challan Date:</strong> {{ $challan->challan_date->format('d-m-Y') }}</p>
        <p><strong>Receiver:</strong> {{ $challan->receiver_name }}</p>
        <p><strong>Shipping Address:</strong> {{ $challan->shipping_address }}</p>
        <p><strong>Status:</strong> {{ ucfirst($challan->status) }}</p>

        <hr>

        <h5>Items</h5>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Description</th>
                    <th>Quantity</th>
                    <th>Boxes</th>
                    <th>Pieces</th>
                </tr>
            </thead>
            <tbody>
                @foreach($challan->items as $item)
                <tr>
                    <td>{{ $item->product->name }}</td>
                    <td>{{ $item->description }}</td>
                    <td>{{ $item->quantity }}</td>
                    <td>{{ $item->boxes ?? '-' }}</td>
                    <td>{{ $item->pieces ?? '-' }}</td>
                </tr>
                @endforeach
            </tbody>
        </table>
<br>
        <a href="{{ route('challans.index') }}" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Back
        </a>
        <a href="{{ route('challans.print', $challan) }}" target="_blank" class="btn btn-secondary">
            <i class="fas fa-print"></i> Print
        </a>

        @if($challan->status != 'delivered')
        <form action="{{ route('challans.destroy', $challan) }}" method="POST" class="d-inline"
            onsubmit="return confirm('Are you sure you want to delete this challan?')">
            @csrf
            @method('DELETE')
            <button class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
        </form>
        @endif
    </div>
</div>
@stop


--- Contents of management.blade.php ---
@extends('adminlte::page')

@section('title', 'Colorent Management')

@section('content_header')
    <h1>Colorent Management</h1>
@stop

@section('content')
<div class="container-fluid">
    <!-- Totals Cards Row -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="info-box">
                <span class="info-box-icon bg-info">
                    <i class="fas fa-boxes"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Total Stock</span>
                    <span class="info-box-number" id="total-stock">{{ number_format($totalStock) }}</span>
                    <span class="info-box-text">Units</span>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="info-box">
                <span class="info-box-icon bg-success">
                    <i class="fas fa-dollar-sign"></i>
                </span>
                <div class="info-box-content">
                    <span class="info-box-text">Total Value</span>
                    <span class="info-box-number" id="total-value"> {{ number_format($totalValue, 2) }}</span>
                    <span class="info-box-text">Current Inventory Value</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Table Row -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Manage Colorent Stock & Prices</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-sm btn-info" onclick="refreshTotals()">
                            <i class="fas fa-sync-alt"></i> Refresh Totals
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th style="width: 40%">Product Name</th>
                                    <th style="width: 20%">Stock</th>
                                    <th style="width: 20%">Price ()</th>
                                    <th style="width: 20%">Value ()</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($colorents as $colorent)
                                <tr id="colorent-{{ $colorent->id }}">
                                    <td><strong>{{ $colorent->name }}</strong></td>
                                    
                                    <!-- Stock Management -->
                                    <td>
                                        <div class="input-group input-group-sm">
                                            <div class="input-group-prepend">
                                                <button class="btn btn-outline-danger btn-sm stock-btn" 
                                                        data-id="{{ $colorent->id }}" 
                                                        data-change="-1"
                                                        {{ $colorent->stock <= 0 ? 'disabled' : '' }}>
                                                    <i class="fas fa-minus"></i>
                                                </button>
                                            </div>
                                            
                                            <input type="number" 
                                                   class="form-control text-center stock-input" 
                                                   id="stock-{{ $colorent->id }}"
                                                   data-id="{{ $colorent->id }}"
                                                   value="{{ $colorent->stock }}"
                                                   min="0"
                                                   style="max-width: 80px;">
                                            
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-success btn-sm stock-btn" 
                                                        data-id="{{ $colorent->id }}" 
                                                        data-change="1">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- Price Management -->
                                    <td>
                                        <span class="price-display" 
                                              data-id="{{ $colorent->id }}" 
                                              style="cursor: pointer; padding: 5px; border-radius: 3px;">
                                             {{ number_format($colorent->price, 2) }}
                                        </span>
                                        
                                        <div class="price-edit" 
                                             data-id="{{ $colorent->id }}" 
                                             style="display: none;">
                                            <div class="input-group input-group-sm">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"></span>
                                                </div>
                                                <input type="number" 
                                                       class="form-control price-input" 
                                                       data-id="{{ $colorent->id }}"
                                                       value="{{ $colorent->price }}"
                                                       step="0.01"
                                                       min="0"
                                                       style="max-width: 120px;">
                                                <div class="input-group-append">
                                                    <button class="btn btn-success btn-sm save-price-btn" 
                                                            data-id="{{ $colorent->id }}">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                    <button class="btn btn-secondary btn-sm cancel-price-btn" 
                                                            data-id="{{ $colorent->id }}">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- Item Value -->
                                    <td>
                                        <span class="item-value" data-id="{{ $colorent->id }}">
                                             {{ number_format($colorent->stock * $colorent->price, 2) }}
                                        </span>
                                    </td>
                                </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Simple loading overlay -->
<div id="loading-overlay" style="display: none; position: fixed; top: 20px; right: 20px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 1000;">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
    <span class="ml-2">Updating...</span>
</div>
@stop

@section('css')
<style>
    .price-display:hover {
        background-color: #e9ecef !important;
        transition: background-color 0.2s;
    }
    
    .btn:disabled {
        opacity: 0.5;
    }
    
    .table td {
        vertical-align: middle;
    }
    
    .info-box-number {
        font-weight: bold;
        font-size: 1.5rem;
    }
    
    .info-box {
        box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
        border-radius: .25rem;
        background: #fff;
        display: flex;
        margin-bottom: 1rem;
        min-height: 80px;
        padding: .5rem;
        position: relative;
        width: 100%;
    }
</style>
@stop

@section('js')
<script>
$(document).ready(function() {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });

    // Stock button clicks
    $('.stock-btn').click(function() {
        const $btn = $(this);
        const id = $btn.data('id');
        const change = $btn.data('change');
        
        updateStock(id, change, $btn);
    });

    // Stock input changes
    $('.stock-input').change(function() {
        const id = $(this).data('id');
        const newStock = $(this).val();
        updateStockDirect(id, newStock);
    });

    // Price display clicks
    $('.price-display').click(function() {
        const id = $(this).data('id');
        showPriceEdit(id);
    });

    // Save price button
    $('.save-price-btn').click(function() {
        const id = $(this).data('id');
        const newPrice = $(`.price-input[data-id="${id}"]`).val();
        updatePrice(id, newPrice);
    });

    // Cancel price edit
    $('.cancel-price-btn').click(function() {
        const id = $(this).data('id');
        hidePriceEdit(id);
    });

    function updateStock(id, change, $btn) {
        $('#loading-overlay').show();
        
        // Show loading on button
        $btn.prop('disabled', true);
        const originalIcon = $btn.find('i').attr('class');
        $btn.find('i').attr('class', 'fas fa-spinner fa-spin');
        
        $.ajax({
            url: `/colorents/${id}/update-stock`,
            method: 'POST',
            data: { change: change },
            success: function(response) {
                if (response.success) {
                    $(`#stock-${id}`).val(response.new_stock);
                    
                    // Update totals
                    $('#total-stock').text(response.total_stock.toLocaleString());
                    $('#total-value').text(' ' + response.total_value);
                    
                    // Update item value
                    const price = parseFloat($(`.price-display[data-id="${id}"]`).text().replace(' ', '').replace(',', ''));
                    const itemValue = response.new_stock * price;
                    $(`.item-value[data-id="${id}"]`).text(' ' + itemValue.toFixed(2));
                    
                    // Update minus button state
                    const minusBtn = $(`.stock-btn[data-id="${id}"][data-change="-1"]`);
                    minusBtn.prop('disabled', response.new_stock <= 0);
                    
                    showAlert('Stock updated successfully!', 'success');
                }
            },
            error: function() {
                showAlert('Error updating stock!', 'error');
            },
            complete: function() {
                $('#loading-overlay').hide();
                $btn.prop('disabled', false);
                $btn.find('i').attr('class', originalIcon);
            }
        });
    }

    function updateStockDirect(id, newStock) {
        $('#loading-overlay').show();
        
        $.ajax({
            url: `/colorents/${id}/update-stock`,
            method: 'POST',
            data: { new_stock: newStock },
            success: function(response) {
                if (response.success) {
                    // Update totals
                    $('#total-stock').text(response.total_stock.toLocaleString());
                    $('#total-value').text(' ' + response.total_value);
                    
                    showAlert('Stock updated successfully!', 'success');
                }
            },
            error: function() {
                showAlert('Error updating stock!', 'error');
            },
            complete: function() {
                $('#loading-overlay').hide();
            }
        });
    }

    function updatePrice(id, newPrice) {
        $('#loading-overlay').show();
        
        $.ajax({
            url: `/colorents/${id}/update-price`,
            method: 'POST',
            data: { price: newPrice },
            success: function(response) {
                if (response.success) {
                    $(`.price-display[data-id="${id}"]`).text(` ${response.new_price}`);
                    
                    // Update totals
                    $('#total-stock').text(response.total_stock.toLocaleString());
                    $('#total-value').text(' ' + response.total_value);
                    
                    // Update item value
                    const stock = parseInt($(`#stock-${id}`).val());
                    const itemValue = stock * parseFloat(newPrice);
                    $(`.item-value[data-id="${id}"]`).text(' ' + itemValue.toFixed(2));
                    
                    hidePriceEdit(id);
                    showAlert('Price updated successfully!', 'success');
                }
            },
            error: function() {
                showAlert('Error updating price!', 'error');
            },
            complete: function() {
                $('#loading-overlay').hide();
            }
        });
    }

    function showPriceEdit(id) {
        $(`.price-display[data-id="${id}"]`).hide();
        $(`.price-edit[data-id="${id}"]`).show();
        $(`.price-input[data-id="${id}"]`).focus().select();
    }

    function hidePriceEdit(id) {
        $(`.price-edit[data-id="${id}"]`).hide();
        $(`.price-display[data-id="${id}"]`).show();
    }

    function showAlert(message, type) {
        const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
        const alertHtml = `
            <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
        `;
        
        $('.card-body').prepend(alertHtml);
        
        setTimeout(function() {
            $('.alert').fadeOut();
        }, 3000);
    }
});

// Refresh totals function
function refreshTotals() {
    location.reload();
}
</script>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Company')

@section('content_header')
    <h1>Create Company</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Add New Company</h3>
        </div>
        <div class="card-body">
            @if($errors->any())
                <div class="alert alert-danger">
                    <ul>
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('companies.store') }}" method="POST">
                @csrf
                <div class="form-group">
                    <label for="name">Company Name <span class="text-danger">*</span></label>
                    <input type="text" name="name" id="name" class="form-control" value="{{ old('name') }}" required>
                </div>

                <div class="form-group">
                    <label for="description">Description (Optional)</label>
                    <textarea name="description" id="description" class="form-control" rows="3">{{ old('description') }}</textarea>
                </div>

                <div class="form-group">
                    <label for="contact">Contact (Optional)</label>
                    <input type="text" name="contact" id="contact" class="form-control" value="{{ old('contact') }}">
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Company</button>
                    <a href="{{ route('companies.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script>
        // Any specific JavaScript can go here
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Company')

@section('content_header')
    <h1>Edit Company</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Company: {{ $company->name }}</h3>
        </div>
        <div class="card-body">
            @if($errors->any())
                <div class="alert alert-danger">
                    <ul>
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('companies.update', $company) }}" method="POST">
                @csrf
                @method('PUT')
                
                <div class="form-group">
                    <label for="name">Company Name <span class="text-danger">*</span></label>
                    <input type="text" name="name" id="name" class="form-control" value="{{ old('name', $company->name) }}" required>
                </div>

                <div class="form-group">
                    <label for="description">Description (Optional)</label>
                    <textarea name="description" id="description" class="form-control" rows="3">{{ old('description', $company->description) }}</textarea>
                </div>

                <div class="form-group">
                    <label for="contact">Contact (Optional)</label>
                    <input type="text" name="contact" id="contact" class="form-control" value="{{ old('contact', $company->contact) }}">
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update Company</button>
                    <a href="{{ route('companies.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script>
        // Any specific JavaScript can go here
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Companies')

@section('content_header')
    <h1>Companies</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Companies</h3>
            <div class="card-tools">
                <a href="{{ route('companies.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Company
                </a>
            </div>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            <table id="companies-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Contact</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($companies as $company)
                        <tr>
                            <td>{{ $company->id }}</td>
                            <td>{{ $company->name }}</td>
                            <td>{{ $company->contact ?? 'N/A' }}</td>
                            <td>{{ $company->created_at->format('Y-m-d') }}</td>
                            <td>
                                <a href="{{ route('companies.show', $company) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ route('companies.edit', $company) }}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form action="{{ route('companies.destroy', $company) }}" method="POST" style="display: inline-block;">
                                    @csrf
                                    @method('DELETE')
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this company?')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#companies-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Company Details')

@section('content_header')
    <h1>Company Details</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ $company->name }}</h3>
            <div class="card-tools">
                <a href="{{ route('companies.index') }}" class="btn btn-default">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
                <a href="{{ route('companies.edit', $company) }}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Edit
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 200px;">Company Name</th>
                                    <td>{{ $company->name }}</td>
                                </tr>
                                <tr>
                                    <th>Description</th>
                                    <td>{{ $company->description ?? 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th>Contact</th>
                                    <td>{{ $company->contact ?? 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th>Created At</th>
                                    <td>{{ $company->created_at->format('F d, Y h:i A') }}</td>
                                </tr>
                                <tr>
                                    <th>Updated At</th>
                                    <td>{{ $company->updated_at->format('F d, Y h:i A') }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script>
        // Any specific JavaScript can go here
    </script>
@stop


--- Contents of application-logo.blade.php ---
<svg viewBox="0 0 316 316" xmlns="http://www.w3.org/2000/svg" {{ $attributes }}>
    <path d="M305.8 81.125C305.77 80.995 305.69 80.885 305.65 80.755C305.56 80.525 305.49 80.285 305.37 80.075C305.29 79.935 305.17 79.815 305.07 79.685C304.94 79.515 304.83 79.325 304.68 79.175C304.55 79.045 304.39 78.955 304.25 78.845C304.09 78.715 303.95 78.575 303.77 78.475L251.32 48.275C249.97 47.495 248.31 47.495 246.96 48.275L194.51 78.475C194.33 78.575 194.19 78.725 194.03 78.845C193.89 78.955 193.73 79.045 193.6 79.175C193.45 79.325 193.34 79.515 193.21 79.685C193.11 79.815 192.99 79.935 192.91 80.075C192.79 80.285 192.71 80.525 192.63 80.755C192.58 80.875 192.51 80.995 192.48 81.125C192.38 81.495 192.33 81.875 192.33 82.265V139.625L148.62 164.795V52.575C148.62 52.185 148.57 51.805 148.47 51.435C148.44 51.305 148.36 51.195 148.32 51.065C148.23 50.835 148.16 50.595 148.04 50.385C147.96 50.245 147.84 50.125 147.74 49.995C147.61 49.825 147.5 49.635 147.35 49.485C147.22 49.355 147.06 49.265 146.92 49.155C146.76 49.025 146.62 48.885 146.44 48.785L93.99 18.585C92.64 17.805 90.98 17.805 89.63 18.585L37.18 48.785C37 48.885 36.86 49.035 36.7 49.155C36.56 49.265 36.4 49.355 36.27 49.485C36.12 49.635 36.01 49.825 35.88 49.995C35.78 50.125 35.66 50.245 35.58 50.385C35.46 50.595 35.38 50.835 35.3 51.065C35.25 51.185 35.18 51.305 35.15 51.435C35.05 51.805 35 52.185 35 52.575V232.235C35 233.795 35.84 235.245 37.19 236.025L142.1 296.425C142.33 296.555 142.58 296.635 142.82 296.725C142.93 296.765 143.04 296.835 143.16 296.865C143.53 296.965 143.9 297.015 144.28 297.015C144.66 297.015 145.03 296.965 145.4 296.865C145.5 296.835 145.59 296.775 145.69 296.745C145.95 296.655 146.21 296.565 146.45 296.435L251.36 236.035C252.72 235.255 253.55 233.815 253.55 232.245V174.885L303.81 145.945C305.17 145.165 306 143.725 306 142.155V82.265C305.95 81.875 305.89 81.495 305.8 81.125ZM144.2 227.205L100.57 202.515L146.39 176.135L196.66 147.195L240.33 172.335L208.29 190.625L144.2 227.205ZM244.75 114.995V164.795L226.39 154.225L201.03 139.625V89.825L219.39 100.395L244.75 114.995ZM249.12 57.105L292.81 82.265L249.12 107.425L205.43 82.265L249.12 57.105ZM114.49 184.425L96.13 194.995V85.305L121.49 70.705L139.85 60.135V169.815L114.49 184.425ZM91.76 27.425L135.45 52.585L91.76 77.745L48.07 52.585L91.76 27.425ZM43.67 60.135L62.03 70.705L87.39 85.305V202.545V202.555V202.565C87.39 202.735 87.44 202.895 87.46 203.055C87.49 203.265 87.49 203.485 87.55 203.695V203.705C87.6 203.875 87.69 204.035 87.76 204.195C87.84 204.375 87.89 204.575 87.99 204.745C87.99 204.745 87.99 204.755 88 204.755C88.09 204.905 88.22 205.035 88.33 205.175C88.45 205.335 88.55 205.495 88.69 205.635L88.7 205.645C88.82 205.765 88.98 205.855 89.12 205.965C89.28 206.085 89.42 206.225 89.59 206.325C89.6 206.325 89.6 206.325 89.61 206.335C89.62 206.335 89.62 206.345 89.63 206.345L139.87 234.775V285.065L43.67 229.705V60.135ZM244.75 229.705L148.58 285.075V234.775L219.8 194.115L244.75 179.875V229.705ZM297.2 139.625L253.49 164.795V114.995L278.85 100.395L297.21 89.825V139.625H297.2Z"/>
</svg>


--- Contents of auth-session-status.blade.php ---
@props(['status'])

@if ($status)
    <div {{ $attributes->merge(['class' => 'font-medium text-sm text-green-600']) }}>
        {{ $status }}
    </div>
@endif


--- Contents of customer-modal.blade.php ---
{{-- resources/views/components/customer-modal.blade.php --}}
<div class="modal fade" id="newCustomerModal" tabindex="-1" role="dialog" aria-labelledby="newCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newCustomerModalLabel">Add New Customer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="modal-errors" class="alert alert-danger" style="display: none;">
                    <strong>Whoops!</strong> There were some problems with your input.<br><br>
                    <ul id="error-list"></ul>
                </div>
                
                <form id="customerForm">
                    @csrf
                    <div class="form-group">
                        <label for="modal-name">Name:</label>
                        <input type="text" name="name" id="modal-name" class="form-control" placeholder="Customer Name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-phone">Phone:</label>
                        <input type="text" name="phone" id="modal-phone" class="form-control" placeholder="Phone Number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-address">Address:</label>
                        <textarea class="form-control" name="address" id="modal-address" placeholder="Address"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-opening-balance">Opening Balance:</label>
                        <input type="number" name="opening_balance" id="modal-opening-balance" class="form-control" placeholder="0.00" step="0.01" value="0">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveCustomerBtn">Save Customer</button>
            </div>
        </div>
    </div>
</div>

@push('js')
<script>
$(document).ready(function() {
    // Fix for Bootstrap modals and Select2
    $.fn.modal.Constructor.prototype.enforceFocus = function() {
        var modal = this;
        $(document).on('focusin.modal', function(e) {
            if (modal.$element[0] !== e.target && 
                !modal.$element.has(e.target).length && 
                !$(e.target).closest('.select2-container').length) {
                modal.$element.focus();
            }
        });
    };

    // Customer modal handling
    $('#saveCustomerBtn').click(function() {
        // Clear previous errors
        $('#modal-errors').hide();
        $('#error-list').empty();
        
        // Get form data
        const formData = {
            name: $('#modal-name').val(),
            phone: $('#modal-phone').val(),
            address: $('#modal-address').val(),
            opening_balance: $('#modal-opening-balance').val(),
            _token: $('meta[name="csrf-token"]').attr('content')
        };
        
        // Submit form via AJAX
        $.ajax({
            url: "{{ route('customers.store') }}",
            type: "POST",
            data: formData,
            success: function(response) {
                // Close modal
                $('#newCustomerModal').modal('hide');
                
                // Add the new customer to the dropdown
                const newOption = new Option(response.customer.name, response.customer.id, true, true);
                $('#customer_id').append(newOption).trigger('change');
                
                // Set customer details
                $('#customer_phone').val(response.customer.phone);
                $('#customer_address').val(response.customer.address);
                $('#customer_balance').val(response.customer.outstanding_balance);
                
                // Show success message
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Customer created successfully',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                $('#customerForm')[0].reset();
            },
            error: function(xhr) {
                if(xhr.status === 422) {
                    const errors = xhr.responseJSON.errors;
                    $('#modal-errors').show();
                    
                    // Display each error
                    $.each(errors, function(key, value) {
                        $('#error-list').append('<li>' + value + '</li>');
                    });
                } else {
                    // Show general error
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Something went wrong. Please try again.'
                    });
                }
            }
        });
    });

    // Reset form when modal is closed
    $('#newCustomerModal').on('hidden.bs.modal', function () {
        $('#customerForm')[0].reset();
        $('#modal-errors').hide();
        $('#error-list').empty();
    });
    
    // Initialize Select2 elements inside the customer modal
    $('#newCustomerModal').on('shown.bs.modal', function() {
        $(this).find('.select2').each(function() {
            $(this).select2({
                dropdownParent: $('#newCustomerModal'),
                width: '100%'
            });
        });
    });
});
</script>
@endpush

@push('css')
<style>
    /* Ensure modal is visible on top of everything */
    #newCustomerModal {
        z-index: 9999 !important;
    }
    
    /* Fix for select2 inside modals */
    #newCustomerModal .select2-container {
        width: 100% !important;
        z-index: 10000 !important;
    }
    
    #newCustomerModal .select2-dropdown {
        z-index: 10001 !important;
    }
</style>
@endpush


--- Contents of danger-button.blade.php ---
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-500 active:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


--- Contents of decor-calculator-modal.blade.php ---
<div class="modal fade" id="decorCalculatorModal" tabindex="-1" role="dialog" aria-labelledby="decorCalculatorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="decorCalculatorModalLabel">
                    <i class="fas fa-calculator mr-2"></i>Decor Calculator
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-3">
                <form id="calculatorForm">
                    <!-- Category select -->
                    <div class="form-group mb-2">
                        <select class="form-control form-control-sm" id="tilesCategory">
                            <option value="">Select Tiles Category</option>
                            @foreach(\App\Models\TilesCategory::all() as $category)
                                <option value="{{ $category->id }}" 
                                        data-height="{{ $category->height }}" 
                                        data-width="{{ $category->width }}">
                                    {{ $category->name }} ({{ $category->height }}x{{ $category->width }})
                                </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <!-- Main inputs in a compact row -->
                    <div class="d-flex mb-2">
                        <div class="mr-1 flex-fill">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Area</span>
                                </div>
                                <input type="number" class="form-control" id="quantity" value="100">
                                <div class="input-group-append">
                                    <span class="input-group-text">sq ft</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex-fill">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Height</span>
                                </div>
                                <input type="number" class="form-control" id="height" value="7">
                                <div class="input-group-append">
                                    <span class="input-group-text">ft</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Times inputs in a card -->
                    <div class="card mb-2">
                        <div class="card-header py-1 px-2 bg-light">
                            <div class="custom-control custom-switch float-right">
                                <input type="checkbox" class="custom-control-input" id="excludeDeep">
                                <label class="custom-control-label small" for="excludeDeep">Exclude Deep</label>
                            </div>
                            <small class="font-weight-bold">Times Settings</small>
                        </div>
                        <div class="card-body p-2">
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" style="width: 50px;">Light</span>
                                </div>
                                <input type="number" class="form-control" id="lightTimes" value="4" step="0.1">
                            </div>
                            <div class="input-group input-group-sm mb-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" style="width: 50px;">Deco</span>
                                </div>
                                <input type="number" class="form-control" id="decoTimes" value="1" step="0.1">
                            </div>
                            <div class="input-group input-group-sm" id="deepSection">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" style="width: 50px;">Deep</span>
                                </div>
                                <input type="number" class="form-control" id="deepTimes" value="1" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculate button -->
                    <button type="button" class="btn btn-primary btn-sm btn-block" id="calculateBtn">
                        <i class="fas fa-calculator mr-1"></i>Calculate
                    </button>
                </form>
                
                <!-- Results -->
                <div id="resultBox" class="mt-3 card bg-light" style="display: none;">
                    <div class="card-header py-1 px-2 bg-success text-white">
                        <small class="font-weight-bold">Results</small>
                    </div>
                    <div class="card-body p-2">
                        <div class="row no-gutters">
                            <div class="col-4">
                                <small class="d-block font-weight-bold">Light:</small>
                                <span id="lightResult" class="d-block">0</span>
                            </div>
                            <div class="col-4">
                                <small class="d-block font-weight-bold">Deco:</small>
                                <span id="decoResult" class="d-block">0</span>
                            </div>
                            <div class="col-4" id="deepResultContainer">
                                <small class="d-block font-weight-bold">Deep:</small>
                                <span id="deepResult" class="d-block">0</span>
                            </div>
                        </div>
                        <div id="totalResult" class="mt-2 text-center font-weight-bold"></div>
                        <div id="calculationDetails" class="mt-1 small text-muted"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle category change
        document.getElementById('tilesCategory').addEventListener('change', function() {
            const categoryId = this.value;
            if (categoryId) {
                // Load settings from database via AJAX
                fetch(`/admin/decor-calculator/settings/${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            document.getElementById('lightTimes').value = data.light_times || 4;
                            document.getElementById('decoTimes').value = data.deco_times || 1;
                            document.getElementById('deepTimes').value = data.deep_times || 1;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading settings:', error);
                    });
            }
        });
        
        // Handle exclude deep checkbox
        document.getElementById('excludeDeep').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('deepSection').style.display = 'none';
                document.getElementById('deepResultContainer').style.display = 'none';
            } else {
                document.getElementById('deepSection').style.display = 'flex';
                document.getElementById('deepResultContainer').style.display = 'block';
            }
        });
        
        // Calculate button click
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const categoryId = document.getElementById('tilesCategory').value;
            if (!categoryId) {
                alert('Please select a tiles category');
                return;
            }
            
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            
            const data = {
                category_id: categoryId,
                quantity: document.getElementById('quantity').value,
                height: document.getElementById('height').value,
                light_times: document.getElementById('lightTimes').value,
                light_qty: 1,
                deco_times: document.getElementById('decoTimes').value,
                deco_qty: 1,
                deep_times: document.getElementById('deepTimes').value,
                deep_qty: 1,
                exclude_deep: document.getElementById('excludeDeep').checked
            };
            
            fetch('/admin/decor-calculator/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(response => {
                document.getElementById('lightResult').textContent = 
                    `${Math.round(response.light_quantity)} pcs (${response.light_sqft.toFixed(2)} sq ft)`;
                document.getElementById('decoResult').textContent = 
                    `${Math.round(response.deco_quantity)} pcs (${response.deco_sqft.toFixed(2)} sq ft)`;
                document.getElementById('deepResult').textContent = 
                    `${Math.round(response.deep_quantity)} pcs (${response.deep_sqft.toFixed(2)} sq ft)`;
                
                // Show the total
                document.getElementById('totalResult').textContent = 
                    `Total: ${Math.round(response.total_tiles)} pcs (${response.total_sqft.toFixed(2)} sq ft)`;
                
                // Add calculation details
                document.getElementById('calculationDetails').innerHTML = 
                    `Vertical: ${response.total_vertical_tiles.toFixed(2)} | ` +
                    `Horizontal: ${response.horizontal_tiles.toFixed(2)} | ` +
                    `${response.light_rows.toFixed(1)}L, ${response.deco_rows}D, ${response.deep_rows.toFixed(1)}Dp`;
                
                document.getElementById('resultBox').style.display = 'block';
            })
            .catch(error => {
                alert('Error in calculation. Please check your inputs.');
                console.error('Calculation error:', error);
            });
        });
    });
</script>


--- Contents of dropdown-link.blade.php ---
<a {{ $attributes->merge(['class' => 'block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition duration-150 ease-in-out']) }}>{{ $slot }}</a>


--- Contents of dropdown.blade.php ---
@props(['align' => 'right', 'width' => '48', 'contentClasses' => 'py-1 bg-white'])

@php
$alignmentClasses = match ($align) {
    'left' => 'ltr:origin-top-left rtl:origin-top-right start-0',
    'top' => 'origin-top',
    default => 'ltr:origin-top-right rtl:origin-top-left end-0',
};

$width = match ($width) {
    '48' => 'w-48',
    default => $width,
};
@endphp

<div class="relative" x-data="{ open: false }" @click.outside="open = false" @close.stop="open = false">
    <div @click="open = ! open">
        {{ $trigger }}
    </div>

    <div x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="absolute z-50 mt-2 {{ $width }} rounded-md shadow-lg {{ $alignmentClasses }}"
            style="display: none;"
            @click="open = false">
        <div class="rounded-md ring-1 ring-black ring-opacity-5 {{ $contentClasses }}">
            {{ $content }}
        </div>
    </div>
</div>


--- Contents of input-error.blade.php ---
@props(['messages'])

@if ($messages)
    <ul {{ $attributes->merge(['class' => 'text-sm text-red-600 space-y-1']) }}>
        @foreach ((array) $messages as $message)
            <li>{{ $message }}</li>
        @endforeach
    </ul>
@endif


--- Contents of input-label.blade.php ---
@props(['value'])

<label {{ $attributes->merge(['class' => 'block font-medium text-sm text-gray-700']) }}>
    {{ $value ?? $slot }}
</label>


--- Contents of modal.blade.php ---
@props([
    'name',
    'show' => false,
    'maxWidth' => '2xl'
])

@php
$maxWidth = [
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    'xl' => 'sm:max-w-xl',
    '2xl' => 'sm:max-w-2xl',
][$maxWidth];
@endphp

<div
    x-data="{
        show: @js($show),
        focusables() {
            // All focusable element types...
            let selector = 'a, button, input:not([type=\'hidden\']), textarea, select, details, [tabindex]:not([tabindex=\'-1\'])'
            return [...$el.querySelectorAll(selector)]
                // All non-disabled elements...
                .filter(el => ! el.hasAttribute('disabled'))
        },
        firstFocusable() { return this.focusables()[0] },
        lastFocusable() { return this.focusables().slice(-1)[0] },
        nextFocusable() { return this.focusables()[this.nextFocusableIndex()] || this.firstFocusable() },
        prevFocusable() { return this.focusables()[this.prevFocusableIndex()] || this.lastFocusable() },
        nextFocusableIndex() { return (this.focusables().indexOf(document.activeElement) + 1) % (this.focusables().length + 1) },
        prevFocusableIndex() { return Math.max(0, this.focusables().indexOf(document.activeElement)) -1 },
    }"
    x-init="$watch('show', value => {
        if (value) {
            document.body.classList.add('overflow-y-hidden');
            {{ $attributes->has('focusable') ? 'setTimeout(() => firstFocusable().focus(), 100)' : '' }}
        } else {
            document.body.classList.remove('overflow-y-hidden');
        }
    })"
    x-on:open-modal.window="$event.detail == '{{ $name }}' ? show = true : null"
    x-on:close-modal.window="$event.detail == '{{ $name }}' ? show = false : null"
    x-on:close.stop="show = false"
    x-on:keydown.escape.window="show = false"
    x-on:keydown.tab.prevent="$event.shiftKey || nextFocusable().focus()"
    x-on:keydown.shift.tab.prevent="prevFocusable().focus()"
    x-show="show"
    class="fixed inset-0 overflow-y-auto px-4 py-6 sm:px-0 z-50"
    style="display: {{ $show ? 'block' : 'none' }};"
>
    <div
        x-show="show"
        class="fixed inset-0 transform transition-all"
        x-on:click="show = false"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>

    <div
        x-show="show"
        class="mb-6 bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:w-full {{ $maxWidth }} sm:mx-auto"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
    >
        {{ $slot }}
    </div>
</div>


--- Contents of nav-link.blade.php ---
@props(['active'])

@php
$classes = ($active ?? false)
            ? 'inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


--- Contents of primary-button.blade.php ---
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


--- Contents of product-modal.blade.php ---
<div class="modal fade" id="newProductModal" tabindex="-1" role="dialog" aria-labelledby="newProductModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form id="new-product-form">
      @csrf
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="newProductModalLabel">Create New Product</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Name <span class="text-danger">*</span></label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Company <span class="text-danger">*</span></label>
            <select name="company_id" class="form-control" required>
              <option value="">Select Company</option>
              @foreach($companies as $company)
                <option value="{{ $company->id }}">{{ $company->name }}</option>
              @endforeach
            </select>
          </div>
          <div class="form-group">
            <label>Category <span class="text-danger">*</span></label>
            <select name="category_id" class="form-control" required>
              <option value="">Select Category</option>
              @foreach($categories as $category)
                <option value="{{ $category->id }}">{{ $category->name }}</option>
              @endforeach
            </select>
          </div>
          <div class="form-group">
            <label>Opening Stock <span class="text-danger">*</span></label>
            <input type="number" name="opening_stock" class="form-control" min="0" required>
          </div>
          <div class="form-group">
            <label>Purchase Price <span class="text-danger">*</span></label>
            <input type="number" name="purchase_price" class="form-control" min="0" required>
          </div>
          <div class="form-group">
            <label>Sale Price <span class="text-danger">*</span></label>
            <input type="number" name="sale_price" class="form-control" min="0" required>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea name="description" class="form-control"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save Product</button>
        </div>
      </div>
    </form>
  </div>
</div>


--- Contents of responsive-nav-link.blade.php ---
@props(['active'])

@php
$classes = ($active ?? false)
            ? 'block w-full ps-3 pe-4 py-2 border-l-4 border-indigo-400 text-start text-base font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'block w-full ps-3 pe-4 py-2 border-l-4 border-transparent text-start text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


--- Contents of secondary-button.blade.php ---
<button {{ $attributes->merge(['type' => 'button', 'class' => 'inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


--- Contents of text-input.blade.php ---
@props(['disabled' => false])

<input @disabled($disabled) {{ $attributes->merge(['class' => 'border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm']) }}>


--- Contents of create.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'Add Customer')
@section('page_title', 'Add New Customer')

@section('header_actions')
    <a href="{{ route('customers.index') }}" class="btn modern-btn modern-btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Customers
    </a>
@stop

@section('page_content')
    <!-- Customer Form Card -->
    <div class="card modern-card">
        <div class="card-header modern-header success-header">
            <h3 class="card-title">
                <i class="fas fa-user-plus"></i> Customer Information
            </h3>
        </div>

        <div class="card-body">
            @if ($errors->any())
                <div class="modern-alert modern-alert-danger mb-4">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="alert-content">
                        <h5>Whoops! There were some problems with your input.</h5>
                        <ul class="error-list">
                            @foreach ($errors->all() as $error)
                                <li>{{ $error }}</li>
                            @endforeach
                        </ul>
                    </div>
                </div>
            @endif

            <form action="{{ route('customers.store') }}" method="POST" class="modern-form">
                @csrf

                <div class="form-grid">
                    <div class="form-group-modern full-width">
                        <label for="name" class="modern-label">
                            <i class="fas fa-user"></i>
                            Customer Name
                        </label>
                        <input type="text" 
                               name="name" 
                               id="name" 
                               class="modern-input" 
                               placeholder="Enter customer name" 
                               value="{{ old('name') }}" 
                               required>
                    </div>

                    <div class="form-group-modern full-width">
                        <label for="phone" class="modern-label">
                            <i class="fas fa-phone"></i>
                            Phone Number
                        </label>
                        <input type="text" 
                               name="phone" 
                               id="phone" 
                               class="modern-input" 
                               placeholder="Enter phone number" 
                               value="{{ old('phone') }}" 
                               required>
                    </div>

                    <div class="form-group-modern full-width">
                        <label for="address" class="modern-label">
                            <i class="fas fa-map-marker-alt"></i>
                            Address
                        </label>
                        <textarea name="address" 
                                  id="address" 
                                  class="modern-input" 
                                  rows="3"
                                  placeholder="Enter customer address">{{ old('address') }}</textarea>
                    </div>

                    <div class="form-group-modern half-width">
                        <label for="opening_balance" class="modern-label">
                            <i class="fas fa-dollar-sign"></i>
                            Opening Balance
                        </label>
                        <input type="number" 
                               name="opening_balance" 
                               id="opening_balance" 
                               class="modern-input" 
                               placeholder="0.00" 
                               step="0.01" 
                               value="{{ old('opening_balance', 0) }}">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn modern-btn modern-btn-success">
                        <i class="fas fa-save"></i> Create Customer
                    </button>
                    <a href="{{ route('customers.index') }}" class="btn modern-btn modern-btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Help Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header modern-header info-header">
                    <h3 class="card-title">
                        <i class="fas fa-info-circle"></i> Quick Help
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="help-item">
                                <div class="help-icon bg-success">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="help-content">
                                    <h6>Customer Name</h6>
                                    <p>Enter the full name of the customer. This field is required and must be unique.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="help-item">
                                <div class="help-icon bg-info">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <div class="help-content">
                                    <h6>Phone Number</h6>
                                    <p>Enter a valid phone number. This field is required and must be unique.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="help-item">
                                <div class="help-icon bg-warning">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="help-content">
                                    <h6>Opening Balance</h6>
                                    <p>Set the initial balance for this customer. Can be positive, negative, or zero.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('additional_css')
<style>
/* Form Grid Layout */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.form-group-modern.full-width {
    grid-column: 1 / -1;
}

.form-group-modern.half-width {
    grid-column: span 1;
}

.form-group-modern {
    margin-bottom: 0;
}

/* Modern Form Styling */
.modern-form {
    padding: 0;
}

.modern-label {
    display: flex;
    align-items: center;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.modern-label i {
    margin-right: 0.5rem;
    color: var(--primary-color);
    width: 16px;
}

.modern-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: white;
}

.modern-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.modern-input::placeholder {
    color: var(--text-muted);
}

/* Form Actions */
.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-color);
}

/* Modern Alert Styling */
.modern-alert {
    display: flex;
    align-items: flex-start;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
}

.modern-alert-danger {
    background: linear-gradient(135deg, #fee 0%, #fdd 100%);
    border-left: 4px solid #dc3545;
}

.alert-icon {
    margin-right: 1rem;
    font-size: 1.25rem;
    color: #dc3545;
}

.alert-content h5 {
    margin: 0 0 0.5rem 0;
    color: #721c24;
    font-weight: 600;
}

.error-list {
    margin: 0;
    padding-left: 1.25rem;
    color: #721c24;
}

.error-list li {
    margin-bottom: 0.25rem;
}

/* Help Section */
.help-item {
    display: flex;
    align-items: flex-start;
    text-align: left;
}

.help-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    color: white;
    font-size: 1rem;
    flex-shrink: 0;
}

.help-content h6 {
    margin: 0 0 0.5rem 0;
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
}

.help-content p {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.85rem;
    line-height: 1.4;
}

/* Responsive Design */
@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .form-group-modern.half-width {
        grid-column: 1;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .help-item {
        flex-direction: column;
        text-align: center;
    }
    
    .help-icon {
        margin-right: 0;
        margin-bottom: 0.75rem;
        align-self: center;
    }
}
/* Add to your existing CSS */
.form-group-modern.focused .modern-label {
    color: var(--primary-color);
    transform: translateY(-2px);
    transition: all 0.2s ease;
}

.modern-input.is-valid {
    border-color: #28a745;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.1);
}

.modern-input.is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.1);
}

/* Smooth scrolling for the entire page */
html {
    scroll-behavior: smooth;
}

/* Hardware acceleration for better performance */
.modern-input, .modern-label {
    transform: translateZ(0);
    backface-visibility: hidden;
}

/* Remove spinner arrows from number inputs */
/* Chrome, Safari, Edge, Opera */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* Firefox */
input[type="number"] {
    -moz-appearance: textfield;
}

</style>
@stop

@section('additional_js')
<script>
$(document).ready(function() {
    // Debounce utility function
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Smooth validation feedback
    function smoothValidation(input, isValid) {
        const $input = $(input);
        $input.removeClass('is-valid is-invalid');
        
        requestAnimationFrame(() => {
            if (isValid) {
                $input.addClass('is-valid');
            } else {
                $input.addClass('is-invalid');
            }
        });
    }
    
    // Optimized name capitalization
    const optimizedCapitalize = debounce(function(input) {
        const value = input.value;
        const cursorPosition = input.selectionStart;
        
        // Capitalize first letter of each word
        const capitalizedValue = value.replace(/\b\w/g, match => match.toUpperCase());
        
        if (value !== capitalizedValue) {
            // Use requestAnimationFrame for smooth updates
            requestAnimationFrame(() => {
                input.value = capitalizedValue;
                input.setSelectionRange(cursorPosition, cursorPosition);
            });
        }
    }, 150);
    
    // Enhanced name input handler
    $('#name').on('input', function(e) {
        const value = $(this).val();
        
        // Immediate validation feedback
        smoothValidation(this, value.length > 0);
        
        // Debounced capitalization
        optimizedCapitalize(this);
    });
    
    // Enhanced phone input handler
    $('#phone').on('input', function(e) {
        const $this = $(this);
        let value = $this.val().replace(/\D/g, '');
        
        if (value.length <= 11) {
            $this.val(value);
            smoothValidation(this, value.length >= 10);
        }
    });
    
    // Smooth focus effects
    $('.modern-input').on('focus', function() {
        $(this).closest('.form-group-modern').addClass('focused');
    }).on('blur', function() {
        $(this).closest('.form-group-modern').removeClass('focused');
        
        // Validation on blur
        if ($(this).prop('required') && !$(this).val()) {
            smoothValidation(this, false);
        }
    });
    
    // Enhanced form submission
    $('.modern-form').on('submit', function(e) {
        let isValid = true;
        const $form = $(this);
        
        // Smooth validation for all required fields
        $form.find('[required]').each(function() {
            const hasValue = $(this).val().trim() !== '';
            smoothValidation(this, hasValue);
            if (!hasValue) isValid = false;
        });
        
        if (!isValid) {
            e.preventDefault();
            
            // Smooth scroll to first invalid field
            const $firstInvalid = $form.find('.is-invalid').first();
            if ($firstInvalid.length) {
                $('html, body').animate({
                    scrollTop: $firstInvalid.offset().top - 100
                }, 300);
            }
        }
    });
});
</script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Customer')

@section('content_header')
    <h1>Edit Customer</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if ($errors->any())
                <div class="alert alert-danger">
                    <strong>Whoops!</strong> There were some problems with your input.<br><br>
                    <ul>
                        @foreach ($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('customers.update', $customer->id) }}" method="POST">
                @csrf
                @method('PUT')

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12">
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" name="name" id="name" value="{{ $customer->name }}" class="form-control" placeholder="Customer Name" required>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12">
                        <div class="form-group">
                            <label for="phone">Phone:</label>
                            <input type="text" name="phone" id="phone" value="{{ $customer->phone }}" class="form-control" placeholder="Phone Number" required>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12">
                        <div class="form-group">
                            <label for="address">Address:</label>
                            <textarea class="form-control" name="address" id="address" placeholder="Address">{{ $customer->address }}</textarea>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="opening_balance">Opening Balance:</label>
                            <input type="number" name="opening_balance" id="opening_balance" value="{{ $customer->opening_balance }}" class="form-control" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                    {{-- <div class="col-xs-12 col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="outstanding_balance">Outstanding Balance:</label>
                            <input type="number" name="outstanding_balance" id="outstanding_balance" value="{{ $customer->outstanding_balance }}" class="form-control" placeholder="0.00" step="0.01">
                        </div>
                    </div> --}}
                    <div class="col-xs-12 col-sm-12 col-md-12 text-center">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <a class="btn btn-secondary" href="{{ route('customers.index') }}">Cancel</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script> console.log('Hi!'); </script>
@stop


--- Contents of import.blade.php ---
@extends('adminlte::page')

@section('title', 'Import Customers')

@section('content_header')
    <h1>Import Customers</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Upload Excel File</h3>
        </div>
        <div class="card-body">
            @if ($message = Session::get('error'))
                <div class="alert alert-danger">
                    <p>{{ $message }}</p>
                </div>
            @endif

            <form action="{{ route('customers.import') }}" method="POST" enctype="multipart/form-data">
                @csrf
                <div class="form-group">
                    <label for="file">Excel File</label>
                    <input type="file" name="file" class="form-control @error('file') is-invalid @enderror" required>
                    @error('file')
                        <span class="invalid-feedback" role="alert">
                            <strong>{{ $message }}</strong>
                        </span>
                    @enderror
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Import</button>
                    <a href="{{ route('customers.index') }}" class="btn btn-secondary">Back</a>
                </div>
            </form>

            <div class="mt-4">
                <h4>Instructions:</h4>
                <ol>
                    <li>Download the <a href="{{ route('customers.export.template') }}">template file</a> (optional)</li>
                    <li>Fill in your customer data</li>
                    <li>Upload the file using the form above</li>
                </ol>
                <div class="alert alert-info">
                    <strong>Note:</strong> The Excel file should have the following columns:
                    <ul>
                        <li>name (required)</li>
                        <li>phone (required)</li>
                        <li>address (optional)</li>
                        <li>opening_balance (optional, default: 0)</li>
                        <li>outstanding_balance (optional, default: same as opening_balance)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
@stop


--- Contents of index.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'Customers')
@section('page_title', 'Customer Management')

@section('header_actions')
    <div class="btn-group">
        <a class="btn modern-btn modern-btn-success" href="{{ route('customers.create') }}">
            <i class="fas fa-user-plus"></i> Add New Customer
        </a>
        <button type="button" class="btn modern-btn modern-btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown">
            <span class="sr-only">Toggle Dropdown</span>
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{{ route('customers.import.form') }}">
                <i class="fas fa-file-excel text-success"></i> Import from Excel
            </a>
            <a class="dropdown-item" href="{{ route('customers.export.template') }}">
                <i class="fas fa-download text-info"></i> Download Template
            </a>
        </div>
    </div>
@stop

@section('page_content')
    <!-- Customer Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-primary">
                <div class="stats-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-customers">0</h3>
                    <p class="stats-label">Total Customers</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 5% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="clearFilters();">
                    View All <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-success">
                <div class="stats-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-outstanding">0.00</h3>
                    <p class="stats-label">Total Outstanding</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-down"></i> 2% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByBalance('positive');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-warning">
                <div class="stats-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="overdue-customers">0</h3>
                    <p class="stats-label">High Outstanding</p>
                    <div class="stats-trend">
                        <i class="fas fa-minus"></i> No change
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByBalance('high');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-info">
                <div class="stats-icon">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="active-customers">0</h3>
                    <p class="stats-label">Recently Active</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 8% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByActivity('recent');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Advanced Filters Section -->
    <div class="card modern-card mb-4">
        <div class="card-header modern-header">
            <h3 class="card-title">
                <i class="fas fa-filter"></i> Search & Filters
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-sm btn-light" id="clear-all-filters">
                    <i class="fas fa-times"></i> Clear All
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="search-input" class="form-label">Search Customers</label>
                        <div class="input-group">
                            <input type="text" id="search-input" class="form-control modern-input" placeholder="Name, phone, address...">
                            <div class="input-group-append">
                                <button class="btn modern-btn modern-btn-primary" type="button" id="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="balance-filter" class="form-label">Balance Status</label>
                        <select id="balance-filter" class="form-control modern-select">
                            <option value="">All Customers</option>
                            <option value="positive">Has Outstanding</option>
                            <option value="zero">Zero Balance</option>
                            <option value="negative">Credit Balance</option>
                            <option value="high">High Outstanding (>5000)</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="sort-filter" class="form-label">Sort By</label>
                        <select id="sort-filter" class="form-control modern-select">
                            <option value="name_asc">Name (A-Z)</option>
                            <option value="name_desc">Name (Z-A)</option>
                            <option value="balance_desc">Highest Balance</option>
                            <option value="balance_asc">Lowest Balance</option>
                            <option value="recent">Most Recent</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="form-label">Quick Actions</label>
                        <div class="btn-group btn-block">
                            <button type="button" class="btn modern-btn modern-btn-info btn-sm" id="export-btn">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button type="button" class="btn modern-btn modern-btn-warning btn-sm" id="bulk-actions-btn">
                                <i class="fas fa-cogs"></i> Bulk Actions
                            </button>
                            <button type="button" class="btn modern-btn modern-btn-success btn-sm" id="refresh-btn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customers Table -->
    <div class="card modern-card">
        <div class="card-header modern-header success-header">
            <h3 class="card-title">
                <i class="fas fa-users"></i> Customer Directory
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-sm btn-light" data-toggle="tooltip" title="Refresh Table" id="refresh-table">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button type="button" class="btn btn-sm btn-light" data-toggle="tooltip" title="Column Visibility" id="column-visibility">
                    <i class="fas fa-columns"></i>
                </button>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table id="customers-table" class="table modern-table mb-0">
                    <thead>
                        <tr>
                            <th width="40px">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="select-all">
                                    <label class="custom-control-label" for="select-all"></label>
                                </div>
                            </th>
                            <th>Customer Info</th>
                            <th>Contact Details</th>
                            <th>Opening Balance</th>
                            <th>Outstanding Balance</th>
                            <th>Status</th>
                            <th width="200px">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded via AJAX -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="dataTables_info">
                        Showing <span id="showing-start">0</span> to <span id="showing-end">0</span> of <span id="total-records">0</span> entries
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="float-right">
                        <div class="btn-group">
                            <button class="btn modern-btn modern-btn-primary btn-sm" id="export-selected" disabled>
                                <i class="fas fa-download"></i> Export Selected
                            </button>
                            <button class="btn modern-btn modern-btn-warning btn-sm" id="bulk-edit" disabled>
                                <i class="fas fa-edit"></i> Bulk Edit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header modern-header info-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('customers.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-success">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Customer</h5>
                                    <p>Register new customer</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('customers.import.form') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-info">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Import Customers</h5>
                                    <p>Bulk import from Excel</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('transactions.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-primary">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Payment</h5>
                                    <p>Record customer payment</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('customers.export.template') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-warning">
                                    <i class="fas fa-download"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Download Template</h5>
                                    <p>Excel import template</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('additional_css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">

<style>
/* Stats Cards - Matching your invoice design */
.stats-card {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: none;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
}

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-primary::before {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-success::before {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.stats-card-warning::before {
    background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
}

.stats-card-info::before {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
}

.stats-icon {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    font-size: 1.5rem;
}

.stats-card-success .stats-icon {
    background: rgba(17, 153, 142, 0.1);
    color: #11998e;
}

.stats-card-warning .stats-icon {
    background: rgba(252, 70, 107, 0.1);
    color: #fc466b;
}

.stats-card-info .stats-icon {
    background: rgba(255, 154, 158, 0.1);
    color: #ff9a9e;
}

.stats-content {
    padding-right: 80px;
}

.stats-number {
    font-size: 2rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 0.5rem;
    line-height: 1;
}

.stats-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.stats-trend {
    font-size: 0.75rem;
    color: #28a745;
    font-weight: 500;
}

.stats-trend .fa-arrow-down {
    color: #dc3545;
}

.stats-trend .fa-minus {
    color: var(--text-muted);
}

.stats-link {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0.75rem 1.5rem;
    background: rgba(0, 0, 0, 0.03);
    color: #667eea;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.stats-link:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    text-decoration: none;
}

/* Customer Info Cell Styling */
.customer-info {
    display: flex;
    align-items: center;
}

.customer-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    margin-right: 0.75rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    flex-shrink: 0;
}

.customer-details h6 {
    margin: 0;
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
}

.customer-details small {
    color: var(--text-muted);
    font-size: 0.8rem;
}

/* Contact Details Styling */
.contact-info {
    line-height: 1.4;
}

.contact-info .phone {
    font-weight: 500;
    color: #333;
    margin-bottom: 0.25rem;
}

.contact-info .address {
    color: var(--text-muted);
    font-size: 0.85rem;
}

/* Balance Styling */
.balance-amount {
    font-weight: 600;
    font-size: 1rem;
}

.balance-positive {
    color: #dc3545;
}

.balance-zero {
    color: #28a745;
}

.balance-negative {
    color: #17a2b8;
}

/* Status Badges */
.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-active {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.status-inactive {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: white;
}

.status-overdue {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
}

.status-credit {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 0.25rem;
    justify-content: center;
    flex-wrap: wrap;
}

.action-buttons .btn {
    padding: 0.375rem 0.5rem;
    font-size: 0.75rem;
    border-radius: var(--border-radius);
    min-width: 35px;
}

/* Quick Action Cards */
.quick-action-card {
    display: block;
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    text-decoration: none;
    color: inherit;
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
    height: 100%;
}

.quick-action-card:hover {
    text-decoration: none;
    color: inherit;
    border-color: #667eea;
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.quick-action-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    color: white;
    font-size: 1.25rem;
}

.quick-action-content h5 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.quick-action-content p {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin: 0;
}

/* Enhanced Checkbox Styling */
.custom-control-input:checked ~ .custom-control-label::before {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

/* Loading State */
.table-loading {
    position: relative;
    opacity: 0.6;
}

.table-loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 10;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .stats-content {
        padding-right: 0;
    }
    
    .stats-icon {
        position: static;
        margin-bottom: 1rem;
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
    
    .stats-number {
        font-size: 1.5rem;
    }
    
    .customer-info {
        flex-direction: column;
        text-align: center;
    }
    
    .customer-avatar {
        margin-right: 0;
        margin-bottom: 0.5rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>
@stop

@section('additional_js')
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable with enhanced features
    const table = $('#customers-table').DataTable({
        processing: true,
        serverSide: true,
         searching: false, // Disable built-in search
        ajax: {
            url: "{{ route('customers.getCustomers') }}",
            data: function(d) {
                d.search_input = $('#search-input').val();
                d.balance_filter = $('#balance-filter').val();
                d.sort_filter = $('#sort-filter').val();
            }
        },
        columns: [
            {
                data: null,
                name: 'checkbox',
                orderable: false,
                searchable: false,
                width: '40px',
                render: function(data, type, row) {
                    return `<div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input customer-checkbox" id="check_${row.id}" value="${row.id}">
                                <label class="custom-control-label" for="check_${row.id}"></label>
                            </div>`;
                }
            },
            {
                data: 'name',
                name: 'name',
                render: function(data, type, row) {
                    const initials = row.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    return `
                        <div class="customer-info">
                            <div class="customer-avatar">${initials}</div>
                            <div class="customer-details">
                                <h6>${row.name}</h6>
                                <small>ID: ${row.id}</small>
                            </div>
                        </div>
                    `;
                }
            },
            {
                data: 'phone',
                name: 'phone',
                render: function(data, type, row) {
                    return `
                        <div class="contact-info">
                            <div class="phone">
                                <i class="fas fa-phone text-primary"></i> ${row.phone || 'N/A'}
                            </div>
                            <div class="address">
                                <i class="fas fa-map-marker-alt text-muted"></i> ${row.address || 'No address provided'}
                            </div>
                        </div>
                    `;
                }
            },
            {
                data: 'opening_balance',
                name: 'opening_balance',
                render: function(data, type, row) {
                    const amount = parseFloat(data) || 0;
                    const className = amount > 0 ? 'balance-positive' : amount < 0 ? 'balance-negative' : 'balance-zero';
                    return `<span class="balance-amount ${className}">${amount.toFixed(2)}</span>`;
                }
            },
            {
                data: 'outstanding_balance',
                name: 'outstanding_balance',
                render: function(data, type, row) {
                    const amount = parseFloat(data) || 0;
                    const className = amount > 0 ? 'balance-positive' : amount < 0 ? 'balance-negative' : 'balance-zero';
                    return `<span class="balance-amount ${className}">${amount.toFixed(2)}</span>`;
                }
            },
            {
                data: null,
                name: 'status',
                render: function(data, type, row) {
                    const outstanding = parseFloat(row.outstanding_balance) || 0;
                    if (outstanding > 5000) {
                        return '<span class="status-badge status-overdue">High Outstanding</span>';
                    } else if (outstanding > 0) {
                        return '<span class="status-badge status-active">Outstanding</span>';
                    } else if (outstanding < 0) {
                        return '<span class="status-badge status-credit">Credit</span>';
                    } else {
                        return '<span class="status-badge status-active">Clear</span>';
                    }
                }
            },
            {
                data: 'action',
                name: 'action',
                orderable: false,
                searchable: false,
                render: function(data, type, row) {
                    return `
                        <div class="action-buttons">
                            <a href="/customers/${row.id}" class="btn modern-btn modern-btn-info btn-sm" title="View" data-toggle="tooltip">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="/customers/${row.id}/edit" class="btn modern-btn modern-btn-warning btn-sm" title="Edit" data-toggle="tooltip">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="/customer/${row.id}/ledger/" class="btn modern-btn modern-btn-success btn-sm" title="Ledger" data-toggle="tooltip">
                                <i class="fas fa-book"></i>
                            </a>
                            <button type="button" class="btn modern-btn modern-btn-danger btn-sm delete-customer" data-id="${row.id}" title="Delete" data-toggle="tooltip">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                }
            }
        ],
        pageLength: 25,
        lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
        order: [[1, 'asc']],
        responsive: true,
        language: {
            processing: '<div class="d-flex justify-content-center"><div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div></div>',
            emptyTable: '<div class="text-center py-4"><i class="fas fa-users fa-3x text-muted mb-3"></i><br><h5>No customers found</h5><p class="text-muted">Start by adding your first customer</p></div>',
            zeroRecords: '<div class="text-center py-4"><i class="fas fa-search fa-3x text-muted mb-3"></i><br><h5>No matching customers found</h5><p class="text-muted">Try adjusting your search criteria</p></div>'
        },
        drawCallback: function(settings) {
            // Update info display
            const api = this.api();
            const info = api.page.info();
            $('#showing-start').text(info.start + 1);
            $('#showing-end').text(info.end);
            $('#total-records').text(info.recordsTotal);
            
            // Update statistics
            updateStatistics();
            
            // Initialize tooltips
            $('[data-toggle="tooltip"]').tooltip();
            
            // Update bulk action buttons
            updateBulkActionButtons();
        }
    });

    // Search functionality
    $('#search-input').on('keyup', function() {
        table.ajax.reload();
    });

    $('#search-btn').on('click', function() {
        table.ajax.reload();
    });

    // Filter functionality
    $('#balance-filter, #sort-filter').on('change', function() {
        table.ajax.reload();
    });

    // Clear all filters
    $('#clear-all-filters').on('click', function() {
        clearFilters();
    });

    function clearFilters() {
        $('#search-input').val('');
        $('#balance-filter').val('');
        $('#sort-filter').val('name_asc');
        table.ajax.reload();
    }

    // Select all functionality
    $('#select-all').on('change', function() {
        const isChecked = $(this).is(':checked');
        $('.customer-checkbox').prop('checked', isChecked);
        updateBulkActionButtons();
    });

    // Individual checkbox functionality
    $(document).on('change', '.customer-checkbox', function() {
        updateBulkActionButtons();
        
        // Update select all checkbox
        const totalCheckboxes = $('.customer-checkbox').length;
        const checkedCheckboxes = $('.customer-checkbox:checked').length;
        $('#select-all').prop('checked', totalCheckboxes === checkedCheckboxes);
    });

    // Update bulk action buttons
    function updateBulkActionButtons() {
        const checkedCount = $('.customer-checkbox:checked').length;
        $('#export-selected, #bulk-edit').prop('disabled', checkedCount === 0);
    }

    // Delete customer functionality using SweetAlert
    $(document).on('click', '.delete-customer', function() {
        const customerId = $(this).data('id');
        
        Swal.fire({
            title: 'Are you sure?',
            text: "This action cannot be undone!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                // Show loading
                Swal.fire({
                    title: 'Deleting...',
                    text: 'Please wait while we delete the customer.',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // Create form and submit
                const form = $('<form>', {
                    method: 'POST',
                    action: `/customers/${customerId}`
                });
                
                form.append($('<input>', {
                    type: 'hidden',
                    name: '_token',
                    value: $('meta[name="csrf-token"]').attr('content')
                }));
                
                form.append($('<input>', {
                    type: 'hidden',
                    name: '_method',
                    value: 'DELETE'
                }));
                
                $.ajax({
                    url: `/customers/${customerId}`,
                    type: 'POST',
                    data: form.serialize(),
                    success: function(response) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Deleted!',
                            text: 'Customer has been deleted successfully.',
                            timer: 2000,
                            showConfirmButton: false
                        });
                        table.ajax.reload();
                    },
                    error: function(xhr) {
                        let errorMessage = 'Something went wrong. Please try again.';
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        }
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: errorMessage
                        });
                    }
                });
            }
        });
    });

    // Refresh table
    $('#refresh-table, #refresh-btn').on('click', function() {
        $(this).find('i').addClass('fa-spin');
        table.ajax.reload(function() {
            $('.fa-spin').removeClass('fa-spin');
        });
    });

    // Filter functions for stats cards
    window.filterByBalance = function(type) {
        $('#balance-filter').val(type);
        table.ajax.reload();
    };

    window.filterByActivity = function(period) {
        // Implement activity filter if needed
        table.ajax.reload();
    };

    // Update statistics based on current data
    function updateStatistics() {
        // You can implement AJAX calls to get real statistics
        // For now, using the table data
        const info = table.page.info();
        $('#total-customers').text(info.recordsTotal);
        
        // Calculate totals from visible data (you might want to get this from server)
        let totalOutstanding = 0;
        let highOutstanding = 0;
        
        table.rows().data().each(function(row) {
            const outstanding = parseFloat(row.outstanding_balance) || 0;
            totalOutstanding += outstanding;
            if (outstanding > 5000) {
                highOutstanding++;
            }
        });
        
        $('#total-outstanding').text(totalOutstanding.toFixed(2));
        $('#overdue-customers').text(highOutstanding);
        $('#active-customers').text(Math.floor(info.recordsTotal * 0.7)); // Example calculation
    }

    // Export functionality
    $('#export-btn, #export-selected').on('click', function() {
        const isSelected = $(this).attr('id') === 'export-selected';
        let url = '/customers/export';
        
        if (isSelected) {
            const selectedIds = $('.customer-checkbox:checked').map(function() {
                return $(this).val();
            }).get();
            
            if (selectedIds.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Selection',
                    text: 'Please select customers to export.'
                });
                return;
            }
            
            url += '?selected=' + selectedIds.join(',');
        }
        
        window.location.href = url;
    });

    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
});
</script>
@stop


--- Contents of print_ledger.blade.php ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Ledger: {{ $customer->name }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        
        .ledger-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .ledger-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo-container {
            width: 80px;
            margin-right: 10px;
        }
        
        .logo-container img {
            width: 100%;
            height: auto;
        }
        
        .company-info {
            text-align: center;
            flex-grow: 1;
        }
        
        .company-info h1 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .customer-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .customer-info {
            width: 50%;
            text-align: left;
        }
        
        .customer-info h3 {
            margin: 0 0 3px 0;
            font-size: 12px;
        }
        
        .customer-info p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .ledger-title {
            width: 50%;
            text-align: right;
        }
        
        .ledger-title h2 {
            margin: 0;
            color: blue;
            font-size: 16px;
        }
        
        .ledger-title p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .summary-boxes {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .summary-box {
            width: 30%;
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .summary-box h4 {
            margin: 0 0 5px 0;
            font-size: 12px;
        }
        
        .summary-box p {
            margin: 0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .ledger-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }
        
        .ledger-table th, .ledger-table td {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
            font-size: 11px;
        }
        
        .ledger-table th {
            background-color: #f2f2f2;
        }
        
        .footer-text {
            text-align: center;
            font-size: 10px;
            margin-top: 15px;
        }
        
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-box {
            width: 45%;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 2px;
        }
        
        .signature-box p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="ledger-container">
        <div class="ledger-header">
            <div class="logo-container">
                <img src="{{ asset('logo/logo.png') }}" alt="RTS Logo">
            </div>
                <div class="company-info">
                    <h1>{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</h1>
                    <p>Phone: {{ $businessSettings->phone ?? '01970-598 449 (Bikash),01795-833 166 (Bikash, Nagad)' }}</p>
                    <p>Email: {{ $businessSettings->email ?? 'rahmantilesbd@gmail.com' }}</p>
                    <p>{{ $businessSettings->address ?? 'Model Town, Sadar, Shariatpur' }} 
                    @if($businessSettings->bin_number) 
                        (BIN: {{ $businessSettings->bin_number }})
                    @else
                        (BIN: 004975254-0811)
                    @endif
                    </p>
                </div>
            </div>
        </div>
        
        <div class="customer-section">
            <div class="customer-info">
                <h3>Customer Details</h3>
                <p><strong>{{ $customer->name }}</strong></p>
                <p>Address: {{ $customer->address }}</p>
                <p>Phone: {{ $customer->phone }}</p>
                @if($customer->email)
                <p>Email: {{ $customer->email }}</p>
                @endif
            </div>
            <div class="ledger-title">
                <h2>CUSTOMER LEDGER</h2>
                <p>Date: {{ date('Y-m-d') }}</p>
                <p>Time: {{ date('h:i A') }}</p>
            </div>
        </div>
        
        <div class="summary-boxes">
            <div class="summary-box">
                <h4>Opening Balance</h4>
                <p>{{ number_format($customer->opening_balance, 2) }}</p>
            </div>
            <div class="summary-box">
                <h4>Total Debit</h4>
                <p>{{ number_format($transactions->where('type', 'debit')->sum('amount'), 2) }}</p>
            </div>
            <div class="summary-box">
                <h4>Total Credit</h4>
                <p>{{ number_format($transactions->where('type', 'credit')->sum('amount'), 2) }}</p>
            </div>
            <div class="summary-box">
                <h4>Outstanding Balance</h4>
                <p>{{ number_format($customer->outstanding_balance, 2) }}</p>
            </div>
        </div>
        
        <table class="ledger-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Purpose</th>
                    <th>Method</th>
                    <th>Reference</th>
                    <th>Debit</th>
                    <th>Credit</th>
                    <th>Balance</th>
                </tr>
            </thead>
            <tbody>
                @php
                    $runningBalance = $customer->opening_balance;
                @endphp
                <tr>
                    <td>-</td>
                    <td><strong>Opening Balance</strong></td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>{{ number_format($runningBalance, 2) }}</td>
                </tr>
                @foreach($transactions as $transaction)
                    @php
                        if ($transaction->type == 'debit') {
                            $runningBalance -= $transaction->amount;
                        } else {
                            $runningBalance += $transaction->amount;
                        }
                    @endphp
                    <tr>
                        <td>{{ $transaction->created_at->format('Y-m-d') }}</td>
                        <td>{{ $transaction->purpose }}</td>
                        <td>{{ ucfirst($transaction->method) }}</td>
                        <td>{{ $transaction->reference ?? '-' }}</td>
                        <td>{{ $transaction->type == 'debit' ? number_format($transaction->amount, 2) : '-' }}</td>
                        <td>{{ $transaction->type == 'credit' ? number_format($transaction->amount, 2) : '-' }}</td>
                        <td>{{ number_format($runningBalance, 2) }}</td>
                    </tr>
                @endforeach
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="4">Total</th>
                    <th>{{ number_format($transactions->where('type', 'debit')->sum('amount'), 2) }}</th>
                    <th>{{ number_format($transactions->where('type', 'credit')->sum('amount'), 2) }}</th>
                    <th>{{ number_format($customer->outstanding_balance, 2) }}</th>
                </tr>
            </tfoot>
        </table>
        
        <div class="signatures">
            <div class="signature-box">
                <p>Customer: {{ $customer->name }}</p>
                <p>Signature and Date</p>
            </div>
                <div class="signature-box">
                    <p>Issued By: {{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</p>
                    <p>Signature and Date</p>
                </div>
        </div>
        
        <div class="footer-text">
            Thanks for being with us.
        </div>
        
        <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px;">
                Print Ledger
            </button>
            <button onclick="window.close()" style="padding: 8px 16px; background-color: #f44336; color: white; border: none; cursor: pointer; font-size: 14px; margin-left: 10px; border-radius: 4px;">
                Close
            </button>
        </div>
    </div>
    
    <script>
        window.onload = function() {
            // Uncomment to automatically print when the page loads
            // window.print();
        };
    </script>
</body>
</html>


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Customer Details')

@section('content_header')
    <h1>Customer Details</h1>
@stop

@section('content')
    <!-- Customer Information Card -->
    <div class="card">
        <div class="card-header bg-info">
            <h3 class="card-title">Customer Information</h3>
            <div class="float-right">
                <a class="btn btn-secondary" href="{{ route('customers.index') }}">Back</a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <strong>Name:</strong>
                        {{ $customer->name }}
                    </div>
                    <div class="form-group">
                        <strong>Phone:</strong>
                        {{ $customer->phone }}
                    </div>
                    <div class="form-group">
                        <strong>Address:</strong>
                        {{ $customer->address }}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <strong>Opening Balance:</strong>
                        {{ number_format($customer->opening_balance, 2) }}
                    </div>
                    <div class="form-group">
                        <strong>Outstanding Balance:</strong>
                        <span class="{{ $customer->outstanding_balance > 0 ? 'text-danger' : 'text-success' }}">
                            {{ number_format($customer->outstanding_balance, 2) }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoices Card -->
    <div class="card">
        <div class="card-header bg-primary">
            <h3 class="card-title">Invoices</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Date</th>
                        <th>Total</th>
                        <th>Paid</th>
                        <th>Due</th>
                        <th>Status</th>
                        <th>Items Count</th>
                        <th>Total Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if(isset($customer->invoices) && $customer->invoices->count() > 0)
                        @foreach($customer->invoices as $invoice)
                        <tr>
                            <td>
                                <a href="{{ route('invoices.show', $invoice->id) }}">
                                    {{ $invoice->invoice_number }}
                                </a>
                            </td>
                            <td>{{ \Carbon\Carbon::parse($invoice->invoice_date)->format('d M, Y') }}</td>
                            <td>{{ number_format($invoice->total, 2) }}</td>
                            <td>{{ number_format($invoice->paid_amount, 2) }}</td>
                            <td>{{ number_format($invoice->due_amount, 2) }}</td>
                            <td>
                                @if($invoice->payment_status == 'paid')
                                    <span class="badge badge-success">Paid</span>
                                @elseif($invoice->payment_status == 'partial')
                                    <span class="badge badge-warning">Partial</span>
                                @else
                                    <span class="badge badge-danger">Unpaid</span>
                                @endif
                            </td>
                            <td>{{ isset($invoice->items) ? $invoice->items->count() : 0 }}</td>
                            <td>{{ isset($invoice->items) ? $invoice->items->sum('quantity') : 0 }}</td>
                            <td>
                                <a href="{{ route('invoices.show', $invoice->id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ route('invoices.print', $invoice->id) }}" class="btn btn-sm btn-secondary">
                                    <i class="fas fa-print"></i>
                                </a>
                            </td>
                        </tr>
                        @endforeach
                    @else
                    <tr>
                        <td colspan="9" class="text-center">No invoices found</td>
                    </tr>
                    @endif
                </tbody>
                <tfoot>
                    <tr class="bg-light">
                        <th colspan="2">Total</th>
                        <th>{{ isset($customer->invoices) ? number_format($customer->invoices->sum('total'), 2) : '0.00' }}</th>
                        <th>{{ isset($customer->invoices) ? number_format($customer->invoices->sum('paid_amount'), 2) : '0.00' }}</th>
                        <th>{{ isset($customer->invoices) ? number_format($customer->invoices->sum('due_amount'), 2) : '0.00' }}</th>
                        <th></th>
                        <th>{{ isset($customer->invoices) && $customer->invoices->count() > 0 ? $customer->invoices->sum(function($invoice) { return isset($invoice->items) ? $invoice->items->count() : 0; }) : 0 }}</th>
                        <th>{{ isset($customer->invoices) && $customer->invoices->count() > 0 ? $customer->invoices->sum(function($invoice) { return isset($invoice->items) ? $invoice->items->sum('quantity') : 0; }) : 0 }}</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Product Returns Card -->
    <div class="card">
        <div class="card-header bg-danger">
            <h3 class="card-title">Product Returns</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Return #</th>
                        <th>Date</th>
                        <th>Invoice #</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Items Count</th>
                        <th>Total Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if(isset($customer->productReturns) && $customer->productReturns->count() > 0)
                        @foreach($customer->productReturns as $return)
                        <tr>
                            <td>
                                <a href="{{ route('returns.show', $return->id) }}">
                                    {{ $return->return_number }}
                                </a>
                            </td>
                            <td>{{ \Carbon\Carbon::parse($return->return_date)->format('d M, Y') }}</td>
                            <td>
                                @if(isset($return->invoice) && $return->invoice)
                                    <a href="{{ route('invoices.show', $return->invoice_id) }}">
                                        {{ $return->invoice->invoice_number }}
                                    </a>
                                @else
                                    N/A
                                @endif
                            </td>
                            <td>{{ number_format($return->total, 2) }}</td>
                            <td>
                                @if($return->status == 'completed')
                                    <span class="badge badge-success">Completed</span>
                                @elseif($return->status == 'pending')
                                    <span class="badge badge-warning">Pending</span>
                                @else
                                    <span class="badge badge-info">{{ ucfirst($return->status) }}</span>
                                @endif
                            </td>
                            <td>{{ isset($return->items) ? $return->items->count() : 0 }}</td>
                            <td>{{ isset($return->items) ? $return->items->sum('quantity') : 0 }}</td>
                            <td>
                                <a href="{{ route('returns.show', $return->id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ route('returns.print', $return->id) }}" class="btn btn-sm btn-secondary">
                                    <i class="fas fa-print"></i>
                                </a>
                            </td>
                        </tr>
                        @endforeach
                    @else
                    <tr>
                        <td colspan="8" class="text-center">No product returns found</td>
                    </tr>
                    @endif
                </tbody>
                <tfoot>
                    <tr class="bg-light">
                        <th colspan="3">Total</th>
                        <th>{{ isset($customer->productReturns) ? number_format($customer->productReturns->sum('total'), 2) : '0.00' }}</th>
                        <th></th>
                        <th>{{ isset($customer->productReturns) && $customer->productReturns->count() > 0 ? $customer->productReturns->sum(function($return) { return isset($return->items) ? $return->items->count() : 0; }) : 0 }}</th>
                        <th>{{ isset($customer->productReturns) && $customer->productReturns->count() > 0 ? $customer->productReturns->sum(function($return) { return isset($return->items) ? $return->items->sum('quantity') : 0; }) : 0 }}</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Returned Products Summary -->
    <div class="card">
        <div class="card-header bg-danger">
            <h3 class="card-title">Returned Products Summary</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Total Returned Quantity</th>
                        <th>Total Return Amount</th>
                        <th>Last Return Date</th>
                    </tr>
                </thead>
                <tbody>
                    @php
                        // Use a regular PHP array for building the returns summary
                        $returnSummaryArray = [];
                        
                        if(isset($customer->productReturns) && $customer->productReturns->count() > 0) {
                            foreach($customer->productReturns as $return) {
                                if(isset($return->items) && $return->items->count() > 0) {
                                    foreach($return->items as $item) {
                                        if(isset($item->product)) {
                                            $key = $item->product_id;
                                            
                                            // Initialize product entry if it doesn't exist
                                            if(!isset($returnSummaryArray[$key])) {
                                                $returnSummaryArray[$key] = [
                                                    'name' => $item->product->name ?? 'Unknown Product',
                                                    'category' => isset($item->product->category) ? $item->product->category->name : 'N/A',
                                                    'quantity' => 0,
                                                    'amount' => 0,
                                                    'last_date' => $return->return_date
                                                ];
                                            }
                                            
                                            // Update summary values
                                            $returnSummaryArray[$key]['quantity'] += $item->quantity;
                                            $returnSummaryArray[$key]['amount'] += $item->total;
                                            
                                            // Update last return date if newer
                                            if($return->return_date > $returnSummaryArray[$key]['last_date']) {
                                                $returnSummaryArray[$key]['last_date'] = $return->return_date;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Convert to collection after all modifications
                        $returnSummary = collect($returnSummaryArray);
                    @endphp
                    
                    @if(count($returnSummaryArray) > 0)
                        @foreach($returnSummary as $product)
                        <tr>
                            <td>{{ $product['name'] }}</td>
                            <td>{{ $product['category'] }}</td>
                            <td>{{ number_format($product['quantity'], 2) }}</td>
                            <td>{{ number_format($product['amount'], 2) }}</td>
                            <td>{{ \Carbon\Carbon::parse($product['last_date'])->format('d M, Y') }}</td>
                        </tr>
                        @endforeach
                    @else
                        <tr>
                            <td colspan="5" class="text-center">No product return data available</td>
                        </tr>
                    @endif
                </tbody>
                <tfoot>
                    <tr class="bg-light">
                        <th colspan="2">Total</th>
                        <th>{{ number_format(collect($returnSummaryArray)->sum('quantity'), 2) }}</th>
                        <th>{{ number_format(collect($returnSummaryArray)->sum('amount'), 2) }}</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Challans Card -->
    <div class="card">
        <div class="card-header bg-success">
            <h3 class="card-title">Delivery Challans</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Challan #</th>
                        <th>Date</th>
                        <th>Invoice #</th>
                        <th>Items Count</th>
                        <th>Total Quantity</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if(isset($customer->challans) && $customer->challans->count() > 0)
                        @foreach($customer->challans as $challan)
                        <tr>
                            <td>
                                <a href="{{ route('challans.show', $challan->id) }}">
                                    {{ $challan->challan_number }}
                                </a>
                            </td>
                            <td>{{ \Carbon\Carbon::parse($challan->challan_date)->format('d M, Y') }}</td>
                            <td>
                                @if(isset($challan->invoice) && $challan->invoice)
                                    <a href="{{ route('invoices.show', $challan->invoice_id) }}">
                                        {{ $challan->invoice->invoice_number }}
                                    </a>
                                @else
                                    N/A
                                @endif
                            </td>
                            <td>{{ isset($challan->items) ? $challan->items->count() : 0 }}</td>
                            <td>{{ isset($challan->items) ? $challan->items->sum('quantity') : 0 }}</td>
                            <td>
                                @if($challan->status == 'delivered')
                                    <span class="badge badge-success">Delivered</span>
                                @elseif($challan->status == 'cancelled')
                                    <span class="badge badge-danger">Cancelled</span>
                                @else
                                    <span class="badge badge-warning">Pending</span>
                                @endif
                            </td>
                            <td>
                                <a href="{{ route('challans.show', $challan->id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ route('challans.print', $challan->id) }}" class="btn btn-sm btn-secondary">
                                    <i class="fas fa-print"></i>
                                </a>
                            </td>
                        </tr>
                        @endforeach
                    @else
                    <tr>
                        <td colspan="7" class="text-center">No challans found</td>
                    </tr>
                    @endif
                </tbody>
                <tfoot>
                    <tr class="bg-light">
                        <th colspan="3">Total</th>
                        <th>{{ isset($customer->challans) && $customer->challans->count() > 0 ? $customer->challans->sum(function($challan) { return isset($challan->items) ? $challan->items->count() : 0; }) : 0 }}</th>
                        <th>{{ isset($customer->challans) && $customer->challans->count() > 0 ? $customer->challans->sum(function($challan) { return isset($challan->items) ? $challan->items->sum('quantity') : 0; }) : 0 }}</th>
                        <th colspan="2"></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    
    <!-- Purchase Summary Card -->
    <div class="card">
        <div class="card-header bg-warning">
            <h3 class="card-title">Product Purchase Summary</h3>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Total Quantity</th>
                        <th>Total Amount</th>
                        <th>Last Purchase Date</th>
                    </tr>
                </thead>
                <tbody>
                    @php
                        // Use a regular PHP array instead of a Collection for building the summary
                        $productSummaryArray = [];
                        
                        if(isset($customer->invoices) && $customer->invoices->count() > 0) {
                            foreach($customer->invoices as $invoice) {
                                if(isset($invoice->items) && $invoice->items->count() > 0) {
                                    foreach($invoice->items as $item) {
                                        if(isset($item->product)) {
                                            $key = $item->product_id;
                                            
                                            // Initialize product entry if it doesn't exist
                                            if(!isset($productSummaryArray[$key])) {
                                                $productSummaryArray[$key] = [
                                                    'name' => $item->product->name ?? 'Unknown Product',
                                                    'category' => isset($item->product->category) ? $item->product->category->name : 'N/A',
                                                    'quantity' => 0,
                                                    'amount' => 0,
                                                    'last_date' => $invoice->invoice_date
                                                ];
                                            }
                                            
                                            // Update summary values
                                            $productSummaryArray[$key]['quantity'] += $item->quantity;
                                            $productSummaryArray[$key]['amount'] += $item->total;
                                            
                                            // Update last purchase date if newer
                                            if($invoice->invoice_date > $productSummaryArray[$key]['last_date']) {
                                                $productSummaryArray[$key]['last_date'] = $invoice->invoice_date;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Convert to collection only after all modifications are done
                        $productSummary = collect($productSummaryArray);
                    @endphp
                    
                    @if(count($productSummaryArray) > 0)
                        @foreach($productSummary as $product)
                        <tr>
                            <td>{{ $product['name'] }}</td>
                            <td>{{ $product['category'] }}</td>
                            <td>{{ number_format($product['quantity'], 2) }}</td>
                            <td>{{ number_format($product['amount'], 2) }}</td>
                            <td>{{ \Carbon\Carbon::parse($product['last_date'])->format('d M, Y') }}</td>
                        </tr>
                        @endforeach
                    @else
                        <tr>
                            <td colspan="5" class="text-center">No product purchase data available</td>
                        </tr>
                    @endif
                </tbody>
                <tfoot>
                    <tr class="bg-light">
                        <th colspan="2">Total</th>
                        <th>{{ number_format(collect($productSummaryArray)->sum('quantity'), 2) }}</th>
                        <th>{{ number_format(collect($productSummaryArray)->sum('amount'), 2) }}</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <style>
        .table th {
            background-color: #f4f6f9;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .card-header {
            color: white;
        }
    </style>
@stop

@section('js')
    <script>
        $(document).ready(function() {
            // Add DataTables for better table functionality
            $('.table').DataTable({
                "paging": true,
                "lengthChange": false,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });
    </script>
@stop


--- Contents of call_log.blade.php ---
@extends('adminlte::page')

@section('title', 'Call History')

@section('content_header')
    <h1>Call History - {{ $customer->name }}</h1>
@stop

@section('content')
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Customer Details</h3>
            </div>
            <div class="card-body">
                <p><strong>Name:</strong> {{ $customer->name }}</p>
                <p><strong>Phone:</strong> {{ $customer->phone }}</p>
                <p><strong>Outstanding Balance:</strong> {{ number_format($customer->outstanding_balance, 2) }}</p>
                <p><strong>Total Calls:</strong> {{ $tracking->calls_made ?? 0 }}</p>
                <p><strong>Missed Calls:</strong> {{ $tracking->missed_calls ?? 0 }}</p>
                <p><strong>Priority:</strong> {{ ucfirst($tracking->priority ?? 'medium') }}</p>
                <p><strong>Due Date:</strong> {{ $tracking->due_date ? $tracking->due_date->format('Y-m-d') : 'Not set' }}</p>
                <a href="{{ route('debt-collection.index') }}" class="btn btn-default">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
                <a href="{{ route('debt-collection.edit-tracking', $customer->id) }}" class="btn btn-primary">
                    <i class="fas fa-edit"></i> Edit Tracking
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Call Notes</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-toggle="modal" data-target="#logCallModal">
                        <i class="fas fa-plus"></i> Log Call
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="timeline">
                    @if($tracking && $tracking->notes)
                        @php
                            $notes = explode("\n", $tracking->notes);
                            $notes = array_filter($notes);
                        @endphp
                        
                        @foreach($notes as $note)
                            @php
                                preg_match('/\[(.*?)\]/', $note, $dateMatch);
                                $date = $dateMatch[1] ?? '';
                                $content = preg_replace('/\[(.*?)\]/', '', $note);
                            @endphp
                            
                            <div>
                                <i class="fas fa-phone bg-blue"></i>
                                <div class="timeline-item">
                                    <span class="time"><i class="fas fa-clock"></i> {{ $date }}</span>
                                    <div class="timeline-body">{{ trim($content) }}</div>
                                </div>
                            </div>
                        @endforeach
                    @else
                        <div class="text-center py-3">
                            <p>No call history found</p>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Log Call Modal -->
<div class="modal fade" id="logCallModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Log Call</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="{{ route('debt-collection.log-call', $customer->id) }}" method="POST">
                @csrf
                <div class="modal-body">
                    <div class="form-group">
                        <label>Call Status</label>
                        <select class="form-control" name="call_status">
                            <option value="successful">Successful</option>
                            <option value="missed">Missed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea class="form-control" name="notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
@stop


--- Contents of call_schedule.blade.php ---
@extends('adminlte::page')

@section('title', 'Call Schedule Planner')

@section('content_header')
    <h1>Call Schedule Planner</h1>
@stop

@section('content')
<div class="row">
    <div class="col-md-3">
        <!-- Filter Card -->
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Filters</h3>
            </div>
            <div class="card-body">
                <form id="schedule-filter-form">
                    <div class="form-group">
                        <label>Priority</label>
                        <select class="form-control" id="priority-filter">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Date Range</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="far fa-calendar-alt"></i>
                                </span>
                            </div>
                            <input type="text" class="form-control float-right" id="date-range-filter">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Min Outstanding</label>
                        <input type="number" class="form-control" id="min-outstanding">
                    </div>
                    
                    <button type="button" class="btn btn-primary btn-block" id="apply-schedule-filters">
                        Apply Filters
                    </button>
                    <button type="button" class="btn btn-default btn-block" id="reset-schedule-filters">
                        Reset
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Statistics Card -->
        <div class="card card-info">
            <div class="card-header">
                <h3 class="card-title">Call Statistics</h3>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                    <p class="text-success text-xl">
                        <i class="fas fa-phone"></i>
                    </p>
                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold">
                            {{ $callsToday }}
                        </span>
                        <span class="text-muted">Calls Today</span>
                    </p>
                </div>
                
                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                    <p class="text-warning text-xl">
                        <i class="fas fa-calendar-day"></i>
                    </p>
                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold">
                            {{ $callsScheduledToday }}
                        </span>
                        <span class="text-muted">Scheduled Today</span>
                    </p>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <p class="text-danger text-xl">
                        <i class="fas fa-hourglass-half"></i>
                    </p>
                    <p class="d-flex flex-column text-right">
                        <span class="font-weight-bold">
                            {{ $overdueCalls }}
                        </span>
                        <span class="text-muted">Overdue Calls</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-9">
        <!-- Calendar View Card -->
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Call Schedule Calendar</h3>
            </div>
            <div class="card-body">
                <div id="call-schedule-calendar"></div>
            </div>
        </div>
    </div>
</div>

<!-- Call Schedule Modal -->
<div class="modal fade" id="schedule-call-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Schedule Call</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="schedule-call-form">
                <div class="modal-body">
                    <input type="hidden" id="schedule-customer-id">
                    <input type="hidden" id="schedule-date">
                    
                    <div class="form-group">
                        <label>Customer</label>
                        <select class="form-control select2" id="customer-select" style="width: 100%;">
                            @foreach($customers as $customer)
                                <option value="{{ $customer->id }}">{{ $customer->name }} (Balance: {{ number_format($customer->outstanding_balance, 2) }})</option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Date</label>
                        <div class="input-group date" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input" id="call-date-input" data-target="#call-date-input"/>
                            <div class="input-group-append" data-target="#call-date-input" data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea class="form-control" id="schedule-notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Priority</label>
                        <select class="form-control" id="schedule-priority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<script>
$(function() {
    // Initialize date range picker
    $('#date-range-filter').daterangepicker({
        locale: {
            format: 'YYYY-MM-DD'
        }
    });
    
    // Initialize select2
    $('.select2').select2();
    
    // Initialize calendar
    const calendarEl = document.getElementById('call-schedule-calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: @json($calendarEvents),
        selectable: true,
        select: function(info) {
            $('#schedule-date').val(info.startStr);
            $('#call-date-input').val(info.startStr);
            $('#schedule-call-modal').modal('show');
        },
        eventClick: function(info) {
            // Show details or edit scheduled call
            $('#schedule-customer-id').val(info.event.extendedProps.customerId);
            $('#customer-select').val(info.event.extendedProps.customerId).trigger('change');
            $('#call-date-input').val(info.event.start.toISOString().slice(0, 10));
            $('#schedule-notes').val(info.event.extendedProps.notes || '');
            $('#schedule-priority').val(info.event.extendedProps.priority || 'medium');
            $('#schedule-call-modal').modal('show');
        },
        eventClassNames: function(arg) {
            // Apply different classes based on priority
            return [
                'bg-' + (arg.event.extendedProps.priority === 'high' ? 'danger' : 
                         (arg.event.extendedProps.priority === 'medium' ? 'warning' : 'info'))
            ];
        }
    });
    calendar.render();
    
    // Handle form submission
    $('#schedule-call-form').submit(function(e) {
        e.preventDefault();
        
        const customerId = $('#customer-select').val();
        const callDate = $('#call-date-input').val();
        const notes = $('#schedule-notes').val();
        const priority = $('#schedule-priority').val();
        
        $.ajax({
            url: "{{ route('debt-collection.schedule-call') }}",
            type: "POST",
            data: {
                _token: "{{ csrf_token() }}",
                customer_id: customerId,
                due_date: callDate,
                notes: notes,
                priority: priority
            },
            success: function(response) {
                $('#schedule-call-modal').modal('hide');
                calendar.refetchEvents();
                toastr.success('Call scheduled successfully');
            },
            error: function(xhr) {
                toastr.error('Error scheduling call');
            }
        });
    });
    
    // Apply filters
    $('#apply-schedule-filters').click(function() {
        const priority = $('#priority-filter').val();
        const dateRange = $('#date-range-filter').val().split(' - ');
        const minOutstanding = $('#min-outstanding').val();
        
        calendar.refetchEvents({
            url: "{{ route('debt-collection.get-schedule-events') }}",
            extraParams: {
                priority: priority,
                start_date: dateRange[0],
                end_date: dateRange[1],
                min_outstanding: minOutstanding
            }
        });
    });
    
    // Reset filters
    $('#reset-schedule-filters').click(function() {
        $('#schedule-filter-form')[0].reset();
        calendar.refetchEvents();
    });
});
</script>
@stop


--- Contents of customer_payment_history.blade.php ---
@extends('adminlte::page')

@section('title', 'Customer Payment History')

@section('content_header')
    <h1>Payment History: {{ $customer->name }}</h1>
@stop

@section('content')
<div class="row">
    <div class="col-md-4">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Customer Information</h3>
            </div>
            <div class="card-body">
                <p><strong>Name:</strong> {{ $customer->name }}</p>
                <p><strong>Phone:</strong> {{ $customer->phone }}</p>
                <p><strong>Email:</strong> {{ $customer->email }}</p>
                <p><strong>Current Balance:</strong> {{ number_format($customer->outstanding_balance, 2) }}</p>
                <p><strong>Payment Terms:</strong> {{ $customer->payment_terms ?? 'Not specified' }}</p>
                
                <hr>
                <h5>Collection Stats</h5>
                <p><strong>Average Days to Pay:</strong> {{ $avgDaysToPay }}</p>
                <p><strong>Payment Reliability:</strong> 
                    <span class="badge badge-{{ $paymentReliability >= 80 ? 'success' : ($paymentReliability >= 50 ? 'warning' : 'danger') }}">
                        {{ $paymentReliability }}%
                    </span>
                </p>
                
                <a href="{{ route('debt-collection.index') }}" class="btn btn-default mt-3">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
                <a href="{{ route('debt-collection.call-history', $customer->id) }}" class="btn btn-info mt-3">
                    <i class="fas fa-phone"></i> Call History
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card card-success">
            <div class="card-header">
                <h3 class="card-title">Payment Timeline</h3>
            </div>
            <div class="card-body">
                <div class="chart">
                    <canvas id="payment-timeline-chart" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <div class="card card-info">
            <div class="card-header">
                <h3 class="card-title">Payment Records</h3>
            </div>
            <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Invoice #</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Payment Date</th>
                            <th>Days Late</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($paymentRecords as $record)
                        <tr class="{{ $record->days_late > 0 ? ($record->days_late > 30 ? 'table-danger' : 'table-warning') : 'table-success' }}">
                            <td>{{ $record->invoice_date->format('d M Y') }}</td>
                            <td>{{ $record->invoice_number }}</td>
                            <td>{{ number_format($record->amount, 2) }}</td>
                            <td>{{ $record->due_date->format('d M Y') }}</td>
                            <td>{{ $record->payment_date ? $record->payment_date->format('d M Y') : 'Unpaid' }}</td>
                            <td>
                                @if($record->payment_date)
                                    @if($record->days_late > 0)
                                        <span class="badge badge-danger">{{ $record->days_late }} days late</span>
                                    @else
                                        <span class="badge badge-success">On time</span>
                                    @endif
                                @else
                                    @if(now()->gt($record->due_date))
                                        <span class="badge badge-danger">{{ now()->diffInDays($record->due_date) }} days overdue</span>
                                    @else
                                        <span class="badge badge-info">Not yet due</span>
                                    @endif
                                @endif
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
$(function() {
    const ctx = document.getElementById('payment-timeline-chart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {!! json_encode($timelineLabels) !!},
            datasets: [
                {
                    label: 'Invoiced Amount',
                    backgroundColor: 'rgba(210, 214, 222, 0.2)',
                    borderColor: 'rgba(210, 214, 222, 1)',
                    pointRadius: 4,
                    pointColor: 'rgba(210, 214, 222, 1)',
                    pointStrokeColor: '#c1c7d1',
                    pointHighlightFill: '#fff',
                    pointHighlightStroke: 'rgba(220,220,220,1)',
                    data: {!! json_encode($invoicedData) !!}
                },
                {
                    label: 'Payment Amount',
                    backgroundColor: 'rgba(60,141,188,0.2)',
                    borderColor: 'rgba(60,141,188,1)',
                    pointRadius: 4,
                    pointColor: '#3b8bba',
                    pointStrokeColor: 'rgba(60,141,188,1)',
                    pointHighlightFill: '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                    data: {!! json_encode($paymentData) !!}
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
});
</script>
@stop


--- Contents of dashboard.blade.php ---
@extends('adminlte::page')

@section('title', 'Collection Dashboard')

@section('content_header')
    <h1>Collection Dashboard</h1>
@stop

@section('content')
<div class="row">
    <!-- Performance Summary -->
    <div class="col-md-8">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Collection Performance</h3>
            </div>
            <div class="card-body">
                <canvas id="collection-performance-chart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Key Metrics -->
    <div class="col-md-4">
        <div class="card card-success">
            <div class="card-header">
                <h3 class="card-title">Key Metrics</h3>
            </div>
            <div class="card-body">
                <div class="info-box bg-light">
                    <div class="info-box-content">
                        <span class="info-box-text text-center text-muted">Total Outstanding</span>
                        <span class="info-box-number text-center text-muted mb-0">{{ number_format($totalOutstanding, 2) }}</span>
                    </div>
                </div>
                <div class="info-box bg-light">
                    <div class="info-box-content">
                        <span class="info-box-text text-center text-muted">Collection Rate</span>
                        <span class="info-box-number text-center text-muted mb-0">{{ number_format($collectionRate, 2) }}%</span>
                    </div>
                </div>
                <div class="info-box bg-light">
                    <div class="info-box-content">
                        <span class="info-box-text text-center text-muted">Average Days to Pay</span>
                        <span class="info-box-number text-center text-muted mb-0">{{ $avgDaysToPay }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Collection Activities -->
<div class="row">
    <div class="col-md-6">
        <div class="card card-info">
            <div class="card-header">
                <h3 class="card-title">Recent Collections</h3>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($recentCollections as $collection)
                        <tr>
                            <td>{{ $collection->customer->name }}</td>
                            <td>{{ number_format($collection->amount, 2) }}</td>
                            <td>{{ $collection->created_at->format('d M Y') }}</td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card card-warning">
            <div class="card-header">
                <h3 class="card-title">Upcoming Due Dates</h3>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Due Amount</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($upcomingDueDates as $tracking)
                        <tr>
                            <td>{{ $tracking->customer->name }}</td>
                            <td>{{ number_format($tracking->customer->outstanding_balance, 2) }}</td>
                            <td>{{ $tracking->due_date->format('d M Y') }}</td>
                            <td>
                                <a href="{{ route('debt-collection.edit-tracking', $tracking->customer_id) }}" class="btn btn-xs btn-info">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
$(function() {
    // Sample chart data - replace with dynamic data from your controller
    const ctx = document.getElementById('collection-performance-chart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {!! json_encode($performanceLabels) !!},
            datasets: [{
                label: 'Collections',
                backgroundColor: 'rgba(60,141,188,0.2)',
                borderColor: 'rgba(60,141,188,1)',
                pointRadius: 3,
                pointColor: '#3b8bba',
                pointStrokeColor: 'rgba(60,141,188,1)',
                pointHighlightFill: '#fff',
                pointHighlightStroke: 'rgba(60,141,188,1)',
                data: {!! json_encode($collectionData) !!}
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});
</script>
@stop


--- Contents of due_this_week.blade.php ---
@extends('adminlte::page')

@section('title', 'Due This Week')

@section('content_header')
    <h1>Customers Due This Week</h1>
@stop

@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ $totalDueThisWeek }} Customers Due This Week</h3>
        <div class="card-tools">
            <a href="{{ route('debt-collection.index') }}" class="btn btn-sm btn-default">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-striped" id="due-this-week-table">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Balance</th>
                    <th>Due Date</th>
                    <th>Last Interaction</th>
                    <th>Call Tracking</th>
                    <th>Actions</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>

<script>
$(function() {
    $('#due-this-week-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{{ route('debt-collection.get-customers') }}",
            data: {
                due_date_start: "{{ now()->startOfWeek()->format('Y-m-d') }}",
                due_date_end: "{{ now()->endOfWeek()->format('Y-m-d') }}"
            }
        },
        columns: [
            { 
                data: null,
                render: function(data) {
                    return `<strong>${data.name}</strong><br>
                            <small>Phone: ${data.phone}</small>`;
                }
            },
            { 
                data: 'outstanding_balance',
                render: function(data) {
                    return parseFloat(data).toFixed(2);
                }
            },
            { data: 'due_date', name: 'due_date' },
            { data: 'last_interaction', name: 'last_interaction' },
            { data: 'call_tracking', name: 'call_tracking' },
            { data: 'action', name: 'action', orderable: false }
        ]
    });
});
</script>
@stop


--- Contents of due_today.blade.php ---
@extends('adminlte::page')

@section('title', 'Due Today')

@section('content_header')
    <h1>Customers Due Today</h1>
@stop

@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ $totalDueToday }} Customers Due Today</h3>
        <div class="card-tools">
            <a href="{{ route('debt-collection.index') }}" class="btn btn-sm btn-default">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-striped" id="due-today-table">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Balance</th>
                    <th>Last Interaction</th>
                    <th>Call Tracking</th>
                    <th>Actions</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>

<script>
$(function() {
    $('#due-today-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{{ route('debt-collection.get-customers') }}",
            data: {
                due_date_start: "{{ now()->format('Y-m-d') }}",
                due_date_end: "{{ now()->format('Y-m-d') }}"
            }
        },
        columns: [
            { 
                data: null,
                render: function(data) {
                    return `<strong>${data.name}</strong><br>
                            <small>Phone: ${data.phone}</small>`;
                }
            },
            { 
                data: 'outstanding_balance',
                render: function(data) {
                    return parseFloat(data).toFixed(2);
                }
            },
            { data: 'last_interaction', name: 'last_interaction' },
            { data: 'call_tracking', name: 'call_tracking' },
            { data: 'action', name: 'action', orderable: false }
        ]
    });
});
</script>
@stop


--- Contents of edit_tracking.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Debt Collection Tracking')

@section('content_header')
    <h1>Edit Tracking - {{ $customer->name }}</h1>
@stop

@section('content')
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Debt Collection Tracking</h3>
        <div class="card-tools">
            <a href="{{ route('debt-collection.index') }}" class="btn btn-sm btn-default">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
    <div class="card-body">
        <form action="{{ route('debt-collection.update-tracking', $customer->id) }}" method="POST">
            @csrf
            @method('PUT')
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="due_date">Due Date</label>
                        <input type="date" name="due_date" id="due_date" class="form-control @error('due_date') is-invalid @enderror" value="{{ old('due_date', $tracking->due_date ? $tracking->due_date->format('Y-m-d') : '') }}">
                        @error('due_date')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="last_call_date">Last Call Date</label>
                        <input type="date" name="last_call_date" id="last_call_date" class="form-control @error('last_call_date') is-invalid @enderror" value="{{ old('last_call_date', $tracking->last_call_date ? $tracking->last_call_date->format('Y-m-d') : '') }}">
                        @error('last_call_date')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="calls_made">Calls Made</label>
                        <input type="number" name="calls_made" id="calls_made" class="form-control @error('calls_made') is-invalid @enderror" value="{{ old('calls_made', $tracking->calls_made ?? 0) }}" min="0">
                        @error('calls_made')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="missed_calls">Missed Calls</label>
                        <input type="number" name="missed_calls" id="missed_calls" class="form-control @error('missed_calls') is-invalid @enderror" value="{{ old('missed_calls', $tracking->missed_calls ?? 0) }}" min="0">
                        @error('missed_calls')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="priority">Priority</label>
                        <select name="priority" id="priority" class="form-control @error('priority') is-invalid @enderror">
                            <option value="low" @if(old('priority', $tracking->priority ?? 'medium') == 'low') selected @endif>Low</option>
                            <option value="medium" @if(old('priority', $tracking->priority ?? 'medium') == 'medium') selected @endif>Medium</option>
                            <option value="high" @if(old('priority', $tracking->priority ?? 'medium') == 'high') selected @endif>High</option>
                        </select>
                        @error('priority')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea name="notes" id="notes" class="form-control @error('notes') is-invalid @enderror" rows="5">{{ old('notes', $tracking->notes ?? '') }}</textarea>
                @error('notes')
                    <div class="invalid-feedback">{{ $message }}</div>
                @enderror
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Update Tracking</button>
            </div>
        </form>
    </div>
</div>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Debt Collection')

@section('content_header')
    <h1>Debt Collection Management</h1>
@stop

@section('content')
<!-- Dashboard Summary Widgets -->
<div class="row">
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h3>{{ $totalDueToday }}</h3>
                <p>Due Today</p>
            </div>
            <div class="icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <a href="{{ route('debt-collection.due-today') }}" class="small-box-footer">
                View Details <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>{{ $totalDueThisWeek }}</h3>
                <p>Due This Week</p>
            </div>
            <div class="icon">
                <i class="fas fa-calendar-week"></i>
            </div>
            <a href="{{ route('debt-collection.due-this-week') }}" class="small-box-footer">
                View Details <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
            <div class="inner">
                <h3>{{ $totalOverdue }}</h3>
                <p>Overdue</p>
            </div>
            <div class="icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <a href="#" class="small-box-footer" id="filter-overdue">
                View Details <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h3>{{ $totalHighPriority }}</h3>
                <p>High Priority</p>
            </div>
            <div class="icon">
                <i class="fas fa-fire"></i>
            </div>
            <a href="#" class="small-box-footer" id="filter-high-priority">
                View Details <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
</div>

<!-- Advanced Filter Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Advanced Filters</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <form id="filter-form">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Outstanding Balance</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="min-balance" placeholder="Min">
                            <input type="number" class="form-control" id="max-balance" placeholder="Max">
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Due Date Range</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                            </div>
                            <input type="text" class="form-control float-right" id="due-date-range">
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Last Call Date</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                            </div>
                            <input type="text" class="form-control float-right" id="last-call-date-range">
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Priority</label>
                        <select class="form-control" id="priority-filter">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 text-right">
                    <button type="button" class="btn btn-default" id="reset-filters">Reset</button>
                    <button type="button" class="btn btn-primary" id="apply-filters">Apply Filters</button>
                </div>
            </div>
        </form>
    </div>
</div>
</div>

<!-- Main Data Table -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Customers with Outstanding Balance</h3>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-striped" id="customers-table">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Balance</th>
                    <th>Last Interaction</th>
                    <th>Due Date</th>
                    <th>Call Tracking</th>
                    <th>Actions</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<!-- Call Modal -->
<div class="modal fade" id="callModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Log Call</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="call-form">
                <div class="modal-body">
                    <input type="hidden" id="customer-id">
                    <div class="form-group">
                        <label>Call Status</label>
                        <select class="form-control" id="call-status">
                            <option value="successful">Successful</option>
                            <option value="missed">Missed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea class="form-control" id="call-notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
@stop

@section('js')
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<script>
$(function() {
    // Initialize date pickers
    $('#due-date-range, #last-call-date-range').daterangepicker({
        autoUpdateInput: false,
        locale: {
            cancelLabel: 'Clear'
        }
    });

    $('#due-date-range, #last-call-date-range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
    });

    $('#due-date-range, #last-call-date-range').on('cancel.daterangepicker', function() {
        $(this).val('');
    });

    // Initialize DataTable
    let table = $('#customers-table').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{{ route('debt-collection.get-customers') }}",
            data: function(d) {
                d.min_balance = $('#min-balance').val();
                d.max_balance = $('#max-balance').val();
                d.priority = $('#priority-filter').val();
                
                let dueDateRange = $('#due-date-range').val().split(' - ');
                if (dueDateRange.length === 2) {
                    d.due_date_start = dueDateRange[0];
                    d.due_date_end = dueDateRange[1];
                }
                
                let lastCallRange = $('#last-call-date-range').val().split(' - ');
                if (lastCallRange.length === 2) {
                    d.last_call_start = lastCallRange[0];
                    d.last_call_end = lastCallRange[1];
                }
            }
        },
        columns: [
            { 
                data: null,
                render: function(data) {
                    return `<strong>${data.name}</strong><br>
                            <small>Phone: ${data.phone}</small>`;
                }
            },
            { 
                data: 'outstanding_balance',
                render: function(data) {
                    return parseFloat(data).toFixed(2);
                }
            },
            { data: 'last_interaction', name: 'last_interaction' },
            { data: 'due_date', name: 'due_date' },
            { data: 'call_tracking', name: 'call_tracking' },
            { data: 'action', name: 'action', orderable: false }
        ]
    });

    // Apply filters
    $('#apply-filters').click(function() {
        table.draw();
    });

    // Reset filters
    $('#reset-filters').click(function() {
        $('#filter-form')[0].reset();
        table.draw();
    });

    // Quick filters
    $('#filter-overdue').click(function() {
        const today = moment().format('YYYY-MM-DD');
        $('#due-date-range').val(`01/01/2000 - ${moment().subtract(1, 'days').format('MM/DD/YYYY')}`);
        table.draw();
    });

    $('#filter-high-priority').click(function() {
        $('#priority-filter').val('high');
        table.draw();
    });

    // Handle call logging
    $('#customers-table').on('click', '.log-call-btn', function() {
        const customerId = $(this).data('customer-id');
        $('#customer-id').val(customerId);
        $('#callModal').modal('show');
    });

    $('#call-form').submit(function(e) {
        e.preventDefault();
        
        const customerId = $('#customer-id').val();
        const callStatus = $('#call-status').val();
        const notes = $('#call-notes').val();
        
        $.ajax({
            url: `/debt-collection/log-call/${customerId}`,
            type: 'POST',
            data: {
                _token: "{{ csrf_token() }}",
                call_status: callStatus,
                notes: notes
            },
            success: function(response) {
                if (response.success) {
                    $('#callModal').modal('hide');
                    table.draw(false);
                    toastr.success('Call logged successfully');
                }
            },
            error: function(xhr) {
                toastr.error('Error logging call');
            }
        });
    });

    // Handle due date updates
    $('#customers-table').on('change', '.due-date-picker', function() {
        const customerId = $(this).data('customer-id');
        const dueDate = $(this).val();
        
        $.ajax({
            url: `/debt-collection/update-due-date/${customerId}`,
            type: 'POST',
            data: {
                _token: "{{ csrf_token() }}",
                due_date: dueDate
            },
            success: function(response) {
                if (response.success) {
                    toastr.success('Due date updated');
                }
            },
            error: function(xhr) {
                toastr.error('Error updating due date');
            }
        });
    });
});
</script>
@stop


--- Contents of overdue_accounts.blade.php ---
@extends('adminlte::page')

@section('title', 'Overdue Accounts')

@section('content_header')
    <h1>Overdue Accounts</h1>
@stop

@section('content')
<div class="row">
    <div class="col-md-12">
        <!-- Aging Breakdown -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Aging Breakdown</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box bg-info">
                            <span class="info-box-icon"><i class="far fa-calendar-alt"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">1-30 Days</span>
                                <span class="info-box-number">{{ number_format($aging['0_30'], 2) }}</span>
                                <div class="progress">
                                    <div class="progress-bar" style="width: {{ $agingPercentage['0_30'] }}%"></div>
                                </div>
                                <span class="progress-description">
                                    {{ $agingCount['0_30'] }} Accounts
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box bg-warning">
                            <span class="info-box-icon"><i class="far fa-calendar-alt"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">31-60 Days</span>
                                <span class="info-box-number">{{ number_format($aging['31_60'], 2) }}</span>
                                <div class="progress">
                                    <div class="progress-bar" style="width: {{ $agingPercentage['31_60'] }}%"></div>
                                </div>
                                <span class="progress-description">
                                    {{ $agingCount['31_60'] }} Accounts
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box bg-danger">
                            <span class="info-box-icon"><i class="far fa-calendar-alt"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">61-90 Days</span>
                                <span class="info-box-number">{{ number_format($aging['61_90'], 2) }}</span>
                                <div class="progress">
                                    <div class="progress-bar" style="width: {{ $agingPercentage['61_90'] }}%"></div>
                                </div>
                                <span class="progress-description">
                                    {{ $agingCount['61_90'] }} Accounts
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box bg-dark">
                            <span class="info-box-icon"><i class="far fa-calendar-alt"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">90+ Days</span>
                                <span class="info-box-number">{{ number_format($aging['90_plus'], 2) }}</span>
                                <div class="progress">
                                    <div class="progress-bar" style="width: {{ $agingPercentage['90_plus'] }}%"></div>
                                </div>
                                <span class="progress-description">
                                    {{ $agingCount['90_plus'] }} Accounts
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filter Controls -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Filter Overdue Accounts</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <form id="overdue-filter-form" class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label>Days Overdue</label>
                    <select class="form-control" id="days-overdue-filter">
                        <option value="">All Overdue</option>
                        <option value="0_30">1-30 Days</option>
                        <option value="31_60">31-60 Days</option>
                        <option value="61_90">61-90 Days</option>
                        <option value="90_plus">90+ Days</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Min Amount</label>
                    <input type="number" class="form-control" id="min-amount-filter">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Last Contact</label>
                    <select class="form-control" id="last-contact-filter">
                        <option value="">Any Time</option>
                        <option value="7">Within 7 Days</option>
                        <option value="14">Within 14 Days</option>
                        <option value="30">Within 30 Days</option>
                        <option value="no_contact">No Contact</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>&nbsp;</label>
                    <div class="d-flex">
                        <button type="button" class="btn btn-primary mr-2" id="apply-overdue-filters">Apply</button>
                        <button type="button" class="btn btn-default" id="reset-overdue-filters">Reset</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Overdue Accounts Table -->
<!-- Overdue Accounts Table -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Overdue Accounts</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool dropdown-toggle" data-toggle="dropdown">
                <i class="fas fa-download"></i> Export
            </button>
            <div class="dropdown-menu dropdown-menu-right">
                <a href="{{ route('debt-collection.export-overdue', ['format' => 'xlsx']) }}" class="dropdown-item">
                    <i class="fas fa-file-excel mr-2"></i> Excel
                </a>
                <a href="{{ route('debt-collection.export-overdue', ['format' => 'pdf']) }}" class="dropdown-item">
                    <i class="fas fa-file-pdf mr-2"></i> PDF
                </a>
            </div>
        </div>
    </div>
    <div class="card-body table-responsive p-0">
        <table class="table table-hover text-nowrap" id="overdue-accounts-table">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Days Overdue</th>
                    <th>Amount</th>
                    <th>Last Contact</th>
                    <th>Last Payment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @forelse($customers as $customer)
                    <tr>
                        <td>
                            <strong>{{ $customer->name }}</strong><br>
                            <small>{{ $customer->phone }}</small>
                        </td>
                        <td>
                            @php
                                $days = $customer->days_overdue ?? 0;
                                $badgeClass = 'badge-';
                                if ($days <= 30) $badgeClass .= 'info';
                                elseif ($days <= 60) $badgeClass .= 'warning';
                                elseif ($days <= 90) $badgeClass .= 'danger';
                                else $badgeClass .= 'dark';
                            @endphp
                            <span class="badge {{ $badgeClass }}">{{ $days }} days</span>
                        </td>
                        <td>{{ number_format($customer->outstanding_balance, 2) }}</td>
                        <td>
                            @if($customer->last_contact_date)
                                {{ $customer->last_contact_date }}<br>
                                <small>{{ $customer->days_since_last_contact }} days ago</small>
                            @else
                                Never
                            @endif
                        </td>
                        <td>
                            @if($customer->last_payment_date)
                                {{ $customer->last_payment_date }}<br>
                                <small>{{ $customer->days_since_last_payment }} days ago</small>
                            @else
                                No payments
                            @endif
                        </td>
                        <td>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-success log-call-btn" data-customer-id="{{ $customer->id }}">
                                    <i class="fas fa-phone"></i>
                                </button>
                                <a href="{{ url('debt-collection/call-history/' . $customer->id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-history"></i>
                                </a>
                                <a href="{{ url('debt-collection/edit-tracking/' . $customer->id) }}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                @empty
                    <tr>
                        <td colspan="6" class="text-center">No overdue accounts found.</td>
                    </tr>
                @endforelse
            </tbody>
        </table>
    </div>
</div>

<!-- Call Modal -->
<div class="modal fade" id="callModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Log Call</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="log-call-form">
        <div class="modal-body">
          <input type="hidden" id="customer-id" name="customer_id">
          <!-- Add your call logging form fields here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

@stop

@section('css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
<script>
document.getElementById('apply-overdue-filters').onclick = function(e) {
    e.preventDefault();
    let params = [];
    let days = document.getElementById('days-overdue-filter').value;
    let min = document.getElementById('min-amount-filter').value;
    let last = document.getElementById('last-contact-filter').value;
    if(days) params.push('days_overdue=' + encodeURIComponent(days));
    if(min) params.push('min_amount=' + encodeURIComponent(min));
    if(last) params.push('last_contact=' + encodeURIComponent(last));
    window.location.search = params.join('&');
};

document.getElementById('reset-overdue-filters').onclick = function(e) {
    e.preventDefault();
    window.location.search = '';
};
</script>
@stop



--- Contents of performance.blade.php ---
@extends('adminlte::page')

@section('title', 'Collection Performance')

@section('content_header')
    <h1>Collection Performance Metrics</h1>
@stop

@section('content')
<div class="row">
    <!-- Time Period Selector -->
    <div class="col-md-12 mb-3">
        <div class="btn-group">
            <button type="button" class="btn btn-default period-selector" data-period="week">This Week</button>
            <button type="button" class="btn btn-default period-selector" data-period="month">This Month</button>
            <button type="button" class="btn btn-default period-selector" data-period="quarter">This Quarter</button>
            <button type="button" class="btn btn-default period-selector" data-period="year">This Year</button>
            <button type="button" class="btn btn-default period-selector active" data-period="custom">Custom Range</button>
        </div>
        
        <div class="float-right">
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">
                        <i class="far fa-calendar-alt"></i>
                    </span>
                </div>
                <input type="text" class="form-control float-right" id="performance-date-range">
            </div>
        </div>
    </div>
    
    <!-- Performance KPIs -->
    <div class="col-md-3">
        <div class="info-box bg-gradient-success">
            <span class="info-box-icon"><i class="fas fa-money-bill"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Total Collected</span>
                <span class="info-box-number">{{ number_format($totalCollected, 2) }}</span>
                <div class="progress">
                    <div class="progress-bar" style="width: {{ $collectionRate }}%"></div>
                </div>
                <span class="progress-description">
                    {{ number_format($collectionRate, 1) }}% of Due Amount
                </span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box bg-gradient-info">
            <span class="info-box-icon"><i class="fas fa-phone"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Calls Made</span>
                <span class="info-box-number">{{ $totalCalls }}</span>
                <div class="progress">
                    <div class="progress-bar" style="width: {{ $callSuccessRate }}%"></div>
                </div>
                <span class="progress-description">
                    {{ number_format($callSuccessRate, 1) }}% Success Rate
                </span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box bg-gradient-warning">
            <span class="info-box-icon"><i class="fas fa-calendar-check"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Due Date Adherence</span>
                <span class="info-box-number">{{ number_format($dueDateAdherence, 1) }}%</span>
                <div class="progress">
                    <div class="progress-bar" style="width: {{ $dueDateAdherence }}%"></div>
                </div>
                <span class="progress-description">
                    {{ $dueDatesMet }} out of {{ $totalDueDates }} due dates met
                </span>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="info-box bg-gradient-danger">
            <span class="info-box-icon"><i class="fas fa-hand-holding-usd"></i></span>
            <div class="info-box-content">
                <span class="info-box-text">Outstanding Reduction</span>
                <span class="info-box-number">{{ number_format($outstandingReduction, 1) }}%</span>
                <div class="progress">
                    <div class="progress-bar" style="width: {{ abs($outstandingReduction) }}%"></div>
                </div>
                <span class="progress-description">
                    {{ $outstandingReduction < 0 ? 'Decreased' : 'Increased' }} from previous period
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Collection Trends -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Collection Trends</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="chart">
            <canvas id="collection-trends-chart" height="300"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <!-- Call Effectiveness -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Call Effectiveness</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart">
                    <canvas id="call-effectiveness-chart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Aging Trends -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Aging Trends</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart">
                    <canvas id="aging-trends-chart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Top Performers and Problem Accounts -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Top Paying Customers</h3>
            </div>
            <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Amount Paid</th>
                            <th>Payment %</th>
                            <th>On-time Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($topCustomers as $customer)
                        <tr>
                            <td>{{ $customer->name }}</td>
                            <td>{{ number_format($customer->amount_paid, 2) }}</td>
                            <td>
                                <div class="progress progress-xs">
                                    <div class="progress-bar bg-success" style="width: {{ $customer->payment_percentage }}%"></div>
                                </div>
                                {{ number_format($customer->payment_percentage, 1) }}%
                            </td>
                            <td>
                                <div class="progress progress-xs">
                                    <div class="progress-bar bg-info" style="width: {{ $customer->on_time_rate }}%"></div>
                                </div>
                                {{ number_format($customer->on_time_rate, 1) }}%
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Problem Accounts</h3>
            </div>
            <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Outstanding</th>
                            <th>Days Overdue</th>
                            <th>No. of Calls</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($problemAccounts as $account)
                        <tr>
                            <td>{{ $account->name }}</td>
                            <td>{{ number_format($account->outstanding_balance, 2) }}</td>
                            <td>
                                <span class="badge badge-{{ $account->days_overdue > 90 ? 'danger' : ($account->days_overdue > 60 ? 'warning' : 'info') }}">
                                    {{ $account->days_overdue }} days
                                </span>
                            </td>
                            <td>{{ $account->calls_made }}</td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<script>
$(function() {
    // Initialize date range picker
    $('#performance-date-range').daterangepicker({
        startDate: moment().subtract(30, 'days'),
        endDate: moment(),
        ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
    }, function(start, end) {
        // When date range is changed, reload data
        loadPerformanceData(start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD'));
    });
    
    // Period selector buttons
    $('.period-selector').click(function() {
        $('.period-selector').removeClass('active');
        $(this).addClass('active');
        
        let period = $(this).data('period');
        let start, end;
        
        switch(period) {
            case 'week':
                start = moment().startOf('week');
                end = moment().endOf('week');
                break;
            case 'month':
                start = moment().startOf('month');
                end = moment().endOf('month');
                break;
            case 'quarter':
                start = moment().startOf('quarter');
                end = moment().endOf('quarter');
                break;
            case 'year':
                start = moment().startOf('year');
                end = moment().endOf('year');
                break;
            default:
                return; // For custom, let the date range picker handle it
        }
        
        $('#performance-date-range').data('daterangepicker').setStartDate(start);
        $('#performance-date-range').data('daterangepicker').setEndDate(end);
        loadPerformanceData(start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD'));
    });
    
    // Collection Trends Chart
    const ctxCollectionTrends = document.getElementById('collection-trends-chart').getContext('2d');
    const collectionTrendsChart = new Chart(ctxCollectionTrends, {
        type: 'line',
        data: {
            labels: {!! json_encode($trendLabels) !!},
            datasets: [
                {
                    label: 'Invoiced Amount',
                    backgroundColor: 'rgba(210, 214, 222, 0.2)',
                    borderColor: 'rgba(210, 214, 222, 1)',
                    pointRadius: 3,
                    fill: true,
                    data: {!! json_encode($invoicedAmounts) !!}
                },
                {
                    label: 'Collected Amount',
                    backgroundColor: 'rgba(60, 141, 188, 0.2)',
                    borderColor: 'rgba(60, 141, 188, 1)',
                    pointRadius: 3,
                    fill: true,
                    data: {!! json_encode($collectedAmounts) !!}
                }
            ]
        },
        options: {
            maintainAspectRatio: false,
            responsive: true,
        }
    });
    
    // Call Effectiveness Chart
    const ctxCallEffectiveness = document.getElementById('call-effectiveness-chart').getContext('2d');
    const callEffectivenessChart = new Chart(ctxCallEffectiveness, {
        type: 'pie',
        data: {
            labels: ['Successful Calls', 'Missed Calls', 'No Payment After Call'],
            datasets: [{
                data: [{{ $successfulCalls }}, {{ $missedCalls }}, {{ $unsuccessfulCalls }}],
                backgroundColor: ['#28a745', '#ffc107', '#dc3545']
            }]
        },
        options: {
            maintainAspectRatio: false,
            responsive: true,
        }
    });
    
    // Aging Trends Chart
    const ctxAgingTrends = document.getElementById('aging-trends-chart').getContext('2d');
    const agingTrendsChart = new Chart(ctxAgingTrends, {
        type: 'bar',
        data: {
            labels: {!! json_encode($agingLabels) !!},
            datasets: [
                {
                    label: '1-30 Days',
                    backgroundColor: '#17a2b8',
                    data: {!! json_encode($aging1to30) !!}
                },
                {
                    label: '31-60 Days',
                    backgroundColor: '#ffc107',
                    data: {!! json_encode($aging31to60) !!}
                },
                {
                    label: '61-90 Days',
                    backgroundColor: '#dc3545',
                    data: {!! json_encode($aging61to90) !!}
                },
                {
                    label: '90+ Days',
                    backgroundColor: '#343a40',
                    data: {!! json_encode($aging90plus) !!}
                }
            ]
        },
        options: {
            maintainAspectRatio: false,
            responsive: true,
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true
                }
            }
        }
    });
    
    // Function to load performance data
    function loadPerformanceData(startDate, endDate) {
        $.ajax({
            url: "{{ route('debt-collection.get-performance-data') }}",
            data: {
                start_date: startDate,
                end_date: endDate
            },
            success: function(data) {
                // Update KPIs
                $('.info-box-number').eq(0).text(numberFormat(data.totalCollected));
                $('.progress-description').eq(0).text(numberFormat(data.collectionRate) + '% of Due Amount');
                
                $('.info-box-number').eq(1).text(data.totalCalls);
                $('.progress-description').eq(1).text(numberFormat(data.callSuccessRate) + '% Success Rate');
                
                $('.info-box-number').eq(2).text(numberFormat(data.dueDateAdherence) + '%');
                $('.progress-description').eq(2).text(data.dueDatesMet + ' out of ' + data.totalDueDates + ' due dates met');
                
                $('.info-box-number').eq(3).text(numberFormat(data.outstandingReduction) + '%');
                $('.progress-description').eq(3).text((data.outstandingReduction < 0 ? 'Decreased' : 'Increased') + ' from previous period');
                
                // Update charts
                updateCollectionTrendsChart(collectionTrendsChart, data.trendLabels, data.invoicedAmounts, data.collectedAmounts);
                updateCallEffectivenessChart(callEffectivenessChart, data.successfulCalls, data.missedCalls, data.unsuccessfulCalls);
                updateAgingTrendsChart(agingTrendsChart, data.agingLabels, data.aging1to30, data.aging31to60, data.aging61to90, data.aging90plus);
                
                // Could also update tables with new data if needed
            },
            error: function() {
                toastr.error('Failed to load performance data');
            }
        });
    }
    
    // Helper functions for updating charts
    function updateCollectionTrendsChart(chart, labels, invoiced, collected) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = invoiced;
        chart.data.datasets[1].data = collected;
        chart.update();
    }
    
    function updateCallEffectivenessChart(chart, successful, missed, unsuccessful) {
        chart.data.datasets[0].data = [successful, missed, unsuccessful];
        chart.update();
    }
    
    function updateAgingTrendsChart(chart, labels, data1, data2, data3, data4) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = data1;
        chart.data.datasets[1].data = data2;
        chart.data.datasets[2].data = data3;
        chart.data.datasets[3].data = data4;
        chart.update();
    }
    
    function numberFormat(number) {
        return parseFloat(number).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    }
});
</script>
@stop


--- Contents of action_buttons.blade.php ---
<div class="btn-group">
    <button type="button" class="btn btn-sm btn-success log-call-btn" data-customer-id="{{ $customer->id }}">
        <i class="fas fa-phone"></i>
    </button>
    <a href="{{ route('debt-collection.call-history', $customer->id) }}" class="btn btn-sm btn-info">
        <i class="fas fa-history"></i>
    </a>
    <a href="{{ route('debt-collection.edit-tracking', $customer->id) }}" class="btn btn-sm btn-primary">
        <i class="fas fa-edit"></i>
    </a>
</div>


--- Contents of call_tracking.blade.php ---
<div class="input-group">
    <input type="date" 
           class="form-control due-date-picker" 
           value="{{ $customer->due_date }}"
           data-customer-id="{{ $customer->id }}">
    <div class="input-group-append">
        <span class="input-group-text">
            <i class="far fa-calendar-alt"></i>
        </span>
    </div>
</div>


--- Contents of customer_info.blade.php ---
<strong>{{ $customer->name }}</strong>
<br>
<small>Phone: {{ $customer->phone }}</small>
<br>
<small>Balance: {{ number_format($customer->outstanding_balance, 2) }}</small>


--- Contents of due_date.blade.php ---
<div class="input-group">
    <input type="date" 
           class="form-control due-date-picker" 
           value="{{ $customer->due_date }}"
           data-customer-id="{{ $customer->id }}">
    <div class="input-group-append">
        <span class="input-group-text">
            <i class="far fa-calendar-alt"></i>
        </span>
    </div>
</div>


--- Contents of last_interaction.blade.php ---
<p>
    <strong>Last Transaction:</strong><br>
    {{ $customer->last_transaction_date }}<br>
    <small>{{ ucfirst($customer->last_transaction_type) }}</small>
</p>
<p>
    <strong>Last Invoice:</strong><br>
    {{ $customer->last_invoice_date }}
</p>
<p>
    <strong>Last Payment:</strong><br>
    {{ $customer->last_payment_date }}
</p>
<p>
    <small>{{ $customer->days_since_last_transaction }} days since last transaction</small>
</p>


--- Contents of create.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'Create Invoice')

@section('page_title', 'Create New Invoice')

@section('header_actions')
    <button type="button" class="btn modern-btn modern-btn-primary" data-toggle="modal" data-target="#decorCalculatorModal">
        <i class="fas fa-calculator"></i> Calculator
    </button>
@stop

@section('page_content')
    <form action="{{ route('invoices.store') }}" method="POST" id="invoice-form">
        @csrf
        
        <!-- Invoice Details Header -->
        <div class="card modern-card">
            <div class="card-header modern-header">
                <h3 class="card-title"><i class="fas fa-file-invoice"></i> Invoice Details</h3>
            </div>
            <div class="card-body">
                <!-- Invoice Type and Delivery Status Row -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label">Invoice Type</label>
                        <div class="toggle-group">
                            <input type="radio" id="invoice_type_tiles" name="invoice_type" value="tiles" 
                                   {{ (!isset($defaultInvoiceType) || $defaultInvoiceType === 'tiles') ? 'checked' : '' }}>
                            <label for="invoice_type_tiles" class="toggle-option">
                                <i class="fas fa-th-large"></i> Tiles
                            </label>
                            
                            <input type="radio" id="invoice_type_other" name="invoice_type" value="other" 
                                   {{ (isset($defaultInvoiceType) && $defaultInvoiceType === 'other') ? 'checked' : '' }}>
                            <label for="invoice_type_other" class="toggle-option">
                                <i class="fas fa-cube"></i> Other
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">Delivery Status</label>
                        <div class="toggle-group">
                            <input type="radio" id="delivery_pending" name="delivery_status" value="pending" checked>
                            <label for="delivery_pending" class="toggle-option">
                                <i class="fas fa-clock"></i> Pending
                            </label>
                            
                            <input type="radio" id="delivery_delivered" name="delivery_status" value="delivered">
                            <label for="delivery_delivered" class="toggle-option">
                                <i class="fas fa-check"></i> Delivered
                            </label>
                        </div>
                    </div>
                </div>
                    
                    <!-- Invoice Info and Customer Info Row -->
                    <div class="row">
                        <!-- Invoice Information -->
                        <div class="col-md-5">
                            <div class="info-section">
                                <div class="section-header">
                                    <i class="fas fa-info-circle"></i> Invoice Info
                                </div>
                                <div class="section-content">
                                    <div class="form-group">
                                        <label for="invoice_number">Invoice Number <span class="required">*</span></label>
                                        <input type="text" name="invoice_number" id="invoice_number" class="form-control modern-input" value="{{ $invoice_number }}" readonly>
                                        <small class="form-text">Auto-generated</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="invoice_date">Invoice Date <span class="required">*</span></label>
                                        <input type="date" name="invoice_date" id="invoice_date" class="form-control modern-input" value="{{ $invoice_date }}" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Information -->
                        <div class="col-md-7">
                            <div class="info-section">
                                <div class="section-header">
                                    <i class="fas fa-user"></i> Customer Information
                                </div>
                                <div class="section-content">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label for="customer_id">Customer <span class="required">*</span></label>
                                                <div class="input-group">
                                                    <select name="customer_id" id="customer_id" class="form-control select2 modern-select" required tabindex="1">
                                                        <option value="">Select Customer</option>
                                                        @foreach($customers as $customer)
                                                            <option value="{{ $customer->id }}" data-phone="{{ $customer->phone }}" data-address="{{ $customer->address }}">
                                                               {{ $customer->name }}{{ $customer->phone ? ' - ' . $customer->phone : '' }}
                                                            </option>
                                                        @endforeach
                                                    </select>
                                                    <div class="input-group-append">
                                                        <button type="button" class="btn btn-success add-btn" data-toggle="modal" data-target="#newCustomerModal" tabindex="-1">
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Outstanding Balance</label>
                                                <input type="text" id="customer_balance" class="form-control modern-input" readonly>
                                                <small class="form-text">Current balance</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="customer_phone">Phone</label>
                                                <input type="text" id="customer_phone" name="customer_phone" class="form-control modern-input" readonly tabindex="-1">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="customer_address">Address</label>
                                                <input type="text" id="customer_address" name="customer_address" class="form-control modern-input" readonly tabindex="-1">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Products Section -->
            <div class="card modern-card mt-4">
                <div class="card-header modern-header products-header">
                    <h3 class="card-title"><i class="fas fa-boxes"></i> Products</h3>
                    {{-- <button type="button" class="btn btn-primary add-product-btn" id="add-product-row">
                        <i class="fas fa-plus"></i> Add Product
                    </button> --}}
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table modern-table" id="product-table">
                            <thead>
                                <tr>
                                    <th>Product <span class="required">*</span></th>
                                    <th>Description</th>
                                    <th>Company</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th class="box-pieces-column">Box</th>
                                    <th class="box-pieces-column">Pieces</th>
                                    <th>Unit Price <span class="required">*</span></th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="product-row">
                                    <td>
                                        <select name="product_id[]" class="form-control select2 product-select modern-select" required tabindex="5">
                                            <option value="">Select Product</option>
                                            @foreach($products as $product)
                                                 <option value="{{ $product->id }}" 
                                                        data-price="{{ $product->sale_price }}" 
                                                        data-stock="{{ $product->current_stock }}" 
                                                        data-purchase="{{ $product->purchase_price }}">
                                                    {{ $product->name }} (Stock: {{ $product->current_stock }})
                                                </option>
                                            @endforeach
                                            <option value="__new__">+ New Product</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" name="description[]" class="form-control product-description modern-input" required>
                                        <input type="text" name="code[]" class="form-control product-code modern-input mt-1" placeholder="Color code (optional)">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control product-company modern-input" readonly>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control product-category modern-input" readonly>
                                    </td>
                                    <td>
                                        <input type="number" name="quantity[]" class="form-control product-quantity modern-input" step="0.01" min="0.01" required>
                                    </td>
                                    <td class="box-pieces-cell">
                                        <input type="number" name="boxes[]" class="form-control product-boxes modern-input" readonly>
                                    </td>
                                    <td class="box-pieces-cell">
                                        <input type="number" name="pieces[]" class="form-control product-pieces modern-input" readonly>
                                    </td>
                                    <td>
                                        <input type="number" name="unit_price[]" class="form-control product-price modern-input" step="0.01" min="0" required>
                                    </td>
                                    <td>
                                        <input type="number" name="item_total[]" class="form-control product-total modern-input" step="0.01" min="0" readonly required>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button type="button" class="btn btn-sm btn-danger remove-row">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-success add-product-row">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="10" class="text-center py-3">
                                        <button type="button" class="btn btn-success add-product-row-bottom">
                                            <i class="fas fa-plus"></i> Add New Row
                                        </button>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Payment and Totals Row -->
            <div class="row mt-4">
                <!-- Payment Information -->
                <div class="col-md-6">
                    <div class="card modern-card">
                        <div class="card-header payment-header">
                            <h3 class="card-title"><i class="fas fa-credit-card"></i> Payment Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="payment_method">Payment Method <span class="required">*</span></label>
                                <select name="payment_method" id="payment_method" class="form-control modern-select" required>
                                    <option value="cash">Cash</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="mobile_bank">Mobile Banking</option>
                                    <option value="cheque">Cheque</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes">Notes</label>
                                <textarea name="notes" id="notes" class="form-control modern-textarea" rows="3" placeholder="Additional notes or comments..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Totals -->
                <div class="col-md-6">
                    <div class="card modern-card">
                        <div class="card-header totals-header">
                            <h3 class="card-title"><i class="fas fa-calculator"></i> Invoice Totals</h3>
                        </div>
                        <div class="card-body">
                            <div class="totals-section">
                                <div class="total-row">
                                    <label>Subtotal:</label>
                                    <input type="number" name="subtotal" id="subtotal" class="form-control modern-input" step="0.01" min="0" readonly required>
                                </div>
                                
                                <div class="total-row">
                                    <label>Discount:</label>
                                    <input type="number" name="discount" id="discount" class="form-control modern-input" step="0.01" min="0" value="0">
                                </div>
                                
                                <div class="total-row total-main">
                                    <label>Total:</label>
                                    <input type="number" name="total" id="total" class="form-control modern-input total-input" step="0.01" min="0" readonly required>
                                </div>
                                
                                <div class="total-row">
                                    <label>Paid Amount:</label>
                                    <input type="number" name="paid_amount" id="paid_amount" class="form-control modern-input" step="0.01" min="0" value="0" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
           <!-- Submit Buttons -->
        <div class="text-center mt-4 mb-4">
            <button type="submit" class="btn modern-btn modern-btn-primary btn-lg" id="save-invoice-btn">
                <i class="fas fa-save"></i> Save Invoice
            </button>
            <a href="{{ route('invoices.index') }}" class="btn btn-outline-secondary btn-lg ml-3">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>
    
    <!-- Include modals -->
    <x-product-modal :companies="$companies" :categories="$categories" />
    <x-customer-modal />
    <x-decor-calculator-modal />
@stop

@section('additional_js')


   <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready(function() {
    // Initialize Select2
    initializeSelect2();
    // Enter key handler for product selection dropdown
    // Enhanced tab navigation that works with Enter key
$(document).on('keydown', '.product-select, .product-description, .product-quantity, .product-price', function(e) {
    const isEnter = e.keyCode === 13 || e.which === 13;
    const isTab = e.keyCode === 9 || e.which === 9;
    const isShiftTab = isTab && e.shiftKey;
    
    if (isEnter || (isTab && !isShiftTab)) {
        const currentRow = $(this).closest('tr');
        const currentField = $(this);
        
        // Prevent default behavior for Enter
        if (isEnter) {
            e.preventDefault();
        }
        
        // Define field order for navigation
        const fieldOrder = ['.product-select', '.product-description', '.product-quantity', '.product-price'];
        const currentFieldClass = getCurrentFieldClass(currentField);
        const currentIndex = fieldOrder.indexOf(currentFieldClass);
        
        // Check if we're on the last field of the row
        if (currentIndex === fieldOrder.length - 1) {
            const productId = currentRow.find('.product-select').val();
            const quantity = currentRow.find('.product-quantity').val();
            const price = currentRow.find('.product-price').val();
            
            // Only create new row if essential data is present
            if (productId && quantity && price) {
                if (isTab) e.preventDefault(); // Prevent default tab behavior
                
                setTimeout(() => {
                    const newRow = addProductRowAfter(currentRow);
                    newRow.find('.product-select').focus();
                    
                    // Open Select2 dropdown for immediate selection
                    if (newRow.find('.product-select').hasClass('select2-hidden-accessible')) {
                        newRow.find('.product-select').select2('open');
                    }
                }, 50);
            }
        } else if (isEnter) {
            // Move to next field in same row for Enter key
            const nextFieldClass = fieldOrder[currentIndex + 1];
            const nextField = currentRow.find(nextFieldClass);
            
            if (nextField.hasClass('select2-hidden-accessible')) {
                nextField.select2('open');
            } else {
                nextField.focus();
            }
        }
    }
});

// Helper function to determine current field class
function getCurrentFieldClass(field) {
    if (field.hasClass('product-select')) return '.product-select';
    if (field.hasClass('product-description')) return '.product-description';
    if (field.hasClass('product-quantity')) return '.product-quantity';
    if (field.hasClass('product-price')) return '.product-price';
    return '';
}


// Helper function to move to next required field
function moveToNextRequiredField(row, currentField) {
    const productSelect = row.find('.product-select');
    const quantityField = row.find('.product-quantity');
    const priceField = row.find('.product-price');
    
    if (!productSelect.val()) {
        productSelect.select2('open');
    } else if (!quantityField.val()) {
        quantityField.focus();
    } else if (!priceField.val()) {
        priceField.focus();
    }
}
// Show modal when "+ New Product" is selected
$(document).on('change', '.product-select', function() {
    if ($(this).val() === '__new__') {
        $('#newProductModal').modal('show');
        $('#new-product-form')[0].reset();
        $(this).val('').trigger('change');
    } else {
        handleProductSelection($(this));
    }
});

$('#newProductModal').on('shown.bs.modal', function() {
    $(this).find('.select2').each(function() {
        $(this).select2({
            dropdownParent: $('#newProductModal'),
            width: '100%'
        });
    });
});


// AJAX submit for new product
$('#new-product-form').submit(function(e) {
    e.preventDefault();
    var $form = $(this);
    $.ajax({
        url: '/products', // Make sure this route accepts AJAX and returns JSON
        type: 'POST',
        data: $form.serialize(),
        success: function(product) {
            // Add new product to all selects
            $('.product-select').each(function() {
                $(this).append(
                  $('<option>', {
                    value: product.id,
                    text: product.name + ' (Stock: ' + product.current_stock + ')',
                    'data-price': product.sale_price,
                    'data-stock': product.current_stock,
                    'data-purchase': product.purchase_price
                  })
                );
            });
            // Select the new product in the last changed row
            var lastSelect = $('.product-select').last();
            lastSelect.val(product.id).trigger('change');
            $('#newProductModal').modal('hide');
        },
        error: function(xhr) {
            alert('Failed to create product. Please check your input.');
        }
    });
});


    // Initial state setup
    const initialInvoiceType = $('input[name="invoice_type"]:checked').val();
    toggleBoxPiecesColumns(initialInvoiceType === 'tiles');

    // Event handlers
    $('input[name="invoice_type"]').change(function() {
        toggleBoxPiecesColumns($(this).val() === 'tiles');
    });
    
    // Handle delivery status change with stock validation
$('input[name="delivery_status"]').change(function() {
    const deliveryStatus = $(this).val();
    const isDelivered = deliveryStatus === 'delivered';
    
    toggleStockWarnings(isDelivered);
    
    // Clear ALL stock warnings when switching away from delivered
    if (!isDelivered) {
        $('.product-row').each(function() {
            $(this).removeClass('insufficient-stock');
            $(this).find('.product-quantity').removeClass('is-invalid');
            $(this).find('.stock-warning-text').remove();
        });
    } else {
        // Re-validate all rows when switching to delivered
        $('.product-row').each(function() {
            validateRowStock($(this));
        });
    }
});

    
    // Add product row handlers - multiple ways to add rows
    $('#add-product-row').click(addProductRow);
    $('.add-product-row-bottom').click(addProductRow);
    
    // Add row from the + button in each row
    $(document).on('click', '.add-product-row', function() {
        const newRow = addProductRowAfter($(this).closest('tr'));
        // Focus on the newly added row's product select
        newRow.find('.product-select').select2('open');
    });
    
    // Remove product row handler
    $(document).on('click', '.remove-row', function() {
        if ($('.product-row').length > 1) {
            $(this).closest('tr').remove();
            calculateInvoiceTotal();
        } else {
            alert('At least one product is required.');
        }
    });
    
    // Calculation event handlers
$(document).on('input', '.product-quantity, .product-price', function() {
    const row = $(this).closest('tr');
    calculateRowTotal(row);
    calculateInvoiceTotal();
    
    // If it's a quantity change, also update boxes/pieces
    if ($(this).hasClass('product-quantity')) {
        calculateBoxesAndPieces(row);
        
        // ONLY validate stock for delivered orders
        const deliveryStatus = $('input[name="delivery_status"]:checked').val();
        if (deliveryStatus === 'delivered') {
            validateRowStock(row);
        } else {
            // Clear any existing stock warnings for non-delivered orders
            row.removeClass('insufficient-stock');
            row.find('.product-quantity').removeClass('is-invalid');
            row.find('.stock-warning-text').remove();
        }
    }
});


    
    $('#discount').on('input', calculateInvoiceTotal);
    $('#paid_amount').on('input', calculateDueAmount);
    
    // Product selection handler
    $(document).on('change', '.product-select', function() {
        handleProductSelection($(this));
    });
    
    // Customer selection handler
    $('#customer_id').change(function() {
        handleCustomerSelection($(this).val());
    });
    
    // Form submission handler with stock validation
// Enhanced form submission handler with stock validation and SweetAlert
$('#invoice-form').on('submit', function(e) {
    e.preventDefault(); // Always prevent default submission
    
    const form = this;
    const formData = new FormData(form);
    
    // Basic validation first (but NOT stock validation)
    let isValid = true;
    $(form).find('input[required], select[required]').each(function() {
        if (!validateField(this)) {
            isValid = false;
        }
    });
    
    if (!isValid) {
        const firstInvalid = $(form).find('.is-invalid').first();
        if (firstInvalid.length) {
            $('html, body').animate({
                scrollTop: firstInvalid.offset().top - 100
            }, 200);
            firstInvalid.focus();
        }
        return false;
    }
    
    // Submit via AJAX to handle stock validation on server-side only
    submitInvoiceForm(formData);
});
    
    // Fix for Bootstrap modals and Select2
    $.fn.modal.Constructor.prototype.enforceFocus = function() {
        var modal = this;
        $(document).on('focusin.modal', function(e) {
            if (modal.$element[0] !== e.target && 
                !modal.$element.has(e.target).length && 
                !$(e.target).closest('.select2-container').length) {
                modal.$element.focus();
            }
        });
    };
});

// Helper Functions
function initializeSelect2() {
    $('.select2').each(function() {
        let options = {
            width: '100%',
            dropdownAutoWidth: true
        };
        
        // If the select is inside a modal, set the dropdown parent
        const modalParent = $(this).closest('.modal');
        if (modalParent.length) {
            options.dropdownParent = modalParent;
        }
        
        $(this).select2(options);
    });
}

function addProductRow() {
    // Get the first row as template
    const templateRow = $('.product-row:first');
    
    // Destroy Select2 on template row temporarily
    const templateSelect = templateRow.find('.product-select');
    if (templateSelect.hasClass('select2-hidden-accessible')) {
        templateSelect.select2('destroy');
    }
    
    // Clone the clean row
    const newRow = templateRow.clone();
    
    // Clear values
    newRow.find('input').val('');
    newRow.find('select').val('').trigger('change');
    
    // Remove Select2 artifacts
    newRow.find('.select2-container').remove();
    newRow.removeClass('insufficient-stock');
    newRow.find('.is-invalid').removeClass('is-invalid');
    newRow.find('.invalid-feedback').remove();
    
    // Add highlighting class
    newRow.addClass('new-row');
    setTimeout(function() {
        newRow.removeClass('new-row');
    }, 1500);
    
    // Append to table
    $('#product-table tbody').append(newRow);
    
    // Apply visibility based on invoice type
    if ($('input[name="invoice_type"]:checked').val() !== 'tiles') {
        newRow.find('.box-pieces-cell').hide();
    }
    
    // Reinitialize Select2 on both template and new row
    initializeRowSelect2(templateRow);
    initializeRowSelect2(newRow);
    
    // Focus on the product select in the new row
    newRow.find('.product-select').select2('open');
    
    return newRow;
}


function addProductRowAfter(currentRow) {
    // Get the original select element before cloning
    const originalSelect = currentRow.find('.product-select');
    
    // Destroy Select2 on the original row temporarily to get clean HTML
    if (originalSelect.hasClass('select2-hidden-accessible')) {
        originalSelect.select2('destroy');
    }
    
    // Clone the row (now without Select2 artifacts)
    const newRow = currentRow.clone();
    
    // Clear all input values in the new row
    newRow.find('input').val('');
    newRow.find('select').val('').trigger('change');
    newRow.find('.product-total').val('');
    
    // Remove any validation classes and Select2 artifacts
    newRow.find('.is-invalid').removeClass('is-invalid');
    newRow.find('.invalid-feedback').remove();
    newRow.removeClass('insufficient-stock');
    
    // Remove any Select2 containers that might have been cloned
    newRow.find('.select2-container').remove();
    
    // Add visual feedback for new row
    newRow.addClass('new-row');
    setTimeout(() => {
        newRow.removeClass('new-row');
    }, 1500);
    
    // Insert after the current row
    currentRow.after(newRow);
    
    // Apply visibility based on invoice type
    if ($('input[name="invoice_type"]:checked').val() !== 'tiles') {
        newRow.find('.box-pieces-cell').hide();
    }
    
    // Reinitialize Select2 on BOTH the original and new row
    initializeRowSelect2(currentRow);
    initializeRowSelect2(newRow);
    
    return newRow;
}
function initializeRowSelect2(row) {
    row.find('.select2').each(function() {
        // Ensure any existing Select2 is destroyed first
        if ($(this).hasClass('select2-hidden-accessible')) {
            $(this).select2('destroy');
        }
        
        // Remove any orphaned Select2 containers
        $(this).siblings('.select2-container').remove();
        
        const modalParent = $(this).closest('.modal');
        const options = {
            width: '100%',
            dropdownAutoWidth: true,
            closeOnSelect: true
        };
        
        if (modalParent.length) {
            options.dropdownParent = modalParent;
        }
        
        $(this).select2(options);
    });
}


function calculateRowTotal(row) {
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const price = parseFloat(row.find('.product-price').val()) || 0;
    row.find('.product-total').val((quantity * price).toFixed(2));
}

function calculateBoxesAndPieces(row) {
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const boxPcs = parseFloat(row.data('box-pcs')) || 0;
    const piecesFeet = parseFloat(row.data('pieces-feet')) || 0;
    
    if (boxPcs > 0 && piecesFeet > 0) {
        const totalPieces = Math.round(quantity / piecesFeet);
        const boxes = Math.floor(totalPieces / boxPcs);
        const pieces = totalPieces - (boxes * boxPcs);
        
        row.find('.product-boxes').val(boxes);
        row.find('.product-pieces').val(pieces);
    } else {
        row.find('.product-boxes').val('');
        row.find('.product-pieces').val('');
    }
}

function calculateInvoiceTotal() {
    let subtotal = 0;
    $('.product-total').each(function() {
        subtotal += parseFloat($(this).val()) || 0;
    });
    
    const discount = parseFloat($('#discount').val()) || 0;
    const total = subtotal - discount;
    
    $('#subtotal').val(subtotal.toFixed(2));
    $('#total').val(total.toFixed(2));
    
    calculateDueAmount();
}

function calculateDueAmount() {
    const total = parseFloat($('#total').val()) || 0;
    const paidAmount = parseFloat($('#paid_amount').val()) || 0;
    $('#due_amount').val((total - paidAmount).toFixed(2));
}

function toggleBoxPiecesColumns(show) {
    if (show) {
        $('.box-pieces-column').show();
        $('.box-pieces-cell').show();
    } else {
        $('.box-pieces-column').hide();
        $('.box-pieces-cell').hide();
    }
}

function validateRowStock(row) {
    // Get current delivery status
    const deliveryStatus = $('input[name="delivery_status"]:checked').val();
    
    // Skip ALL stock validation if not delivered
    if (deliveryStatus !== 'delivered') {
        // Clear any existing warnings
        row.removeClass('insufficient-stock');
        row.find('.product-quantity').removeClass('is-invalid');
        row.find('.stock-warning-text').remove();
        return; // Exit function completely
    }
    
    // Only run stock validation for delivered orders
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const stock = parseFloat(row.find('.product-select option:selected').data('stock')) || 0;
    
    if (quantity > stock) {
        row.addClass('insufficient-stock');
        row.find('.product-quantity').addClass('is-invalid');
        
        if (!row.find('.stock-warning-text').length) {
            row.find('.product-quantity').after('<div class="invalid-feedback stock-warning-text">Exceeds available stock (' + stock + ') - Will result in negative stock</div>');
        }
    } else {
        row.removeClass('insufficient-stock');
        row.find('.product-quantity').removeClass('is-invalid');
        row.find('.stock-warning-text').remove();
    }
}



function toggleStockWarnings(isDelivered) {
    if (isDelivered) {
        $('#delivery-stock-warning').slideDown();
        // Validate stock for all rows
        $('.product-row').each(function() {
            validateRowStock($(this));
        });
    } else {
        $('#delivery-stock-warning').slideUp();
        $('.insufficient-stock').removeClass('insufficient-stock');
        $('.product-quantity.is-invalid').removeClass('is-invalid');
        $('.stock-warning-text').remove();
    }
}

// function hasInsufficientStock() {
//     let hasStockIssues = false;
    
//     $('.product-row').each(function() {
//         const productId = $(this).find('.product-select').val();
        
//         if (productId) {
//             const quantity = parseFloat($(this).find('.product-quantity').val()) || 0;
//             const stock = parseFloat($(this).find('.product-select option:selected').data('stock')) || 0;
            
//             if (quantity > stock) {
//                 hasStockIssues = true;
//                 $(this).find('.product-quantity').addClass('is-invalid');
//             }
//         }
//     });
    
//     return hasStockIssues;
// }

function handleProductSelection(selectElement) {
    const row = selectElement.closest('tr');
    const productId = selectElement.val();
    
    if (productId) {
        $.ajax({
            url: '/product-details/' + productId,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                row.find('.product-description').val(data.name);
                row.find('.product-company').val(data.company ? data.company.name : '');
                row.find('.product-category').val(data.category ? data.category.name : '');
                row.find('.product-price').val(data.sale_price);
                
                row.data('box-pcs', data.category ? data.category.box_pcs : 0);
                row.data('pieces-feet', data.category ? data.category.pieces_feet : 0);
                
                row.find('.product-quantity').val('');
                row.find('.product-boxes').val('');
                row.find('.product-pieces').val('');
                row.find('.product-total').val('');
                
                row.find('.product-quantity').focus();
            }
        });
    } else {
        // Clear fields if no product selected
        row.find('.product-description, .product-company, .product-category, .product-price, .product-quantity, .product-boxes, .product-pieces, .product-total').val('');
        row.data('box-pcs', 0);
        row.data('pieces-feet', 0);
    }
}

function handleCustomerSelection(customerId) {
    if (customerId) {
        $.ajax({
            url: '/customer-details/' + customerId,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                $('#customer_phone').val(data.phone);
                $('#customer_address').val(data.address);
                $('#customer_balance').val(data.outstanding_balance);
            }
        });
    } else {
        $('#customer_phone, #customer_address, #customer_balance').val('');
    }
}

$(document).on('select2:open', () => {
    document.querySelector('.select2-search__field').focus();
});

function validateField(field) {
    if (field.hasAttribute('required') && !field.value) {
        field.classList.add('is-invalid');
        if (!field.nextElementSibling || !field.nextElementSibling.classList.contains('invalid-feedback')) {
            const feedback = document.createElement('div');
            feedback.classList.add('invalid-feedback');
            feedback.textContent = 'This field is required';
            field.after(feedback);
        }
        return false;
    } else {
        field.classList.remove('is-invalid');
        const feedback = field.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback')) {
            feedback.remove();
        }
        return true;
    }
}

// Add event listeners for inline validation
$(document).on('blur', 'input[required], select[required]', function() {
    validateField(this);
});

// Enhance form submission with validation
// Enhanced form submission handler with stock validation and SweetAlert
$('#invoice-form').on('submit', function(e) {
    e.preventDefault(); // Always prevent default submission
    
    const form = this;
    const formData = new FormData(form);
    
    // Basic validation first
    let isValid = true;
    $(form).find('input[required], select[required]').each(function() {
        if (!validateField(this)) {
            isValid = false;
        }
    });
    
    if (!isValid) {
        const firstInvalid = $(form).find('.is-invalid').first();
        if (firstInvalid.length) {
            $('html, body').animate({
                scrollTop: firstInvalid.offset().top - 100
            }, 200);
            firstInvalid.focus();
        }
        return false;
    }
    
    // Submit via AJAX to handle stock validation
    submitInvoiceForm(formData);
});

function submitInvoiceForm(formData, forceNegativeStock = false) {
    // Check delivery status - if pending, always force negative stock
    const deliveryStatus = $('input[name="delivery_status"]:checked').val();
    if (deliveryStatus === 'pending' || deliveryStatus === 'partial') {
        forceNegativeStock = true;
    }
    
    // Add force flag if needed
    if (forceNegativeStock) {
        formData.set('force_negative_stock', '1');
    }
    
    // Show loading state
    const submitBtn = $('#save-invoice-btn');
    const originalText = submitBtn.html();
    submitBtn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');
    
    $.ajax({
        url: $('#invoice-form').attr('action'),
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        success: function(response) {
            if (response.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: response.message,
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    window.location.href = response.redirect;
                });
            }
        },
        error: function(xhr) {
            submitBtn.prop('disabled', false).html(originalText);
            
            if (xhr.status === 422) {
                const response = xhr.responseJSON;
                
                // Only show stock warnings for delivered orders
                if (response.stock_issues && deliveryStatus === 'delivered') {
                    showStockWarningAlert(response.stock_issues, formData);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Validation Error',
                        text: response.message || 'Please check your input and try again.'
                    });
                }
            } else {
                const errorMessage = xhr.responseJSON?.message || 'An error occurred while saving the invoice.';
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage
                });
            }
        }
    });
}

function showStockWarningAlert(stockIssues, formData) {
    let warningHtml = '<div class="text-left"><strong>The following products have insufficient stock:</strong><br><br>';
    
    stockIssues.forEach(issue => {
        warningHtml += `<div class="mb-2">
            <strong>${issue.name}</strong><br>
            <span class="text-muted">Available: ${issue.available} | Required: ${issue.required} | Shortage: ${issue.shortage}</span>
        </div>`;
    });
    
    warningHtml += '<br><strong>Proceeding will result in negative stock levels.</strong></div>';
    
    Swal.fire({
        icon: 'warning',
        title: 'Insufficient Stock Warning',
        html: warningHtml,
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: ' Proceed Anyway',
        cancelButtonText: ' Cancel',
        reverseButtons: true,
        customClass: {
            popup: 'swal-wide'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // User confirmed, submit with force flag
            submitInvoiceForm(formData, true);
        } else {
            // User cancelled, re-enable submit button
            const submitBtn = $('#save-invoice-btn');
            submitBtn.prop('disabled', false).html('<i class="fas fa-save"></i> Save Invoice');
        }
    });
}

// Initialize tooltips
$('[data-toggle="tooltip"]').tooltip();

// For customer modal
$('#newCustomerModal').on('shown.bs.modal', function() {
    $(this).find('.select2').each(function() {
        $(this).select2({
            dropdownParent: $('#newCustomerModal'),
            width: '100%'
        });
    });
});
</script>
@stop

--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Invoice #' . $invoice->invoice_number)

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1>Edit Invoice #{{ $invoice->invoice_number }}</h1>
        <div class="btn-group">
            <a href="{{ route('invoices.show', $invoice) }}" class="btn btn-info">
                <i class="fas fa-eye"></i> View
            </a>
            <a href="{{ route('invoices.print', $invoice) }}" target="_blank" class="btn btn-secondary">
                <i class="fas fa-print"></i> Print
            </a>
        </div>
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Invoice Details</h3>
            <div class="card-tools">
                <div class="btn-group">
                    <span class="badge badge-{{ $invoice->invoice_type == 'tiles' ? 'info' : 'secondary' }} mr-2">
                        {{ ucfirst($invoice->invoice_type) }}
                    </span>
                    <span class="badge badge-{{ $invoice->payment_status == 'paid' ? 'success' : ($invoice->payment_status == 'partial' ? 'info' : 'warning') }} mr-2">
                        {{ ucfirst($invoice->payment_status) }}
                    </span>
                    <span class="badge badge-{{ $invoice->delivery_status == 'delivered' ? 'success' : ($invoice->delivery_status == 'partial' ? 'info' : 'warning') }}">
                        {{ ucfirst($invoice->delivery_status) }}
                    </span>
                </div>
            </div>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif
            
            <form action="{{ route('invoices.update', $invoice) }}" method="POST" id="invoice-form">
                @csrf
                @method('PUT')
                
                <!-- Invoice Type Toggle -->
                <div class="form-group">
                    <label>Invoice Type:</label>
                    <div class="d-flex">
                        <div class="custom-control custom-radio mr-3">
                            <input type="radio" id="invoice_type_tiles" name="invoice_type" value="tiles" 
                                   class="custom-control-input" {{ $invoice->invoice_type == 'tiles' ? 'checked' : '' }}>
                            <label class="custom-control-label" for="invoice_type_tiles">Tiles</label>
                        </div>
                        <div class="custom-control custom-radio">
                            <input type="radio" id="invoice_type_other" name="invoice_type" value="other" 
                                   class="custom-control-input" {{ $invoice->invoice_type == 'other' ? 'checked' : '' }}>
                            <label class="custom-control-label" for="invoice_type_other">Other</label>
                        </div>
                    </div>
                </div>

                <!-- Delivery Status Toggle -->
                <div class="form-group">
                    <label>Delivery Status:</label>
                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                        <label class="btn btn-outline-warning {{ $invoice->delivery_status == 'pending' ? 'active' : '' }}">
                            <input type="radio" name="delivery_status" value="pending" {{ $invoice->delivery_status == 'pending' ? 'checked' : '' }}> Pending
                        </label>
                        <label class="btn btn-outline-info {{ $invoice->delivery_status == 'partial' ? 'active' : '' }}">
                            <input type="radio" name="delivery_status" value="partial" {{ $invoice->delivery_status == 'partial' ? 'checked' : '' }}> Partial
                        </label>
                        <label class="btn btn-outline-success {{ $invoice->delivery_status == 'delivered' ? 'active' : '' }}" id="delivered-status-btn">
                            <input type="radio" name="delivery_status" value="delivered" {{ $invoice->delivery_status == 'delivered' ? 'checked' : '' }}> Delivered
                        </label>
                    </div>
                    <div class="alert alert-warning mt-2 stock-warning" id="delivery-stock-warning" style="display:none;">
                        <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> Setting status to "Delivered" will immediately reduce stock levels for remaining items.
                    </div>
                </div>
                
                <div class="row">
                    <!-- Invoice Info Section -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Invoice Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="invoice_number">Invoice Number <span class="text-danger">*</span></label>
                                    <input type="text" name="invoice_number" id="invoice_number" class="form-control" value="{{ $invoice->invoice_number }}" readonly>
                                    <small class="text-muted">Cannot be changed</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="invoice_date">Invoice Date <span class="text-danger">*</span></label>
                                    <input type="date" name="invoice_date" id="invoice_date" class="form-control" value="{{ $invoice->invoice_date->format('Y-m-d') }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <!-- Customer Info Section -->
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label for="customer_id">Customer <span class="text-danger">*</span></label>
                                    <select name="customer_id" id="customer_id" class="form-control select2" required tabindex="1">
                                        <option value="">Select Customer</option>
                                        @foreach($customers as $customer)
                                            <option value="{{ $customer->id }}" 
                                                {{ $invoice->customer_id == $customer->id ? 'selected' : '' }}
                                                data-phone="{{ $customer->phone }}" 
                                                data-address="{{ $customer->address }}">
                                               {{ $customer->name }}{{ $customer->phone ? ' - ' . $customer->phone : '' }}
                                            </option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Outstanding Balance</label>
                                    <input type="text" id="customer_balance" class="form-control bg-light" value="{{ $invoice->customer->outstanding_balance }}" readonly>
                                    <small class="text-muted">Customer's current balance</small>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="customer_phone">Phone <span class="text-muted">(Customer)</span></label>
                                    <input type="text" id="customer_phone" name="customer_phone" class="form-control bg-light" value="{{ $invoice->customer->phone }}" readonly tabindex="-1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="customer_address">Address <span class="text-muted">(Customer)</span></label>
                                    <input type="text" id="customer_address" name="customer_address" class="form-control bg-light" value="{{ $invoice->customer->address }}" readonly tabindex="-1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="card mt-3">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-sm btn-primary" id="add-product-row">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="product-table">
                                <thead>
                                    <tr>
                                        <th width="18%">Product <span class="text-danger">*</span></th>
                                        <th width="12%">Description</th>
                                        <th width="10%">Company</th>
                                        <th width="10%">Category</th>
                                        <th width="16%">Quantity <span class="text-danger">*</span></th>
                                        <th width="10%" class="box-pieces-column">Box</th>
                                        <th width="10%" class="box-pieces-column">Pieces</th>
                                        <th width="10%">Unit Price <span class="text-danger">*</span></th>
                                        <th width="15%">Total</th>
                                        <th width="5%">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($invoice->items as $index => $item)
                                    <tr class="product-row">
                                        <td>
                                            <select name="product_id[]" class="form-control select2 product-select" required tabindex="5">
                                                <option value="">Select Product</option>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}" 
                                                        {{ $item->product_id == $product->id ? 'selected' : '' }}
                                                        data-price="{{ $product->sale_price }}" 
                                                        data-stock="{{ $product->current_stock + ($item->product_id == $product->id ? $item->quantity : 0) }}"
                                                        data-purchase="{{ $product->purchase_price }}">
                                                        {{ $product->name }} (Stock: {{ $product->current_stock + ($item->product_id == $product->id ? $item->quantity : 0) }})
                                                    </option>
                                                @endforeach
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" name="description[]" class="form-control product-description" value="{{ $item->description }}" required>
                                            <input type="text" name="code[]" class="form-control product-code mt-1" value="{{ $item->code }}" placeholder="Color code (optional)" style="font-size: 0.8rem; height: calc(1.5rem + 2px); padding: 0.2rem 0.4rem;">
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-company" value="{{ $item->product->company->name ?? '' }}" readonly>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-category" value="{{ $item->product->category->name ?? '' }}" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="quantity[]" class="form-control product-quantity" value="{{ $item->quantity }}" step="0.01" min="0.01" required>
                                        </td>
                                        <td class="box-pieces-cell">
                                            <input type="number" name="boxes[]" class="form-control product-boxes" value="{{ $item->boxes }}" readonly>
                                        </td>
                                        <td class="box-pieces-cell">
                                            <input type="number" name="pieces[]" class="form-control product-pieces" value="{{ $item->pieces }}" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="unit_price[]" class="form-control product-price" value="{{ $item->unit_price }}" step="0.01" min="0" required>
                                        </td>
                                        <td>
                                            <input type="number" name="item_total[]" class="form-control product-total" value="{{ $item->total }}" step="0.01" min="0" readonly required>
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-danger remove-row">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                <button type="button" class="btn btn-success add-product-row">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    @endforeach
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="10" class="text-right">
                                            <button type="button" class="btn btn-success add-product-row-bottom">
                                                <i class="fas fa-plus"></i> Add New Row
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Payment and Totals Sections -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <!-- Payment section -->
                        <div class="card">
                            <div class="card-header bg-warning">
                                <h3 class="card-title">Payment Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="payment_method">Payment Method <span class="text-danger">*</span></label>
                                    <select name="payment_method" id="payment_method" class="form-control" required>
                                        <option value="cash" {{ $invoice->payment_method == 'cash' ? 'selected' : '' }}>Cash</option>
                                        <option value="bank" {{ $invoice->payment_method == 'bank' ? 'selected' : '' }}>Bank Transfer</option>
                                        <option value="mobile_bank" {{ $invoice->payment_method == 'mobile_bank' ? 'selected' : '' }}>Mobile Banking</option>
                                        <option value="cheque" {{ $invoice->payment_method == 'cheque' ? 'selected' : '' }}>Cheque</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notes">Notes</label>
                                    <textarea name="notes" id="notes" class="form-control" rows="3">{{ $invoice->notes }}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <!-- Totals section -->
                        <div class="card">
                            <div class="card-header bg-danger">
                                <h3 class="card-title">Invoice Totals</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Subtotal:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="subtotal" id="subtotal" class="form-control" value="{{ $invoice->subtotal }}" step="0.01" min="0" readonly required>
                                    </div>
                                </div>
                                
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Discount:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="discount" id="discount" class="form-control" value="{{ $invoice->discount }}" step="0.01" min="0">
                                    </div>
                                </div>
                                
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Total:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="total" id="total" class="form-control" value="{{ $invoice->total }}" step="0.01" min="0" readonly required>
                                    </div>
                                </div>
                                
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Paid Amount:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="paid_amount" id="paid_amount" class="form-control" value="{{ $invoice->paid_amount }}" step="0.01" min="0" required>
                                    </div>
                                </div>
                                
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Due Amount:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="due_amount" id="due_amount" class="form-control" value="{{ $invoice->due_amount }}" step="0.01" min="0" readonly required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="update-invoice-btn">
                        <i class="fas fa-save"></i> Update Invoice
                    </button>
                    <a href="{{ route('invoices.show', $invoice) }}" class="btn btn-info btn-lg">
                        <i class="fas fa-eye"></i> View Invoice
                    </a>
                    <a href="{{ route('invoices.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
<link rel="stylesheet" href="/css/admin_custom.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
    /* Use the same compact styling from create view */
    .form-group {
        margin-bottom: 10px;
        position: relative;
    }

    .form-control {
        height: 32px;
        padding: 6px 10px;
        border: 1px solid #ced4da;
        font-size: 0.85rem;
    }

    label {
        font-size: 0.85rem;
        margin-bottom: 3px;
        font-weight: 500;
    }

    .card-body {
        padding: 15px;
    }

    .card-header {
        padding: 10px 15px;
    }

    .card-title {
        font-size: 1rem;
        margin-bottom: 0;
    }

    .select2-container--default .select2-selection--single {
        height: 32px;
        padding: 6px 10px;
        border: 1px solid #ced4da;
        font-size: 0.85rem;
    }
    
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 30px;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 20px;
        font-size: 0.85rem;
    }

    #product-table {
        font-size: 0.8rem;
    }

    #product-table th {
        padding: 8px 6px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    #product-table td {
        padding: 6px 4px;
        vertical-align: middle;
    }

    #product-table .form-control {
        height: 28px;
        padding: 4px 6px;
        font-size: 0.75rem;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 0.75rem;
    }

    .btn {
        font-size: 0.85rem;
        padding: 6px 12px;
    }

    .btn-lg {
        font-size: 1rem;
        padding: 8px 16px;
    }

    .badge {
        font-size: 0.7rem;
        padding: 3px 6px;
    }

    .input-group-text {
        font-size: 0.8rem;
        padding: 6px 10px;
    }

    .text-muted, small {
        font-size: 0.75rem;
    }

    .custom-control-label {
        font-size: 0.85rem;
    }

    .custom-control-label::before,
    .custom-control-label::after {
        width: 1rem;
        height: 1rem;
    }

    .alert {
        padding: 8px 12px;
        font-size: 0.85rem;
    }

    .row {
        margin-left: -8px;
        margin-right: -8px;
    }

    .row > [class*="col-"] {
        padding-left: 8px;
        padding-right: 8px;
    }

    textarea.form-control {
        padding: 6px 10px;
        font-size: 0.85rem;
    }

    .col-form-label {
        font-size: 0.85rem;
        padding-top: 6px;
        padding-bottom: 6px;
    }

    .btn-group .btn {
        padding: 4px 6px;
    }

    .fas, .far {
        font-size: 0.8rem;
    }

    .btn-group-toggle .btn {
        font-size: 0.8rem;
        padding: 6px 10px;
    }

    .bg-light, input[readonly] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }

    .text-danger {
        font-weight: bold;
    }

    .form-control:focus, .select2-container--default.select2-container--focus .select2-selection--single {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .add-product-row-bottom {
        margin: 10px 0;
    }

    .product-row.new-row {
        background-color: #f8fff8;
        transition: background-color 1s ease;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    @media (max-width: 768px) {
        .card-body {
            padding: 10px;
        }
        
        .form-control {
            height: 30px;
            font-size: 0.8rem;
        }
        
        #product-table {
            font-size: 0.75rem;
        }
        
        #product-table .form-control {
            height: 26px;
            font-size: 0.7rem;
        }
    }

    .product-row:focus-within {
        background-color: #f8f9fa;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
        transition: all 0.2s ease;
    }

    .product-row.new-row {
        background-color: #d4edda;
        transition: background-color 1.5s ease;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-control[required]:not(:focus):invalid {
        border-color: #dc3545;
    }

    .form-control[required]:valid {
        border-color: #28a745;
    }
</style>

@stop

@section('js')
   <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready(function() {
    // Initialize Select2
    initializeSelect2();
    
    // Store category details for existing rows
    $('.product-row').each(function() {
        const row = $(this);
        const productId = row.find('.product-select').val();
        
        if (productId) {
            $.ajax({
                url: '/product-details/' + productId,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    row.data('box-pcs', data.category ? data.category.box_pcs : 0);
                    row.data('pieces-feet', data.category ? data.category.pieces_feet : 0);
                }
            });
        }
    });

    // Initial state setup
    const initialInvoiceType = $('input[name="invoice_type"]:checked').val();
    toggleBoxPiecesColumns(initialInvoiceType === 'tiles');

    // Event handlers
    $('input[name="invoice_type"]').change(function() {
        toggleBoxPiecesColumns($(this).val() === 'tiles');
    });
    
    // Handle delivery status change with stock validation
    $('input[name="delivery_status"]').change(function() {
        const deliveryStatus = $(this).val();
        const isDelivered = deliveryStatus === 'delivered';
        
        toggleStockWarnings(isDelivered);
        
        if (!isDelivered) {
            $('.product-row').each(function() {
                $(this).removeClass('insufficient-stock');
                $(this).find('.product-quantity').removeClass('is-invalid');
                $(this).find('.stock-warning-text').remove();
            });
        } else {
            $('.product-row').each(function() {
                validateRowStock($(this));
            });
        }
    });

    // Add product row handlers
    $('#add-product-row').click(addProductRow);
    $('.add-product-row-bottom').click(addProductRow);
    
    $(document).on('click', '.add-product-row', function() {
        const newRow = addProductRowAfter($(this).closest('tr'));
        newRow.find('.product-select').select2('open');
    });
    
    // Remove product row handler
    $(document).on('click', '.remove-row', function() {
        if ($('.product-row').length > 1) {
            $(this).closest('tr').remove();
            calculateInvoiceTotal();
        } else {
            alert('At least one product is required.');
        }
    });
    
    // Calculation event handlers
    $(document).on('input', '.product-quantity, .product-price', function() {
        const row = $(this).closest('tr');
        calculateRowTotal(row);
        calculateInvoiceTotal();
        
        if ($(this).hasClass('product-quantity')) {
            calculateBoxesAndPieces(row);
            
            const deliveryStatus = $('input[name="delivery_status"]:checked').val();
            if (deliveryStatus === 'delivered') {
                validateRowStock(row);
            } else {
                row.removeClass('insufficient-stock');
                row.find('.product-quantity').removeClass('is-invalid');
                row.find('.stock-warning-text').remove();
            }
        }
    });

    $('#discount').on('input', calculateInvoiceTotal);
    $('#paid_amount').on('input', calculateDueAmount);
    
    // Product selection handler
    $(document).on('change', '.product-select', function() {
        handleProductSelection($(this));
    });
    
    // Customer selection handler
    $('#customer_id').change(function() {
        handleCustomerSelection($(this).val());
    });
    
    // Form submission handler
    $('#invoice-form').on('submit', function(e) {
        e.preventDefault();
        
        const form = this;
        const formData = new FormData(form);
        
        // Basic validation
        let isValid = true;
        $(form).find('input[required], select[required]').each(function() {
            if (!validateField(this)) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            const firstInvalid = $(form).find('.is-invalid').first();
            if (firstInvalid.length) {
                $('html, body').animate({
                    scrollTop: firstInvalid.offset().top - 100
                }, 200);
                firstInvalid.focus();
            }
            return false;
        }
        
        // Submit the form
        submitInvoiceForm(formData);
    });
});

// Helper Functions (same as create view)
function initializeSelect2() {
    $('.select2').each(function() {
        let options = {
            width: '100%',
            dropdownAutoWidth: true
        };
        
        const modalParent = $(this).closest('.modal');
        if (modalParent.length) {
            options.dropdownParent = modalParent;
        }
        
        $(this).select2(options);
    });
}

function addProductRow() {
    const templateRow = $('.product-row:first');
    const templateSelect = templateRow.find('.product-select');
    
    if (templateSelect.hasClass('select2-hidden-accessible')) {
        templateSelect.select2('destroy');
    }
    
    const newRow = templateRow.clone();
    
    newRow.find('input').val('');
    newRow.find('select').val('').trigger('change');
    newRow.find('.select2-container').remove();
    newRow.removeClass('insufficient-stock');
    newRow.find('.is-invalid').removeClass('is-invalid');
    newRow.find('.invalid-feedback').remove();
    
    newRow.addClass('new-row');
    setTimeout(function() {
        newRow.removeClass('new-row');
    }, 1500);
    
    $('#product-table tbody').append(newRow);
    
    if ($('input[name="invoice_type"]:checked').val() !== 'tiles') {
        newRow.find('.box-pieces-cell').hide();
    }
    
    initializeRowSelect2(templateRow);
    initializeRowSelect2(newRow);
    
    newRow.find('.product-select').select2('open');
    
    return newRow;
}

function addProductRowAfter(currentRow) {
    const originalSelect = currentRow.find('.product-select');
    
    if (originalSelect.hasClass('select2-hidden-accessible')) {
        originalSelect.select2('destroy');
    }
    
    const newRow = currentRow.clone();
    
    newRow.find('input').val('');
    newRow.find('select').val('').trigger('change');
    newRow.find('.product-total').val('');
    
    newRow.find('.is-invalid').removeClass('is-invalid');
    newRow.find('.invalid-feedback').remove();
    newRow.removeClass('insufficient-stock');
    
    newRow.find('.select2-container').remove();
    
    newRow.addClass('new-row');
    setTimeout(() => {
        newRow.removeClass('new-row');
    }, 1500);
    
    currentRow.after(newRow);
    
    if ($('input[name="invoice_type"]:checked').val() !== 'tiles') {
        newRow.find('.box-pieces-cell').hide();
    }
    
    initializeRowSelect2(currentRow);
    initializeRowSelect2(newRow);
    
    return newRow;
}

function initializeRowSelect2(row) {
    row.find('.select2').each(function() {
        if ($(this).hasClass('select2-hidden-accessible')) {
            $(this).select2('destroy');
        }
        
        $(this).siblings('.select2-container').remove();
        
        const modalParent = $(this).closest('.modal');
        const options = {
            width: '100%',
            dropdownAutoWidth: true,
            closeOnSelect: true
        };
        
        if (modalParent.length) {
            options.dropdownParent = modalParent;
        }
        
        $(this).select2(options);
    });
}

function calculateRowTotal(row) {
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const price = parseFloat(row.find('.product-price').val()) || 0;
    row.find('.product-total').val((quantity * price).toFixed(2));
}

function calculateBoxesAndPieces(row) {
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const boxPcs = parseFloat(row.data('box-pcs')) || 0;
    const piecesFeet = parseFloat(row.data('pieces-feet')) || 0;
    
    if (boxPcs > 0 && piecesFeet > 0) {
        const totalPieces = Math.round(quantity / piecesFeet);
        const boxes = Math.floor(totalPieces / boxPcs);
        const pieces = totalPieces - (boxes * boxPcs);
        
        row.find('.product-boxes').val(boxes);
        row.find('.product-pieces').val(pieces);
    } else {
        row.find('.product-boxes').val('');
        row.find('.product-pieces').val('');
    }
}

function calculateInvoiceTotal() {
    let subtotal = 0;
    $('.product-total').each(function() {
        subtotal += parseFloat($(this).val()) || 0;
    });
    
    const discount = parseFloat($('#discount').val()) || 0;
    const total = subtotal - discount;
    
    $('#subtotal').val(subtotal.toFixed(2));
    $('#total').val(total.toFixed(2));
    
    calculateDueAmount();
}

function calculateDueAmount() {
    const total = parseFloat($('#total').val()) || 0;
    const paidAmount = parseFloat($('#paid_amount').val()) || 0;
    $('#due_amount').val((total - paidAmount).toFixed(2));
}

function toggleBoxPiecesColumns(show) {
    if (show) {
        $('.box-pieces-column').show();
        $('.box-pieces-cell').show();
    } else {
        $('.box-pieces-column').hide();
        $('.box-pieces-cell').hide();
    }
}

function validateRowStock(row) {
    const deliveryStatus = $('input[name="delivery_status"]:checked').val();
    
    if (deliveryStatus !== 'delivered') {
        row.removeClass('insufficient-stock');
        row.find('.product-quantity').removeClass('is-invalid');
        row.find('.stock-warning-text').remove();
        return;
    }
    
    const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
    const stock = parseFloat(row.find('.product-select option:selected').data('stock')) || 0;
    
    if (quantity > stock) {
        row.addClass('insufficient-stock');
        row.find('.product-quantity').addClass('is-invalid');
        
        if (!row.find('.stock-warning-text').length) {
            row.find('.product-quantity').after('<div class="invalid-feedback stock-warning-text">Exceeds available stock (' + stock + ') - Will result in negative stock</div>');
        }
    } else {
        row.removeClass('insufficient-stock');
        row.find('.product-quantity').removeClass('is-invalid');
        row.find('.stock-warning-text').remove();
    }
}

function toggleStockWarnings(isDelivered) {
    if (isDelivered) {
        $('#delivery-stock-warning').slideDown();
        $('.product-row').each(function() {
            validateRowStock($(this));
        });
    } else {
        $('#delivery-stock-warning').slideUp();
        $('.insufficient-stock').removeClass('insufficient-stock');
        $('.product-quantity.is-invalid').removeClass('is-invalid');
        $('.stock-warning-text').remove();
    }
}

function handleProductSelection(selectElement) {
    const row = selectElement.closest('tr');
    const productId = selectElement.val();
    
    if (productId) {
        $.ajax({
            url: '/product-details/' + productId,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                row.find('.product-description').val(data.name);
                row.find('.product-company').val(data.company ? data.company.name : '');
                row.find('.product-category').val(data.category ? data.category.name : '');
                row.find('.product-price').val(data.sale_price);
                
                row.data('box-pcs', data.category ? data.category.box_pcs : 0);
                row.data('pieces-feet', data.category ? data.category.pieces_feet : 0);
                
                row.find('.product-quantity').focus();
            }
        });
    } else {
        row.find('.product-description, .product-company, .product-category, .product-price, .product-quantity, .product-boxes, .product-pieces, .product-total').val('');
        row.data('box-pcs', 0);
        row.data('pieces-feet', 0);
    }
}

function handleCustomerSelection(customerId) {
    if (customerId) {
        $.ajax({
            url: '/customer-details/' + customerId,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                $('#customer_phone').val(data.phone);
                $('#customer_address').val(data.address);
                $('#customer_balance').val(data.outstanding_balance);
            }
        });
    } else {
        $('#customer_phone, #customer_address, #customer_balance').val('');
    }
}

function validateField(field) {
    if (field.hasAttribute('required') && !field.value) {
        field.classList.add('is-invalid');
        if (!field.nextElementSibling || !field.nextElementSibling.classList.contains('invalid-feedback')) {
            const feedback = document.createElement('div');
            feedback.classList.add('invalid-feedback');
            feedback.textContent = 'This field is required';
            field.after(feedback);
        }
        return false;
    } else {
        field.classList.remove('is-invalid');
        const feedback = field.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback')) {
            feedback.remove();
        }
        return true;
    }
}

function submitInvoiceForm(formData) {
    const submitBtn = $('#update-invoice-btn');
    const originalText = submitBtn.html();
    submitBtn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Updating...');
    
    $.ajax({
        url: $('#invoice-form').attr('action'),
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        success: function(response) {
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Invoice updated successfully.',
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                window.location.href = "{{ route('invoices.show', $invoice) }}";
            });
        },
        error: function(xhr) {
            submitBtn.prop('disabled', false).html(originalText);
            
            const errorMessage = xhr.responseJSON?.message || 'An error occurred while updating the invoice.';
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: errorMessage
            });
        }
    });
}

// Add event listeners for inline validation
$(document).on('blur', 'input[required], select[required]', function() {
    validateField(this);
});
</script>
@stop


--- Contents of index.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'Invoices')
@section('page_title', 'Invoice Management')

@section('header_actions')
    <div class="btn-group">
        <a class="btn modern-btn modern-btn-success" href="{{ route('invoices.create') }}">
            <i class="fas fa-plus"></i> Create Invoice
        </a>
        <button type="button" class="btn modern-btn modern-btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown">
            <span class="sr-only">Toggle Dropdown</span>
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{{ route('invoices.export') }}">
                <i class="fas fa-file-excel text-success"></i> Export to Excel
            </a>

        </div>
    </div>
@stop

@section('page_content')
    <!-- Invoice Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-primary">
                <div class="stats-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-invoices">{{ $totalInvoices }}</h3>
                    <p class="stats-label">Total Invoices</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 12% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="clearFilters();">
                    View All <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-success">
                <div class="stats-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-amount">{{ number_format($totalAmount, 2) }}</h3>
                    <p class="stats-label">Total Amount</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 8% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByStatus('all');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-warning">
                <div class="stats-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-due">{{ number_format($totalDue, 2) }}</h3>
                    <p class="stats-label">Total Due</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-down"></i> 3% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByPaymentStatus('unpaid');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="stats-card stats-card-info">
                <div class="stats-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stats-content">
                    <h3 class="stats-number" id="total-paid">{{ number_format($totalPaid, 2) }}</h3>
                    <p class="stats-label">Total Paid</p>
                    <div class="stats-trend">
                        <i class="fas fa-arrow-up"></i> 15% from last month
                    </div>
                </div>
                <a href="#" class="stats-link" onclick="filterByPaymentStatus('paid');">
                    View Details <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Advanced Filters Section -->
    <div class="card modern-card mb-4">
        <div class="card-header modern-header">
            <h3 class="card-title">
                <i class="fas fa-filter"></i> Search & Filters
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-sm btn-light" id="clear-all-filters">
                    <i class="fas fa-times"></i> Clear All
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="search-input" class="form-label">Search Invoices</label>
                        <div class="input-group">
                            <input type="text" id="search-input" class="form-control modern-input" placeholder="Invoice #, customer...">
                            <div class="input-group-append">
                                <button class="btn modern-btn modern-btn-primary" type="button" id="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="customer-filter" class="form-label">Customer</label>
                        <select id="customer-filter" class="form-control modern-select">
                            <option value="">All Customers</option>
                            @foreach($customers as $customer)
                                <option value="{{ $customer->id }}">{{ $customer->name }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="payment-status-filter" class="form-label">Payment Status</label>
                        <select id="payment-status-filter" class="form-control modern-select">
                            <option value="">All Status</option>
                            <option value="paid">Paid</option>
                            <option value="partial">Partial</option>
                            <option value="unpaid">Unpaid</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="delivery-status-filter" class="form-label">Delivery Status</label>
                        <select id="delivery-status-filter" class="form-control modern-select">
                            <option value="">All Status</option>
                            <option value="delivered">Delivered</option>
                            <option value="partial">Partial</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="form-label">Date Range</label>
                        <div class="input-group">
                            <input type="date" id="from-date" class="form-control modern-input">
                            <input type="date" id="to-date" class="form-control modern-input">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoices Table -->
    <div class="card modern-card">
        <div class="card-header modern-header success-header">
            <h3 class="card-title">
                <i class="fas fa-list"></i> Invoice Directory
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-sm btn-light" data-toggle="tooltip" title="Refresh Table" id="refresh-table">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button type="button" class="btn btn-sm btn-light" data-toggle="tooltip" title="Column Visibility" id="column-visibility">
                    <i class="fas fa-columns"></i>
                </button>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table id="invoices-table" class="table modern-table mb-0">
                    <thead>
                        <tr>
                            <th width="40px">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="select-all">
                                    <label class="custom-control-label" for="select-all"></label>
                                </div>
                            </th>
                            <th>Invoice Info</th>
                            <th>Customer</th>
                            <th>Type & Date</th>
                            <th>Amount</th>
                            <th>Payment Status</th>
                            <th>Delivery Status</th>
                            <th width="200px">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @forelse($invoices as $invoice)
                        <tr data-invoice-id="{{ $invoice->id }}">
                            <td>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input invoice-checkbox" id="check_{{ $invoice->id }}" value="{{ $invoice->id }}">
                                    <label class="custom-control-label" for="check_{{ $invoice->id }}"></label>
                                </div>
                            </td>
                            <td>
                                <div class="invoice-info">
                                    <div class="invoice-avatar">
                                        <i class="fas fa-file-invoice"></i>
                                    </div>
                                    <div class="invoice-details">
                                        <h6>
                                            <a href="{{ route('invoices.show', $invoice) }}" class="invoice-link">
                                                {{ $invoice->invoice_number }}
                                            </a>
                                        </h6>
                                        <small>{{ $invoice->invoice_date->format('d M, Y') }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="customer-info">
                                    <div class="customer-name">
                                        <a href="{{ route('customers.show', $invoice->customer_id) }}" class="customer-link">
                                            {{ $invoice->customer->name }}
                                        </a>
                                    </div>
                                    <small class="customer-phone">{{ $invoice->customer->phone ?? 'No phone' }}</small>
                                </div>
                            </td>
                            <td>
                                <div class="type-date-info">
                                    <span class="invoice-type-badge invoice-type-{{ $invoice->invoice_type }}">
                                        {{ ucfirst($invoice->invoice_type) }}
                                    </span>
                                    <small class="invoice-date">{{ $invoice->created_at->diffForHumans() }}</small>
                                </div>
                            </td>
                            <td>
                                <div class="amount-info">
                                    <div class="total-amount">{{ number_format($invoice->total, 2) }}</div>
                                    <div class="amount-breakdown">
                                        <small class="paid-amount text-success">Paid: {{ number_format($invoice->paid_amount, 2) }}</small>
                                        <small class="due-amount text-danger">Due: {{ number_format($invoice->due_amount, 2) }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="payment-status-container">
                                    <span class="status-badge status-payment-{{ $invoice->payment_status }}">
                                        {{ ucfirst($invoice->payment_status) }}
                                    </span>
                                    @if($invoice->payment_status != 'paid' && $invoice->due_amount > 0)
                                        <button class="btn btn-sm modern-btn modern-btn-success mt-1 mark-paid-btn" 
                                                data-invoice-id="{{ $invoice->id }}" 
                                                data-due-amount="{{ $invoice->due_amount }}">
                                            <i class="fas fa-check"></i> Mark Paid
                                        </button>
                                    @endif
                                </div>
                            </td>
                            <td>
                                @php
                                    $deliveryStatus = $invoice->calculateDeliveryStatus();
                                    if ($deliveryStatus !== $invoice->delivery_status) {
                                        $invoice->delivery_status = $deliveryStatus;
                                        $invoice->save();
                                    }
                                @endphp
                                <div class="delivery-status-container">
                                    <span class="status-badge status-delivery-{{ $invoice->delivery_status }}">
                                        {{ ucfirst($invoice->delivery_status) }}
                                    </span>
                                    @if($invoice->delivery_status != 'delivered')
                                        <select class="form-control form-control-sm modern-select-sm mt-1 delivery-status-select" 
                                                data-invoice-id="{{ $invoice->id }}">
                                            <option value="pending"{{ $invoice->delivery_status == 'pending' ? ' selected' : '' }}>Pending</option>
                                            <option value="partial"{{ $invoice->delivery_status == 'partial' ? ' selected' : '' }}>Partial</option>
                                            <option value="delivered">Delivered</option>
                                        </select>
                                    @endif
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="{{ route('invoices.show', $invoice) }}" class="btn modern-btn modern-btn-info btn-sm" title="View" data-toggle="tooltip">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    @if($invoice->delivery_status != 'delivered')
                                        <a href="{{ route('invoices.edit', $invoice) }}" class="btn modern-btn modern-btn-warning btn-sm" title="Edit" data-toggle="tooltip">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    @endif
                                    <a href="{{ route('invoices.print', $invoice) }}" target="_blank" class="btn modern-btn modern-btn-secondary btn-sm" title="Print" data-toggle="tooltip">
                                        <i class="fas fa-print"></i>
                                    </a>
                                    @if($invoice->delivery_status != 'delivered' && $invoice->hasRemainingItems())
                                        <a href="{{ route('challans.create', ['invoice_id' => $invoice->id]) }}" class="btn modern-btn modern-btn-primary btn-sm" title="Create Challan" data-toggle="tooltip">
                                            <i class="fas fa-truck"></i>
                                        </a>
                                    @endif
                                    @if($invoice->payment_status != 'paid')
                                        <a href="{{ route('transactions.create') }}?customer_id={{ $invoice->customer_id }}&invoice_id={{ $invoice->id }}" class="btn modern-btn modern-btn-success btn-sm" title="Add Payment" data-toggle="tooltip">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </a>
                                    @endif
                                    @if($invoice->delivery_status === 'partial')
                                        <button type="button" class="btn modern-btn modern-btn-danger btn-sm disabled" disabled title="Delete all challans first" data-toggle="tooltip">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    @else
                                        <button type="button" class="btn modern-btn modern-btn-danger btn-sm delete-invoice" data-invoice-id="{{ $invoice->id }}" title="Delete" data-toggle="tooltip">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    @endif
                                </div>
                            </td>
                        </tr>
                        @empty
                        <tr>
                            <td colspan="8" class="text-center py-4">
                                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                <h5>No invoices found</h5>
                                <p class="text-muted">Start by creating your first invoice</p>
                            </td>
                        </tr>
                        @endforelse
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="dataTables_info">
                        Showing <span id="showing-start">{{ $invoices->firstItem() ?? 0 }}</span> to <span id="showing-end">{{ $invoices->lastItem() ?? 0 }}</span> of <span id="total-records">{{ $invoices->total() }}</span> entries
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="float-right">
                        {{ $invoices->withQueryString()->links() }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card modern-card">
                <div class="card-header modern-header info-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('invoices.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-success">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Create Invoice</h5>
                                    <p>Generate new invoice</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('invoices.export') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-info">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Export Invoices</h5>
                                    <p>Download Excel report</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('transactions.create') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-primary">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>Add Payment</h5>
                                    <p>Record payment</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ route('reports.products.sales') }}" class="quick-action-card">
                                <div class="quick-action-icon bg-warning">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="quick-action-content">
                                    <h5>View Reports</h5>
                                    <p>Invoice analytics</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

<!-- Payment Confirmation Modal -->
<div class="modal fade" id="paymentConfirmModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content modern-modal">
            <div class="modal-header modern-modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-credit-card"></i> Confirm Payment
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body modern-modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-question-circle fa-3x text-warning"></i>
                </div>
                <p class="text-center">Are you sure you want to mark this invoice as paid?</p>
                <div class="payment-details">
                    <div class="detail-row">
                        <span>Amount to be paid:</span>
                        <strong id="modal-due-amount" class="text-success"></strong>
                    </div>
                </div>
                <p class="text-muted small text-center mt-3">This will update the customer's ledger balance and mark the invoice as paid.</p>
            </div>
            <div class="modal-footer modern-modal-footer">
                <button type="button" class="btn modern-btn-outline-secondary" data-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn modern-btn modern-btn-success" id="confirm-payment-btn">
                    <i class="fas fa-check"></i> Confirm Payment
                </button>
            </div>
        </div>
    </div>
</div>

@section('additional_css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">

<style>
/* Stats Cards - Same as customer design */
.stats-card {
    background: white;
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: none;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
}

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-primary::before {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stats-card-success::before {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.stats-card-warning::before {
    background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
}

.stats-card-info::before {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
}

.stats-icon {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    font-size: 1.5rem;
}

.stats-card-success .stats-icon {
    background: rgba(17, 153, 142, 0.1);
    color: #11998e;
}

.stats-card-warning .stats-icon {
    background: rgba(252, 70, 107, 0.1);
    color: #fc466b;
}

.stats-card-info .stats-icon {
    background: rgba(255, 154, 158, 0.1);
    color: #ff9a9e;
}

.stats-content {
    padding-right: 80px;
}

.stats-number {
    font-size: 2rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 0.5rem;
    line-height: 1;
}

.stats-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.stats-trend {
    font-size: 0.75rem;
    color: #28a745;
    font-weight: 500;
}

.stats-trend .fa-arrow-down {
    color: #dc3545;
}

.stats-link {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0.75rem 1.5rem;
    background: rgba(0, 0, 0, 0.03);
    color: #667eea;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.stats-link:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    text-decoration: none;
}

/* Invoice Info Cell Styling */
.invoice-info {
    display: flex;
    align-items: center;
}

.invoice-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    margin-right: 0.75rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    flex-shrink: 0;
}

.invoice-details h6 {
    margin: 0;
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
}

.invoice-details small {
    color: var(--text-muted);
    font-size: 0.8rem;
}

.invoice-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
}

.invoice-link:hover {
    color: #324cdd;
    text-decoration: none;
}

/* Customer Info in Invoice Table */
.customer-name {
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.customer-link {
    color: #333;
    text-decoration: none;
}

.customer-link:hover {
    color: #667eea;
    text-decoration: none;
}

.customer-phone {
    color: var(--text-muted);
    font-size: 0.8rem;
}

/* Type and Date Info */
.type-date-info {
    text-align: center;
}

.invoice-type-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    margin-bottom: 0.25rem;
}

.invoice-type-tiles {
    background: linear-gradient(135deg, #11cdef 0%, #1171ef 100%);
    color: white;
}

.invoice-type-sanitary {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: white;
}

.invoice-date {
    color: var(--text-muted);
    font-size: 0.75rem;
}

/* Amount Info */
.amount-info {
    text-align: right;
}

.total-amount {
    font-weight: 600;
    font-size: 1rem;
    color: #333;
    margin-bottom: 0.25rem;
}

.amount-breakdown {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
}

.amount-breakdown small {
    font-size: 0.7rem;
}

/* Status Badges */
.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    margin-bottom: 0.25rem;
}

.status-payment-paid {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.status-payment-partial {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
}

.status-payment-unpaid {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: white;
}

.status-delivery-delivered {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.status-delivery-partial {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
}

.status-delivery-pending {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: white;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 0.25rem;
    justify-content: center;
    flex-wrap: wrap;
}

.action-buttons .btn {
    padding: 0.375rem 0.5rem;
    font-size: 0.75rem;
    border-radius: var(--border-radius);
    min-width: 35px;
}

/* Quick Action Cards */
.quick-action-card {
    display: block;
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    text-decoration: none;
    color: inherit;
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
    height: 100%;
}

.quick-action-card:hover {
    text-decoration: none;
    color: inherit;
    border-color: #667eea;
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.quick-action-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    color: white;
    font-size: 1.25rem;
}

.quick-action-content h5 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.quick-action-content p {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin: 0;
}

/* Modern Select Small */
.modern-select-sm {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid #e3e6f0;
}

/* Enhanced Checkbox Styling */
.custom-control-input:checked ~ .custom-control-label::before {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

/* Modern Modal */
.modern-modal .modal-content {
    border: none;
    border-radius: 0.5rem;
    box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
}

.modern-modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 0.5rem 0.5rem 0 0;
}

.modern-modal-body {
    padding: 2rem;
}

.modern-modal-footer {
    border: none;
    padding: 1rem 2rem 2rem;
}

.payment-details {
    background: #f8f9fc;
    padding: 1rem;
    border-radius: 0.5rem;
    margin: 1rem 0;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Responsive Design */
@media (max-width: 768px) {
    .stats-content {
        padding-right: 0;
    }
    
    .stats-icon {
        position: static;
        margin-bottom: 1rem;
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
    
    .stats-number {
        font-size: 1.5rem;
    }
    
    .invoice-info {
        flex-direction: column;
        text-align: center;
    }
    
    .invoice-avatar {
        margin-right: 0;
        margin-bottom: 0.5rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .amount-info {
        text-align: left;
    }
}
</style>
@stop
@section('additional_js')
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready(function() {
    // Initialize Select2
    $('.select2').select2({
        width: '100%'
    });
    // Filter functionality
    function applyFilters() {
        const searchValue = $('#search-input').val();
        const customerFilter = $('#customer-filter').val();
        const paymentStatusFilter = $('#payment-status-filter').val();
        const deliveryStatusFilter = $('#delivery-status-filter').val();
        const fromDate = $('#from-date').val();
        const toDate = $('#to-date').val();
        
        // Build query string
        const params = new URLSearchParams();
        if (searchValue) params.append('search', searchValue);
        if (customerFilter) params.append('customer_id', customerFilter);
        if (paymentStatusFilter) params.append('payment_status', paymentStatusFilter);
        if (deliveryStatusFilter) params.append('delivery_status', deliveryStatusFilter);
        if (fromDate) params.append('from_date', fromDate);
        if (toDate) params.append('to_date', toDate);
        
        // Reload page with filters
        window.location.href = window.location.pathname + '?' + params.toString();
    }
    
    // Search functionality
    $('#search-btn').on('click', applyFilters);
    $('#search-input').on('keypress', function(e) {
        if (e.which === 13) applyFilters();
    });
    
    // Filter change events
    $('#customer-filter, #payment-status-filter, #delivery-status-filter, #from-date, #to-date').on('change', applyFilters);
    
    // Clear all filters
    $('#clear-all-filters').on('click', function() {
        $('#search-input').val('');
        $('#customer-filter').val('');
        $('#payment-status-filter').val('');
        $('#delivery-status-filter').val('');
        $('#from-date').val('');
        $('#to-date').val('');
        window.location.href = window.location.pathname;
    });
    
    // Select all functionality
    $('#select-all').on('change', function() {
        const isChecked = $(this).is(':checked');
        $('.invoice-checkbox').prop('checked', isChecked);
    });
    
    // Individual checkbox functionality
    $(document).on('change', '.invoice-checkbox', function() {
        const totalCheckboxes = $('.invoice-checkbox').length;
        const checkedCheckboxes = $('.invoice-checkbox:checked').length;
        $('#select-all').prop('checked', totalCheckboxes === checkedCheckboxes);
    });
    // Refresh table
    $('#refresh-table').on('click', function() {
        $(this).find('i').addClass('fa-spin');
        location.reload();
    });
    
    // Filter functions for stats cards
    window.clearFilters = function() {
        $('#clear-all-filters').click();
    };
    
    window.filterByPaymentStatus = function(status) {
        $('#payment-status-filter').val(status);
        applyFilters();
    };
    
    window.filterByStatus = function(type) {
        // Handle different filter types
        applyFilters();
    };
    
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
    // Make sure the CSRF token is set for all AJAX requests
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    
    // Initialize DataTable with server-side processing
    $('#invoicesTable').DataTable({
        "processing": true,
        "serverSide": true,
        paging: true,
    pageLength: 25,
    lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
    dom: '<"row"<"col-sm-6"l><"col-sm-6"f>>' +
         '<"row"<"col-sm-12"tr>>' +
         '<"row"<"col-sm-5"i><"col-sm-7"p>>', // Single pagination at bottom right
    language: {
        paginate: {
            previous: '<i class="fas fa-chevron-left"></i>',
            next: '<i class="fas fa-chevron-right"></i>'
        }
    },
        "ajax": {
            "url": "{{ route('invoices.data') }}",
            "type": "GET",
            "data": function(d) {
                d.customer_id = $('#customer_id').val();
                d.invoice_number = $('#invoice_number').val();
                d.from_date = $('#from_date').val();
                d.to_date = $('#to_date').val();
                d.payment_status = $('#payment_status').val();
                d.delivery_status = $('#delivery_status').val();
                d.invoice_type = $('#invoice_type').val();
            }
        },
        "columns": [
            {"data": "invoice_number", "name": "invoice_number"},
            {"data": "invoice_date", "name": "invoice_date"},
            {"data": "customer", "name": "customer_id"},
            {"data": "invoice_type", "name": "invoice_type"},
            {"data": "total", "name": "total"},
            {"data": "paid", "name": "paid_amount"},
            {"data": "due", "name": "due_amount"},
            {"data": "payment_status", "name": "payment_status"},
            {"data": "delivery_status", "name": "delivery_status"},
            {"data": "actions", "name": "actions", "orderable": false, "searchable": false}
        ],
        "columnDefs": [
            {"className": "dt-center", "targets": [3, 7, 8, 9]},
            {"orderable": false, "targets": 9},
            {"responsivePriority": 1, "targets": [0, 9]},
            {"responsivePriority": 2, "targets": [2, 4]},
            {"searchable": false, "targets": [4, 5, 6, 9]}
        ],
        "order": [[1, "desc"]],
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        "pageLength": 15,
        "responsive": true,
        "autoWidth": false,
        "dom": '<"top"lf>rt<"bottom"ip><"clear">',
        "drawCallback": function() {
            updateSummary();
        }
    });
    
    // Toggle filter collapse icon
    $('.card-header[data-toggle="collapse"]').on('click', function() {
        $(this).find('.toggle-icon').toggleClass('fa-chevron-down fa-chevron-up');
    });
    
    // Delete confirmation with SweetAlert2
    $(document).on('submit', '.delete-form', function(e) {
        e.preventDefault();
        const form = this;
        
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to recover this invoice and related data!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel',
            reverseButtons: true,
            focusCancel: true
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit();
            }
        });
    });
    
    // Prevent multiple clicks on buttons
    window.disableButtonAfterClick = function(button) {
        $(button).addClass('disabled')
               .attr('disabled', 'disabled')
               .css('pointer-events', 'none');
    };
    
    // Function to update summary cards
    function updateSummary() {
        $.ajax({
            url: "{{ route('invoices.summary') }}",
            type: "GET",
            data: {
                customer_id: $('#customer_id').val(),
                invoice_number: $('#invoice_number').val(),
                from_date: $('#from_date').val(),
                to_date: $('#to_date').val(),
                payment_status: $('#payment_status').val(),
                delivery_status: $('#delivery_status').val(),
                invoice_type: $('#invoice_type').val(),
                search: $('#invoicesTable_filter input').val()
            },
            success: function(response) {
                $('.card:eq(0) .h5').text(response.totalInvoices);
                $('.card:eq(1) .h5').text(' ' + response.totalAmount);
                $('.card:eq(2) .h5').text(' ' + response.totalPaid);
                $('.card:eq(3) .h5').text(' ' + response.totalDue);
            }
        });
    }
    
    // Delete invoice button handler
    $(document).on('click', '.delete-invoice', function() {
        const invoiceId = $(this).data('invoice-id');
        
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to recover this invoice and related data!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel',
            reverseButtons: true,
            focusCancel: true
        }).then((result) => {
            if (result.isConfirmed) {
                // Create and submit a form programmatically
                const form = $('<form>', {
                    'method': 'POST',
                    'action': '/invoices/' + invoiceId
                }).append($('<input>', {
                    'name': '_token',
                    'value': $('meta[name="csrf-token"]').attr('content'),
                    'type': 'hidden'
                })).append($('<input>', {
                    'name': '_method',
                    'value': 'DELETE',
                    'type': 'hidden'
                }));
                
                $('body').append(form);
                form.submit();
            }
        });
    });
    // Add this to your existing JavaScript section
$(document).on('change', '.delivery-status-select', function() {
    const invoiceId = $(this).data('invoice-id');
    const newStatus = $(this).val();
    const selectElement = $(this);
    
    if (newStatus === 'delivered') {
        Swal.fire({
            title: 'Confirm Delivery',
            text: 'This will mark the invoice as delivered and update product stock. Are you sure?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#28a745',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, mark as delivered',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                updateDeliveryStatus(invoiceId, newStatus, selectElement);
            } else {
                // Reset select to previous value
                selectElement.val(selectElement.data('previous-value') || 'pending');
            }
        });
    } else {
        updateDeliveryStatus(invoiceId, newStatus, selectElement);
    }
});

function updateDeliveryStatus(invoiceId, newStatus, selectElement) {
    $.ajax({
        url: '/invoices/update-delivery-status',
        type: 'POST',
        data: {
            _token: $('meta[name="csrf-token"]').attr('content'),
            invoice_id: invoiceId,
            delivery_status: newStatus
        },
        beforeSend: function() {
            selectElement.prop('disabled', true);
        },
        success: function(response) {
            if (response.success) {
                // Reload DataTable to reflect changes
                $('#invoicesTable').DataTable().ajax.reload();
                
                toastr.success('Delivery status updated successfully');
                
                // If marked as delivered, page will reload to hide buttons
                if (newStatus === 'delivered') {
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                }
            } else {
                toastr.error(response.message || 'Failed to update delivery status');
                selectElement.val(selectElement.data('previous-value') || 'pending');
            }
        },
        error: function(xhr) {
            let errorMessage = 'Failed to update delivery status';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            toastr.error(errorMessage);
            selectElement.val(selectElement.data('previous-value') || 'pending');
        },
        complete: function() {
            selectElement.prop('disabled', false);
        }
    });
}

// Store previous value for rollback
$(document).on('focus', '.delivery-status-select', function() {
    $(this).data('previous-value', $(this).val());
});

    // Mark as Paid button handling - FIXED VERSION
    $(document).on('click', '.mark-paid-btn', function() {
        const invoiceId = $(this).data('invoice-id');
        const dueAmount = parseFloat($(this).data('due-amount')).toFixed(2);
        
        Swal.fire({
            title: 'Confirm Payment',
            html: `
                <p>Are you sure you want to mark this invoice as paid?</p>
                <p>Amount to be paid: <strong> ${dueAmount}</strong></p>
                <p>This will update the customer's ledger balance and mark the invoice as paid.</p>
            `,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#28a745',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, mark as paid',
            cancelButtonText: 'Cancel',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                processPayment(invoiceId);
            }
        });
    });
    
    // Separate function to process payment
    function processPayment(invoiceId) {
        // Show loading state
        Swal.fire({
            title: 'Processing Payment',
            html: 'Please wait...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        $.ajax({
            url: '/invoices/' + invoiceId + '/mark-as-paid',
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content')
            },
            success: function(response) {
                console.log('Payment response:', response);
                
                if (response.success) {
                    // Reload the DataTable to reflect changes
                    $('#invoicesTable').DataTable().ajax.reload();
                    
                    // Update summary data
                    updateSummary();
                    
                    // Show success message
                    Swal.fire({
                        icon: 'success',
                        title: 'Payment Successful',
                        text: 'Invoice has been marked as paid successfully',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Payment Failed',
                        text: response.message || 'An error occurred while processing payment'
                    });
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX Error:', status, error);
                
                let errorMessage = 'Failed to process payment';
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage += ': ' + xhr.responseJSON.message;
                }
                
                Swal.fire({
                    icon: 'error',
                    title: 'Payment Failed',
                    text: errorMessage
                });
            }
        });
    }
    
    // Apply filters without page reload
    $('#filter-form').on('submit', function(e) {
        e.preventDefault();
        $('#invoicesTable').DataTable().ajax.reload();
        updateSummary();
    });
    
    // Expand filter section if there are active filters
    if (window.location.search && window.location.search !== '') {
        $('#filterBody').addClass('show');
        $('.toggle-icon').removeClass('fa-chevron-down').addClass('fa-chevron-up');
    }
    
    // Date picker default behavior
    $('#from_date, #to_date').on('change', function() {
        const fromDate = $('#from_date').val();
        const toDate = $('#to_date').val();
        
        if (fromDate && toDate && new Date(fromDate) > new Date(toDate)) {
            toastr.warning('From date cannot be greater than to date');
            $(this).val('');
        }
    });
    
    // Initialize toastr options
    toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    };
    
    // Error handling
    window.onerror = function(message, source, lineno, colno, error) {
        console.error("JavaScript Error:", message, "at", source, "line:", lineno);
        toastr.error("A JavaScript error occurred: " + message);
        return true;
    };
});

</script>

@stop

--- Contents of print.blade.php ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice #{{ $invoice->invoice_number }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        
        .invoice-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .invoice-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo-container {
            width: 80px;
            margin-right: 10px;
        }
        
        .logo-container img {
            width: 100%;
            height: auto;
        }
        
        .company-info {
            text-align: center;
            flex-grow: 1;
        }
        
        .company-info h1 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .bill-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .bill-to {
            width: 50%;
            text-align: left;
        }
        
        .bill-to h3 {
            margin: 0 0 3px 0;
            font-size: 12px;
        }
        
        .bill-to p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .invoice-title {
            width: 50%;
            text-align: right;
        }
        
        .invoice-title h2 {
            margin: 0;
            color: blue;
            font-size: 16px;
        }
        
        .invoice-title p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }
        
        .invoice-table th, .invoice-table td {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
            font-size: 11px;
        }
        
        .invoice-table th {
            background-color: #f2f2f2;
        }
        
        .words-total {
            text-align: left;
            font-style: italic;
            margin: 3px 0;
            font-size: 11px;
        }
        
        .words-total p {
            margin: 0;
        }
        
        .amount-totals {
            width: 40%;
            float: right;
            margin-top: 3px;
        }
        
        .amount-totals table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .amount-totals table th, .amount-totals table td {
            padding: 2px;
            text-align: right;
            border: none;
            font-size: 11px;
            line-height: 1.2;
        }
        
        .amount-totals table th {
            font-weight: normal;
            padding-right: 8px;
            white-space: nowrap;
        }
        
        .amount-totals table td {
            min-width: 80px;
        }
        
        .amount-totals table tr.total-row th,
        .amount-totals table tr.total-row td {
            font-weight: bold;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            padding-top: 3px;
            padding-bottom: 3px;
        }
        
        .disclaimer {
            clear: both;
            text-align: center;
            margin: 15px 0 10px 0;
            font-weight: bold;
            font-size: 11px;
        }
        
        .bank-details {
            font-size: 10px;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        
        .footer-text {
            text-align: center;
            font-size: 10px;
            margin-top: 5px;
        }
        
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-box {
            width: 45%;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 2px;
        }
        
        .signature-box p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        .paid-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 80px;
            color: rgba(255, 0, 0, 0.3);
            font-weight: bold;
            border: 10px solid rgba(255, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100;
            pointer-events: none;
        }
        
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        @if($invoice->due_amount == 0)
        <div class="paid-stamp">PAID</div>
        @endif
        
        <div class="invoice-header">
                <div class="logo-container">
                    @if($businessSettings->logo)
                        <img src="{{ Storage::url($businessSettings->logo) }}" alt="{{ $businessSettings->business_name }} Logo">
                    @else
                        <img src="{{ asset('logo/logo.png') }}" alt="RTS Logo">
                    @endif
                </div>

                <div class="company-info">
                    <h1>{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</h1>
                    <p>Phone: {{ $businessSettings->phone ?? '01970-598 449 (Bikash),01795-833 166 (Bikash, Nagad)' }}</p>
                    <p>Email: {{ $businessSettings->email ?? 'rahmantilesbd@gmail.com' }}</p>
                    <p>{{ $businessSettings->address ?? 'Model Town, Sadar, Shariatpur' }} 
                    @if($businessSettings->bin_number) 
                        (BIN: {{ $businessSettings->bin_number }})
                    @else
                        (BIN: 004975254-0811)
                    @endif
                    </p>
                </div>

        </div>
        
        <div class="bill-section">
            <div class="bill-to">
                <h3>Bill To</h3>
                <p><strong>{{ $invoice->customer->name }}</strong></p>
                <p>Address: {{ $invoice->customer->address }}</p>
                <p>Phone: {{ $invoice->customer->phone }}</p>
                @if($invoice->customer->email)
                <p>Email: {{ $invoice->customer->email }}</p>
                @endif
            </div>
            <div class="invoice-title">
                <h2>INVOICE</h2>
                <p>Date: {{ $invoice->invoice_date->format('Y-m-d') }}</p>
                <p>Invoice ID: #{{ $invoice->invoice_number }}</p>
            </div>
        </div>
        
        <table class="invoice-table">
    <thead>
        <tr>
            <th>SL</th>
            <th>Product Description</th>
            <th>Category</th>
            @if($invoice->invoice_type != 'other')
            <th>Box</th>
            <th>Piece</th>
            @endif
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Sub Total</th>
        </tr>
    </thead>
    <tbody>
        @foreach($invoice->items as $index => $item)
        <tr>
            <td>{{ $index + 1 }}</td>
            <td>{{ $item->description }}
                @if($item->code)
                <br><small>{{ $item->code }}</small>
                @endif
            </td>
            <td>{{ $item->product->category->name ?? 'N/A' }}</td>
            @if($invoice->invoice_type != 'other')
            <td>{{ $item->boxes }}</td>
            <td>{{ $item->pieces }}</td>
            @endif
            <td>{{ number_format($item->quantity, 2) }}</td>
            <td>{{ number_format($item->unit_price, 2) }}</td>
            <td>{{ number_format($item->total, 2) }}</td>
        </tr>
        @endforeach
    </tbody>
    <tfoot>
        <tr>
        <td colspan="{{ $invoice->invoice_type != 'other' ? 2 : 2 }}" style="text-align: right;"><strong>Total:</strong></td>
        <td></td>
        <!--<td>{{ $invoice->items->pluck('product.category.name')->unique()->implode(', ') }}</td>-->
        @if($invoice->invoice_type != 'other')
        <td>{{ $invoice->items->sum('boxes') }}</td>
        <td>{{ $invoice->items->sum('pieces') }}</td>
        @endif
         <td>{{ $invoice->items->sum('quantity') }}</td>
        <td></td>
        <td>{{ number_format($invoice->subtotal, 2) }}</td>
    </tr>
    </tfoot>
</table>

        
        <div class="words-total">
            <p>In Words: {{ $invoice->total_in_words ?? '' }}</p>
        </div>
        
       <div class="amount-totals">
    <table>
        <tr>
            <th>Sub Total:</th>
            <td>{{ number_format($invoice->subtotal, 2) }}</td>
        </tr>
        <tr>
            <th>Discount:</th>
            <td>{{ number_format($invoice->discount, 2) }}</td>
        </tr>
        <tr class="total-row">
            <th>Invoice Total:</th>
            <td>{{ number_format($invoice->total, 2) }}</td>
        </tr>
        <tr>
            <th>Previous Due:</th>
            <td>{{ number_format($invoice->customer->outstanding_balance - $invoice->due_amount, 2) }}</td>
        </tr>
        <tr class="total-row">
            <th>Total Payable:</th>
            <td>{{ number_format($invoice->total + ($invoice->customer->outstanding_balance - $invoice->due_amount), 2) }}</td>
        </tr>
        <tr>
            <th>Given Amount:</th>
            <td>{{ number_format($invoice->paid_amount, 2) }}</td>
        </tr>
        <tr class="total-row">
            <th>Total Due:</th>
            <td>{{ number_format(($invoice->total + ($invoice->customer->outstanding_balance - $invoice->due_amount)) - $invoice->paid_amount, 2) }}</td>
        </tr>
    </table>
</div>

        
            <div class="disclaimer">
                @if($businessSettings->return_policy_message)
                    {{ $businessSettings->return_policy_message }}
                @else
                    All sold goods should be returnable within {{ $businessSettings->return_policy_days ?? 90 }} days.
                @endif
            </div>
        
            <div class="bank-details">
                @if($businessSettings->bank_details)
                    {!! nl2br(e($businessSettings->bank_details)) !!}
                @else
                    <strong>Bank Details:</strong><br>
                    Dutch Bangla Bank Ltd.<br>
                    Shariatpur Branch (Routing: 090860678)<br>
                    A/C Name: Rahman Tiles And Sanitary<br>
                    A/C No: 181 110 0000 282
                @endif
            </div>

        
        <div class="signatures">
            <div class="signature-box">
                <p>Customer: {{ $invoice->customer->name }}</p>
                <p>Signature and Date</p>
            </div>
                <div class="signature-box">
                    <p>Issued By: {{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</p>
                    <p>Signature and Date</p>
                </div>
        </div>
        
<div class="footer-text">
    {{ $businessSettings->footer_message ?? 'Thanks for being with us.' }}
</div>
        
        <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px;">
                Print Invoice
            </button>
            <button onclick="window.close()" style="padding: 8px 16px; background-color: #f44336; color: white; border: none; cursor: pointer; font-size: 14px; margin-left: 10px; border-radius: 4px;">
                Close
            </button>
        </div>
    </div>
    
    <script>
        window.onload = function() {
            // Uncomment to automatically print when the page loads
            window.print();
        };
    </script>
</body>
</html>


--- Contents of show.blade.php ---
@extends('layouts.modern-admin')

@section('title', 'Invoice Details')

@section('page_title', 'Invoice #' . $invoice->invoice_number)

@section('header_actions')
    <div class="btn-group">
        <a href="{{ route('invoices.index') }}" class="btn modern-btn modern-btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
        <a href="{{ route('invoices.edit', $invoice) }}" class="btn modern-btn modern-btn-warning">
            <i class="fas fa-edit"></i> Edit
        </a>
        <a href="{{ route('invoices.print', $invoice) }}" class="btn modern-btn modern-btn-primary" target="_blank">
            <i class="fas fa-print"></i> Print
        </a>
    </div>
@stop

@section('page_content')
    @if(session('success'))
        <div class="alert alert-success alert-dismissible modern-alert">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
            {{ session('success') }}
        </div>
    @endif
    
    <!-- Invoice and Customer Information Row -->
    <div class="row">
        <!-- Invoice Information -->
        <div class="col-md-6">
            <div class="card modern-card">
                <div class="card-header modern-header">
                    <h3 class="card-title"><i class="fas fa-file-invoice"></i> Invoice Information</h3>
                </div>
                <div class="card-body">
                    <div class="info-section">
                        <div class="section-content">
                            <div class="detail-row">
                                <label>Invoice Number:</label>
                                <span class="detail-value">{{ $invoice->invoice_number }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Invoice Date:</label>
                                <span class="detail-value">{{ $invoice->invoice_date->format('d M, Y') }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Invoice Type:</label>
                                <span class="detail-value">
                                    <span class="badge modern-badge modern-badge-info">
                                        <i class="fas fa-{{ $invoice->invoice_type == 'tiles' ? 'th-large' : 'cube' }}"></i>
                                        {{ ucfirst($invoice->invoice_type) }}
                                    </span>
                                </span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Delivery Status:</label>
                                <span class="detail-value">
                                    <span class="badge modern-badge modern-badge-{{ $invoice->delivery_status == 'delivered' ? 'success' : 'warning' }}">
                                        <i class="fas fa-{{ $invoice->delivery_status == 'delivered' ? 'check' : 'clock' }}"></i>
                                        {{ ucfirst($invoice->delivery_status) }}
                                    </span>
                                </span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Payment Method:</label>
                                <span class="detail-value">{{ ucfirst(str_replace('_', ' ', $invoice->payment_method)) }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Payment Status:</label>
                                <span class="detail-value">
                                    @if($invoice->payment_status == 'paid')
                                        <span class="badge modern-badge modern-badge-success">
                                            <i class="fas fa-check-circle"></i> Paid
                                        </span>
                                    @elseif($invoice->payment_status == 'partial')
                                        <span class="badge modern-badge modern-badge-warning">
                                            <i class="fas fa-exclamation-circle"></i> Partial
                                        </span>
                                    @else
                                        <span class="badge modern-badge modern-badge-danger">
                                            <i class="fas fa-times-circle"></i> Due
                                        </span>
                                    @endif
                                </span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Created At:</label>
                                <span class="detail-value">{{ $invoice->created_at->format('d M, Y h:i A') }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Updated At:</label>
                                <span class="detail-value">{{ $invoice->updated_at->format('d M, Y h:i A') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Customer Information -->
        <div class="col-md-6">
            <div class="card modern-card">
                <div class="card-header modern-header">
                    <h3 class="card-title"><i class="fas fa-user"></i> Customer Information</h3>
                </div>
                <div class="card-body">
                    <div class="info-section">
                        <div class="section-content">
                            <div class="detail-row">
                                <label>Customer Name:</label>
                                <span class="detail-value">
                                    <a href="{{ route('customers.show', $invoice->customer_id) }}" class="modern-link">
                                        {{ $invoice->customer->name }}
                                    </a>
                                </span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Phone:</label>
                                <span class="detail-value">{{ $invoice->customer->phone }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Address:</label>
                                <span class="detail-value">{{ $invoice->customer->address }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Opening Balance:</label>
                                <span class="detail-value">{{ number_format($invoice->customer->opening_balance, 2) }}</span>
                            </div>
                            
                            <div class="detail-row">
                                <label>Outstanding Balance:</label>
                                <span class="detail-value amount-highlight">{{ number_format($invoice->customer->outstanding_balance, 2) }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Invoice Items -->
    <div class="card modern-card mt-4">
        <div class="card-header modern-header">
            <h3 class="card-title"><i class="fas fa-boxes"></i> Invoice Items</h3>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table modern-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Product</th>
                            <th>Description</th>
                            <th>Company</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            @if($invoice->invoice_type != 'other')
                            <th class="box-pieces-column">Box</th>
                            <th class="box-pieces-column">Pieces</th>
                            @endif
                            <th>Unit Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($invoice->items as $index => $item)
                        <tr>
                            <td>{{ $index + 1 }}</td>
                            <td>{{ $item->product->name }}</td>
                            <td>
                                {{ $item->description }}
                                @if($item->code)
                                <br><small class="text-muted">{{ $item->code }}</small>
                                @endif
                            </td>
                            <td>{{ $item->product->company->name ?? 'N/A' }}</td>
                            <td>{{ $item->product->category->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item->quantity, 2) }}</td>
                            @if($invoice->invoice_type != 'other')
                            <td class="box-pieces-cell">{{ $item->boxes }}</td>
                            <td class="box-pieces-cell">{{ $item->pieces }}</td>
                            @endif
                            <td>{{ number_format($item->unit_price, 2) }}</td>
                            <td>{{ number_format($item->total, 2) }}</td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Totals and Notes Row -->
    <div class="row mt-4">
        <!-- Notes Section -->
        @if($invoice->notes)
        <div class="col-md-6">
            <div class="card modern-card">
                <div class="card-header modern-header">
                    <h3 class="card-title"><i class="fas fa-sticky-note"></i> Notes</h3>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ $invoice->notes }}</p>
                </div>
            </div>
        </div>
        @endif
        
        <!-- Invoice Totals -->
        <div class="col-md-{{ $invoice->notes ? '6' : '12' }}">
            <div class="card modern-card">
                <div class="card-header totals-header">
                    <h3 class="card-title"><i class="fas fa-calculator"></i> Invoice Totals</h3>
                </div>
                <div class="card-body">
                    <div class="totals-section">
                        <div class="total-row">
                            <label>Subtotal:</label>
                            <span class="total-value">{{ number_format($invoice->subtotal, 2) }}</span>
                        </div>
                        
                        <div class="total-row">
                            <label>Discount:</label>
                            <span class="total-value">{{ number_format($invoice->discount, 2) }}</span>
                        </div>
                        
                        <div class="total-row total-main">
                            <label>Total:</label>
                            <span class="total-value">{{ number_format($invoice->total, 2) }}</span>
                        </div>
                        
                        <div class="total-row">
                            <label>Paid Amount:</label>
                            <span class="total-value">{{ number_format($invoice->paid_amount, 2) }}</span>
                        </div>
                        
                        <div class="total-row">
                            <label>Due Amount:</label>
                            <span class="total-value">{{ number_format($invoice->due_amount, 2) }}</span>
                        </div>
                        
                        <div class="total-row">
                            <label>Previous Outstanding Balance:</label>
                            <span class="total-value">{{ number_format($invoice->customer->outstanding_balance - $invoice->due_amount, 2) }}</span>
                        </div>
                        
                        <div class="total-row total-highlight">
                            <label>Total Balance Due:</label>
                            <span class="total-value">{{ number_format($invoice->customer->outstanding_balance, 2) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="text-center mt-4 mb-4">
        <div class="btn-group">
            <a href="{{ route('invoices.index') }}" class="btn modern-btn modern-btn-secondary btn-lg">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
            <a href="{{ route('invoices.edit', $invoice) }}" class="btn modern-btn modern-btn-warning btn-lg">
                <i class="fas fa-edit"></i> Edit Invoice
            </a>
            <a href="{{ route('invoices.print', $invoice) }}" class="btn modern-btn modern-btn-primary btn-lg" target="_blank">
                <i class="fas fa-print"></i> Print Invoice
            </a>
        </div>
    </div>
@stop

@section('css')
    <style>
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-row label {
            font-weight: 600;
            color: #555;
            margin-bottom: 0;
            min-width: 150px;
        }
        
        .detail-value {
            color: #333;
            text-align: right;
        }
        
        .modern-link {
            color: #007bff;
            text-decoration: none;
        }
        
        .modern-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        
        .modern-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .modern-badge-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .modern-badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .modern-badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .modern-badge-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .amount-highlight {
            font-weight: 600;
            color: #dc3545;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .total-row:last-child {
            border-bottom: none;
        }
        
        .total-row label {
            font-weight: 600;
            color: #555;
            margin-bottom: 0;
        }
        
        .total-value {
            font-weight: 600;
            color: #333;
        }
        
        .total-main {
            background-color: #f8f9fa;
            padding: 15px 10px;
            margin: 10px -10px;
            border-radius: 5px;
        }
        
        .total-main label,
        .total-main .total-value {
            font-size: 1.1em;
            color: #007bff;
        }
        
        .total-highlight {
            background-color: #fff3cd;
            padding: 15px 10px;
            margin: 10px -10px;
            border-radius: 5px;
        }
        
        .total-highlight label,
        .total-highlight .total-value {
            font-size: 1.1em;
            color: #856404;
            font-weight: 700;
        }
        
        .modern-alert {
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
@stop

@section('js')
    <script>
        // Any specific JavaScript can go here
    </script>
@stop


--- Contents of app.blade.php ---
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">

        <title>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans antialiased">
        <div class="min-h-screen bg-gray-100">
            @include('layouts.navigation')

            <!-- Page Heading -->
            @isset($header)
                <header class="bg-white shadow">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        {{ $header }}
                    </div>
                </header>
            @endisset

            <!-- Page Content -->
            <main>
                {{ $slot }}
            </main>
        </div>
    </body>
</html>


--- Contents of auth.blade.php ---
@extends('adminlte::auth.auth-page', ['auth_type' => 'login'])

@section('adminlte_css_pre')
    <link rel="stylesheet" href="{{ asset('vendor/icheck-bootstrap/icheck-bootstrap.min.css') }}">
@stop

@section('adminlte_css')
    @stack('css')
    @yield('css')
@stop

@section('adminlte_js')
    @stack('js')
    @yield('js')
@stop


--- Contents of guest.blade.php ---
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">

        <title>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans text-gray-900 antialiased">
        <div class="min-h-screen flex flex-col sm:justify-center items-center pt-6 sm:pt-0 bg-gray-100">
            <div>
                <a href="/">
                    <x-application-logo class="w-20 h-20 fill-current text-gray-500" />
                </a>
            </div>

            <div class="w-full sm:max-w-md mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg">
                {{ $slot }}
            </div>
        </div>
    </body>
</html>


--- Contents of modern-admin.blade.php ---
@extends('adminlte::page')

@section('title', $title ?? 'Dashboard')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <div>
            @if(isset($breadcrumbs))
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0 m-0">
                        @foreach($breadcrumbs as $breadcrumb)
                            @if($loop->last)
                                <li class="breadcrumb-item active">{{ $breadcrumb['title'] }}</li>
                            @else
                                <li class="breadcrumb-item">
                                    <a href="{{ $breadcrumb['url'] }}" class="text-primary">{{ $breadcrumb['title'] }}</a>
                                </li>
                            @endif
                        @endforeach
                    </ol>
                </nav>
            @endif
            <h1 class="m-0">@yield('page_title', $pageTitle ?? 'Page Title')</h1>
        </div>
        <div>
            @yield('header_actions')
        </div>
    </div>
@stop

@section('content')
    <div class="container-fluid">
        @if(session('success'))
            <div class="alert alert-success alert-dismissible modern-alert">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                <i class="fas fa-check-circle"></i> {{ session('success') }}
            </div>
        @endif
        
        @if(session('error'))
            <div class="alert alert-danger alert-dismissible modern-alert">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                <i class="fas fa-exclamation-circle"></i> {{ session('error') }}
            </div>
        @endif
        
        @if(session('warning'))
            <div class="alert alert-warning alert-dismissible modern-alert">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                <i class="fas fa-exclamation-triangle"></i> {{ session('warning') }}
            </div>
        @endif
        
        @yield('page_content')
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        /* Modern Design System */
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --border-color: #e9ecef;
            --text-muted: #6c757d;
            --shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --border-radius: 0.375rem;
            --border-radius-lg: 0.5rem;
        }

        /* Global Styles */
        body {
            background-color: #f5f6fa;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Breadcrumb Styling */
        .breadcrumb {
            font-size: 0.875rem;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            content: "";
            color: var(--text-muted);
        }

        /* Modern Card Design */
        .modern-card {
            border: none;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            background: white;
        }

        .modern-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            padding: 1rem 1.5rem;
            border: none;
        }

        .modern-header.success-header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .modern-header.warning-header {
            background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
        }

        .modern-header.danger-header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
        }

        .modern-header.info-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .modern-header .card-title {
            margin: 0;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Toggle Groups */
        .toggle-group {
            display: flex;
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--border-color);
            background: white;
        }

        .toggle-group input[type="radio"] {
            display: none;
        }

        .toggle-option {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: none;
            background: white;
            color: var(--text-muted);
        }

        .toggle-option:hover {
            background-color: var(--light-bg);
        }

        .toggle-group input:checked + .toggle-option {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Info Sections */
        .info-section {
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .section-content {
            padding: 1rem;
        }

        /* Modern Form Controls */
        .modern-input,
        .modern-select,
        .modern-textarea {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: white;
        }

        .modern-input:focus,
        .modern-select:focus,
        .modern-textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .modern-input[readonly] {
            background-color: var(--light-bg);
            color: var(--text-muted);
        }

        /* Form Labels */
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .required {
            color: var(--danger-color);
        }

        .form-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Modern Table */
        .modern-table {
            margin: 0;
            font-size: 0.875rem;
        }

        .modern-table thead th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: none;
            padding: 1rem 0.75rem;
            font-weight: 600;
            color: #333;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modern-table tbody td {
            padding: 0.75rem;
            border-top: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .modern-table tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
        }

        /* Modern Buttons */
        .modern-btn {
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .modern-btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, #0056b3 100%);
            color: white;
        }

        .modern-btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #20c997 100%);
            color: white;
        }

        .modern-btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #ff8c00 100%);
            color: white;
        }

        .modern-btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #c82333 100%);
            color: white;
        }

        .modern-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* Modern Alerts */
        .modern-alert {
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            border-left: 4px solid;
        }

        .modern-alert.alert-success {
            border-left-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.1);
        }

        .modern-alert.alert-danger {
            border-left-color: var(--danger-color);
            background-color: rgba(220, 53, 69, 0.1);
        }

        .modern-alert.alert-warning {
            border-left-color: var(--warning-color);
            background-color: rgba(255, 193, 7, 0.1);
        }

        /* Select2 Customization */
        .select2-container--default .select2-selection--single {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            height: auto;
            padding: 0.5rem 0.75rem;
        }

        .select2-container--default.select2-container--focus .select2-selection--single {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .modern-header {
                padding: 0.75rem 1rem;
            }
            
            .section-content {
                padding: 0.75rem;
            }
        }
    </style>
    
    @yield('additional_css')
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize Select2
            $('.select2').each(function() {
                let options = {
                    width: '100%',
                    dropdownAutoWidth: true
                };
                
                const modalParent = $(this).closest('.modal');
                if (modalParent.length) {
                    options.dropdownParent = modalParent;
                }
                
                $(this).select2(options);
            });
            
            // Auto-hide alerts after 5 seconds
            $('.alert').delay(5000).fadeOut();
        });
    </script>
    
    @yield('additional_js')
@stop


--- Contents of navigation.blade.php ---
<nav x-data="{ open: false }" class="bg-white border-b border-gray-100">
    <!-- Primary Navigation Menu -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <!-- Logo -->
                <div class="shrink-0 flex items-center">
                    <a href="{{ route('dashboard') }}">
                        <x-application-logo class="block h-9 w-auto fill-current text-gray-800" />
                    </a>
                </div>

                <!-- Navigation Links -->
                <div class="hidden space-x-8 sm:-my-px sm:ms-10 sm:flex">
                    <x-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                        {{ __('Dashboard') }}
                    </x-nav-link>
                </div>
            </div>

            <!-- Settings Dropdown -->
            <div class="hidden sm:flex sm:items-center sm:ms-6">
                <x-dropdown align="right" width="48">
                    <x-slot name="trigger">
                        <button class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150">
                            <div>{{ Auth::user()->name }}</div>

                            <div class="ms-1">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </button>
                    </x-slot>

                    <x-slot name="content">
                        <x-dropdown-link :href="route('profile.edit')">
                            {{ __('Profile') }}
                        </x-dropdown-link>

                        <!-- Authentication -->
                        <form method="POST" action="{{ route('logout') }}">
                            @csrf

                            <x-dropdown-link :href="route('logout')"
                                    onclick="event.preventDefault();
                                                this.closest('form').submit();">
                                {{ __('Log Out') }}
                            </x-dropdown-link>
                        </form>
                    </x-slot>
                </x-dropdown>
            </div>

            <!-- Hamburger -->
            <div class="-me-2 flex items-center sm:hidden">
                <button @click="open = ! open" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out">
                    <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path :class="{'hidden': open, 'inline-flex': ! open }" class="inline-flex" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        <path :class="{'hidden': ! open, 'inline-flex': open }" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Responsive Navigation Menu -->
    <div :class="{'block': open, 'hidden': ! open}" class="hidden sm:hidden">
        <div class="pt-2 pb-3 space-y-1">
            <x-responsive-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                {{ __('Dashboard') }}
            </x-responsive-nav-link>
        </div>

        <!-- Responsive Settings Options -->
        <div class="pt-4 pb-1 border-t border-gray-200">
            <div class="px-4">
                <div class="font-medium text-base text-gray-800">{{ Auth::user()->name }}</div>
                <div class="font-medium text-sm text-gray-500">{{ Auth::user()->email }}</div>
            </div>

            <div class="mt-3 space-y-1">
                <x-responsive-nav-link :href="route('profile.edit')">
                    {{ __('Profile') }}
                </x-responsive-nav-link>

                <!-- Authentication -->
                <form method="POST" action="{{ route('logout') }}">
                    @csrf

                    <x-responsive-nav-link :href="route('logout')"
                            onclick="event.preventDefault();
                                        this.closest('form').submit();">
                        {{ __('Log Out') }}
                    </x-responsive-nav-link>
                </form>
            </div>
        </div>
    </div>
</nav>


--- Contents of print.blade.php ---
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@yield('title') - Rahman Tiles and Sanitary</title>
    @yield('styles')
</head>
<body>
    <div class="print-container">
        @yield('content')
    </div>
</body>
</html>


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Other Delivery')

@section('content_header')
    <h1>Create New Delivery Challan</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Delivery Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('other-deliveries.store') }}" method="POST" id="delivery-form">
                @csrf
                
                <div class="row">
                    <!-- Challan Info Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Challan Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="challan_number">Challan Number <span class="text-danger">*</span></label>
                                    <input type="text" name="challan_number" id="challan_number" class="form-control" value="{{ $challan_number }}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="delivery_date">Delivery Date <span class="text-danger">*</span></label>
                                    <input type="date" name="delivery_date" id="delivery_date" class="form-control" value="{{ $delivery_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recipient Information -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Recipient Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="recipient_name">Recipient Name <span class="text-danger">*</span></label>
                                    <input type="text" name="recipient_name" id="recipient_name" class="form-control" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="recipient_phone">Recipient Phone</label>
                                    <input type="text" name="recipient_phone" id="recipient_phone" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="recipient_address">Recipient Address <span class="text-danger">*</span></label>
                                    <textarea name="recipient_address" id="recipient_address" class="form-control" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Information -->
                <div class="card mt-4">
                    <div class="card-header bg-warning">
                        <h3 class="card-title">Transport Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="vehicle_type">Vehicle Type</label>
                                    <input type="text" name="vehicle_type" id="vehicle_type" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="vehicle_number">Vehicle Number</label>
                                    <input type="text" name="vehicle_number" id="vehicle_number" class="form-control">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="driver_name">Driver Name</label>
                                    <input type="text" name="driver_name" id="driver_name" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="driver_phone">Driver Phone</label>
                                    <input type="text" name="driver_phone" id="driver_phone" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea name="notes" id="notes" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products for Delivery</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="products-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <th width="20%">Description</th>
                                        <th width="15%">Available</th>
                                        <th width="10%">Quantity</th>
                                        <th width="10%">Unit</th>
                                        <th width="10%">Cartons</th>
                                        <th width="10%">Pieces</th>
                                        <th width="5%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="product-row">
                                        <td>
                                            <select name="product_id[]" class="form-control select2 product-select" required>
                                                <option value="">Select Product</option>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}" data-stock="{{ $product->current_stock }}" data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}">
                                                        {{ $product->name }} ({{ $product->current_stock }} in stock)
                                                    </option>
                                                @endforeach
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" name="description[]" class="form-control">
                                        </td>
                                        <td class="available-stock">0</td>
                                        <td>
                                            <input type="number" name="quantity[]" class="form-control quantity-field" min="0.01" step="0.01" required>
                                            <input type="hidden" class="box-pcs" value="0">
                                            <input type="hidden" class="pieces-feet" value="0">
                                        </td>
                                        <td>
                                            <select class="form-control quantity-type">
                                                <option value="quantity">Quantity</option>
                                                <option value="carton_pieces">Carton/Pieces</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" name="cartons[]" class="form-control carton-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="pieces[]" class="form-control pieces-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger btn-sm remove-row">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="8">
                                            <button type="button" class="btn btn-success btn-sm" id="add-row">
                                                <i class="fas fa-plus"></i> Add Product
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                        <i class="fas fa-save"></i> Create Delivery
                    </button>
                    <a href="{{ route('other-deliveries.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            initializeSelect2();
            
            // Add new row
            $('#add-row').click(function() {
                const newRow = $('.product-row:first').clone();
                newRow.find('input').val('');
                newRow.find('select.product-select').val('').trigger('change');
                newRow.find('.available-stock').text('0');
                $('#products-table tbody').append(newRow);
                initializeSelect2();
            });
            
            // Remove row
            $(document).on('click', '.remove-row', function() {
                if ($('.product-row').length > 1) {
                    $(this).closest('tr').remove();
                } else {
                    alert('At least one product is required.');
                }
            });
            
            // Product selection change
            $(document).on('change', '.product-select', function() {
                const row = $(this).closest('tr');
                const selectedOption = $(this).find('option:selected');
                const stock = selectedOption.data('stock') || 0;
                const boxPcs = selectedOption.data('box-pcs') || 0;
                const piecesFeet = selectedOption.data('pieces-feet') || 0;
                
                row.find('.available-stock').text(stock);
                row.find('.box-pcs').val(boxPcs);
                row.find('.pieces-feet').val(piecesFeet);
                row.find('.quantity-field').attr('max', stock);
                
                // Reset quantity fields
                row.find('.quantity-field').val('');
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            });
            
            // Initialize quantity type handling
            initializeQuantityTypes();
            
            // Calculate boxes and pieces on quantity change
            $(document).on('input', '.quantity-field', function() {
                calculateCartonsAndPieces($(this).closest('tr'));
            });
            
            // Calculate quantity based on cartons and pieces
            $(document).on('input', '.carton-field, .pieces-field', function() {
                calculateQuantityFromCartonPieces($(this).closest('tr'));
            });
            
            // Form validation
            $('#delivery-form').submit(function(e) {
                let valid = true;
                let errorMessage = '';
                
                // Check if at least one product has a quantity
                let hasProducts = false;
                $('.quantity-field').each(function() {
                    if (parseFloat($(this).val()) > 0) {
                        hasProducts = true;
                        return false; // Break the loop
                    }
                });
                
                if (!hasProducts) {
                    valid = false;
                    errorMessage = 'Please add at least one product with a quantity.';
                }
                
                // Check if quantities are valid
                $('.product-row').each(function() {
                    const productSelect = $(this).find('.product-select');
                    const quantityField = $(this).find('.quantity-field');
                    const quantity = parseFloat(quantityField.val());
                    const availableStock = parseFloat($(this).find('.available-stock').text());
                    
                    if (productSelect.val() && (isNaN(quantity) || quantity <= 0)) {
                        valid = false;
                        errorMessage = 'Please enter valid quantities for all products.';
                        quantityField.addClass('is-invalid');
                        return false; // Break the loop
                    } else if (productSelect.val() && quantity > availableStock) {
                        valid = false;
                        errorMessage = 'Quantity cannot exceed available stock.';
                        quantityField.addClass('is-invalid');
                        return false; // Break the loop
                    } else {
                        quantityField.removeClass('is-invalid');
                    }
                });
                
                if (!valid) {
                    e.preventDefault();
                    alert(errorMessage);
                    return false;
                }
                
                return true;
            });
        });
        
        function initializeSelect2() {
            $('.select2').select2({
                width: '100%'
            });
        }
        
        // Initialize quantity type handling
        function initializeQuantityTypes() {
            $(document).on('change', '.quantity-type', function() {
                const row = $(this).closest('tr');
                const value = $(this).val();
                
                if (value === 'quantity') {
                    // Quantity mode
                    row.find('.carton-field, .pieces-field').prop('readonly', true);
                    row.find('.quantity-field').prop('readonly', false);
                    
                    // Recalculate cartons and pieces
                    calculateCartonsAndPieces(row);
                } else {
                    // Carton/Pieces mode
                    row.find('.carton-field, .pieces-field').prop('readonly', false);
                    row.find('.quantity-field').prop('readonly', true);
                    
                    // Initialize carton/pieces fields if empty
                    if (!row.find('.carton-field').val() && !row.find('.pieces-field').val()) {
                        calculateCartonsAndPieces(row);
                    }
                }
            });
            
            // Initialize existing rows
            $('.quantity-type').trigger('change');
        }
        
        // Calculate cartons and pieces based on quantity
        function calculateCartonsAndPieces(row) {
            const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = Math.round(quantity / piecesFeet);
                
                // Calculate cartons (whole number)
                const cartons = Math.floor(totalPieces / boxPcs);
                
                // Calculate remaining pieces
                const pieces = totalPieces - (cartons * boxPcs);
                
                row.find('.carton-field').val(cartons);
                row.find('.pieces-field').val(pieces);
            } else {
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            }
        }
        
        // Calculate quantity based on cartons and pieces
        function calculateQuantityFromCartonPieces(row) {
            const cartons = parseInt(row.find('.carton-field').val()) || 0;
            const pieces = parseInt(row.find('.pieces-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = (cartons * boxPcs) + pieces;
                
                // Calculate quantity
                const quantity = (totalPieces * piecesFeet).toFixed(2);
                
                // Check if quantity exceeds maximum
                const maxQuantity = parseFloat(row.find('.available-stock').text());
                if (quantity > maxQuantity) {
                    alert('Quantity exceeds available amount. Adjusting to maximum.');
                    calculateCartonsAndPieces(row);
                } else {
                    row.find('.quantity-field').val(quantity);
                }
            }
        }
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Other Deliveries')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Other Deliveries</h1>
        <a href="{{ route('other-deliveries.create') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create New Delivery
        </a>
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="deliveries-table">
                    <thead>
                        <tr>
                            <th>Challan #</th>
                            <th>Date</th>
                            <th>Recipient</th>
                            <th>Status</th>
                            <th>Delivered By</th>
                            <th width="15%">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($deliveries as $delivery)
                            <tr>
                                <td>{{ $delivery->challan_number }}</td>
                                <td>{{ $delivery->delivery_date->format('d-m-Y') }}</td>
                                <td>
                                    <strong>{{ $delivery->recipient_name }}</strong><br>
                                    <small>{{ $delivery->recipient_phone }}</small>
                                </td>
                                <td>
                                    @if($delivery->status == 'pending')
                                        <span class="badge badge-warning">Pending</span>
                                    @elseif($delivery->status == 'delivered')
                                        <span class="badge badge-success">Delivered</span>
                                    @else
                                        <span class="badge badge-danger">Cancelled</span>
                                    @endif
                                </td>
                                <td>{{ $delivery->deliveredBy->name ?? 'N/A' }}</td>
                                <td>
                                    <div class="btn-group">
                                        <a href="{{ route('other-deliveries.show', $delivery) }}" class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        @if($delivery->status != 'delivered')
                                            <a href="{{ route('other-deliveries.edit', $delivery) }}" class="btn btn-sm btn-warning">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form action="{{ route('other-deliveries.destroy', $delivery) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this delivery?');" style="display: inline-block;">
                                                @csrf
                                                @method('DELETE')
                                                <button type="submit" class="btn btn-sm btn-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        @endif
                                        <a href="{{ route('other-deliveries.print', $delivery) }}" class="btn btn-sm btn-secondary" target="_blank">
                                            <i class="fas fa-print"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#deliveries-table').DataTable({
                "order": [[0, "desc"]]
            });
        });
    </script>
@stop


--- Contents of print.blade.php ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Challan #{{ $otherDelivery->challan_number }}</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        font-size: 12px;
        line-height: 1.4;
        color: #333;
    }
    
    .challan-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
    }
    
    .challan-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .logo-container {
        width: 80px;
        margin-right: 10px;
    }
    
    .logo-container img {
        width: 100%;
        height: auto;
    }
    
    .company-info {
        text-align: center;
        flex-grow: 1;
    }
    
    .company-info h1 {
        margin: 0;
        font-size: 16px;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    .company-info p {
        margin: 1px 0;
        font-size: 11px;
        line-height: 1.3;
    }
    
    .info-section {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }
    
    .recipient-info {
        width: 50%;
        text-align: left;
    }
    
    .recipient-info h3 {
        margin: 0 0 3px 0;
        font-size: 12px;
    }
    
    .recipient-info p {
        margin: 1px 0;
        font-size: 11px;
    }
    
    .challan-title {
        width: 50%;
        text-align: right;
    }
    
    .challan-title h2 {
        margin: 0;
        color: blue;
        font-size: 16px;
    }
    
    .challan-title p {
        margin: 1px 0;
        font-size: 11px;
    }
    
    .products-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 5px;
    }
    
    .products-table th, .products-table td {
        border: 1px solid #000;
        padding: 4px;
        text-align: left;
        font-size: 11px;
    }
    
    .products-table th {
        background-color: #f2f2f2;
    }
    
    .notes-section {
        margin: 10px 0;
        font-size: 11px;
    }
    
    .signatures {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }
    
    .signature-box {
        width: 45%;
        text-align: center;
        border-top: 1px solid #333;
        padding-top: 2px;
    }
    
    .signature-box p {
        margin: 1px 0;
        font-size: 10px;
    }
    
    .footer-text {
        text-align: center;
        font-size: 10px;
        margin-top: 5px;
    }
    
    @media print {
        body {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
        }
        
        .no-print {
            display: none;
        }
    }
</style>

</head>
<body>
    <div class="challan-container">
        <div class="challan-header">
            <div class="logo-container">
                <img src="{{ asset('logo/logo.png') }}" alt="RTS Logo">
            </div>
                <div class="company-info">
                    <h1>{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</h1>
                    <p>Phone: {{ $businessSettings->phone ?? '01970-598 449 (Bikash),01795-833 166 (Bikash, Nagad)' }}</p>
                    <p>Email: {{ $businessSettings->email ?? 'rahmantilesbd@gmail.com' }}</p>
                    <p>{{ $businessSettings->address ?? 'Model Town, Sadar, Shariatpur' }} 
                    @if($businessSettings->bin_number) 
                        (BIN: {{ $businessSettings->bin_number }})
                    @else
                        (BIN: 004975254-0811)
                    @endif
                    </p>
                </div>
        </div>
        
        <div class="info-section">
            <div class="recipient-info">
                <h3>Recipient</h3>
                <p><strong>{{ $otherDelivery->recipient_name }}</strong></p>
                <p>Address: {{ $otherDelivery->recipient_address }}</p>
                <p>Phone: {{ $otherDelivery->recipient_phone ?? 'N/A' }}</p>
            </div>
            <div class="challan-title">
                <h2>DELIVERY CHALLAN</h2>
                <p>Date: {{ $otherDelivery->delivery_date->format('Y-m-d') }}</p>
                <p>Challan ID: #{{ $otherDelivery->challan_number }}</p>
            </div>
        </div>
        
        <div class="vehicle-info" style="margin-bottom: 15px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="width: 25%;"><strong>Vehicle Type:</strong></td>
                    <td style="width: 25%;">{{ $otherDelivery->vehicle_type ?? 'N/A' }}</td>
                    <td style="width: 25%;"><strong>Vehicle Number:</strong></td>
                    <td style="width: 25%;">{{ $otherDelivery->vehicle_number ?? 'N/A' }}</td>
                </tr>
                <tr>
                    <td><strong>Driver Name:</strong></td>
                    <td>{{ $otherDelivery->driver_name ?? 'N/A' }}</td>
                    <td><strong>Driver Phone:</strong></td>
                    <td>{{ $otherDelivery->driver_phone ?? 'N/A' }}</td>
                </tr>
            </table>
        </div>
        
        <table class="products-table">
            <thead>
                <tr>
                    <th>SL</th>
                    <th>Product Description</th>
                    <th>Category</th>
                    <th>Cartons</th>
                    <th>Pieces</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                @foreach($otherDelivery->items as $index => $item)
                <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ $item->product->name }}
                        @if($item->description)
                        <br><small>{{ $item->description }}</small>
                        @endif
                    </td>
                    <td>{{ $item->product->category->name ?? 'N/A' }}</td>
                    <td>{{ $item->cartons ?? 'N/A' }}</td>
                    <td>{{ $item->pieces ?? 'N/A' }}</td>
                    <td>{{ $item->quantity }}</td>
                </tr>
                @endforeach
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5" style="text-align: right;"><strong>Total Quantity:</strong></td>
                    <td>{{ $otherDelivery->items->sum('quantity') }}</td>
                </tr>
            </tfoot>
        </table>
        
        @if($otherDelivery->notes)
        <div class="notes-section">
            <strong>Notes:</strong> {{ $otherDelivery->notes }}
        </div>
        @endif
        
        <div class="signatures">
            <div class="signature-box">
                <p>Recipient: {{ $otherDelivery->recipient_name }}</p>
                <p>Signature and Date</p>
            </div>
                <div class="signature-box">
                    <p>Issued By: {{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</p>
                    <p>Signature and Date</p>
                </div>
        </div>
        
        <div class="footer-text">
            <p>This is a computer generated document.</p>
            <p>Delivered By: {{ $otherDelivery->deliveredBy->name ?? 'N/A' }} | Status: {{ ucfirst($otherDelivery->status) }}</p>
            <p>Thanks for being with us.</p>
        </div>
        
        <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px;">
                Print Challan
            </button>
            <button onclick="window.close()" style="padding: 8px 16px; background-color: #f44336; color: white; border: none; cursor: pointer; font-size: 14px; margin-left: 10px; border-radius: 4px;">
                Close
            </button>
        </div>
    </div>
    
    <script>
        window.onload = function() {
            // Uncomment to automatically print when the page loads
            // window.print();
        };
    </script>
</body>
</html>


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'View Delivery')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Delivery Challan Details</h1>
        <div>
            <a href="{{ route('other-deliveries.print', $otherDelivery) }}" class="btn btn-info" target="_blank">
                <i class="fas fa-print"></i> Print Challan
            </a>
            <a href="{{ route('other-deliveries.index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-primary">
                            <h3 class="card-title">Challan Information</h3>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <tr>
                                    <th width="40%">Challan Number</th>
                                    <td>{{ $otherDelivery->challan_number }}</td>
                                </tr>
                                <tr>
                                    <th>Delivery Date</th>
                                    <td>{{ $otherDelivery->delivery_date->format('d-m-Y') }}</td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>
                                        @if($otherDelivery->status == 'pending')
                                            <span class="badge badge-warning">Pending</span>
                                        @elseif($otherDelivery->status == 'delivered')
                                            <span class="badge badge-success">Delivered</span>
                                        @else
                                            <span class="badge badge-danger">Cancelled</span>
                                        @endif
                                    </td>
                                </tr>
                                <tr>
                                    <th>Delivered By</th>
                                    <td>{{ $otherDelivery->deliveredBy->name ?? 'N/A' }}</td>
                                </tr>
                            </table>
                            
                            @if($otherDelivery->status != 'delivered')
                                <form action="{{ route('other-deliveries.update-status', $otherDelivery) }}" method="POST" class="mt-3">
                                    @csrf
                                    @method('PATCH')
                                    <div class="input-group">
                                        <select name="status" class="form-control">
                                            <option value="pending" {{ $otherDelivery->status == 'pending' ? 'selected' : '' }}>Pending</option>
                                            <option value="delivered" {{ $otherDelivery->status == 'delivered' ? 'selected' : '' }}>Delivered</option>
                                            <option value="cancelled" {{ $otherDelivery->status == 'cancelled' ? 'selected' : '' }}>Cancelled</option>
                                        </select>
                                        <div class="input-group-append">
                                            <button type="submit" class="btn btn-primary">Update Status</button>
                                        </div>
                                    </div>
                                </form>
                            @endif
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info">
                            <h3 class="card-title">Recipient Information</h3>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <tr>
                                    <th width="40%">Recipient Name</th>
                                    <td>{{ $otherDelivery->recipient_name }}</td>
                                </tr>
                                <tr>
                                    <th>Phone</th>
                                    <td>{{ $otherDelivery->recipient_phone ?? 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th>Address</th>
                                    <td>{{ $otherDelivery->recipient_address }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-warning">
                            <h3 class="card-title">Transport Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-bordered">
                                        <tr>
                                            <th width="40%">Vehicle Type</th>
                                            <td>{{ $otherDelivery->vehicle_type ?? 'N/A' }}</td>
                                        </tr>
                                        <tr>
                                            <th>Vehicle Number</th>
                                            <td>{{ $otherDelivery->vehicle_number ?? 'N/A' }}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <table class="table table-bordered">
                                        <tr>
                                            <th width="40%">Driver Name</th>
                                            <td>{{ $otherDelivery->driver_name ?? 'N/A' }}</td>
                                        </tr>
                                        <tr>
                                            <th>Driver Phone</th>
                                            <td>{{ $otherDelivery->driver_phone ?? 'N/A' }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            @if($otherDelivery->notes)
                                <div class="mt-3">
                                    <strong>Notes:</strong>
                                    <p>{{ $otherDelivery->notes }}</p>
                                </div>
                            @endif
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header bg-success">
                    <h3 class="card-title">Delivered Products</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Product</th>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th>Cartons</th>
                                    <th>Pieces</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($otherDelivery->items as $index => $item)
                                    <tr>
                                        <td>{{ $index + 1 }}</td>
                                        <td>
                                            <strong>{{ $item->product->name }}</strong>
                                            @if($item->product->category)
                                                <br><small>{{ $item->product->category->name }}</small>
                                            @endif
                                        </td>
                                        <td>{{ $item->description }}</td>
                                        <td>{{ $item->quantity }}</td>
                                        <td>{{ $item->cartons ?? 'N/A' }}</td>
                                        <td>{{ $item->pieces ?? 'N/A' }}</td>
                                    </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <div class="btn-group">
                    @if($otherDelivery->status != 'delivered')
                        <a href="{{ route('other-deliveries.edit', $otherDelivery) }}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> Edit Delivery
                        </a>
                        <form action="{{ route('other-deliveries.destroy', $otherDelivery) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this delivery?');">
                            @csrf
                            @method('DELETE')
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Delete Delivery
                            </button>
                        </form>
                    @endif
                    <a href="{{ route('other-deliveries.print', $otherDelivery) }}" class="btn btn-info" target="_blank">
                        <i class="fas fa-print"></i> Print Challan
                    </a>
                </div>
            </div>
        </div>
    </div>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Return')

@section('content_header')
    <h1>Create New Return Record</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Return Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('other-delivery-returns.store') }}" method="POST" id="return-form">
                @csrf
                
                <div class="row">
                    <!-- Return Info Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Return Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="return_number">Return Number <span class="text-danger">*</span></label>
                                    <input type="text" name="return_number" id="return_number" class="form-control" value="{{ $return_number }}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="return_date">Return Date <span class="text-danger">*</span></label>
                                    <input type="date" name="return_date" id="return_date" class="form-control" value="{{ $return_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Returner Information -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Returner Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="returner_name">Returner Name <span class="text-danger">*</span></label>
                                    <input type="text" name="returner_name" id="returner_name" class="form-control" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="returner_phone">Returner Phone</label>
                                    <input type="text" name="returner_phone" id="returner_phone" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="returner_address">Returner Address <span class="text-danger">*</span></label>
                                    <textarea name="returner_address" id="returner_address" class="form-control" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Information -->
                <div class="card mt-4">
                    <div class="card-header bg-warning">
                        <h3 class="card-title">Additional Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="notes">Notes (Reason for Return)</label>
                            <textarea name="notes" id="notes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products Being Returned</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="products-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <th width="20%">Description</th>
                                        <th width="10%">Quantity</th>
                                        <th width="10%">Unit</th>
                                        <th width="10%">Cartons</th>
                                        <th width="10%">Pieces</th>
                                        <th width="5%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="product-row">
                                        <td>
                                            <select name="product_id[]" class="form-control select2 product-select" required>
                                                <option value="">Select Product</option>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}" data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}">
                                                        {{ $product->name }}
                                                    </option>
                                                @endforeach
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" name="description[]" class="form-control">
                                        </td>
                                        <td>
                                            <input type="number" name="quantity[]" class="form-control quantity-field" min="0.01" step="0.01" required>
                                            <input type="hidden" class="box-pcs" value="0">
                                            <input type="hidden" class="pieces-feet" value="0">
                                        </td>
                                        <td>
                                            <select class="form-control quantity-type">
                                                <option value="quantity">Quantity</option>
                                                <option value="carton_pieces">Carton/Pieces</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" name="cartons[]" class="form-control carton-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="pieces[]" class="form-control pieces-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger btn-sm remove-row">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="7">
                                            <button type="button" class="btn btn-success btn-sm" id="add-row">
                                                <i class="fas fa-plus"></i> Add Product
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                        <i class="fas fa-save"></i> Create Return
                    </button>
                    <a href="{{ route('other-delivery-returns.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            initializeSelect2();
            
            // Add new row
            $('#add-row').click(function() {
                const newRow = $('.product-row:first').clone();
                newRow.find('input').val('');
                newRow.find('select.product-select').val('').trigger('change');
                $('#products-table tbody').append(newRow);
                initializeSelect2();
            });
            
            // Remove row
            $(document).on('click', '.remove-row', function() {
                if ($('.product-row').length > 1) {
                    $(this).closest('tr').remove();
                } else {
                    alert('At least one product is required.');
                }
            });
            
            // Product selection change
            $(document).on('change', '.product-select', function() {
                const row = $(this).closest('tr');
                const selectedOption = $(this).find('option:selected');
                const boxPcs = selectedOption.data('box-pcs') || 0;
                const piecesFeet = selectedOption.data('pieces-feet') || 0;
                
                row.find('.box-pcs').val(boxPcs);
                row.find('.pieces-feet').val(piecesFeet);
                
                // Reset quantity fields
                row.find('.quantity-field').val('');
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            });
            
            // Initialize quantity type handling
            initializeQuantityTypes();
            
            // Calculate boxes and pieces on quantity change
            $(document).on('input', '.quantity-field', function() {
                calculateCartonsAndPieces($(this).closest('tr'));
            });
            
            // Calculate quantity based on cartons and pieces
            $(document).on('input', '.carton-field, .pieces-field', function() {
                calculateQuantityFromCartonPieces($(this).closest('tr'));
            });
            
            // Form validation
            $('#return-form').submit(function(e) {
                let valid = true;
                let errorMessage = '';
                
                // Check if at least one product has a quantity
                let hasProducts = false;
                $('.quantity-field').each(function() {
                    if (parseFloat($(this).val()) > 0) {
                        hasProducts = true;
                        return false; // Break the loop
                    }
                });
                
                if (!hasProducts) {
                    valid = false;
                    errorMessage = 'Please add at least one product with a quantity.';
                }
                
                // Check if quantities are valid
                $('.product-row').each(function() {
                    const productSelect = $(this).find('.product-select');
                    const quantityField = $(this).find('.quantity-field');
                    const quantity = parseFloat(quantityField.val());
                    
                    if (productSelect.val() && (isNaN(quantity) || quantity <= 0)) {
                        valid = false;
                        errorMessage = 'Please enter valid quantities for all products.';
                        quantityField.addClass('is-invalid');
                        return false; // Break the loop
                    } else {
                        quantityField.removeClass('is-invalid');
                    }
                });
                
                if (!valid) {
                    e.preventDefault();
                    alert(errorMessage);
                    return false;
                }
                
                return true;
            });
        });
        
        function initializeSelect2() {
            $('.select2').select2({
                width: '100%'
            });
        }
        
        // Initialize quantity type handling
        function initializeQuantityTypes() {
            $(document).on('change', '.quantity-type', function() {
                const row = $(this).closest('tr');
                const value = $(this).val();
                
                if (value === 'quantity') {
                    // Quantity mode
                    row.find('.carton-field, .pieces-field').prop('readonly', true);
                    row.find('.quantity-field').prop('readonly', false);
                    
                    // Recalculate cartons and pieces
                    calculateCartonsAndPieces(row);
                } else {
                    // Carton/Pieces mode
                    row.find('.carton-field, .pieces-field').prop('readonly', false);
                    row.find('.quantity-field').prop('readonly', true);
                    
                    // Initialize carton/pieces fields if empty
                    if (!row.find('.carton-field').val() && !row.find('.pieces-field').val()) {
                        calculateCartonsAndPieces(row);
                    }
                }
            });
            
            // Initialize existing rows
            $('.quantity-type').trigger('change');
        }
        
        // Calculate cartons and pieces based on quantity
        function calculateCartonsAndPieces(row) {
            const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = Math.round(quantity / piecesFeet);
                
                // Calculate cartons (whole number)
                const cartons = Math.floor(totalPieces / boxPcs);
                
                // Calculate remaining pieces
                const pieces = totalPieces - (cartons * boxPcs);
                
                row.find('.carton-field').val(cartons);
                row.find('.pieces-field').val(pieces);
            } else {
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            }
        }
        
        // Calculate quantity based on cartons and pieces
        function calculateQuantityFromCartonPieces(row) {
            const cartons = parseInt(row.find('.carton-field').val()) || 0;
            const pieces = parseInt(row.find('.pieces-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = (cartons * boxPcs) + pieces;
                
                // Calculate quantity
                const quantity = (totalPieces * piecesFeet).toFixed(2);
                
                row.find('.quantity-field').val(quantity);
            }
        }
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Return')

@section('content_header')
    <h1>Edit Return Record</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Return Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('other-delivery-returns.update', ['otherDeliveryReturn' => $otherDeliveryReturn->id]) }}" method="POST" id="return-form">
                @csrf
                @method('PUT')
                
                <div class="row">
                    <!-- Return Info Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Return Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="return_number">Return Number <span class="text-danger">*</span></label>
                                    <input type="text" name="return_number" id="return_number" class="form-control" value="{{ $otherDeliveryReturn->return_number }}" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="return_date">Return Date <span class="text-danger">*</span></label>
                                    <input type="date" name="return_date" id="return_date" class="form-control" value="{{ $otherDeliveryReturn->return_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Returner Information -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Returner Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="returner_name">Returner Name <span class="text-danger">*</span></label>
                                    <input type="text" name="returner_name" id="returner_name" class="form-control" value="{{ $otherDeliveryReturn->returner_name }}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="returner_phone">Invoice</label>
                                    <input type="text" name="returner_phone" id="returner_phone" class="form-control" value="{{ $otherDeliveryReturn->returner_phone }}">
                                </div>
                                
                                <div class="form-group">
                                    <label for="returner_address">Returner Address <span class="text-danger">*</span></label>
                                    <textarea name="returner_address" id="returner_address" class="form-control" rows="3" required>{{ $otherDeliveryReturn->returner_address }}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Information -->
                <div class="card mt-4">
                    <div class="card-header bg-warning">
                        <h3 class="card-title">Additional Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="notes">Notes (Reason for Return)</label>
                            <textarea name="notes" id="notes" class="form-control" rows="3">{{ $otherDeliveryReturn->notes }}</textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products Being Returned</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="products-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <th width="20%">Description</th>
                                        <th width="10%">Quantity</th>
                                        <th width="10%">Unit</th>
                                        <th width="10%">Cartons</th>
                                        <th width="10%">Pieces</th>
                                        <th width="5%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($otherDeliveryReturn->items as $index => $item)
                                        <tr class="product-row">
                                            <td>
                                                <select name="product_id[]" class="form-control select2 product-select" required>
                                                    <option value="">Select Product</option>
                                                    @foreach($products as $product)
                                                        <option value="{{ $product->id }}" data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}" {{ $product->id == $item->product_id ? 'selected' : '' }}>
                                                            {{ $product->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                            </td>
                                            <td>
                                                <input type="text" name="description[]" class="form-control" value="{{ $item->description }}">
                                            </td>
                                            <td>
                                                <input type="number" name="quantity[]" class="form-control quantity-field" min="0.01" step="0.01" value="{{ $item->quantity }}" required>
                                                <input type="hidden" class="box-pcs" value="{{ $item->product->category->box_pcs ?? 0 }}">
                                                <input type="hidden" class="pieces-feet" value="{{ $item->product->category->pieces_feet ?? 0 }}">
                                            </td>
                                            <td>
                                                <select class="form-control quantity-type">
                                                    <option value="quantity">Quantity</option>
                                                    <option value="carton_pieces" {{ ($item->cartons || $item->pieces) ? 'selected' : '' }}>Carton/Pieces</option>
                                                </select>
                                            </td>
                                            <td>
                                                <input type="number" name="cartons[]" class="form-control carton-field" min="0" value="{{ $item->cartons }}" {{ ($item->cartons || $item->pieces) ? '' : 'readonly' }}>
                                            </td>
                                            <td>
                                                <input type="number" name="pieces[]" class="form-control pieces-field" min="0" value="{{ $item->pieces }}" {{ ($item->cartons || $item->pieces) ? '' : 'readonly' }}>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-danger btn-sm remove-row">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    @endforeach
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="7">
                                            <button type="button" class="btn btn-success btn-sm" id="add-row">
                                                <i class="fas fa-plus"></i> Add Product
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                        <i class="fas fa-save"></i> Update Return
                    </button>
                    <a href="{{ route('other-delivery-returns.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            initializeSelect2();
            
            // Template row for adding new products
            const templateRow = `
                <tr class="product-row">
                    <td>
                        <select name="product_id[]" class="form-control select2 product-select" required>
                            <option value="">Select Product</option>
                            @foreach($products as $product)
                                <option value="{{ $product->id }}" data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}">
                                    {{ $product->name }}
                                </option>
                            @endforeach
                        </select>
                    </td>
                    <td>
                        <input type="text" name="description[]" class="form-control">
                    </td>
                    <td>
                        <input type="number" name="quantity[]" class="form-control quantity-field" min="0.01" step="0.01" required>
                        <input type="hidden" class="box-pcs" value="0">
                        <input type="hidden" class="pieces-feet" value="0">
                    </td>
                    <td>
                        <select class="form-control quantity-type">
                            <option value="quantity">Quantity</option>
                            <option value="carton_pieces">Carton/Pieces</option>
                        </select>
                    </td>
                    <td>
                        <input type="number" name="cartons[]" class="form-control carton-field" min="0" readonly>
                    </td>
                    <td>
                        <input type="number" name="pieces[]" class="form-control pieces-field" min="0" readonly>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm remove-row">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            // Add new row
            $('#add-row').click(function() {
                $('#products-table tbody').append(templateRow);
                initializeSelect2();
            });
            
            // Remove row
            $(document).on('click', '.remove-row', function() {
                if ($('.product-row').length > 1) {
                    $(this).closest('tr').remove();
                } else {
                    alert('At least one product is required.');
                }
            });
            
            // Product selection change
            $(document).on('change', '.product-select', function() {
                const row = $(this).closest('tr');
                const selectedOption = $(this).find('option:selected');
                const boxPcs = selectedOption.data('box-pcs') || 0;
                const piecesFeet = selectedOption.data('pieces-feet') || 0;
                
                row.find('.box-pcs').val(boxPcs);
                row.find('.pieces-feet').val(piecesFeet);
                
                // Reset quantity fields
                row.find('.quantity-field').val('');
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            });
            
            // Initialize quantity type handling
            initializeQuantityTypes();
            
            // Calculate boxes and pieces on quantity change
            $(document).on('input', '.quantity-field', function() {
                calculateCartonsAndPieces($(this).closest('tr'));
            });
            
            // Calculate quantity based on cartons and pieces
            $(document).on('input', '.carton-field, .pieces-field', function() {
                calculateQuantityFromCartonPieces($(this).closest('tr'));
            });
            
            // Form validation
            $('#return-form').submit(function(e) {
                let valid = true;
                let errorMessage = '';
                
                // Check if at least one product has a quantity
                let hasProducts = false;
                $('.quantity-field').each(function() {
                    if (parseFloat($(this).val()) > 0) {
                        hasProducts = true;
                        return false; // Break the loop
                    }
                });
                
                if (!hasProducts) {
                    valid = false;
                    errorMessage = 'Please add at least one product with a quantity.';
                }
                
                // Check if quantities are valid
                $('.product-row').each(function() {
                    const productSelect = $(this).find('.product-select');
                    const quantityField = $(this).find('.quantity-field');
                    const quantity = parseFloat(quantityField.val());
                    
                    if (productSelect.val() && (isNaN(quantity) || quantity <= 0)) {
                        valid = false;
                        errorMessage = 'Please enter valid quantities for all products.';
                        quantityField.addClass('is-invalid');
                        return false; // Break the loop
                    } else {
                        quantityField.removeClass('is-invalid');
                    }
                });
                
                if (!valid) {
                    e.preventDefault();
                    alert(errorMessage);
                    return false;
                }
                
                return true;
            });
        });
        
        function initializeSelect2() {
            $('.select2').select2({
                width: '100%'
            });
        }
        
        // Initialize quantity type handling
        function initializeQuantityTypes() {
            $(document).on('change', '.quantity-type', function() {
                const row = $(this).closest('tr');
                const value = $(this).val();
                
                if (value === 'quantity') {
                    // Quantity mode
                    row.find('.carton-field, .pieces-field').prop('readonly', true);
                    row.find('.quantity-field').prop('readonly', false);
                    
                    // Recalculate cartons and pieces
                    calculateCartonsAndPieces(row);
                } else {
                    // Carton/Pieces mode
                    row.find('.carton-field, .pieces-field').prop('readonly', false);
                    row.find('.quantity-field').prop('readonly', true);
                    
                    // Initialize carton/pieces fields if empty
                    if (!row.find('.carton-field').val() && !row.find('.pieces-field').val()) {
                        calculateCartonsAndPieces(row);
                    }
                }
            });
            
            // Initialize existing rows
            $('.quantity-type').trigger('change');
        }
        
        // Calculate cartons and pieces based on quantity
        function calculateCartonsAndPieces(row) {
            const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = Math.round(quantity / piecesFeet);
                
                // Calculate cartons (whole number)
                const cartons = Math.floor(totalPieces / boxPcs);
                
                // Calculate remaining pieces
                const pieces = totalPieces - (cartons * boxPcs);
                
                row.find('.carton-field').val(cartons);
                row.find('.pieces-field').val(pieces);
            } else {
                row.find('.carton-field').val('');
                row.find('.pieces-field').val('');
            }
        }
        
        // Calculate quantity based on cartons and pieces
        function calculateQuantityFromCartonPieces(row) {
            const cartons = parseInt(row.find('.carton-field').val()) || 0;
            const pieces = parseInt(row.find('.pieces-field').val()) || 0;
            const boxPcs = parseFloat(row.find('.box-pcs').val()) || 0;
            const piecesFeet = parseFloat(row.find('.pieces-feet').val()) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = (cartons * boxPcs) + pieces;
                
                // Calculate quantity
                const quantity = (totalPieces * piecesFeet).toFixed(2);
                
                row.find('.quantity-field').val(quantity);
            }
        }
    </script>
@stop

--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Other Delivery Returns')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Other Delivery Returns</h1>
        @can('other-delivery-return-create')
            <a href="{{ route('other-delivery-returns.create') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create New Return
            </a>
        @endcan
    </div>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Return Records</h3>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="returns-table">
                    <thead>
                        <tr>
                            <th>Return #</th>
                            <th>Date</th>
                            <th>Returner</th>
                            <th>Received By</th>
                            <th class="text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($returns as $return)
                            <tr>
                                <td>{{ $return->return_number }}</td>
                                <td>{{ date('d M Y', strtotime($return->return_date)) }}</td>
                                <td>{{ $return->returner_name }}</td>
                                <td>{{ $return->receivedBy->name ?? 'N/A' }}</td>
                                <td class="text-right">
                                    <a href="{{ route('other-delivery-returns.show', $return) }}" class="btn btn-info btn-sm">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    
                                    @if($return->status != 'completed')
                                        @can('other-delivery-return-edit')
                                            <a href="{{ route('other-delivery-returns.edit', $return) }}" class="btn btn-primary btn-sm">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        @endcan
                                        
                                        @can('other-delivery-return-delete')
                                            <form method="POST" action="{{ route('other-delivery-returns.destroy', $return) }}" class="d-inline delete-form">
                                                @csrf
                                                @method('DELETE')
                                                <button type="button" class="btn btn-danger btn-sm delete-btn">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        @endcan
                                    @endif
                                    
                                    @can('other-delivery-return-print')
                                        <a href="{{ route('other-delivery-returns.print', $return) }}" class="btn btn-secondary btn-sm" target="_blank">
                                            <i class="fas fa-print"></i>
                                        </a>
                                    @endcan
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#returns-table').DataTable({
                "order": [[0, "desc"]],
                "language": {
                    "lengthMenu": "Show _MENU_ returns per page",
                    "zeroRecords": "No returns found",
                    "info": "Showing page _PAGE_ of _PAGES_",
                    "infoEmpty": "No returns available",
                    "infoFiltered": "(filtered from _MAX_ total returns)"
                }
            });
            
            // Handle delete button click with confirmation
            $('.delete-btn').click(function() {
                if (confirm('Are you sure you want to delete this return record? This will reverse all inventory adjustments.')) {
                    $(this).closest('.delete-form').submit();
                }
            });
        });
    </script>
@stop


--- Contents of print.blade.php ---
@extends('adminlte::page')

@section('title', 'Print Return')

@section('content')
    <div class="container mt-4 print-container">
        <div class="text-center mb-4">
            <h2>Return Receipt</h2>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5>Return Information</h5>
                        <table class="table table-bordered">
                            <tr>
                                <th width="40%">Return Number</th>
                                <td>{{ $otherDeliveryReturn->return_number }}</td>
                            </tr>
                            <tr>
                                <th>Return Date</th>
                                <td>{{ date('d M Y', strtotime($otherDeliveryReturn->return_date)) }}</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td>
                                    @if($otherDeliveryReturn->status == 'pending')
                                        Pending
                                    @elseif($otherDeliveryReturn->status == 'completed')
                                        Completed
                                    @elseif($otherDeliveryReturn->status == 'rejected')
                                        Rejected
                                    @endif
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5>Returner Information</h5>
                        <table class="table table-bordered">
                            <tr>
                                <th width="40%">Name</th>
                                <td>{{ $otherDeliveryReturn->returner_name }}</td>
                            </tr>
                            <tr>
                                <th>Phone</th>
                                <td>{{ $otherDeliveryReturn->returner_phone ?? 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td>{{ $otherDeliveryReturn->returner_address }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5>Returned Products</h5>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Product</th>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Cartons</th>
                            <th>Pieces</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($otherDeliveryReturn->items as $index => $item)
                            <tr>
                                <td>{{ $index + 1 }}</td>
                                <td>{{ $item->product->name }}</td>
                                <td>{{ $item->description ?? 'N/A' }}</td>
                                <td>{{ $item->quantity }}</td>
                                <td>{{ $item->cartons ?? 'N/A' }}</td>
                                <td>{{ $item->pieces ?? 'N/A' }}</td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="row mt-5">
            <div class="col-md-4 text-center">
                <div class="signature-line"></div>
                <p>Received By</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="signature-line"></div>
                <p>Returned By</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="signature-line"></div>
                <p>Authorized By</p>
            </div>
        </div>
        
        <div class="row mt-5 d-print-none">
            <div class="col-md-12 text-center">
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
                <a href="{{ route('other-delivery-returns.show', ['otherDeliveryReturn' => $otherDeliveryReturn->id]) }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
            </div>
        </div>
    </div>
@stop

@section('css')
    <style>
        @media print {
            body {
                font-size: 12pt;
            }
            
            .d-print-none {
                display: none !important;
            }
            
            .print-container {
                width: 100%;
                max-width: 100%;
            }
            
            .card {
                border: 1px solid #ddd;
                margin-bottom: 20px;
            }
            
            .card-body {
                padding: 15px;
            }
            
            .table {
                width: 100%;
                border-collapse: collapse;
            }
            
            .table th, .table td {
                border: 1px solid #ddd;
                padding: 8px;
            }
            
            .signature-line {
                border-top: 1px solid #000;
                width: 80%;
                margin: 50px auto 10px;
            }
        }
        
        .signature-line {
            border-top: 1px solid #000;
            width: 80%;
            margin: 50px auto 10px;
        }
    </style>
@stop

@section('js')
    <script>
        $(document).ready(function() {
            // Auto-print when page loads
            // window.print();
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Return Details')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Return Details: {{ $otherDeliveryReturn->return_number }}</h1>
        <div>
            
            @if($otherDeliveryReturn->status !== 'completed')
                @can('other-delivery-return-edit')
                    <a href="{{ route('other-delivery-returns.edit', $otherDeliveryReturn) }}" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                @endcan
            @endif
            
            <a href="{{ route('other-delivery-returns.index') }}" class="btn btn-default">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>
@stop

@section('content')
    @if(session('success'))
        <div class="alert alert-success alert-dismissible">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
            {{ session('success') }}
        </div>
    @endif
    
    @if(session('error'))
        <div class="alert alert-danger alert-dismissible">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
            {{ session('error') }}
        </div>
    @endif

    <div class="row">
        <!-- Return Information -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary">
                    <h3 class="card-title">Return Information</h3>
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <tr>
                            <th width="30%">Return Number</th>
                            <td>{{ $otherDeliveryReturn->return_number }}</td>
                        </tr>
                        <tr>
                            <th>Return Date</th>
                            <td>{{ date('d M Y', strtotime($otherDeliveryReturn->return_date)) }}</td>
                        </tr>
                        <tr>

                        </tr>
                        <tr>
                            <th>Received By</th>
                            <td>{{ $otherDeliveryReturn->receivedBy->name ?? 'N/A' }}</td>
                        </tr>
                        <tr>
                            <th>Notes</th>
                            <td>{{ $otherDeliveryReturn->notes ?? 'N/A' }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Returner Information -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info">
                    <h3 class="card-title">Returner Information</h3>
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <tr>
                            <th width="30%">Name</th>
                            <td>{{ $otherDeliveryReturn->returner_name }}</td>
                        </tr>
                        <tr>
                            <th>Phone</th>
                            <td>{{ $otherDeliveryReturn->returner_phone ?? 'N/A' }}</td>
                        </tr>
                        <tr>
                            <th>Address</th>
                            <td>{{ $otherDeliveryReturn->returner_address }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Returned Products -->
    <div class="row mt-3">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-success">
                    <h3 class="card-title">Returned Products</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th>Cartons</th>
                                    <th>Pieces</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($otherDeliveryReturn->items as $index => $item)
                                    <tr>
                                        <td>{{ $index + 1 }}</td>
                                        <td>{{ $item->product->name }}</td>
                                        <td>{{ $item->product->category->name ?? 'N/A' }}</td>
                                        <td>{{ $item->description ?? 'N/A' }}</td>
                                        <td>{{ $item->quantity }}</td>
                                        <td>{{ $item->cartons ?? 'N/A' }}</td>
                                        <td>{{ $item->pieces ?? 'N/A' }}</td>
                                    </tr>
                                @endforeach
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="4" class="text-right">Total:</th>
                                    <th>{{ $otherDeliveryReturn->items->sum('quantity') }}</th>
                                    <th>{{ $otherDeliveryReturn->items->sum('cartons') }}</th>
                                    <th>{{ $otherDeliveryReturn->items->sum('pieces') }}</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Section -->
    @if($otherDeliveryReturn->status !== 'completed')
        @can('other-delivery-return-delete')
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-danger">
                            <h3 class="card-title">Danger Zone</h3>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{{ route('other-delivery-returns.destroy', $otherDeliveryReturn) }}" id="delete-form">
                                @csrf
                                @method('DELETE')
                                
                                <p class="text-danger">
                                    <i class="fas fa-exclamation-triangle"></i> 
                                    Warning: Deleting this return record will remove all items from inventory. This action cannot be undone.
                                </p>
                                
                                <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                                    <i class="fas fa-trash"></i> Delete Return Record
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        @endcan
    @endif
@stop

@section('css')
    <style>
        .table th {
            background-color: #f4f6f9;
        }
    </style>
@stop

@section('js')
    <script>
        function confirmDelete() {
            if (confirm('Are you sure you want to delete this return record? This will remove all items from inventory and cannot be undone.')) {
                document.getElementById('delete-form').submit();
            }
        }
    </script>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Add New Payee')

@section('content_header')
    <h1>Add New Payee</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Payee Information</h3>
        </div>
        <div class="card-body">
            <form action="{{ route('payees.store') }}" method="POST">
                @csrf
                <div class="form-group">
                    <label for="name">Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control @error('name') is-invalid @enderror" id="name" name="name" value="{{ old('name') }}" required>
                    @error('name')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="type">Type <span class="text-danger">*</span></label>
                    <select class="form-control @error('type') is-invalid @enderror" id="type" name="type" required>
                        <option value="supplier" {{ old('type') == 'supplier' ? 'selected' : '' }}>Supplier</option>
                        <option value="individual" {{ old('type') == 'individual' ? 'selected' : '' }}>Individual</option>
                    </select>
                    @error('type')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="text" class="form-control @error('phone') is-invalid @enderror" id="phone" name="phone" value="{{ old('phone') }}">
                    @error('phone')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="address">Address</label>
                    <textarea class="form-control @error('address') is-invalid @enderror" id="address" name="address" rows="3">{{ old('address') }}</textarea>
                    @error('address')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="opening_balance">Opening Balance <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">$</span>
                        </div>
                        <input type="number" step="0.01" class="form-control @error('opening_balance') is-invalid @enderror" id="opening_balance" name="opening_balance" value="{{ old('opening_balance', '0.00') }}" required>
                    </div>
                    <small class="form-text text-muted">Enter the initial amount you owe to this payee.</small>
                    @error('opening_balance')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <button type="submit" class="btn btn-primary">Save Payee</button>
                <a href="{{ route('payees.index') }}" class="btn btn-default">Cancel</a>
            </form>
        </div>
    </div>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Payee')

@section('content_header')
    <h1>Edit Payee</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Payee Information</h3>
        </div>
        <div class="card-body">
            <form action="{{ route('payees.update', $payee->id) }}" method="POST">
                @csrf
                @method('PUT')
                <div class="form-group">
                    <label for="name">Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control @error('name') is-invalid @enderror" id="name" name="name" value="{{ old('name', $payee->name) }}" required>
                    @error('name')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="type">Type <span class="text-danger">*</span></label>
                    <select class="form-control @error('type') is-invalid @enderror" id="type" name="type" required>
                        <option value="supplier" {{ old('type', $payee->type) == 'supplier' ? 'selected' : '' }}>Supplier</option>
                        <option value="individual" {{ old('type', $payee->type) == 'individual' ? 'selected' : '' }}>Individual</option>
                    </select>
                    @error('type')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="text" class="form-control @error('phone') is-invalid @enderror" id="phone" name="phone" value="{{ old('phone', $payee->phone) }}">
                    @error('phone')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="address">Address</label>
                    <textarea class="form-control @error('address') is-invalid @enderror" id="address" name="address" rows="3">{{ old('address', $payee->address) }}</textarea>
                    @error('address')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label>Current Balance</label>
                    <p class="form-control-static">{{ number_format($payee->current_balance, 2) }}</p>
                    <small class="form-text text-muted">To adjust the balance, create a new transaction.</small>
                </div>

                <button type="submit" class="btn btn-primary">Update Payee</button>
                <a href="{{ route('payees.index') }}" class="btn btn-default">Cancel</a>
            </form>
        </div>
    </div>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Payees Management')

@section('content_header')
    <h1>Payees Management</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>{{ number_format($totalPayable, 2) }}</h3>
                    <p>Total Payable Amount</p>
                </div>
                <div class="icon">
                    <i class="fas fa-money-bill"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>{{ $totalSuppliers }}</h3>
                    <p>Total Suppliers</p>
                </div>
                <div class="icon">
                    <i class="fas fa-truck"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>{{ $totalIndividuals }}</h3>
                    <p>Total Individuals</p>
                </div>
                <div class="icon">
                    <i class="fas fa-users"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>{{ $totalSuppliers + $totalIndividuals }}</h3>
                    <p>Total Payees</p>
                </div>
                <div class="icon">
                    <i class="fas fa-user-tag"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Payees List</h3>
            <div class="card-tools">
                <a href="{{ route('payees.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add New Payee
                </a>
            </div>
        </div>
        <div class="card-body">
            <table id="payees-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Phone</th>
                        <th>Current Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    @if($topPayees->count() > 0)
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Top 5 Payees by Balance</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Current Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($topPayees as $payee)
                        <tr>
                            <td>{{ $payee->name }}</td>
                            <td>{{ ucfirst($payee->type) }}</td>
                            <td>{{ number_format($payee->current_balance, 2) }}</td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    @endif
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(function() {
            $('#payees-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: "{{ route('payees.index') }}",
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'name', name: 'name' },
                    { data: 'type', name: 'type' },
                    { data: 'phone', name: 'phone' },
                    { data: 'current_balance', name: 'current_balance' },
                    { data: 'action', name: 'action', orderable: false, searchable: false }
                ]
            });

            // Delete payee with SweetAlert2
            $(document).on('click', '.delete-payee', function() {
                const payeeId = $(this).data('id');
                
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'Cancel',
                    reverseButtons: true,
                    focusCancel: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '/payables/payees/' + payeeId,
                            type: 'DELETE',
                            data: {
                                "_token": "{{ csrf_token() }}"
                            },
                            success: function(response) {
                                if (response.success) {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Deleted!',
                                        text: response.message,
                                        timer: 2000,
                                        showConfirmButton: false
                                    });
                                    $('#payees-table').DataTable().ajax.reload();
                                } else {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Oops...',
                                        text: response.message
                                    });
                                }
                            },
                            error: function() {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong! Please try again.'
                                });
                            }
                        });
                    }
                });
            });
        });
    </script>
@stop


--- Contents of ledger.blade.php ---
@extends('adminlte::page')

@section('title', 'Payee Ledger')

@section('content_header')
    <h1>Ledger for {{ $payee->name }}</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transaction Ledger</h3>
            <div class="card-tools">
                <form action="{{ route('payees.print-ledger', $payee->id) }}" method="GET" target="_blank" class="form-inline">
                    <div class="input-group input-group-sm mr-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">From</span>
                        </div>
                        <input type="date" name="start_date" class="form-control">
                    </div>
                    <div class="input-group input-group-sm mr-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text">To</span>
                        </div>
                        <input type="date" name="end_date" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-sm btn-default">
                        <i class="fas fa-print"></i> Print Ledger
                    </button>
                </form>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-info"><i class="fas fa-user"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Payee</span>
                            <span class="info-box-number">{{ $payee->name }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-warning"><i class="fas fa-money-bill"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Opening Balance</span>
                            <span class="info-box-number">${{ number_format($payee->opening_balance, 2) }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-danger"><i class="fas fa-balance-scale"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">Current Balance</span>
                            <span class="info-box-number">${{ number_format($payee->current_balance, 2) }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <table id="ledger-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Reference</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Balance</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="card-footer">
            <a href="{{ route('payees.show', $payee->id) }}" class="btn btn-default">
                <i class="fas fa-arrow-left"></i> Back to Payee
            </a>
            <a href="{{ route('payable-transactions.create') }}?payee_id={{ $payee->id }}" class="btn btn-success float-right">
                <i class="fas fa-plus"></i> Add Transaction
            </a>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(function() {
            $('#ledger-table').DataTable({
                processing: true,
                serverSide: true,
                order: [[0, 'desc']],
                ajax: "{{ route('payees.ledger', $payee->id) }}",
                columns: [
                    { data: 'transaction_date', name: 'transaction_date' },
                    { data: 'reference_no', name: 'reference_no' },
                    { data: 'transaction_type', name: 'transaction_type' },
                    { data: 'category', name: 'category' },
                    { data: 'description', name: 'description' },
                    { data: 'amount', name: 'amount' },
                    { data: 'balance', name: 'balance' }
                ]
            });
        });
    </script>
@stop


--- Contents of print-ledger.blade.php ---
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ledger for {{ $payee->name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            font-size: 14px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .company-name {
            font-size: 22px;
            font-weight: bold;
        }
        .report-title {
            font-size: 18px;
            margin: 10px 0;
        }
        .payee-info {
            margin-bottom: 20px;
        }
        .payee-info table {
            width: 100%;
            border-collapse: collapse;
        }
        .payee-info table td {
            padding: 5px;
        }
        .ledger-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .ledger-table th, .ledger-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .ledger-table th {
            background-color: #f2f2f2;
        }
        .amount {
            text-align: right;
        }
        .summary {
            margin-top: 20px;
            text-align: right;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #777;
        }
        @media print {
            body {
                padding: 0;
                margin: 0;
            }
            @page {
                margin: 1cm;
            }
        }
    </style>
</head>
<body onload="window.print()">
    <div class="header">
        <div class="company-name">{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</div>
        <div class="report-title">Payee Ledger Report</div>
        <div>
            @if($startDate && $endDate)
                Period: {{ date('M d, Y', strtotime($startDate)) }} to {{ date('M d, Y', strtotime($endDate)) }}
            @else
                All Transactions
            @endif
        </div>
    </div>

    <div class="payee-info">
        <table>
            <tr>
                <td width="15%"><strong>Payee Name:</strong></td>
                <td width="35%">{{ $payee->name }}</td>
                <td width="15%"><strong>Type:</strong></td>
                <td width="35%">{{ ucfirst($payee->type) }}</td>
            </tr>
            <tr>
                <td><strong>Phone:</strong></td>
                <td>{{ $payee->phone ?: 'N/A' }}</td>
                <td><strong>Address:</strong></td>
                <td>{{ $payee->address ?: 'N/A' }}</td>
            </tr>
            <tr>
                <td><strong>Opening Balance:</strong></td>
                <td>${{ number_format($payee->opening_balance, 2) }}</td>
                <td><strong>Current Balance:</strong></td>
                <td>${{ number_format($payee->current_balance, 2) }}</td>
            </tr>
        </table>
    </div>

    <table class="ledger-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Reference</th>
                <th>Type</th>
                <th>Category</th>
                <th>Description</th>
                <th class="amount">Amount</th>
                <th class="amount">Balance</th>
            </tr>
        </thead>
        <tbody>
            @php
                $balance = $payee->opening_balance;
                $totalCashIn = 0;
                $totalCashOut = 0;
            @endphp
            
            @if($transactions->isEmpty())
                <tr>
                    <td colspan="7" style="text-align: center;">No transactions found for this period.</td>
                </tr>
            @else
                @foreach($transactions as $transaction)
                    @php
                        if($transaction->transaction_type == 'cash_in') {
                            $totalCashIn += $transaction->amount;
                        } else {
                            $totalCashOut += $transaction->amount;
                        }
                    @endphp
                    <tr>
                        <td>{{ $transaction->transaction_date->format('Y-m-d') }}</td>
                        <td>{{ $transaction->reference_no ?: 'N/A' }}</td>
                        <td>{{ $transaction->transaction_type == 'cash_in' ? 'Cash In' : 'Cash Out' }}</td>
                        <td>{{ ucfirst($transaction->category) }}</td>
                        <td>{{ $transaction->description ?: 'N/A' }}</td>
                        <td class="amount">${{ number_format($transaction->amount, 2) }}</td>
                        <td class="amount">${{ number_format($transaction->running_balance, 2) }}</td>
                    </tr>
                @endforeach
            @endif
        </tbody>
    </table>

    <div class="summary">
        <p><strong>Total Cash In:</strong> ${{ number_format($totalCashIn, 2) }}</p>
        <p><strong>Total Cash Out:</strong> ${{ number_format($totalCashOut, 2) }}</p>
        <p><strong>Net Change:</strong> ${{ number_format($totalCashOut - $totalCashIn, 2) }}</p>
    </div>

    <div class="footer">
        <p>Generated on {{ date('F d, Y h:i A') }}</p>
    </div>
</body>
</html>


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Payee Details')

@section('content_header')
    <h1>Payee Details</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Payee Information</h3>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th style="width: 30%">Name:</th>
                            <td>{{ $payee->name }}</td>
                        </tr>
                        <tr>
                            <th>Type:</th>
                            <td>{{ ucfirst($payee->type) }}</td>
                        </tr>
                        <tr>
                            <th>Phone:</th>
                            <td>{{ $payee->phone ?: 'N/A' }}</td>
                        </tr>
                        <tr>
                            <th>Address:</th>
                            <td>{{ $payee->address ?: 'N/A' }}</td>
                        </tr>
                        <tr>
                            <th>Opening Balance:</th>
                            <td>${{ number_format($payee->opening_balance, 2) }}</td>
                        </tr>
                        <tr>
                            <th>Current Balance:</th>
                            <td>${{ number_format($payee->current_balance, 2) }}</td>
                        </tr>
                        <tr>
                            <th>Created At:</th>
                            <td>{{ $payee->created_at->format('Y-m-d H:i:s') }}</td>
                        </tr>
                        <tr>
                            <th>Updated At:</th>
                            <td>{{ $payee->updated_at->format('Y-m-d H:i:s') }}</td>
                        </tr>
                    </table>
                </div>
                <div class="card-footer">
                    <a href="{{ route('payees.index') }}" class="btn btn-default">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                    <a href="{{ route('payees.edit', $payee->id) }}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <a href="{{ route('payees.ledger', $payee->id) }}" class="btn btn-primary">
                        <i class="fas fa-book"></i> View Ledger
                    </a>
                    <a href="{{ route('payees.print-ledger', $payee->id) }}" class="btn btn-info" target="_blank">
                        <i class="fas fa-print"></i> Print Ledger
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Transactions</h3>
                    <div class="card-tools">
                        <a href="{{ route('payable-transactions.create') }}?payee_id={{ $payee->id }}" class="btn btn-sm btn-success">
                            <i class="fas fa-plus"></i> Add Transaction
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Reference</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                @forelse($payee->transactions()->orderBy('transaction_date', 'desc')->take(5)->get() as $transaction)
                                    <tr>
                                        <td>{{ $transaction->transaction_date->format('Y-m-d') }}</td>
                                        <td>
                                            @if($transaction->transaction_type == 'cash_in')
                                                <span class="badge badge-success">Cash In</span>
                                            @else
                                                <span class="badge badge-danger">Cash Out</span>
                                            @endif
                                        </td>
                                        <td>{{ ucfirst($transaction->category) }}</td>
                                        <td>${{ number_format($transaction->amount, 2) }}</td>
                                        <td>{{ $transaction->reference_no ?: 'N/A' }}</td>
                                        <td>{{ $transaction->description ?: 'N/A' }}</td>
                                    </tr>
                                @empty
                                    <tr>
                                        <td colspan="6" class="text-center">No transactions found.</td>
                                    </tr>
                                @endforelse
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="{{ route('payees.ledger', $payee->id) }}" class="btn btn-default">
                        <i class="fas fa-list"></i> View All Transactions
                    </a>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Balance Summary</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon bg-success"><i class="fas fa-arrow-down"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Total Cash In</span>
                                    <span class="info-box-number">
                                        ${{ number_format($payee->transactions()->where('transaction_type', 'cash_in')->sum('amount'), 2) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-box">
                                <span class="info-box-icon bg-danger"><i class="fas fa-arrow-up"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Total Cash Out</span>
                                    <span class="info-box-number">
                                        ${{ number_format($payee->transactions()->where('transaction_type', 'cash_out')->sum('amount'), 2) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-group">
                        <span class="progress-text">Current Balance vs Opening Balance</span>
                        @php
                            $percentage = $payee->opening_balance > 0 ? 
                                min(100, ($payee->current_balance / $payee->opening_balance) * 100) : 
                                ($payee->current_balance > 0 ? 100 : 0);
                        @endphp
                        <span class="float-right">
                            <b>${{ number_format($payee->current_balance, 2) }}</b> / ${{ number_format($payee->opening_balance, 2) }}
                        </span>
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-primary" style="width: {{ $percentage }}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <style>
        .card-footer .btn {
            margin-right: 5px;
        }
    </style>
@stop


--- Contents of aging.blade.php ---
@extends('adminlte::page')

@section('title', 'Payables Aging Report')

@section('content_header')
    <h1>Payables Aging Report</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Aging Report as of {{ $referenceDate->format('M d, Y') }}</h3>
            <div class="card-tools">
                <form action="{{ route('payables.reports.aging') }}" method="GET" class="form-inline">
                    <div class="input-group input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Reference Date</span>
                        </div>
                        <input type="date" name="reference_date" class="form-control" value="{{ $referenceDate->format('Y-m-d') }}">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-default">Update</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Payee</th>
                            <th>Type</th>
                            <th class="text-right">Current</th>
                            <th class="text-right">1-30 Days</th>
                            <th class="text-right">31-60 Days</th>
                            <th class="text-right">61-90 Days</th>
                            <th class="text-right">Over 90 Days</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @forelse($agingData as $data)
                            <tr>
                                <td>
                                    <a href="{{ route('payees.show', $data['id']) }}">{{ $data['name'] }}</a>
                                </td>
                                <td>{{ ucfirst($data['type']) }}</td>
                                <td class="text-right">${{ number_format($data['current'], 2) }}</td>
                                <td class="text-right">${{ number_format($data['1-30'], 2) }}</td>
                                <td class="text-right">${{ number_format($data['31-60'], 2) }}</td>
                                <td class="text-right">${{ number_format($data['61-90'], 2) }}</td>
                                <td class="text-right">${{ number_format($data['over_90'], 2) }}</td>
                                <td class="text-right">${{ number_format($data['total'], 2) }}</td>
                            </tr>
                        @empty
                            <tr>
                                <td colspan="8" class="text-center">No payables found.</td>
                            </tr>
                        @endforelse
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold">
                            <td colspan="2">TOTAL</td>
                            <td class="text-right">${{ number_format($totals['current'], 2) }}</td>
                            <td class="text-right">${{ number_format($totals['1-30'], 2) }}</td>
                            <td class="text-right">${{ number_format($totals['31-60'], 2) }}</td>
                            <td class="text-right">${{ number_format($totals['61-90'], 2) }}</td>
                            <td class="text-right">${{ number_format($totals['over_90'], 2) }}</td>
                            <td class="text-right">${{ number_format($totals['total'], 2) }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <a href="{{ route('payables.reports.detailed-aging') }}" class="btn btn-info">
                <i class="fas fa-list"></i> View Detailed Aging Report
            </a>
            <button onclick="window.print()" class="btn btn-default">
                <i class="fas fa-print"></i> Print Report
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Aging Summary</h3>
                </div>
                <div class="card-body">
                    <canvas id="aging-chart" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Aging Analysis</h3>
                </div>
                <div class="card-body">
                    <p>
                        <strong>Total Payables:</strong> ${{ number_format($totals['total'], 2) }}
                    </p>
                    <p>
                        <strong>Current Payables:</strong> ${{ number_format($totals['current'], 2) }}
                        ({{ $totals['total'] > 0 ? round(($totals['current'] / $totals['total']) * 100, 2) : 0 }}%)
                    </p>
                    <p>
                        <strong>Overdue Payables:</strong> ${{ number_format($totals['total'] - $totals['current'], 2) }}
                        ({{ $totals['total'] > 0 ? round((($totals['total'] - $totals['current']) / $totals['total']) * 100, 2) : 0 }}%)
                    </p>
                    <p>
                        <strong>Severely Overdue (>90 days):</strong> ${{ number_format($totals['over_90'], 2) }}
                        ({{ $totals['total'] > 0 ? round(($totals['over_90'] / $totals['total']) * 100, 2) : 0 }}%)
                    </p>
                </div>
            </div>
        </div>
    </div>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(function() {
            // Create aging chart
            var ctx = document.getElementById('aging-chart').getContext('2d');
            var agingChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Current', '1-30 Days', '31-60 Days', '61-90 Days', 'Over 90 Days'],
                    datasets: [{
                        data: [
                            {{ $totals['current'] }},
                            {{ $totals['1-30'] }},
                            {{ $totals['31-60'] }},
                            {{ $totals['61-90'] }},
                            {{ $totals['over_90'] }}
                        ],
                        backgroundColor: [
                            '#28a745', // Green for current
                            '#17a2b8', // Blue for 1-30
                            '#ffc107', // Yellow for 31-60
                            '#fd7e14', // Orange for 61-90
                            '#dc3545'  // Red for over 90
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
@stop


--- Contents of detailed-aging.blade.php ---
@extends('adminlte::page')

@section('title', 'Detailed Payables Aging Report')

@section('content_header')
    <h1>Detailed Payables Aging Report</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Detailed Aging Report as of {{ $referenceDate->format('M d, Y') }}</h3>
            <div class="card-tools">
                <form action="{{ route('payables.reports.detailed-aging') }}" method="GET" class="form-inline">
                    <div class="input-group input-group-sm">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Reference Date</span>
                        </div>
                        <input type="date" name="reference_date" class="form-control" value="{{ $referenceDate->format('Y-m-d') }}">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-default">Update</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="card-body">
            @forelse($agingData as $data)
                <div class="payee-section mb-4">
                    <h5>{{ $data['payee']->name }} ({{ ucfirst($data['payee']->type) }})</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Reference</th>
                                    <th>Category</th>
                                    <th class="text-right">Current</th>
                                    <th class="text-right">1-30 Days</th>
                                    <th class="text-right">31-60 Days</th>
                                    <th class="text-right">61-90 Days</th>
                                    <th class="text-right">Over 90 Days</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($data['transactions'] as $transaction)
                                    <tr>
                                        <td>{{ $transaction['date'] }}</td>
                                        <td>{{ $transaction['reference'] ?: 'N/A' }}</td>
                                        <td>{{ ucfirst($transaction['category']) }}</td>
                                        <td class="text-right">${{ number_format($transaction['current'], 2) }}</td>
                                        <td class="text-right">${{ number_format($transaction['1-30'], 2) }}</td>
                                        <td class="text-right">${{ number_format($transaction['31-60'], 2) }}</td>
                                        <td class="text-right">${{ number_format($transaction['61-90'], 2) }}</td>
                                        <td class="text-right">${{ number_format($transaction['over_90'], 2) }}</td>
                                    </tr>
                                @endforeach
                            </tbody>
                            <tfoot>
                                <tr class="font-weight-bold">
                                    <td colspan="3">Subtotal</td>
                                    <td class="text-right">${{ number_format($data['totals']['current'], 2) }}</td>
                                    <td class="text-right">${{ number_format($data['totals']['1-30'], 2) }}</td>
                                    <td class="text-right">${{ number_format($data['totals']['31-60'], 2) }}</td>
                                    <td class="text-right">${{ number_format($data['totals']['61-90'], 2) }}</td>
                                    <td class="text-right">${{ number_format($data['totals']['over_90'], 2) }}</td>
                                </tr>
                                <tr class="font-weight-bold">
                                    <td colspan="3">Total</td>
                                    <td colspan="5" class="text-right">${{ number_format($data['totals']['total'], 2) }}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            @empty
                <div class="alert alert-info">
                    No payables found for the selected date range.
                </div>
            @endforelse

            <div class="grand-total mt-4">
                <h4>Grand Totals</h4>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th class="text-right">Current</th>
                                <th class="text-right">1-30 Days</th>
                                <th class="text-right">31-60 Days</th>
                                <th class="text-right">61-90 Days</th>
                                <th class="text-right">Over 90 Days</th>
                                <th class="text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="font-weight-bold">
                                <td class="text-right">${{ number_format($totals['current'], 2) }}</td>
                                <td class="text-right">${{ number_format($totals['1-30'], 2) }}</td>
                                <td class="text-right">${{ number_format($totals['31-60'], 2) }}</td>
                                <td class="text-right">${{ number_format($totals['61-90'], 2) }}</td>
                                <td class="text-right">${{ number_format($totals['over_90'], 2) }}</td>
                                <td class="text-right">${{ number_format($totals['total'], 2) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <a href="{{ route('payables.reports.aging') }}" class="btn btn-default">
                <i class="fas fa-arrow-left"></i> Back to Summary Report
            </a>
            <button onclick="window.print()" class="btn btn-default">
                <i class="fas fa-print"></i> Print Report
            </button>
        </div>
    </div>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Add New Transaction')

@section('content_header')
    <h1>Add New Transaction</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transaction Information</h3>
        </div>
        <div class="card-body">
            <form action="{{ route('payable-transactions.store') }}" method="POST">
                @csrf
                <div class="form-group">
                    <label for="payee_id">Payee <span class="text-danger">*</span></label>
                    <select class="form-control select2 @error('payee_id') is-invalid @enderror" id="payee_id" name="payee_id" required>
                        <option value="">Select Payee</option>
                        @foreach($payees as $payee)
                            <option value="{{ $payee->id }}" {{ old('payee_id', request()->get('payee_id')) == $payee->id ? 'selected' : '' }}>
                                {{ $payee->name }} ({{ ucfirst($payee->type) }}) - Balance: ${{ number_format($payee->current_balance, 2) }}
                            </option>
                        @endforeach
                    </select>
                    @error('payee_id')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="transaction_date">Transaction Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control @error('transaction_date') is-invalid @enderror" id="transaction_date" name="transaction_date" value="{{ old('transaction_date', date('Y-m-d')) }}" required>
                    @error('transaction_date')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="transaction_type">Transaction Type <span class="text-danger">*</span></label>
                    <select class="form-control @error('transaction_type') is-invalid @enderror" id="transaction_type" name="transaction_type" required>
                        <option value="cash_in" {{ old('transaction_type') == 'cash_in' ? 'selected' : '' }}>Cash In (Payment to Payee)</option>
                        <option value="cash_out" {{ old('transaction_type') == 'cash_out' ? 'selected' : '' }}>Cash Out (Received from Payee)</option>
                    </select>
                    @error('transaction_type')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="category">Category <span class="text-danger">*</span></label>
                    <select class="form-control @error('category') is-invalid @enderror" id="category" name="category" required>
                        <option value="">Select Category</option>
                        <optgroup label="Cash In Categories">
                            <option value="payment" {{ old('category') == 'payment' ? 'selected' : '' }}>Payment</option>
                            <option value="commission" {{ old('category') == 'commission' ? 'selected' : '' }}>Commission</option>
                            <option value="adjustment" {{ old('category') == 'adjustment' ? 'selected' : '' }}>Adjustment</option>
                            <option value="other_in" {{ old('category') == 'other_in' ? 'selected' : '' }}>Other</option>
                        </optgroup>
                        <optgroup label="Cash Out Categories">
                            <option value="purchase" {{ old('category') == 'purchase' ? 'selected' : '' }}>Purchase</option>
                            <option value="borrow" {{ old('category') == 'borrow' ? 'selected' : '' }}>Borrow</option>
                            <option value="other_out" {{ old('category') == 'other_out' ? 'selected' : '' }}>Other</option>
                        </optgroup>
                    </select>
                    @error('category')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="amount">Amount <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">$</span>
                        </div>
                        <input type="number" step="0.01" min="0.01" class="form-control @error('amount') is-invalid @enderror" id="amount" name="amount" value="{{ old('amount') }}" required>
                    </div>
                    @error('amount')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                    <label for="payment_method">Payment Method</label>
                    <select class="form-control @error('payment_method') is-invalid @enderror" id="payment_method" name="payment_method">
                        <option value="">Select Payment Method</option>
                        <option value="cash" {{ old('payment_method') == 'cash' ? 'selected' : '' }}>Cash</option>
                        <option value="bank_transfer" {{ old('payment_method') == 'bank_transfer' ? 'selected' : '' }}>Bank Transfer</option>
                        <option value="check" {{ old('payment_method') == 'check' ? 'selected' : '' }}>Check</option>
                        <option value="credit_card" {{ old('payment_method') == 'credit_card' ? 'selected' : '' }}>Credit Card</option>
                        <option value="other" {{ old('payment_method') == 'other' ? 'selected' : '' }}>Other</option>
                    </select>
                    @error('payment_method')
                        <span class="invalid-feedback">{{ $message }}</span>
                    @enderror
                </div>

                <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control @error('description') is-invalid @enderror" id="description" name="description" rows="3">{{ old('description') }}</textarea>
                @error('description')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <button type="submit" class="btn btn-primary">Save Transaction</button>
            <a href="{{ route('payable-transactions.index') }}" class="btn btn-default">Cancel</a>
        </form>
    </div>
</div>
@stop

@section('css')
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@x.x.x/dist/select2-bootstrap4.min.css">
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
$(function() {
$('.select2').select2({
theme: 'bootstrap4',
width: '100%'
});

        // Show/hide appropriate categories based on transaction type
        $('#transaction_type').change(function() {
            var type = $(this).val();
            var categorySelect = $('#category');
            categorySelect.val('');
            
            if (type === 'cash_in') {
                categorySelect.find('optgroup[label="Cash In Categories"] option').show();
                categorySelect.find('optgroup[label="Cash Out Categories"] option').hide();
            } else {
                categorySelect.find('optgroup[label="Cash In Categories"] option').hide();
                categorySelect.find('optgroup[label="Cash Out Categories"] option').show();
            }
        });

        // Trigger change event on page load
        $('#transaction_type').trigger('change');
    });
</script>
@stop

--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Transaction')

@section('content_header')
<h1>Edit Transaction</h1>
@stop

@section('content')
<div class="card">
<div class="card-header">
<h3 class="card-title">Edit Transaction Information</h3>
</div>
<div class="card-body">
<form action="{{ route('payable-transactions.update', $transaction->id) }}" method="POST">
@csrf
@method('PUT')
<div class="form-group">
<label for="payee_id">Payee <span class="text-danger">*</span></label>
<select class="form-control select2 @error('payee_id') is-invalid @enderror" id="payee_id" name="payee_id" required>
<option value="">Select Payee</option>
@foreach($payees as $payee)
<option value="{{ $payee->id }}" {{ old('payee_id', $transaction->payee_id) == $payee->id ? 'selected' : '' }}>
{{ $payee->name }} ({{ ucfirst($payee->type) }}) - Balance: ${{ number_format($payee->current_balance, 2) }}
</option>
@endforeach
</select>
@error('payee_id')
<span class="invalid-feedback">{{ $message }}</span>
@enderror
</div>
            <div class="form-group">
                <label for="transaction_date">Transaction Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control @error('transaction_date') is-invalid @enderror" id="transaction_date" name="transaction_date" value="{{ old('transaction_date', $transaction->transaction_date->format('Y-m-d')) }}" required>
                @error('transaction_date')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="transaction_type">Transaction Type <span class="text-danger">*</span></label>
                <select class="form-control @error('transaction_type') is-invalid @enderror" id="transaction_type" name="transaction_type" required>
                    <option value="cash_in" {{ old('transaction_type', $transaction->transaction_type) == 'cash_in' ? 'selected' : '' }}>Cash In (Payment to Payee)</option>
                    <option value="cash_out" {{ old('transaction_type', $transaction->transaction_type) == 'cash_out' ? 'selected' : '' }}>Cash Out (Received from Payee)</option>
                </select>
                @error('transaction_type')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="category">Category <span class="text-danger">*</span></label>
                <select class="form-control @error('category') is-invalid @enderror" id="category" name="category" required>
                    <option value="">Select Category</option>
                    <optgroup label="Cash In Categories">
                        <option value="payment" {{ old('category', $transaction->category) == 'payment' ? 'selected' : '' }}>Payment</option>
                        <option value="commission" {{ old('category', $transaction->category) == 'commission' ? 'selected' : '' }}>Commission</option>
                        <option value="adjustment" {{ old('category', $transaction->category) == 'adjustment' ? 'selected' : '' }}>Adjustment</option>
                        <option value="other_in" {{ old('category', $transaction->category) == 'other_in' ? 'selected' : '' }}>Other</option>
                    </optgroup>
                    <optgroup label="Cash Out Categories">
                        <option value="purchase" {{ old('category', $transaction->category) == 'purchase' ? 'selected' : '' }}>Purchase</option>
                        <option value="borrow" {{ old('category', $transaction->category) == 'borrow' ? 'selected' : '' }}>Borrow</option>
                        <option value="other_out" {{ old('category', $transaction->category) == 'other_out' ? 'selected' : '' }}>Other</option>
                    </optgroup>
                </select>
                @error('category')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="amount">Amount <span class="text-danger">*</span></label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                    </div>
                    <input type="number" step="0.01" min="0.01" class="form-control @error('amount') is-invalid @enderror" id="amount" name="amount" value="{{ old('amount', $transaction->amount) }}" required>
                </div>
                @error('amount')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="payment_method">Payment Method</label>
                <select class="form-control @error('payment_method') is-invalid @enderror" id="payment_method" name="payment_method">
                    <option value="">Select Payment Method</option>
                    <option value="cash" {{ old('payment_method', $transaction->payment_method) == 'cash' ? 'selected' : '' }}>Cash</option>
                    <option value="bank_transfer" {{ old('payment_method', $transaction->payment_method) == 'bank_transfer' ? 'selected' : '' }}>Bank Transfer</option>
                    <option value="check" {{ old('payment_method', $transaction->payment_method) == 'check' ? 'selected' : '' }}>Check</option>
                    <option value="credit_card" {{ old('payment_method', $transaction->payment_method) == 'credit_card' ? 'selected' : '' }}>Credit Card</option>
                    <option value="other" {{ old('payment_method', $transaction->payment_method) == 'other' ? 'selected' : '' }}>Other</option>
                </select>
                @error('payment_method')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="reference_no">Reference Number</label>
                <input type="text" class="form-control @error('reference_no') is-invalid @enderror" id="reference_no" name="reference_no" value="{{ old('reference_no', $transaction->reference_no) }}">
                <small class="form-text text-muted">Invoice number, receipt number, check number, etc.</small>
                @error('reference_no')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control @error('description') is-invalid @enderror" id="description" name="description" rows="3">{{ old('description', $transaction->description) }}</textarea>
                @error('description')
                    <span class="invalid-feedback">{{ $message }}</span>
                @enderror
            </div>

            <button type="submit" class="btn btn-primary">Update Transaction</button>
            <a href="{{ route('payable-transactions.index') }}" class="btn btn-default">Cancel</a>
        </form>
    </div>
</div>
@stop

@section('css')
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@x.x.x/dist/select2-bootstrap4.min.css">
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
$(function() {
$('.select2').select2({
theme: 'bootstrap4',
width: '100%'
});

        // Show/hide appropriate categories based on transaction type
        $('#transaction_type').change(function() {
            var type = $(this).val();
            var categorySelect = $('#category');
            var currentCategory = categorySelect.val();
            
            if (type === 'cash_in') {
                categorySelect.find('optgroup[label="Cash In Categories"] option').show();
                categorySelect.find('optgroup[label="Cash Out Categories"] option').hide();
                
                // If current category is from cash_out, reset it
                if (['purchase', 'borrow', 'other_out'].includes(currentCategory)) {
                    categorySelect.val('');
                }
            } else {
                categorySelect.find('optgroup[label="Cash In Categories"] option').hide();
                categorySelect.find('optgroup[label="Cash Out Categories"] option').show();
                
                // If current category is from cash_in, reset it
                if (['payment', 'commission', 'adjustment', 'other_in'].includes(currentCategory)) {
                    categorySelect.val('');
                }
            }
        });

        // Trigger change event on page load
        $('#transaction_type').trigger('change');
    });
</script>
@stop

--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Payable Transactions')

@section('content_header')
    <h1>Payable Transactions</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-lg-4 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>${{ number_format($totalCashIn, 2) }}</h3>
                    <p>Total Cash In</p>
                </div>
                <div class="icon">
                    <i class="fas fa-arrow-down"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>${{ number_format($totalCashOut, 2) }}</h3>
                    <p>Total Cash Out</p>
                </div>
                <div class="icon">
                    <i class="fas fa-arrow-up"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>${{ number_format($netPayable, 2) }}</h3>
                    <p>Net Payable</p>
                </div>
                <div class="icon">
                    <i class="fas fa-balance-scale"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transactions List</h3>
            <div class="card-tools">
                <a href="{{ route('payable-transactions.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add New Transaction
                </a>
            </div>
        </div>
        <div class="card-body">
            <table id="transactions-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Payee</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Reference</th>
                        <th>Actions</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(function() {
            $('#transactions-table').DataTable({
                processing: true,
                serverSide: true,
                order: [[1, 'desc']],
                ajax: "{{ route('payable-transactions.index') }}",
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'transaction_date', name: 'transaction_date' },
                    { data: 'payee_name', name: 'payee.name' },
                    { data: 'transaction_type', name: 'transaction_type' },
                    { data: 'category', name: 'category' },
                    { data: 'amount', name: 'amount' },
                    { data: 'reference_no', name: 'reference_no' },
                    { data: 'action', name: 'action', orderable: false, searchable: false }
                ]
            });

            // Delete transaction with SweetAlert2
            $(document).on('click', '.delete-transaction', function() {
                const transactionId = $(this).data('id');
                
                Swal.fire({
                    title: 'Delete Transaction',
                    text: "Are you sure you want to delete this transaction? This action cannot be undone.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'Cancel',
                    reverseButtons: true,
                    focusCancel: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '/payables/transactions/' + transactionId,
                            type: 'DELETE',
                            data: {
                                "_token": "{{ csrf_token() }}"
                            },
                            success: function(response) {
                                if (response.success) {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Transaction Deleted',
                                        text: response.message,
                                        timer: 2000,
                                        showConfirmButton: false
                                    });
                                    $('#transactions-table').DataTable().ajax.reload();
                                } else {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Delete Failed',
                                        text: response.message
                                    });
                                }
                            },
                            error: function(xhr) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'System Error',
                                    text: 'Something went wrong with the request. Please try again or contact support.'
                                });
                            }
                        });
                    }
                });
            });
        });
    </script>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Product')

@section('content_header')
    <h1>Create Product</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Add New Product</h3>
        </div>
        <div class="card-body">
            @if($errors->any())
                <div class="alert alert-danger">
                    <ul>
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('products.store') }}" method="POST">
                @csrf
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="name">Product Name <span class="text-danger">*</span></label>
                            <input type="text" name="name" id="name" class="form-control" value="{{ old('name') }}" required tabindex="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="company_id">Company <span class="text-danger">*</span></label>
                            <select name="company_id" id="company_id" class="form-control select2" required tabindex="2">
                                <option value="" tabindex="3">Select Company</option>
                                @foreach($companies as $company)
                                    <option value="{{ $company->id }}" {{ old('company_id') == $company->id ? 'selected' : '' }}>
                                        {{ $company->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="category_id">Category <span class="text-danger">*</span></label>
                            <select name="category_id" id="category_id" class="form-control select2" required tabindex="4">
                                <option value="">Select Category</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>
                                        {{ $category->name }} ({{ $category->box_pcs }} pcs/box, {{ $category->pieces_feet }} pcs/feet)
                                    </option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea name="description" id="description" class="form-control" rows="3" tabindex="5">{{ old('description') }}</textarea>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <!-- Stock Management Toggle -->
                        <div class="form-group">
                            <div class="d-flex align-items-center justify-content-between">
                                <label for="is_stock_managed" class="mb-0">Stock Management</label>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="is_stock_managed" name="is_stock_managed" value="1" {{ old('is_stock_managed', true) ? 'checked' : '' }} tabindex="6">
                                    <label class="custom-control-label" for="is_stock_managed">
                                        <span id="stock-status-text">{{ old('is_stock_managed', true) ? 'Enabled' : 'Disabled' }}</span>
                                    </label>
                                </div>
                            </div>
                            <small class="text-muted">Turn off for services or non-trackable items</small>
                        </div>
                        
                        <div class="form-group" id="opening-stock-group">
                            <label for="opening_stock">Opening Stock <span class="text-danger">*</span></label>
                            <input type="number" name="opening_stock" id="opening_stock" class="form-control" value="{{ old('opening_stock', 0) }}" step="0.01" min="0" required tabindex="7">
                            <small class="text-muted">Initial stock quantity</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="purchase_price">Purchase Price <span class="text-danger">*</span></label>
                            <input type="number" name="purchase_price" id="purchase_price" class="form-control" value="{{ old('purchase_price', 0) }}" step="0.01" min="0" required tabindex="8">
                        </div>
                        
                        <div class="form-group">
                            <label for="sale_price">Sale Price <span class="text-danger">*</span></label>
                            <input type="number" name="sale_price" id="sale_price" class="form-control" value="{{ old('sale_price', 0) }}" step="0.01" min="0" required tabindex="9">
                        </div>
                        
                        <div class="form-group" id="current-stock-group">
                            <label for="current_stock">Current Stock</label>
                            <input type="number" id="current_stock" class="form-control bg-light" value="{{ old('opening_stock', 0) }}" step="0.01" min="0" disabled>
                            <small class="text-muted">This will be set automatically based on opening stock</small>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" tabindex="10">Save Product</button>
                    <a href="{{ route('products.index') }}" class="btn btn-default" tabindex="11">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container {
            z-index: 9999;
        }

        .select2-container--open .select2-dropdown {
            z-index: 10000;
        }

        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        /* Style for read-only fields */
        .bg-light {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }

        /* Improve form spacing */
        .card-body {
            padding: 20px;
        }

        /* Improve select2 appearance */
        .select2-container--default .select2-selection--single {
            height: 38px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 36px;
        }
        
        /* Required field indicator */
        .text-danger {
            font-weight: bold;
        }

        /* Custom switch styling */
        .custom-switch .custom-control-label::before {
            border-radius: 0.5rem;
            background-color: #6c757d;
        }
        
        .custom-switch .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        .custom-switch .custom-control-label::after {
            border-radius: 50%;
        }

        /* Disabled stock fields styling */
        .stock-disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .stock-disabled input {
            background-color: #f8f9fa !important;
            cursor: not-allowed;
        }
    </style>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                width: '100%',
                dropdownAutoWidth: true,
                dropdownParent: $('body'),
                tabIndex: -1
            });
            
            // Enable keyboard navigation for Select2 dropdowns
            $(document).on('select2:open', () => {
                document.querySelector('.select2-search__field').focus();
            });
            
            // Update current stock when opening stock changes
            $('#opening_stock').on('input', function() {
                $('#current_stock').val($(this).val());
            });

            // Handle stock management toggle
            function toggleStockManagement() {
                const isChecked = $('#is_stock_managed').is(':checked');
                const statusText = $('#stock-status-text');
                const openingStockGroup = $('#opening-stock-group');
                const currentStockGroup = $('#current-stock-group');
                const openingStockInput = $('#opening_stock');
                const currentStockInput = $('#current_stock');
                
                if (isChecked) {
                    statusText.text('Enabled');
                    statusText.removeClass('text-danger').addClass('text-success');
                    openingStockGroup.removeClass('stock-disabled');
                    currentStockGroup.removeClass('stock-disabled');
                    openingStockInput.prop('required', true);
                } else {
                    statusText.text('Disabled');
                    statusText.removeClass('text-success').addClass('text-danger');
                    openingStockGroup.addClass('stock-disabled');
                    currentStockGroup.addClass('stock-disabled');
                    openingStockInput.prop('required', false);
                    openingStockInput.val(0);
                    currentStockInput.val(0);
                }
            }

            // Initialize toggle state
            toggleStockManagement();

            // Handle toggle change
            $('#is_stock_managed').on('change', function() {
                toggleStockManagement();
            });
        });
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Product')

@section('content_header')
    <h1>Edit Product</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Product: {{ $product->name }}</h3>
        </div>
        <div class="card-body">
            @if($errors->any())
                <div class="alert alert-danger">
                    <ul>
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('products.update', $product) }}" method="POST">
                @csrf
                @method('PUT')
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="name">Product Name <span class="text-danger">*</span></label>
                            <input type="text" name="name" id="name" class="form-control" value="{{ old('name', $product->name) }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="company_id">Company <span class="text-danger">*</span></label>
                            <select name="company_id" id="company_id" class="form-control select2" required>
                                <option value="">Select Company</option>
                                @foreach($companies as $company)
                                    <option value="{{ $company->id }}" {{ (old('company_id', $product->company_id) == $company->id) ? 'selected' : '' }}>
                                        {{ $company->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="category_id">Category <span class="text-danger">*</span></label>
                            <select name="category_id" id="category_id" class="form-control select2" required>
                                <option value="">Select Category</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ (old('category_id', $product->category_id) == $category->id) ? 'selected' : '' }}>
                                        {{ $category->name }} ({{ $category->box_pcs }} pcs/box, {{ $category->pieces_feet }} pcs/feet)
                                    </option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea name="description" id="description" class="form-control" rows="3">{{ old('description', $product->description) }}</textarea>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <!-- Stock Management Toggle -->
                        <div class="form-group">
                            <div class="d-flex align-items-center justify-content-between">
                                <label for="is_stock_managed" class="mb-0">Stock Management</label>
                                <div class="custom-control custom-switch">
                                    <input type="hidden" name="is_stock_managed" value="0">
                                    <input type="checkbox" class="custom-control-input" id="is_stock_managed" name="is_stock_managed" value="1" {{ old('is_stock_managed', $product->is_stock_managed) ? 'checked' : '' }}>
                                    <label class="custom-control-label" for="is_stock_managed">
                                        <span id="stock-status-text">{{ old('is_stock_managed', $product->is_stock_managed) ? 'Enabled' : 'Disabled' }}</span>
                                    </label>
                                </div>
                            </div>
                            <small class="text-muted">Turn off for services or non-trackable items</small>
                        </div>

                        <div class="form-group" id="opening-stock-group">
                            <label for="opening_stock">Opening Stock <span class="text-danger">*</span></label>
                            <input type="number" name="opening_stock" id="opening_stock" class="form-control" 
                                value="{{ old('opening_stock', $product->opening_stock) }}" 
                                step="0.01" min="0" required
                                data-original="{{ $product->opening_stock }}">
                            <small class="text-muted">Changing this will adjust the current stock accordingly</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="purchase_price">Purchase Price <span class="text-danger">*</span></label>
                            <input type="number" name="purchase_price" id="purchase_price" class="form-control" 
                                value="{{ old('purchase_price', $product->purchase_price) }}" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="sale_price">Sale Price <span class="text-danger">*</span></label>
                            <input type="number" name="sale_price" id="sale_price" class="form-control" 
                                value="{{ old('sale_price', $product->sale_price) }}" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group" id="current-stock-group">
                            <label for="current_stock">Current Stock</label>
                            <input type="number" id="current_stock" class="form-control" 
                                value="{{ $product->current_stock }}" step="0.01" min="0" disabled
                                data-original="{{ $product->current_stock }}">
                            <small class="text-muted">This will be adjusted automatically based on opening stock changes</small>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update Product</button>
                    <a href="{{ route('products.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container {
            z-index: 9999;
        }

        .select2-container--open .select2-dropdown {
            z-index: 10000;
        }

        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        /* Style for read-only fields */
        .bg-light {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }

        /* Improve form spacing */
        .card-body {
            padding: 20px;
        }

        /* Improve select2 appearance */
        .select2-container--default .select2-selection--single {
            height: 38px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 36px;
        }
        
        /* Required field indicator */
        .text-danger {
            font-weight: bold;
        }

        /* Custom switch styling */
        .custom-switch .custom-control-label::before {
            border-radius: 0.5rem;
            background-color: #6c757d;
        }
        
        .custom-switch .custom-control-input:checked ~ .custom-control-label::before {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        .custom-switch .custom-control-label::after {
            border-radius: 50%;
        }

        /* Disabled stock fields styling */
        .stock-disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .stock-disabled input {
            background-color: #f8f9fa !important;
            cursor: not-allowed;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                width: '100%',
                dropdownAutoWidth: true,
                dropdownParent: $('body')
            });
            
            // Update current stock when opening stock changes
            $('#opening_stock').on('input', function() {
                if ($('#is_stock_managed').is(':checked')) {
                    var originalOpeningStock = parseFloat($(this).data('original'));
                    var originalCurrentStock = parseFloat($('#current_stock').data('original'));
                    var newOpeningStock = parseFloat($(this).val()) || 0;
                    
                    // Calculate the difference and adjust current stock
                    var difference = newOpeningStock - originalOpeningStock;
                    var newCurrentStock = originalCurrentStock + difference;
                    
                    $('#current_stock').val(newCurrentStock.toFixed(2));
                }
            });

            // Handle stock management toggle
            function toggleStockManagement() {
                const isChecked = $('#is_stock_managed').is(':checked');
                const statusText = $('#stock-status-text');
                const openingStockGroup = $('#opening-stock-group');
                const currentStockGroup = $('#current-stock-group');
                const openingStockInput = $('#opening_stock');
                const currentStockInput = $('#current_stock');
                
                if (isChecked) {
                    statusText.text('Enabled');
                    statusText.removeClass('text-danger').addClass('text-success');
                    openingStockGroup.removeClass('stock-disabled');
                    currentStockGroup.removeClass('stock-disabled');
                    openingStockInput.prop('required', true);
                } else {
                    statusText.text('Disabled');
                    statusText.removeClass('text-success').addClass('text-danger');
                    openingStockGroup.addClass('stock-disabled');
                    currentStockGroup.addClass('stock-disabled');
                    openingStockInput.prop('required', false);
                    // Don't automatically set to 0 in edit mode - let user decide
                }
            }

            // Initialize toggle state
            toggleStockManagement();

            // Handle toggle change
            $('#is_stock_managed').on('change', function() {
                toggleStockManagement();
                
                // If stock management is disabled, show warning
                if (!$(this).is(':checked')) {
                    if (confirm('Disabling stock management will set current stock to 0. Are you sure?')) {
                        $('#opening_stock').val(0);
                        $('#current_stock').val(0);
                    } else {
                        $(this).prop('checked', true);
                        toggleStockManagement();
                    }
                }
            });
        });
    </script>
@stop


--- Contents of import-status.blade.php ---
@extends('adminlte::page')

@section('title', 'Import Status')

@section('content_header')
    <h1>Import Status</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Product Import Progress</h3>
        </div>
        <div class="card-body">
            @if($batch)
                <div class="progress mb-3">
                    <div class="progress-bar" role="progressbar" style="width: {{ $batch->progress() }}%;" 
                         aria-valuenow="{{ $batch->progress() }}" aria-valuemin="0" aria-valuemax="100">
                        {{ $batch->progress() }}%
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="far fa-clock"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Status</span>
                                <span class="info-box-number">{{ $batch->finished() ? 'Completed' : 'Processing' }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="info-box">
                            <span class="info-box-icon bg-success"><i class="fas fa-tasks"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Jobs Processed</span>
                                <span class="info-box-number">{{ $batch->processedJobs() }} / {{ $batch->totalJobs }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                @if($batch->finished())
                    <div class="alert alert-success">
                        <h5><i class="icon fas fa-check"></i> Import Completed!</h5>
                        <p>Your product import has been successfully processed.</p>
                        <a href="{{ route('products.index') }}" class="btn btn-primary">View Products</a>
                    </div>
                @elseif($batch->cancelled())
                    <div class="alert alert-warning">
                        <h5><i class="icon fas fa-exclamation-triangle"></i> Import Cancelled</h5>
                        <p>The import process was cancelled.</p>
                    </div>
                @elseif($batch->failedJobs)
                    <div class="alert alert-danger">
                        <h5><i class="icon fas fa-ban"></i> Import Failed</h5>
                        <p>{{ $batch->failedJobs }} jobs failed during the import process.</p>
                    </div>
                @else
                    <div class="text-center">
                        <p>The import is being processed. This page will refresh automatically.</p>
                    </div>
                    
                    <script>
                        setTimeout(function() {
                            window.location.reload();
                        }, 5000);
                    </script>
                @endif
                
            @else
                <div class="alert alert-info">
                    <h5><i class="icon fas fa-info"></i> No Active Import</h5>
                    <p>There is no active import process to track.</p>
                    <a href="{{ route('products.import.form') }}" class="btn btn-primary">Start New Import</a>
                </div>
            @endif
        </div>
    </div>
@stop


--- Contents of import.blade.php ---
@extends('adminlte::page')

@section('title', 'Import Products')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1>Import Products</h1>
        <a href="{{ route('products.index') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to Products
        </a>
    </div>
@stop

@section('content')
    <div class="row">
        <div class="col-md-8">
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Upload Excel File</h3>
                </div>
                <div class="card-body">
                    <form action="{{ route('products.import') }}" method="POST" enctype="multipart/form-data">
                        @csrf
                        <div class="form-group">
                            <label for="file">Select Excel File (.xlsx or .xls)</label>
                            <div class="input-group">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input @error('file') is-invalid @enderror" id="file" name="file">
                                    <label class="custom-file-label" for="file">Choose file</label>
                                </div>
                            </div>
                            @error('file')
                                <span class="error invalid-feedback d-block">{{ $message }}</span>
                            @enderror
                        </div>
                        
                        <div class="alert alert-info">
                            <h5><i class="icon fas fa-info"></i> Important Notes:</h5>
                            <ul class="mb-0">
                                <li>Maximum file size: 50MB</li>
                                <li>All required fields must be filled in</li>
                                <li>The import process may take some time for large files</li>
                                <li>Make sure company IDs and category IDs exist in the system</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Upload and Import
                            </button>
                            <a href="{{ route('products.template') }}" class="btn btn-info ml-2">
                                <i class="fas fa-download"></i> Download Template
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            @if (session('import_errors'))
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title">Import Errors</h3>
                    </div>
                    <div class="card-body">
                        <p>The following rows had errors and were not imported:</p>
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-sm table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>Row</th>
                                        <th>Errors</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach(session('import_errors') as $error)
                                        <tr>
                                            <td>{{ $error['row'] }}</td>
                                            <td>
                                                <ul class="mb-0 pl-3">
                                                    @foreach($error['errors'] as $field => $messages)
                                                        @foreach($messages as $message)
                                                            <li>{{ $field }}: {{ $message }}</li>
                                                        @endforeach
                                                    @endforeach
                                                </ul>
                                            </td>
                                        </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            @endif
        </div>
        
        <div class="col-md-4">
            <div class="card card-info">
                <div class="card-header">
                    <h3 class="card-title">Import Instructions</h3>
                </div>
                <div class="card-body">
                    <ol>
                        <li>Download the Excel template using the button below</li>
                        <li>Fill in your product data according to the template</li>
                        <li>Save the Excel file</li>
                        <li>Upload the file using the form</li>
                        <li>Click "Upload and Import" to begin the import process</li>
                    </ol>
                    <p><strong>Required fields:</strong></p>
                    <ul>
                        <li>name</li>
                        <li>company_id</li>
                        <li>category_id</li>
                        <li>opening_stock</li>
                        <li>purchase_price</li>
                        <li>sale_price</li>
                    </ul>
                    <a href="{{ route('products.template') }}" class="btn btn-info btn-block">
                        <i class="fas fa-download"></i> Download Template
                    </a>
                </div>
            </div>
            
            <div class="card card-success">
                <div class="card-header">
                    <h3 class="card-title">Reference Data</h3>
                </div>
                <div class="card-body p-0">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs nav-justified">
                            <li class="nav-item">
                                <a class="nav-link active" href="#companies" data-toggle="tab">Companies</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#categories" data-toggle="tab">Categories</a>
                            </li>
                        </ul>
                        <div class="tab-content p-3" style="max-height: 300px; overflow-y: auto;">
                            <div class="tab-pane active" id="companies">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Company Name</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach(App\Models\Company::orderBy('name')->get() as $company)
                                                <tr>
                                                    <td>{{ $company->id }}</td>
                                                    <td>{{ $company->name }}</td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="tab-pane" id="categories">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Category Name</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach(App\Models\Category::orderBy('name')->get() as $category)
                                                <tr>
                                                    <td>{{ $category->id }}</td>
                                                    <td>{{ $category->name }}</td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@section('js')
    <script>
        $(document).ready(function() {
            // Show filename when selected
            $(".custom-file-input").on("change", function() {
                var fileName = $(this).val().split("\\").pop();
                $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
            });
        });
    </script>
@stop

@section('css')
    <style>
        .nav-tabs-custom {
            background-color: #fff;
        }
        .nav-tabs-custom .nav-link {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        .nav-tabs-custom .nav-link.active {
            border-top: 3px solid #17a2b8;
            margin-top: -3px;
        }
    </style>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Products')

@section('content_header')
    <h1>Products</h1>
@stop

@section('content')
    <!-- Filter Card -->
    <div class="card collapsed-card">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-filter"></i> Advanced Filters</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
        <div class="card-body" style="display: none;">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="name-filter">Product Name</label>
                        <input type="text" id="name-filter" class="form-control" placeholder="Search by name...">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="company-filter">Company</label>
                        <select id="company-filter" class="form-control">
                            <option value="">All Companies</option>
                            @foreach($companies as $company)
                                <option value="{{ $company->id }}">{{ $company->name }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="category-filter">Category</label>
                        <select id="category-filter" class="form-control">
                            <option value="">All Categories</option>
                            @foreach($categories as $category)
                                <option value="{{ $category->id }}">{{ $category->name }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="stock-filter">Stock Status</label>
                        <select id="stock-filter" class="form-control">
                            <option value="">All Stock Status</option>
                            <option value="in_stock">In Stock</option>
                            <option value="low_stock">Low Stock</option>
                            <option value="out_of_stock">Out of Stock</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="min-price">Min Price</label>
                        <input type="number" id="min-price" class="form-control" placeholder="Min price...">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="max-price">Max Price</label>
                        <input type="number" id="max-price" class="form-control" placeholder="Max price...">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="date-range">Created Date Range</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="far fa-calendar-alt"></i>
                                </span>
                            </div>
                            <input type="text" id="date-range" class="form-control float-right" placeholder="Select date range">
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group" style="margin-top: 32px;">
                        <button id="apply-filters" class="btn btn-primary">
                            <i class="fas fa-search"></i> Apply Filters
                        </button>
                        <button id="reset-filters" class="btn btn-default">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Table Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Products</h3>
            <div class="card-tools">
                <a href="{{ route('products.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Product
                </a>
                 {{-- Add import dropdown button --}}
                <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#importModal">
                <i class="fas fa-file-import"></i> Import Products
            </button>
            </div>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            <table id="products-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Company</th>
                        <th>Category</th>
                        <th>Stock</th>
                        <th>Purchase Price</th>
                        <th>Sale Price</th>
                        <th width="280px">Action</th>
                    </tr>
                </thead>
                <tbody>
                   <!-- DataTable content will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Confirm Delete</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this product? This action cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <form id="delete-form" method="POST">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

{{-- Import Modal --}}
<div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title" id="importModalLabel">Import Products</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <form action="{{ route('products.import') }}" method="POST" enctype="multipart/form-data">
                            @csrf
                            <div class="form-group">
                                <label for="file">Select Excel File</label>
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input @error('file') is-invalid @enderror" id="file" name="file" accept=".xlsx,.xls,.csv">
                                    <label class="custom-file-label" for="file">Choose file</label>
                                </div>
                                @error('file')
                                    <div class="invalid-feedback d-block">{{ $message }}</div>
                                @enderror
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Upload and Import
                            </button>
                            <a href="{{ route('products.template.download') }}" class="btn btn-info">
                                <i class="fas fa-download"></i> Download Template
                            </a>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h5><i class="icon fas fa-info"></i> Import Instructions</h5>
                            <ol class="pl-3 mb-0">
                                <li>Download the template file first</li>
                                <li>Fill in your product data</li>
                                <li>Required fields: name, company_id, category_id, opening_stock, purchase_price, sale_price</li>
                                <li>Upload the completed file</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                @if(session('import_failures'))
                    <div class="mt-4">
                        <div class="alert alert-warning">
                            <h5><i class="icon fas fa-exclamation-triangle"></i> Import Warnings</h5>
                            <p>{{ session('warning') }}</p>
                        </div>
                        <div class="table-responsive mt-3">
                            <table class="table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Row #</th>
                                        <th>Data</th>
                                        <th>Error</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach(session('import_failures') as $failure)
                                        <tr>
                                            <td>{{ $failure['row_number'] }}</td>
                                            <td><code>{{ $failure['row_data'] }}</code></td>
                                            <td>{{ $failure['error'] }}</td>
                                        </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    </div>
                @endif
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <style>
        .stock-badge {
            font-size: 0.9rem;
            padding: 6px 10px;
            border-radius: 4px;
            font-weight: 600;
        }
        .stock-qty {
            font-size: 1.1rem;
            font-weight: 700;
            margin-left: 5px;
        }
        .stock-info-box {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            border-radius: 4px;
        }
        .stock-out {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .stock-low {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        .stock-good {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .stock-icon {
            margin-right: 5px;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize date range picker
            $('#date-range').daterangepicker({
                autoUpdateInput: false,
                locale: {
                    cancelLabel: 'Clear'
                }
            });

            $('#date-range').on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format('YYYY-MM-DD') + ' - ' + picker.endDate.format('YYYY-MM-DD'));
            });

            $('#date-range').on('cancel.daterangepicker', function(ev, picker) {
                $(this).val('');
            });
            
            //import
            // Show filename when file is selected
            $(".custom-file-input").on("change", function() {
                var fileName = $(this).val().split("\\").pop();
                $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
            });
            
            // Show import modal if there are import failures
            @if(session('import_failures'))
                $('#importModal').modal('show');
            @endif

            // Initialize DataTable
            var table = $('#products-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{{ route('products.getProducts') }}",
                    data: function(d) {
                        // Add custom filter parameters
                        d.name = $('#name-filter').val();
                        d.company_id = $('#company-filter').val();
                        d.category_id = $('#category-filter').val();
                        d.stock_status = $('#stock-filter').val();
                        d.min_price = $('#min-price').val();
                        d.max_price = $('#max-price').val();
                        
                        // Handle date range
                        var dateRange = $('#date-range').val();
                        if (dateRange) {
                            var dates = dateRange.split(' - ');
                            d.start_date = dates[0];
                            d.end_date = dates.length > 1 ? dates[1] : dates[0];
                        }
                    }
                },
                columns: [
                    {data: 'id', name: 'id'},
                    {data: 'name', name: 'name'},
                    {data: 'company_name', name: 'company_name'},
                    {data: 'category_name', name: 'category_name'},
                    {data: 'current_stock', name: 'current_stock'},
                    {data: 'purchase_price', name: 'purchase_price'},
                    {data: 'sale_price', name: 'sale_price'},
                    {data: 'action', name: 'action', orderable: false, searchable: false},
                ],
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Apply filters button click
            $('#apply-filters').on('click', function() {
                table.draw();
            });
            
            // Reset filters button click
            $('#reset-filters').on('click', function() {
                $('#name-filter').val('');
                $('#company-filter').val('');
                $('#category-filter').val('');
                $('#stock-filter').val('');
                $('#min-price').val('');
                $('#max-price').val('');
                $('#date-range').val('');
                table.draw();
            });
            
            // Handle delete confirmation
            $(document).on('click', '.delete-btn', function() {
                var deleteUrl = $(this).data('url');
                $('#delete-form').attr('action', deleteUrl);
                $('#deleteModal').modal('show');
            });
            
            // Enhanced stock status display
            $('#products-table').on('draw.dt', function() {
                $('#products-table tbody tr').each(function() {
                    var stockCell = $(this).find('td:eq(4)');
                    var stockValue = parseInt(stockCell.text());
                    
                    if (stockValue <= 0) {
                        stockCell.html(
                            '<div class="stock-info-box stock-out">' +
                                '<i class="fas fa-exclamation-circle stock-icon"></i>' +
                                '<span>Out of Stock</span>' +
                                '<span class="stock-qty">(' + stockValue + ')</span>' +
                            '</div>'
                        );
                    } else if (stockValue <= 10) {
                        stockCell.html(
                            '<div class="stock-info-box stock-low">' +
                                '<i class="fas fa-exclamation-triangle stock-icon"></i>' +
                                '<span>Low Stock</span>' +
                                '<span class="stock-qty">' + stockValue + '</span>' +
                            '</div>'
                        );
                    } else {
                        stockCell.html(
                            '<div class="stock-info-box stock-good">' +
                                '<i class="fas fa-check-circle stock-icon"></i>' +
                                '<span>In Stock</span>' +
                                '<span class="stock-qty">' + stockValue + '</span>' +
                            '</div>'
                        );
                    }
                });
            });
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Details')

@section('content_header')
    <h1>Product Details</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ $product->name }}</h3>
            <div class="card-tools">
                <a href="{{ route('products.index') }}" class="btn btn-default">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
                <a href="{{ route('products.edit', $product) }}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Edit
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Product Information</h3>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 200px;">Product Name</th>
                                    <td>{{ $product->name }}</td>
                                </tr>
                                <tr>
                                    <th>Description</th>
                                    <td>{{ $product->description ?? 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th>Company</th>
                                    <td>{{ $product->company->name }}</td>
                                </tr>
                                <tr>
                                    <th>Category</th>
                                    <td>
                                        {{ $product->category->name }}
                                        <small class="d-block text-muted">
                                            {{ $product->category->box_pcs }} pcs/box, 
                                            {{ $product->category->pieces_feet }} pcs/feet
                                        </small>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Created At</th>
                                    <td>{{ $product->created_at->format('F d, Y h:i A') }}</td>
                                </tr>
                                <tr>
                                    <th>Updated At</th>
                                    <td>{{ $product->updated_at->format('F d, Y h:i A') }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Stock & Pricing</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-box bg-light">
                                <span class="info-box-icon bg-primary"><i class="fas fa-boxes"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Opening Stock</span>
                                    <span class="info-box-number">{{ number_format($product->opening_stock, 2) }}</span>
                                </div>
                            </div>
                            
                            <div class="info-box bg-light">
                                <span class="info-box-icon bg-success"><i class="fas fa-warehouse"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Current Stock</span>
                                    <span class="info-box-number">{{ number_format($product->current_stock, 2) }}</span>
                                </div>
                            </div>
                            
                            <div class="info-box bg-light">
                                <span class="info-box-icon bg-warning"><i class="fas fa-shopping-cart"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Purchase Price</span>
                                    <span class="info-box-number">{{ number_format($product->purchase_price, 2) }}</span>
                                </div>
                            </div>
                            
                            <div class="info-box bg-light">
                                <span class="info-box-icon bg-danger"><i class="fas fa-tag"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Sale Price</span>
                                    <span class="info-box-number">{{ number_format($product->sale_price, 2) }}</span>
                                </div>
                            </div>
                            
                            <div class="info-box bg-light">
                                <span class="info-box-icon bg-info"><i class="fas fa-percentage"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">Profit Margin</span>
                                    @php
                                        $margin = $product->purchase_price > 0 
                                            ? (($product->sale_price - $product->purchase_price) / $product->purchase_price) * 100 
                                            : 0;
                                    @endphp
                                    <span class="info-box-number">{{ number_format($margin, 2) }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
@stop

@section('js')
    <script>
        // Any specific JavaScript can go here
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Profile - ERP System')

@section('content_header')
    <h1>Profile</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Profile Information</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Update your account's profile information and email address.
                    </p>

                    <form id="send-verification" method="post" action="{{ route('verification.send') }}">
                        @csrf
                    </form>

                    <form method="post" action="{{ route('profile.update') }}" class="mt-3">
                        @csrf
                        @method('patch')

                        <div class="form-group">
                            <label for="name">Name</label>
                            <input id="name" name="name" type="text" class="form-control @error('name') is-invalid @enderror" 
                                value="{{ old('name', $user->name) }}" required autofocus autocomplete="name">
                            @error('name')
                                <span class="invalid-feedback" role="alert">
                                    <strong>{{ $message }}</strong>
                                </span>
                            @enderror
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            <input id="email" name="email" type="email" class="form-control @error('email') is-invalid @enderror" 
                                value="{{ old('email', $user->email) }}" required autocomplete="email">
                            @error('email')
                                <span class="invalid-feedback" role="alert">
                                    <strong>{{ $message }}</strong>
                                </span>
                            @enderror

                            @if ($user instanceof \Illuminate\Contracts\Auth\MustVerifyEmail && ! $user->hasVerifiedEmail())
                                <div class="mt-2">
                                    <p class="text-sm text-muted">
                                        Your email address is unverified.
                                        <button form="send-verification" class="btn btn-link p-0 m-0 align-baseline">
                                            Click here to re-send the verification email.
                                        </button>
                                    </p>

                                    @if (session('status') === 'verification-link-sent')
                                        <p class="mt-2 text-sm text-success">
                                            A new verification link has been sent to your email address.
                                        </p>
                                    @endif
                                </div>
                            @endif
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Update Password</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Ensure your account is using a long, random password to stay secure.
                    </p>

                    <form method="post" action="{{ route('password.update') }}" class="mt-3">
                        @csrf
                        @method('put')

                        <div class="form-group">
                            <label for="current_password">Current Password</label>
                            <input id="current_password" name="current_password" type="password" 
                                class="form-control @error('current_password') is-invalid @enderror" autocomplete="current-password">
                            @error('current_password')
                                <span class="invalid-feedback" role="alert">
                                    <strong>{{ $message }}</strong>
                                </span>
                            @enderror
                        </div>

                        <div class="form-group">
                            <label for="password">New Password</label>
                            <input id="password" name="password" type="password" 
                                class="form-control @error('password') is-invalid @enderror" autocomplete="new-password">
                            @error('password')
                                <span class="invalid-feedback" role="alert">
                                    <strong>{{ $message }}</strong>
                                </span>
                            @enderror
                        </div>

                        <div class="form-group">
                            <label for="password_confirmation">Confirm Password</label>
                            <input id="password_confirmation" name="password_confirmation" type="password" 
                                class="form-control" autocomplete="new-password">
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header bg-danger">
                    <h3 class="card-title">Delete Account</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Once your account is deleted, all of its resources and data will be permanently deleted.
                    </p>

                    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirm-delete-modal">
                        Delete Account
                    </button>

                    <!-- Delete Account Confirmation Modal -->
                    <div class="modal fade" id="confirm-delete-modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header bg-danger">
                                    <h4 class="modal-title" id="modalLabel">Delete Account</h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Are you sure you want to delete your account? Once your account is deleted, all of its resources and data will be permanently deleted.</p>
                                    
                                    <form method="post" action="{{ route('profile.destroy') }}" id="delete-account-form">
                                        @csrf
                                        @method('delete')
                                        
                                        <div class="form-group">
                                            <label for="password_confirmation_delete">Password</label>
                                            <input id="password_confirmation_delete" name="password" type="password" 
                                                class="form-control" placeholder="Enter your password to confirm">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-danger" onclick="document.getElementById('delete-account-form').submit();">
                                        Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

@section('js')
    <script>
        // You can add custom JavaScript here
    </script>
@stop


--- Contents of delete-user-form.blade.php ---
<section class="space-y-6">
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Delete Account') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Before deleting your account, please download any data or information that you wish to retain.') }}
        </p>
    </header>

    <x-danger-button
        x-data=""
        x-on:click.prevent="$dispatch('open-modal', 'confirm-user-deletion')"
    >{{ __('Delete Account') }}</x-danger-button>

    <x-modal name="confirm-user-deletion" :show="$errors->userDeletion->isNotEmpty()" focusable>
        <form method="post" action="{{ route('profile.destroy') }}" class="p-6">
            @csrf
            @method('delete')

            <h2 class="text-lg font-medium text-gray-900">
                {{ __('Are you sure you want to delete your account?') }}
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Please enter your password to confirm you would like to permanently delete your account.') }}
            </p>

            <div class="mt-6">
                <x-input-label for="password" value="{{ __('Password') }}" class="sr-only" />

                <x-text-input
                    id="password"
                    name="password"
                    type="password"
                    class="mt-1 block w-3/4"
                    placeholder="{{ __('Password') }}"
                />

                <x-input-error :messages="$errors->userDeletion->get('password')" class="mt-2" />
            </div>

            <div class="mt-6 flex justify-end">
                <x-secondary-button x-on:click="$dispatch('close')">
                    {{ __('Cancel') }}
                </x-secondary-button>

                <x-danger-button class="ms-3">
                    {{ __('Delete Account') }}
                </x-danger-button>
            </div>
        </form>
    </x-modal>
</section>


--- Contents of update-password-form.blade.php ---
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Update Password') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __('Ensure your account is using a long, random password to stay secure.') }}
        </p>
    </header>

    <form method="post" action="{{ route('password.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('put')

        <div>
            <x-input-label for="update_password_current_password" :value="__('Current Password')" />
            <x-text-input id="update_password_current_password" name="current_password" type="password" class="mt-1 block w-full" autocomplete="current-password" />
            <x-input-error :messages="$errors->updatePassword->get('current_password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password" :value="__('New Password')" />
            <x-text-input id="update_password_password" name="password" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="update_password_password_confirmation" name="password_confirmation" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>

            @if (session('status') === 'password-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>


--- Contents of update-profile-information-form.blade.php ---
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Profile Information') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __("Update your account's profile information and email address.") }}
        </p>
    </header>

    <form id="send-verification" method="post" action="{{ route('verification.send') }}">
        @csrf
    </form>

    <form method="post" action="{{ route('profile.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('patch')

        <div>
            <x-input-label for="name" :value="__('Name')" />
            <x-text-input id="name" name="name" type="text" class="mt-1 block w-full" :value="old('name', $user->name)" required autofocus autocomplete="name" />
            <x-input-error class="mt-2" :messages="$errors->get('name')" />
        </div>

        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" name="email" type="email" class="mt-1 block w-full" :value="old('email', $user->email)" required autocomplete="username" />
            <x-input-error class="mt-2" :messages="$errors->get('email')" />

            @if ($user instanceof \Illuminate\Contracts\Auth\MustVerifyEmail && ! $user->hasVerifiedEmail())
                <div>
                    <p class="text-sm mt-2 text-gray-800">
                        {{ __('Your email address is unverified.') }}

                        <button form="send-verification" class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            {{ __('Click here to re-send the verification email.') }}
                        </button>
                    </p>

                    @if (session('status') === 'verification-link-sent')
                        <p class="mt-2 font-medium text-sm text-green-600">
                            {{ __('A new verification link has been sent to your email address.') }}
                        </p>
                    @endif
                </div>
            @endif
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>

            @if (session('status') === 'profile-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Purchase')

@section('content_header')
    <h1>Create New Purchase</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Purchase Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('purchases.store') }}" method="POST" id="purchase-form">
                @csrf
                
                <div class="row">
                    <!-- Purchase Info Section -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Purchase Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="purchase_date">Purchase Date <span class="text-danger">*</span></label>
                                    <input type="date" name="purchase_date" id="purchase_date" class="form-control" value="{{ date('Y-m-d') }}" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="invoice_no">Invoice Number</label>
                                    <input type="text" name="invoice_no" id="invoice_no" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="company_id">Supplier <span class="text-danger">*</span></label>
                                    <select name="company_id" id="company_id" class="form-control select2" required>
                                        <option value="">Select Supplier</option>
                                        @foreach($companies as $company)
                                            <option value="{{ $company->id }}">{{ $company->name }}</option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Information -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Additional Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="notes">Notes</label>
                                    <textarea name="notes" id="notes" class="form-control" rows="5"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label>Total Amount</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input type="text" id="total_amount" class="form-control" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-toggle="modal" data-target="#add-product-modal">
                                <i class="fas fa-plus"></i> Add New Product
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="products-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <!--<th width="15%">Category</th>-->
                                        <th width="15%">Unit Type</th>
                                        <th width="10%">Boxes</th>
                                        <th width="10%">Pieces</th>
                                        <th width="10%">Quantity</th>
                                        <th width="10%">Purchase Price</th>
                                        <th width="10%">Total</th>
                                        <th width="5%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="product-row" id="product-row-1">
                                        <td>
                                            <select name="items[0][product_id]" class="form-control select2 product-select" required>
                                                <option value="">Select Product</option>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}" 
                                                        data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" 
                                                        data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}"
                                                        data-purchase-price="{{ $product->purchase_price }}">
                                                        {{ $product->name }}
                                                    </option>
                                                @endforeach
                                            </select>
                                        </td>
                                        <!--<td class="product-category"></td>-->
                                        <td>
                                            <select class="form-control unit-type-select">
                                                <option value="box_pieces">Box/Pieces</option>
                                                <option value="quantity">Quantity</option>
                                                
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control box-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control pieces-field" min="0" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="items[0][quantity]" class="form-control quantity-field" min="0.01" step="0.01" required>
                                        </td>
                                        <td>
                                            <input type="number" name="items[0][purchase_price]" class="form-control purchase-price-field" min="0.01" step="0.01" required>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control total-price" readonly>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger btn-sm remove-row" disabled>
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="7" class="text-right">
                                            <strong>Grand Total:</strong>
                                        </td>
                                        <td>
                                            <strong id="grand-total">0.00</strong>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-success btn-sm" id="add-row">
                                                <i class="fas fa-plus"></i> Add
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                        <i class="fas fa-save"></i> Create Purchase
                    </button>
                    <a href="{{ route('purchases.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="add-product-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add New Product</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="add-product-form">
                        <div class="form-group">
                            <label for="product_name">Product Name <span class="text-danger">*</span></label>
                            <input type="text" id="product_name" name="name" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product_description">Description</label>
                            <textarea id="product_description" name="description" class="form-control"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="product_company">Supplier <span class="text-danger">*</span></label>
                            <select id="product_company" name="company_id" class="form-control" required>
                                <option value="">Select Supplier</option>
                                @foreach($companies as $company)
                                    <option value="{{ $company->id }}">{{ $company->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="product_category">Category <span class="text-danger">*</span></label>
                            <select id="product_category" name="category_id" class="form-control" required>
                                <option value="">Select Category</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}">{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product_purchase_price">Purchase Price <span class="text-danger">*</span></label>
                                    <input type="number" id="product_purchase_price" name="purchase_price" class="form-control" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product_sale_price">Sale Price <span class="text-danger">*</span></label>
                                    <input type="number" id="product_sale_price" name="sale_price" class="form-control" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="product_opening_stock">Opening Stock <span class="text-danger">*</span></label>
                            <input type="number" id="product_opening_stock" name="opening_stock" class="form-control" min="0" step="0.01" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-product-btn">Save Product</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        .select2-container--bootstrap4 .select2-selection--single {
            height: calc(2.25rem + 2px) !important;
        }
        .select2-container--bootstrap4 .select2-selection--single .select2-selection__rendered {
            line-height: 2.25rem;
        }
        /* Chrome, Safari, Edge, Opera */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
}
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            $('.select2').select2({
                theme: 'bootstrap4'
            });
            
            let rowCount = 0;
            
            // Add new row
            $('#add-row').click(function() {
                rowCount++;
                const newRow = `
                    <tr class="product-row" id="product-row-${rowCount}">
                        <td>
                            <select name="items[${rowCount}][product_id]" class="form-control select2 product-select" required>
                                <option value="">Select Product</option>
                                @foreach($products as $product)
                                    <option value="{{ $product->id }}" 
                                        data-box-pcs="{{ $product->category->box_pcs ?? 0 }}" 
                                        data-pieces-feet="{{ $product->category->pieces_feet ?? 0 }}"
                                        data-purchase-price="{{ $product->purchase_price }}">
                                        {{ $product->name }}
                                    </option>
                                @endforeach
                            </select>
                        </td>
                        <td>
                            <select class="form-control unit-type-select">
                            <option value="box_pieces">Box/Pieces</option>
                                <option value="quantity">Quantity</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" class="form-control box-field" min="0" readonly>
                        </td>
                        <td>
                            <input type="number" class="form-control pieces-field" min="0" readonly>
                        </td>
                        <td>
                            <input type="number" name="items[${rowCount}][quantity]" class="form-control quantity-field" min="0.01" step="0.01" required>
                        </td>
                        <td>
                            <input type="number" name="items[${rowCount}][purchase_price]" class="form-control purchase-price-field" min="0.01" step="0.01" required>
                        </td>
                        <td>
                            <input type="text" class="form-control total-price" readonly>
                        </td>
                        <td>
                            <button type="button" class="btn btn-danger btn-sm remove-row">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `;
                $('#products-table tbody').append(newRow);
                
                // Initialize Select2 for new row
                $(`#product-row-${rowCount} .select2`).select2({
                    theme: 'bootstrap4'
                });
                
                // Update total
                updateGrandTotal();
            });
            
            // Remove row
            $(document).on('click', '.remove-row', function() {
                if ($('#products-table tbody tr').length > 1) {
                    $(this).closest('tr').remove();
                    updateGrandTotal();
                }
            });
            
            // Product selection change
            $(document).on('change', '.product-select', function() {
                const selectedOption = $(this).find('option:selected');
                const row = $(this).closest('tr');
                
                if ($(this).val()) {
                    const boxPcs = selectedOption.data('box-pcs') || 0;
                    const piecesFeet = selectedOption.data('pieces-feet') || 0;
                    const purchasePrice = selectedOption.data('purchase-price') || 0;
                    
                    // Store box-pcs and pieces-feet as data attributes on the row
                    row.data('box-pcs', boxPcs);
                    row.data('pieces-feet', piecesFeet);
                    
                    // Set purchase price
                    row.find('.purchase-price-field').val(purchasePrice);
                    
                    // Reset fields
                    row.find('.quantity-field').val('');
                    row.find('.box-field').val('');
                    row.find('.pieces-field').val('');
                    row.find('.total-price').val('');
                    
                    // Get category name
                    $.ajax({
                        url: `/products/${$(this).val()}`,
                        type: 'GET',
                        success: function(response) {
                            row.find('.product-category').text(response.category ? response.category.name : '');
                        }
                    });
                    
                    // Set unit type to quantity by default
                    row.find('.unit-type-select').val('quantity').trigger('change');
                }
            });
            
            // Unit type change
            $(document).on('change', '.unit-type-select', function() {
                const row = $(this).closest('tr');
                const unitType = $(this).val();
                
                if (unitType === 'quantity') {
                    // Quantity mode
                    row.find('.quantity-field').prop('readonly', false);
                    row.find('.box-field, .pieces-field').prop('readonly', true);
                } else {
                    // Box/Pieces mode
                    row.find('.quantity-field').prop('readonly', true);
                    row.find('.box-field, .pieces-field').prop('readonly', false);
                }
            });
            
            // Calculate quantity from boxes and pieces
            $(document).on('input', '.box-field, .pieces-field', function() {
                const row = $(this).closest('tr');
                const unitType = row.find('.unit-type-select').val();
                
                if (unitType === 'box_pieces') {
                    calculateQuantityFromBoxPieces(row);
                    calculateRowTotal(row);
                    updateGrandTotal();
                }
            });
            
            // Calculate boxes and pieces from quantity
            $(document).on('input', '.quantity-field', function() {
                const row = $(this).closest('tr');
                const unitType = row.find('.unit-type-select').val();
                
                if (unitType === 'quantity') {
                    calculateBoxPiecesFromQuantity(row);
                }
                
                calculateRowTotal(row);
                updateGrandTotal();
            });
            
            // Calculate row total when purchase price changes
            $(document).on('input', '.purchase-price-field', function() {
                const row = $(this).closest('tr');
                calculateRowTotal(row);
                updateGrandTotal();
            });
            
            // Calculate quantity from boxes and pieces
            function calculateQuantityFromBoxPieces(row) {
                const boxes = parseInt(row.find('.box-field').val()) || 0;
                const pieces = parseInt(row.find('.pieces-field').val()) || 0;
                const boxPcs = parseFloat(row.data('box-pcs')) || 0;
                const piecesFeet = parseFloat(row.data('pieces-feet')) || 0;
                
                if (boxPcs > 0 && piecesFeet > 0) {
                    // Calculate total pieces
                    const totalPieces = (boxes * boxPcs) + pieces;
                    
                    // Calculate quantity
                    const quantity = (totalPieces * piecesFeet).toFixed(2);
                    
                    row.find('.quantity-field').val(quantity);
                }
            }
            
            // Calculate boxes and pieces from quantity
            function calculateBoxPiecesFromQuantity(row) {
                const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
                const boxPcs = parseFloat(row.data('box-pcs')) || 0;
                const piecesFeet = parseFloat(row.data('pieces-feet')) || 0;
                
                if (boxPcs > 0 && piecesFeet > 0) {
                    // Calculate total pieces
                    const totalPieces = Math.round(quantity / piecesFeet);
                    
                    // Calculate boxes (whole number)
                    const boxes = Math.floor(totalPieces / boxPcs);
                    
                    // Calculate remaining pieces
                    const pieces = totalPieces - (boxes * boxPcs);
                    
                    row.find('.box-field').val(boxes);
                    row.find('.pieces-field').val(pieces);
                }
            }
            
            // Calculate row total
            function calculateRowTotal(row) {
                const quantity = parseFloat(row.find('.quantity-field').val()) || 0;
                const purchasePrice = parseFloat(row.find('.purchase-price-field').val()) || 0;
                const total = quantity * purchasePrice;
                
                row.find('.total-price').val(total.toFixed(2));
            }
            
            // Update grand total
            function updateGrandTotal() {
                let grandTotal = 0;
                
                $('.total-price').each(function() {
                    grandTotal += parseFloat($(this).val()) || 0;
                });
                
                $('#grand-total').text(grandTotal.toFixed(2));
                $('#total_amount').val(grandTotal.toFixed(2));
            }
            
            // Add new product via AJAX
            $('#save-product-btn').click(function() {
                const form = $('#add-product-form');
                const formData = form.serialize();
                
                $.ajax({
                    url: '{{ route("purchases.createProduct") }}',
                    type: 'POST',
                    data: formData,
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    success: function(response) {
                        if (response.success) {
                            // Add new product to all select boxes
                            const newOption = new Option(
                                response.product.name, 
                                response.product.id, 
                                false, 
                                false
                            );
                            
                            $(newOption).data('box-pcs', response.product.category.box_pcs || 0);
                            $(newOption).data('pieces-feet', response.product.category.pieces_feet || 0);
                            $(newOption).data('purchase-price', response.product.purchase_price);
                            
                            $('.product-select').each(function() {
                                $(this).append(newOption.cloneNode(true)).trigger('change');
                            });
                            
                            // Close modal and reset form
                            $('#add-product-modal').modal('hide');
                            form[0].reset();
                            
                            toastr.success('Product added successfully');
                        }
                    },
                    error: function(xhr) {
                        const errors = xhr.responseJSON;
                        if (errors && errors.message) {
                            toastr.error(errors.message);
                        } else {
                            toastr.error('Error adding product');
                        }
                    }
                });
            });
            
            // Form validation
            $('#purchase-form').submit(function(e) {
                let valid = true;
                
                // Check if at least one product has a quantity
                let hasProducts = false;
                $('.quantity-field').each(function() {
                    if (parseFloat($(this).val()) > 0) {
                        hasProducts = true;
                        return false; // Break the loop
                    }
                });
                
                if (!hasProducts) {
                    toastr.error('Please add at least one product with a quantity');
                    e.preventDefault();
                    return false;
                }
                
                // Check if all required fields are filled
                $('.product-row').each(function() {
                    const productId = $(this).find('.product-select').val();
                    const quantity = parseFloat($(this).find('.quantity-field').val());
                    const purchasePrice = parseFloat($(this).find('.purchase-price-field').val());
                    
                    if (productId && (isNaN(quantity) || quantity <= 0)) {
                        toastr.error('Please enter a valid quantity for all products');
                        $(this).find('.quantity-field').addClass('is-invalid').focus();
                        valid = false;
                        return false; // Break the loop
                    }
                    
                    if (productId && (isNaN(purchasePrice) || purchasePrice <= 0)) {
                        toastr.error('Please enter a valid purchase price for all products');
                        $(this).find('.purchase-price-field').addClass('is-invalid').focus();
                        valid = false;
                        return false; // Break the loop
                    }
                });
                
                if (!valid) {
                    e.preventDefault();
                    return false;
                }
                
                return true;
            });
            
            // Initialize unit types
            $('.unit-type-select').trigger('change');
        });
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Purchase')

@section('content_header')
    <h1>Edit Purchase</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Purchase #{{ $purchase->id }}</h3>
        </div>
        <form action="{{ route('purchases.update', $purchase) }}" method="POST" id="purchaseForm">
            @csrf
            @method('PUT')
            <div class="card-body">
                @if(session('error'))
                    <div class="alert alert-danger alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                        {{ session('error') }}
                    </div>
                @endif

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="purchase_date">Purchase Date</label>
                            <input type="date" class="form-control @error('purchase_date') is-invalid @enderror" 
                                id="purchase_date" name="purchase_date" value="{{ old('purchase_date', $purchase->purchase_date->format('Y-m-d')) }}" required>
                            @error('purchase_date')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="invoice_no">Invoice No</label>
                            <input type="text" class="form-control @error('invoice_no') is-invalid @enderror" 
                                id="invoice_no" name="invoice_no" value="{{ old('invoice_no', $purchase->invoice_no) }}">
                            @error('invoice_no')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="company_id">Supplier</label>
                            <select class="form-control select2 @error('company_id') is-invalid @enderror" 
                                id="company_id" name="company_id" required>
                                <option value="">Select Supplier</option>
                                @foreach($companies as $company)
                                    <option value="{{ $company->id }}" {{ old('company_id', $purchase->company_id) == $company->id ? 'selected' : '' }}>
                                        {{ $company->name }}
                                    </option>
                                @endforeach
                            </select>
                            @error('company_id')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="notes">Notes</label>
                            <textarea class="form-control @error('notes') is-invalid @enderror" 
                                id="notes" name="notes" rows="2">{{ old('notes', $purchase->notes) }}</textarea>
                            @error('notes')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                </div>

                <h4 class="mt-4">Purchase Items</h4>
                <div class="table-responsive">
                    <table class="table table-bordered" id="items-table">
                        <thead>
                            <tr>
                                <th width="30%">Product</th>
                                <th width="15%">Quantity</th>
                                <th width="20%">Purchase Price</th>
                                <th width="20%">Total</th>
                                <th width="15%">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($purchase->items as $index => $item)
                                <tr id="item-row-{{ $index + 1 }}">
                                    <td>
                                        <select class="form-control select2 product-select" name="items[{{ $index }}][product_id]" required>
                                            <option value="">Select Product</option>
                                            @foreach($products as $product)
                                                <option value="{{ $product->id }}" 
                                                    data-price="{{ $product->purchase_price }}"
                                                    {{ $item->product_id == $product->id ? 'selected' : '' }}>
                                                    {{ $product->name }} - {{ $product->company->name }}
                                                </option>
                                            @endforeach
                                            <option value="new">+ Add New Product</option>
                                        </select>
                                        <input type="hidden" name="items[{{ $index }}][id]" value="{{ $item->id }}">
                                    </td>
                                    <td>
                                        <input type="number" step="0.01" min="0.01" class="form-control item-quantity" 
                                            name="items[{{ $index }}][quantity]" required value="{{ $item->quantity }}">
                                    </td>
                                    <td>
                                        <input type="number" step="0.01" min="0.01" class="form-control item-price" 
                                            name="items[{{ $index }}][purchase_price]" required value="{{ $item->purchase_price }}">
                                    </td>
                                    <td>
                                        <input type="text" class="form-control item-total" readonly value="{{ $item->total_price }}">
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-sm btn-danger delete-row" {{ count($purchase->items) <= 1 ? 'disabled' : '' }}>
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-right"><strong>Grand Total:</strong></td>
                                <td><input type="text" id="grand-total" class="form-control" readonly value="{{ $purchase->total_amount }}"></td>
                                <td>
                                    <button type="button" class="btn btn-success btn-sm" id="add-row">
                                        <i class="fas fa-plus"></i> Add Item
                                    </button>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary">Update Purchase</button>
                <a href="{{ route('purchases.index') }}" class="btn btn-default">Cancel</a>
            </div>
        </form>
    </div>

    <!-- Add New Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="newProductForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_name">Product Name</label>
                                    <input type="text" class="form-control" id="new_name" name="name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_company_id">Company</label>
                                    <select class="form-control" id="new_company_id" name="company_id" required>
                                        <option value="">Select Company</option>
                                        @foreach($companies as $company)
                                            <option value="{{ $company->id }}">{{ $company->name }}</option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_category_id">Category</label>
                                    <select class="form-control" id="new_category_id" name="category_id" required>
                                        <option value="">Select Category</option>
                                        @foreach($categories as $category)
                                            <option value="{{ $category->id }}">{{ $category->name }}</option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_opening_stock">Opening Stock</label>
                                    <input type="number" step="0.01" min="0" class="form-control" id="new_opening_stock" name="opening_stock" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_purchase_price">Purchase Price</label>
                                    <input type="number" step="0.01" min="0" class="form-control" id="new_purchase_price" name="purchase_price" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="new_sale_price">Sale Price</label>
                                    <input type="number" step="0.01" min="0" class="form-control" id="new_sale_price" name="sale_price" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new_description">Description</label>
                            <textarea class="form-control" id="new_description" name="description" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveNewProduct">Save Product</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        .select2-container--bootstrap4 .select2-selection--single {
            height: calc(2.25rem + 2px) !important;
        }
        .select2-container--bootstrap4 .select2-selection--single .select2-selection__rendered {
            line-height: 2.25rem;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize meta csrf-token
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            
            // Initialize Select2
            $('.select2').select2({
                theme: 'bootstrap4'
            });

            // Set initial row count
            let rowCount = {{ count($purchase->items) }};
            
            // Add new row
            $('#add-row').click(function() {
                rowCount++;
                const newRow = `
                    <tr id="item-row-${rowCount}">
                        <td>
                            <select class="form-control select2 product-select" name="items[${rowCount-1}][product_id]" required>
                                <option value="">Select Product</option>
                                @foreach($products as $product)
                                    <option value="{{ $product->id }}" data-price="{{ $product->purchase_price }}">
                                        {{ $product->name }} - {{ $product->company->name }}
                                    </option>
                                @endforeach
                                <option value="new">+ Add New Product</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" step="0.01" min="0.01" class="form-control item-quantity" 
                                name="items[${rowCount-1}][quantity]" required value="1">
                        </td>
                        <td>
                            <input type="number" step="0.01" min="0.01" class="form-control item-price" 
                                name="items[${rowCount-1}][purchase_price]" required value="0.00">
                        </td>
                        <td>
                            <input type="text" class="form-control item-total" readonly value="0.00">
                        </td>
                        <td>
                            <button type="button" class="btn btn-sm btn-danger delete-row">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                $('#items-table tbody').append(newRow);
                
                // Initialize Select2 for new row
                $(`#item-row-${rowCount} .select2`).select2({
                    theme: 'bootstrap4'
                });
                
                // Enable all delete buttons when we have more than one row
                if ($('#items-table tbody tr').length > 1) {
                    $('.delete-row').prop('disabled', false);
                }
                
                // Calculate totals
                calculateTotals();
            });
            
            // Delete row
            $(document).on('click', '.delete-row', function() {
                if ($('#items-table tbody tr').length > 1) {
                    $(this).closest('tr').remove();
                    
                    // Disable delete buttons if only one row remains
                    if ($('#items-table tbody tr').length === 1) {
                        $('.delete-row').prop('disabled', true);
                    }
                    
                    calculateTotals();
                }
            });
            
            // Product selection change
            $(document).on('change', '.product-select', function() {
                const selectedOption = $(this).find('option:selected');
                const row = $(this).closest('tr');
                
                if ($(this).val() === 'new') {
                    // Reset modal form
                    $('#newProductForm')[0].reset();
                    
                    // Set company from purchase form if selected
                    const companyId = $('#company_id').val();
                    if (companyId) {
                        $('#new_company_id').val(companyId);
                    }
                    
                    // Store reference to the current row
                    window.currentProductRow = row;
                    
                    // Show modal
                    $('#addProductModal').modal('show');
                    
                    // Reset the select back to empty
                    $(this).val('').trigger('change');
                } else if ($(this).val()) {
                    const price = selectedOption.data('price');
                    row.find('.item-price').val(price);
                    calculateRowTotal(row);
                }
            });
            
            // Quantity or price change
            $(document).on('input', '.item-quantity, .item-price', function() {
                calculateRowTotal($(this).closest('tr'));
            });
            
            // Calculate row total
            function calculateRowTotal(row) {
                const quantity = parseFloat(row.find('.item-quantity').val()) || 0;
                const price = parseFloat(row.find('.item-price').val()) || 0;
                const total = quantity * price;
                
                row.find('.item-total').val(total.toFixed(2));
                calculateTotals();
            }
            
            // Calculate all totals
            function calculateTotals() {
                let grandTotal = 0;
                
                $('.item-total').each(function() {
                    grandTotal += parseFloat($(this).val()) || 0;
                });
                
                $('#grand-total').val(grandTotal.toFixed(2));
            }
            
            // Save new product
            $('#saveNewProduct').click(function() {
                const formData = $('#newProductForm').serialize();
                
                $.ajax({
                    url: '{{ route("purchases.createProduct") }}',
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        if (response.success) {
                            // Add new product to all dropdowns
                            const newOption = new Option(
                                `${response.product.name} - ${response.product.company.name}`, 
                                response.product.id, 
                                true, 
                                true
                            );
                            $(newOption).data('price', response.product.purchase_price);
                            
                            $('.product-select').each(function() {
                                // Add option before the "Add New" option
                                const addNewOption = $(this).find('option[value="new"]').detach();
                                $(this).append(newOption.cloneNode(true));
                                $(this).append(addNewOption);
                            });
                            
                            // Set values in the current row
                            if (window.currentProductRow) {
                                const row = window.currentProductRow;
                                row.find('.product-select').val(response.product.id).trigger('change');
                                row.find('.item-price').val(response.product.purchase_price);
                                calculateRowTotal(row);
                            }
                            
                            // Close modal and show success message
                            $('#addProductModal').modal('hide');
                            toastr.success('Product added successfully');
                        }
                    },
                    error: function(xhr) {
                        const errors = xhr.responseJSON;
                        let errorMessage = 'Error creating product';
                        
                        if (errors && errors.message) {
                            errorMessage = errors.message;
                        }
                        
                        toastr.error(errorMessage);
                    }
                });
            });
            
            // Form submission
            $('#purchaseForm').submit(function() {
                if ($('#items-table tbody tr').length === 0) {
                    toastr.error('Please add at least one product');
                    return false;
                }
                return true;
            });
            
            // Initialize row calculations
            $('#items-table tbody tr').each(function() {
                calculateRowTotal($(this));
            });
            
            // Calculate initial totals
            calculateTotals();
        });
    </script>
@stop

--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Purchases')

@section('content_header')
    <h1>Purchases</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Purchases</h3>
            <div class="card-tools">
                <a href="{{ route('purchases.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Purchase
                </a>
            </div>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif
            
            <table id="purchases-table" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Invoice No</th>
                        <th>Supplier</th>
                        <th>Total Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($purchases as $purchase)
                        <tr>
                            <td>{{ $purchase->id }}</td>
                            <td>{{ $purchase->purchase_date->format('Y-m-d') }}</td>
                            <td>{{ $purchase->invoice_no ?? 'N/A' }}</td>
                            <td>{{ $purchase->company->name }}</td>
                            <td>{{ number_format($purchase->total_amount, 2) }}</td>
                            <td>
                                <a href="{{ route('purchases.show', $purchase) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ route('purchases.edit', $purchase) }}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form action="{{ route('purchases.destroy', $purchase) }}" method="POST" style="display: inline-block;">
                                    @csrf
                                    @method('DELETE')
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this purchase? This will update product stock levels.')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#purchases-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });
    </script>
@stop

--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Purchase Details')

@section('content_header')
    <h1>Purchase Details</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Purchase #{{ $purchase->id }}</h3>
            <div class="card-tools">
                <a href="{{ route('purchases.edit', $purchase) }}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Edit
                </a>
                <a href="{{ route('purchases.index') }}" class="btn btn-default">
                    <i class="fas fa-list"></i> Back to List
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="card card-primary">
                        <div class="card-header">
                            <h3 class="card-title">Purchase Information</h3>
                        </div>
                        <div class="card-body">
                            <dl class="row">
                                <dt class="col-sm-4">Purchase Date</dt>
                                <dd class="col-sm-8">{{ $purchase->purchase_date->format('Y-m-d') }}</dd>
                                
                                <dt class="col-sm-4">Invoice No</dt>
                                <dd class="col-sm-8">{{ $purchase->invoice_no ?? 'N/A' }}</dd>
                                
                                <dt class="col-sm-4">Supplier</dt>
                                <dd class="col-sm-8">{{ $purchase->company->name }}</dd>
                                
                                <dt class="col-sm-4">Total Amount</dt>
                                <dd class="col-sm-8">{{ number_format($purchase->total_amount, 2) }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card card-info">
                        <div class="card-header">
                            <h3 class="card-title">Additional Information</h3>
                        </div>
                        <div class="card-body">
                            <dl class="row">
                                <dt class="col-sm-4">Supplier Contact</dt>
                                <dd class="col-sm-8">{{ $purchase->company->contact ?? 'N/A' }}</dd>
                                
                                <dt class="col-sm-4">Created At</dt>
                                <dd class="col-sm-8">{{ $purchase->created_at->format('Y-m-d H:i') }}</dd>
                                
                                <dt class="col-sm-4">Last Updated</dt>
                                <dd class="col-sm-8">{{ $purchase->updated_at->format('Y-m-d H:i') }}</dd>
                                
                                <dt class="col-sm-4">Notes</dt>
                                <dd class="col-sm-8">{{ $purchase->notes ?? 'N/A' }}</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card card-success mt-4">
                <div class="card-header">
                    <h3 class="card-title">Purchase Items</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Purchase Price</th>
                                    <th>Total Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($purchase->items as $index => $item)
                                    <tr>
                                        <td>{{ $index + 1 }}</td>
                                        <td>{{ $item->product->name }}</td>
                                        <td>{{ $item->product->category->name }}</td>
                                        <td>{{ $item->quantity }}</td>
                                        <td>{{ number_format($item->purchase_price, 2) }}</td>
                                        <td>{{ number_format($item->total_price, 2) }}</td>
                                    </tr>
                                @endforeach
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="5" class="text-right"><strong>Grand Total:</strong></td>
                                    <td><strong>{{ number_format($purchase->total_amount, 2) }}</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

--- Contents of consolidated.blade.php ---
@extends('adminlte::page')

@section('title', 'Consolidated Product Report')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-chart-line mr-2"></i> Consolidated Product Report</h1>
        <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="{{ route('dashboard') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ route('reports.products.index') }}">Reports</a></li>
            <li class="breadcrumb-item active">Consolidated Report</li>
        </ol>
    </div>
@stop

@section('content')
    <!-- Filter Card -->
    <div class="card card-primary card-outline">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-filter"></i> Filter Report</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ route('reports.products.consolidated') }}" id="report-filter-form">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="start_date">Start Date</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                </div>
                                <input type="date" class="form-control" id="start_date" name="start_date" 
                                    value="{{ $filters['start_date'] ?? '' }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="end_date">End Date</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                </div>
                                <input type="date" class="form-control" id="end_date" name="end_date" 
                                    value="{{ $filters['end_date'] ?? '' }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="product_id">Product</label>
                            <select class="form-control select2" id="product_id" name="product_id">
                                <option value="">All Products</option>
                                @foreach($products as $product)
                                    <option value="{{ $product->id }}" 
                                        {{ (isset($filters['product_id']) && $filters['product_id'] == $product->id) ? 'selected' : '' }}>
                                        {{ $product->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="category_id">Category</label>
                            <select class="form-control select2" id="category_id" name="category_id">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" 
                                        {{ (isset($filters['category_id']) && $filters['category_id'] == $category->id) ? 'selected' : '' }}>
                                        {{ $category->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="company_id">Company</label>
                            <select class="form-control select2" id="company_id" name="company_id">
                                <option value="">All Companies</option>
                                @foreach($companies as $company)
                                    <option value="{{ $company->id }}" 
                                        {{ (isset($filters['company_id']) && $filters['company_id'] == $company->id) ? 'selected' : '' }}>
                                        {{ $company->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-9 d-flex align-items-end">
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i> Generate Report
                            </button>
                            
                            <a href="{{ route('reports.products.consolidated') }}" class="btn btn-default">
                                <i class="fas fa-sync"></i> Reset Filters
                            </a>
                            
                            <button type="button" class="btn btn-success" id="export-excel">
                                <i class="fas fa-file-excel"></i> Export to Excel
                            </button>
                            
                            <button type="button" class="btn btn-info" id="print-report">
                                <i class="fas fa-print"></i> Print Report
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="row">
        <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>{{ number_format(collect($reportData)->sum('sales')) }}</h3>
                    <p>Total Units Sold</p>
                </div>
                <div class="icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <a href="{{ route('reports.products.sales') }}" class="small-box-footer">
                    View Sales Report <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>{{ number_format(collect($reportData)->sum('purchases')) }}</h3>
                    <p>Total Units Purchased</p>
                </div>
                <div class="icon">
                    <i class="fas fa-truck-loading"></i>
                </div>
                <a href="{{ route('reports.products.purchases') }}" class="small-box-footer">
                    View Purchase Report <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>{{ number_format(collect($reportData)->sum('returns')) }}</h3>
                    <p>Total Units Returned</p>
                </div>
                <div class="icon">
                    <i class="fas fa-undo"></i>
                </div>
                <a href="{{ route('reports.products.returns') }}" class="small-box-footer">
                    View Returns Report <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
        
        <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>{{ number_format(collect($reportData)->sum('other_deliveries')) }}</h3>
                    <p>Total Other Deliveries</p>
                </div>
                <div class="icon">
                    <i class="fas fa-truck"></i>
                </div>
                <a href="{{ route('reports.products.other-deliveries') }}" class="small-box-footer">
                    View Deliveries Report <i class="fas fa-arrow-circle-right"></i>
                </a>
            </div>
        </div>
    </div>

    
    <!-- Data Table Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-table mr-1"></i> 
                Complete Product Movement Data
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="product-report-table" class="table table-bordered table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Company</th>
                            <th>Sales <i class="fas fa-shopping-cart text-info"></i></th>
                            <th>Returns <i class="fas fa-undo text-warning"></i></th>
                            <th>Purchases <i class="fas fa-truck-loading text-success"></i></th>
                            <th>Other Deliveries <i class="fas fa-truck text-danger"></i></th>
                            <th>Net Change</th>
                            <th>Current Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($reportData as $item)
                        <tr>
                            <td>{{ $item['product']->name }}</td>
                            <td>{{ $item['product']->category->name ?? 'N/A' }}</td>
                            <td>{{ $item['product']->company->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item['sales']) }}</td>
                            <td>{{ number_format($item['returns']) }}</td>
                            <td>{{ number_format($item['purchases']) }}</td>
                            <td>{{ number_format($item['other_deliveries']) }}</td>
                            <td>
                                <span class="badge badge-{{ $item['net_change'] >= 0 ? 'success' : 'danger' }} p-2">
                                    {{ number_format($item['net_change']) }}
                                    <i class="fas fa-{{ $item['net_change'] >= 0 ? 'arrow-up' : 'arrow-down' }} ml-1"></i>
                                </span>
                            </td>
                            <td>
                                <span class="badge p-2 {{ $item['product']->current_stock > 10 ? 'badge-success' : ($item['product']->current_stock > 0 ? 'badge-warning' : 'badge-danger') }}">
                                    {{ number_format($item['product']->current_stock) }}
                                </span>
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-details" data-product-id="{{ $item['product']->id }}">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                    <tfoot>
                        <tr class="bg-light font-weight-bold">
                            <td colspan="3">TOTALS</td>
                            <td>{{ number_format(collect($reportData)->sum('sales')) }}</td>
                            <td>{{ number_format(collect($reportData)->sum('returns')) }}</td>
                            <td>{{ number_format(collect($reportData)->sum('purchases')) }}</td>
                            <td>{{ number_format(collect($reportData)->sum('other_deliveries')) }}</td>
                            <td>{{ number_format(collect($reportData)->sum('net_change')) }}</td>
                            <td>{{ number_format(collect($reportData)->sum(function($item) { return $item['product']->current_stock; })) }}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
        
    <!-- Chart Card -->
    <div class="card card-primary">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-chart-bar mr-1"></i>
                Product Movement Summary
            </h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="maximize">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="chart">
                <canvas id="productMovementChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <!-- Product Movement Details Modal -->
    <div class="modal fade" id="productDetailsModal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-info">
                    <h4 class="modal-title">Product Movement Details</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs" id="productDetailsTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="sales-tab" data-toggle="pill" href="#sales" role="tab">
                                    <i class="fas fa-shopping-cart mr-1"></i> Sales
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="returns-tab" data-toggle="pill" href="#returns" role="tab">
                                    <i class="fas fa-undo mr-1"></i> Returns
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="purchases-tab" data-toggle="pill" href="#purchases" role="tab">
                                    <i class="fas fa-truck-loading mr-1"></i> Purchases
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="deliveries-tab" data-toggle="pill" href="#deliveries" role="tab">
                                    <i class="fas fa-truck mr-1"></i> Other Deliveries
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content p-3" id="productDetailsTabContent">
                            <div class="tab-pane fade show active" id="sales" role="tabpanel">
                                <!-- Sales data will be loaded by AJAX -->
                                <div class="text-center p-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="returns" role="tabpanel">
                                <!-- Returns data will be loaded by AJAX -->
                            </div>
                            <div class="tab-pane fade" id="purchases" role="tabpanel">
                                <!-- Purchases data will be loaded by AJAX -->
                            </div>
                            <div class="tab-pane fade" id="deliveries" role="tabpanel">
                                <!-- Other Deliveries data will be loaded by AJAX -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-info" id="print-details">
                        <i class="fas fa-print"></i> Print Details
                    </button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize select2
            $('.select2').select2({
                theme: 'bootstrap4',
                placeholder: 'Select an option'
            });
            
            // Initialize DataTable
            $('#product-report-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
                "language": {
                    "emptyTable": "No product data available for the selected period"
                }
            });
            
            // Generate chart with the top 10 products by movement volume
            const labels = {!! json_encode(collect($reportData)->take(10)->map(function($item) { return $item['product']->name; })) !!};
            const sales = {!! json_encode(collect($reportData)->take(10)->pluck('sales')) !!};
            const returns = {!! json_encode(collect($reportData)->take(10)->pluck('returns')) !!};
            const purchases = {!! json_encode(collect($reportData)->take(10)->pluck('purchases')) !!};
            const deliveries = {!! json_encode(collect($reportData)->take(10)->pluck('other_deliveries')) !!};
            
            const ctx = document.getElementById('productMovementChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Sales',
                            data: sales,
                            backgroundColor: 'rgba(60, 141, 188, 0.7)',
                            borderColor: 'rgba(60, 141, 188, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Returns',
                            data: returns,
                            backgroundColor: 'rgba(255, 193, 7, 0.7)',
                            borderColor: 'rgba(255, 193, 7, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Purchases',
                            data: purchases,
                            backgroundColor: 'rgba(40, 167, 69, 0.7)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Other Deliveries',
                            data: deliveries,
                            backgroundColor: 'rgba(220, 53, 69, 0.7)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantity'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Products'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 10 Products by Movement Volume'
                        },
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            });
            
            // Export to Excel button handler
            $('#export-excel').click(function() {
                const url = new URL(window.location.href);
                url.searchParams.append('export', 'excel');
                window.location.href = url.toString();
            });
            
            // Print report handler
            $('#print-report').click(function() {
                window.print();
            });
            
            // View details button handler
            $('.view-details').click(function() {
                const productId = $(this).data('product-id');
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                
                $('#productDetailsModal').modal('show');
                
                // Load sales details
                loadTabData('sales', productId, startDate, endDate);
                
                // Setup tab click handlers to load data only when tab is clicked
                $('#productDetailsTabs a').on('click', function(e) {
                    const tab = $(this).attr('href').replace('#', '');
                    loadTabData(tab, productId, startDate, endDate);
                });
            });
            
            // Print details handler
            $('#print-details').click(function() {
                const activeTab = $('#productDetailsTabs a.active').attr('href').replace('#', '');
                const tabContent = $(activeTab).html();
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Product Details</title>
                        <link rel="stylesheet" href="{{ asset('vendor/adminlte/dist/css/adminlte.min.css') }}">
                        <style>
                            body { padding: 20px; }
                            @media print {
                                table { width: 100%; border-collapse: collapse; }
                                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                                th { background-color: #f2f2f2; }
                            }
                        </style>
                    </head>
                    <body onload="window.print()">
                        <h2>Product Movement Details</h2>
                        ${tabContent}
                    </body>
                    </html>
                `);
                printWindow.document.close();
            });
            
            function loadTabData(tab, productId, startDate, endDate) {
                const endpoints = {
                    sales: '{{ route('reports.products.sales') }}',
                    returns: '{{ route('reports.products.returns') }}',
                    purchases: '{{ route('reports.products.purchases') }}',
                    deliveries: '{{ route('reports.products.other-deliveries') }}'
                };
                
                if (!endpoints[tab]) return;
                
                // Show loading indicator
                $(`#${tab}`).html(`
                    <div class="text-center p-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                `);
                
                // Load data via AJAX
                $.ajax({
                    url: endpoints[tab],
                    type: 'GET',
                    data: {
                        product_id: productId,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        $(`#${tab}`).html(response);
                    },
                    error: function() {
                        $(`#${tab}`).html(`
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                Failed to load data. Please try again.
                            </div>
                        `);
                    }
                });
            }
        });
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Reports')

@section('content_header')
    <h1>Product Reports</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-md-4">
            <div class="info-box bg-info">
                <span class="info-box-icon"><i class="fas fa-shopping-cart"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Sales Report</span>
                    <span class="info-box-number">Track product sales over time</span>
                    <div class="progress">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                    <a href="{{ route('reports.products.sales') }}" class="small-box-footer">
                        View Report <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="info-box bg-success">
                <span class="info-box-icon"><i class="fas fa-truck-loading"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Purchase Report</span>
                    <span class="info-box-number">Product purchase history</span>
                    <div class="progress">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                    <a href="{{ route('reports.products.purchases') }}" class="small-box-footer">
                        View Report <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="info-box bg-warning">
                <span class="info-box-icon"><i class="fas fa-undo"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Returns Report</span>
                    <span class="info-box-number">Product return analysis</span>
                    <div class="progress">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                    <a href="{{ route('reports.products.returns') }}" class="small-box-footer">
                        View Report <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="info-box bg-danger">
                <span class="info-box-icon"><i class="fas fa-truck"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Other Deliveries</span>
                    <span class="info-box-number">Non-invoice deliveries</span>
                    <div class="progress">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                    <a href="{{ route('reports.products.other-deliveries') }}" class="small-box-footer">
                        View Report <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="info-box bg-primary">
                <span class="info-box-icon"><i class="fas fa-chart-line"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text">Consolidated Report</span>
                    <span class="info-box-number">Complete product movement analysis</span>
                    <div class="progress">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>
                    <a href="{{ route('reports.products.consolidated') }}" class="small-box-footer">
                        View Report <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
@stop


--- Contents of other-deliveries.blade.php ---
@extends('adminlte::page')

@section('title', 'Other Deliveries Report')

@section('content_header')
    <h1>Other Deliveries Report</h1>
@stop

@section('content')
    @include('reports.products.components.filters', [
        'action' => route('reports.products.other-deliveries'),
        'filters' => $filters,
        'products' => $products,
        'categories' => $categories,
        'companies' => $companies
    ])
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Other Deliveries Summary</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            
            
            <div class="table-responsive">
                <table id="deliveries-report-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Company</th>
                            <th>Quantity</th>
                            <th>Deliveries Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($deliveriesData as $item)
                        <tr>
                            <td>{{ $item['product']->name }}</td>
                            <td>{{ $item['product']->category->name ?? 'N/A' }}</td>
                            <td>{{ $item['product']->company->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item['quantity']) }}</td>
                            <td>{{ $item['deliveries'] }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-details" 
                                        data-product-id="{{ $item['product']->id }}">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <canvas id="deliveriesChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery Details Modal -->
    <div class="modal fade" id="deliveryDetailsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Delivery Details</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Delivery #</th>
                                    <th>Date</th>
                                    <th>Recipient</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="deliveryDetailsTable">
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4'
            });
            
            $('#deliveries-report-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Chart initialization
            const ctx = document.getElementById('deliveriesChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {!! json_encode($deliveriesData->pluck('product.name')->take(10)) !!},
                    datasets: [{
                        label: 'Quantity Delivered',
                        data: {!! json_encode($deliveriesData->pluck('quantity')->take(10)) !!},
                        backgroundColor: 'rgba(108, 117, 125, 0.5)',
                        borderColor: 'rgba(108, 117, 125, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Export to Excel button handler
            $('#export-excel').click(function() {
                const url = new URL(window.location.href);
                url.searchParams.append('export', 'excel');
                window.location.href = url.toString();
            });
            
            // View details button handler
            $('.view-details').click(function() {
                const productId = $(this).data('product-id');
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                
                $.ajax({
                    url: '/reports/products/other-deliveries/details',
                    type: 'GET',
                    data: {
                        product_id: productId,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        $('#deliveryDetailsTable').html(response);
                        $('#deliveryDetailsModal').modal('show');
                    }
                });
            });
        });
    </script>
@stop


--- Contents of purchases.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Purchases Report')

@section('content_header')
    <h1>Product Purchases Report</h1>
@stop

@section('content')
    @include('reports.products.components.filters', [
        'action' => route('reports.products.purchases'),
        'filters' => $filters,
        'products' => $products,
        'categories' => $categories,
        'companies' => $companies
    ])
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Purchases Summary</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            
            
            <div class="table-responsive">
                <table id="purchases-report-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Company</th>
                            <th>Quantity</th>
                            <th>Total Cost</th>
                            <th>Avg. Price</th>
                            <th>Purchases Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($purchasesData as $item)
                        <tr>
                            <td>{{ $item['product']->name }}</td>
                            <td>{{ $item['product']->category->name ?? 'N/A' }}</td>
                            <td>{{ $item['product']->company->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item['quantity']) }}</td>
                            <td>{{ number_format($item['amount'], 2) }}</td>
                            <td>{{ number_format($item['average_price'], 2) }}</td>
                            <td>{{ $item['purchases'] }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-details" 
                                        data-product-id="{{ $item['product']->id }}">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>

            <div class="row">
                <div class="col-md-12 mb-4">
                    <canvas id="purchasesChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Purchase Details Modal -->
    <div class="modal fade" id="purchaseDetailsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Purchase Details</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Purchase #</th>
                                    <th>Date</th>
                                    <th>Company</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="purchaseDetailsTable">
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4'
            });
            
            $('#purchases-report-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Chart initialization
            const ctx = document.getElementById('purchasesChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {!! json_encode($purchasesData->pluck('product.name')->take(10)) !!},
                    datasets: [{
                        label: 'Quantity Purchased',
                        data: {!! json_encode($purchasesData->pluck('quantity')->take(10)) !!},
                        backgroundColor: 'rgba(40, 167, 69, 0.5)',
                        borderColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Export to Excel button handler
            $('#export-excel').click(function() {
                const url = new URL(window.location.href);
                url.searchParams.append('export', 'excel');
                window.location.href = url.toString();
            });
            
            // View details button handler
            $('.view-details').click(function() {
                const productId = $(this).data('product-id');
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                
                $.ajax({
                    url: '/reports/products/purchases/details',
                    type: 'GET',
                    data: {
                        product_id: productId,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        $('#purchaseDetailsTable').html(response);
                        $('#purchaseDetailsModal').modal('show');
                    }
                });
            });
        });
    </script>
@stop


--- Contents of returns.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Returns Report')

@section('content_header')
    <h1>Product Returns Report</h1>
@stop

@section('content')
    @include('reports.products.components.filters', [
        'action' => route('reports.products.returns'),
        'filters' => $filters,
        'products' => $products,
        'categories' => $categories,
        'companies' => $companies
    ])
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Returns Summary</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            
            
            <div class="table-responsive">
                <table id="returns-report-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Company</th>
                            <th>Quantity</th>
                            <th>Total Amount</th>
                            <th>Returns Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($returnsData as $item)
                        <tr>
                            <td>{{ $item['product']->name }}</td>
                            <td>{{ $item['product']->category->name ?? 'N/A' }}</td>
                            <td>{{ $item['product']->company->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item['quantity']) }}</td>
                            <td>{{ number_format($item['amount'], 2) }}</td>
                            <td>{{ $item['returns'] }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-details" 
                                        data-product-id="{{ $item['product']->id }}">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <canvas id="returnsChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Return Details Modal -->
    <div class="modal fade" id="returnDetailsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Return Details</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Return #</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="returnDetailsTable">
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4'
            });
            
            $('#returns-report-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Chart initialization (replace with actual data)
            const ctx = document.getElementById('returnsChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {!! json_encode($returnsData->pluck('product.name')->take(10)) !!},
                    datasets: [{
                        label: 'Quantity Returned',
                        data: {!! json_encode($returnsData->pluck('quantity')->take(10)) !!},
                        backgroundColor: 'rgba(220, 53, 69, 0.5)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Export to Excel button handler
            $('#export-excel').click(function() {
                const url = new URL(window.location.href);
                url.searchParams.append('export', 'excel');
                window.location.href = url.toString();
            });
            
            // View details button handler
            $('.view-details').click(function() {
                const productId = $(this).data('product-id');
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                
                $.ajax({
                    url: '/reports/products/returns/details',
                    type: 'GET',
                    data: {
                        product_id: productId,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        $('#returnDetailsTable').html(response);
                        $('#returnDetailsModal').modal('show');
                    }
                });
            });
        });
    </script>
@stop


--- Contents of sales.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Sales Report')

@section('content_header')
    <h1>Product Sales Report</h1>
@stop

@section('content')
    @include('reports.products.components.filters', [
        'action' => route('reports.products.sales'),
        'filters' => $filters,
        'products' => $products,
        'categories' => $categories,
        'companies' => $companies
    ])
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Sales Summary</h3>
            <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            
            
            <div class="table-responsive">
                <table id="sales-report-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Company</th>
                            <th>Quantity</th>
                            <th>Total Sales</th>
                            <th>Invoices Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($salesData as $item)
                        <tr>
                            <td>{{ $item['product']->name }}</td>
                            <td>{{ $item['product']->category->name ?? 'N/A' }}</td>
                            <td>{{ $item['product']->company->name ?? 'N/A' }}</td>
                            <td>{{ number_format($item['quantity']) }}</td>
                            <td>{{ number_format($item['amount'], 2) }}</td>
                            <td>{{ $item['invoices'] }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info view-details" 
                                        data-product-id="{{ $item['product']->id }}">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>

            <div class="row">
                <div class="col-md-12 mb-4">
                    <canvas id="salesChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Sale Details Modal -->
    <div class="modal fade" id="saleDetailsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Sale Details</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="saleDetailsTable">
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4'
            });
            
            $('#sales-report-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
            
            // Sample chart data - replace with real data in production
            const ctx = document.getElementById('salesChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {!! json_encode($salesData->pluck('product.name')->take(10)) !!},
                    datasets: [{
                        label: 'Quantity Sold',
                        data: {!! json_encode($salesData->pluck('quantity')->take(10)) !!},
                        backgroundColor: 'rgba(60, 141, 188, 0.5)',
                        borderColor: 'rgba(60, 141, 188, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Export to Excel button handler
            $('#export-excel').click(function() {
                const url = new URL(window.location.href);
                url.searchParams.append('export', 'excel');
                window.location.href = url.toString();
            });
            
            // View details button handler (you'll need to implement the AJAX endpoint)
            $('.view-details').click(function() {
                const productId = $(this).data('product-id');
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                
                $.ajax({
                    url: '/reports/products/sales/details',
                    type: 'GET',
                    data: {
                        product_id: productId,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(response) {
                        $('#saleDetailsTable').html(response);
                        $('#saleDetailsModal').modal('show');
                    }
                });
            });
        });
    </script>
@stop


--- Contents of filters.blade.php ---
<div class="card">
    <div class="card-header">
        <h3 class="card-title"><i class="fas fa-filter"></i> Filter Report</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <form method="GET" action="{{ $action }}">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="start_date">Start Date</label>
                        <input type="date" class="form-control" id="start_date" name="start_date" 
                               value="{{ $filters['start_date'] ?? '' }}">
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="end_date">End Date</label>
                        <input type="date" class="form-control" id="end_date" name="end_date" 
                               value="{{ $filters['end_date'] ?? '' }}">
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="product_id">Product</label>
                        <select class="form-control" id="product_id" name="product_id">
                            <option value="">All Products</option>
                            @foreach($products as $product)
                                <option value="{{ $product->id }}" 
                                    {{ (isset($filters['product_id']) && $filters['product_id'] == $product->id) ? 'selected' : '' }}>
                                    {{ $product->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="category_id">Category</label>
                        <select class="form-control" id="category_id" name="category_id">
                            <option value="">All Categories</option>
                            @foreach($categories as $category)
                                <option value="{{ $category->id }}" 
                                    {{ (isset($filters['category_id']) && $filters['category_id'] == $category->id) ? 'selected' : '' }}>
                                    {{ $category->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="company_id">Company</label>
                        <select class="form-control" id="company_id" name="company_id">
                            <option value="">All Companies</option>
                            @foreach($companies as $company)
                                <option value="{{ $company->id }}" 
                                    {{ (isset($filters['company_id']) && $filters['company_id'] == $company->id) ? 'selected' : '' }}>
                                    {{ $company->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
                
                <div class="col-md-9 d-flex align-items-end">
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Generate Report
                        </button>
                        
                        <a href="{{ $action }}" class="btn btn-default ml-2">
                            <i class="fas fa-sync"></i> Reset Filters
                        </a>
                        
                        <button type="button" class="btn btn-success ml-2" id="export-excel">
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Product Return')

@section('content_header')
    <h1>Create New Product Return</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Return Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('returns.store') }}" method="POST" id="return-form">
                @csrf
                <div class="row">
                    <!-- Return Info Section -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Return Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="return_number">Return Number <span class="text-danger">*</span></label>
                                    <input type="text" name="return_number" id="return_number" class="form-control" value="{{ $return_number }}" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="return_date">Return Date <span class="text-danger">*</span></label>
                                    <input type="date" name="return_date" id="return_date" class="form-control" value="{{ $return_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Info Section -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Customer Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label for="customer_id">Customer <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <select name="customer_id" id="customer_id" class="form-control select2" required>
                                                    <option value="">Select Customer</option>
                                                    @foreach($customers as $customer)
                                                        <option value="{{ $customer->id }}" data-phone="{{ $customer->phone }}" data-address="{{ $customer->address }}">
                                                            {{ $customer->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                                <div class="input-group-append">
                                                    <a href="{{ route('customers.create') }}" class="btn btn-success" id="new-customer-btn">
                                                        <i class="fas fa-plus"></i> New
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Outstanding Balance</label>
                                            <input type="text" id="customer_balance" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Phone</label>
                                            <input type="text" id="customer_phone" class="form-control" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Address</label>
                                            <input type="text" id="customer_address" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                {{-- <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="invoice_id">Related Invoice (Optional)</label>
                                            <select name="invoice_id" id="invoice_id" class="form-control select2">
                                                <option value="">No Invoice (Direct Return)</option>
                                                <!-- Will be populated via AJAX -->
                                            </select>
                                        </div>
                                    </div>
                                </div> --}}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-sm btn-primary" id="add-product-row">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="product-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <th width="20%">Description</th>
                                        <th>Company</th>
                                        <th>Category</th>
                                        <th width="10%">Quantity</th>
                                        <th width="8%">Box</th>
                                        <th width="8%">Pieces</th>
                                        <th width="10%">Unit Price</th>
                                        <th width="10%">Total</th>
                                        <th width="5%">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="product-row">
                                        <td>
                                            <select name="product_id[]" class="form-control select2 product-select" required>
                                                <option value="">Select Product</option>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}"
                                                        data-price="{{ $product->sale_price }}"
                                                        data-stock="{{ $product->current_stock }}"
                                                        data-purchase="{{ $product->purchase_price }}">
                                                        {{ $product->name }} (Stock: {{ $product->current_stock }})
                                                    </option>
                                                @endforeach
                                            </select>
                                            <input type="hidden" name="invoice_item_id[]" class="invoice-item-id">
                                        </td>
                                        <td>
                                            <input type="text" name="description[]" class="form-control product-description" required>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-company" readonly>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-category" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="quantity[]" class="form-control product-quantity" step="0.01" min="0.01" required>
                                        </td>
                                        <td>
                                            <input type="number" name="boxes[]" class="form-control product-boxes" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="pieces[]" class="form-control product-pieces" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="unit_price[]" class="form-control product-price" step="0.01" min="0" required>
                                        </td>
                                        <td>
                                            <input type="number" name="item_total[]" class="form-control product-total" step="0.01" min="0" readonly required>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger remove-row"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Totals Section -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning">
                                <h3 class="card-title">Payment Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="payment_method">Payment Method <span class="text-danger">*</span></label>
                                    <select name="payment_method" id="payment_method" class="form-control" required>
                                        <option value="cash">Cash</option>
                                        <option value="bank">Bank Transfer</option>
                                        <option value="mobile_bank">Mobile Banking</option>
                                        <option value="cheque">Cheque</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="notes">Notes</label>
                                    <textarea name="notes" id="notes" class="form-control" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-danger">
                                <h3 class="card-title">Return Totals</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Subtotal:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="subtotal" id="subtotal" class="form-control" step="0.01" min="0" readonly required>
                                    </div>
                                </div>
                                {{-- <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Tax:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="tax" id="tax" class="form-control" step="0.01" min="0" value="0">
                                    </div>
                                </div> --}}
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Total:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="total" id="total" class="form-control" step="0.01" min="0" readonly required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save"></i> Save Return
                    </button>
                    <a href="{{ route('returns.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .select2-container .select2-selection--single {
            height: 38px;
            line-height: 38px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Select2
            initializeSelect2();

            // Add product row
            $('#add-product-row').click(function() {
                addProductRow();
            });

// Remove product row
$(document).on('click', '.remove-row', function() {
                if ($('.product-row').length > 1) {
                    $(this).closest('tr').remove();
                    calculateReturnTotal();
                } else {
                    alert('At least one product is required.');
                }
            });

            // Calculate totals when quantity or price changes
            $(document).on('input', '.product-quantity, .product-price', function() {
                calculateRowTotal($(this).closest('tr'));
                calculateReturnTotal();
            });

            // Calculate totals when tax changes
            $('#tax').on('input', function() {
                calculateReturnTotal();
            });

            // Product selection change
            $(document).on('change', '.product-select', function() {
                const row = $(this).closest('tr');
                const productId = $(this).val();
                
                if (productId) {
                    // Get product details via AJAX
                    $.ajax({
                        url: '/product-details/' + productId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(data) {
                            row.find('.product-description').val(data.name);
                            row.find('.product-company').val(data.company ? data.company.name : '');
                            row.find('.product-category').val(data.category ? data.category.name : '');
                            row.find('.product-price').val(data.sale_price);
                            
                            // Store category details for box/pieces calculation
                            row.data('box-pcs', data.category ? data.category.box_pcs : 0);
                            row.data('pieces-feet', data.category ? data.category.pieces_feet : 0);
                            
                            // Clear quantity to prevent accidental submissions
                            row.find('.product-quantity').val('');
                            row.find('.product-boxes').val('');
                            row.find('.product-pieces').val('');
                            row.find('.product-total').val('');
                            
                            // Focus on quantity field
                            row.find('.product-quantity').focus();
                        }
                    });
                } else {
                    // Clear fields if no product selected
                    row.find('.product-description').val('');
                    row.find('.product-company').val('');
                    row.find('.product-category').val('');
                    row.find('.product-price').val('');
                    row.find('.product-quantity').val('');
                    row.find('.product-boxes').val('');
                    row.find('.product-pieces').val('');
                    row.find('.product-total').val('');
                    row.data('box-pcs', 0);
                    row.data('pieces-feet', 0);
                }
            });

            // Calculate boxes and pieces when quantity changes
            $(document).on('input', '.product-quantity', function() {
                const row = $(this).closest('tr');
                calculateBoxesAndPieces(row);
            });

            // Customer selection change
            $('#customer_id').change(function() {
                const customerId = $(this).val();
                if (customerId) {
                    // Get customer details via AJAX
                    $.ajax({
                        url: '/customer-details/' + customerId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(data) {
                            $('#customer_phone').val(data.phone);
                            $('#customer_address').val(data.address);
                            $('#customer_balance').val(data.outstanding_balance);
                            
                            // Clear and reload invoices dropdown
                            $('#invoice_id').empty().append('<option value="">No Invoice (Direct Return)</option>');
                            
                            // Get customer invoices
                            $.ajax({
                                url: '/customer-invoices/' + customerId,
                                type: 'GET',
                                dataType: 'json',
                                success: function(invoices) {
                                    if (invoices.length > 0) {
                                        $.each(invoices, function(index, invoice) {
                                            $('#invoice_id').append(
                                                $('<option></option>')
                                                    .attr('value', invoice.id)
                                                    .text(invoice.invoice_number + ' (' + invoice.invoice_date + ')')
                                            );
                                        });
                                    }
                                }
                            });
                        }
                    });
                } else {
                    $('#customer_phone').val('');
                    $('#customer_address').val('');
                    $('#customer_balance').val('');
                    $('#invoice_id').empty().append('<option value="">No Invoice (Direct Return)</option>');
                }
            });

            // Invoice selection change - load invoice items
            $('#invoice_id').change(function() {
                const invoiceId = $(this).val();
                
                // Clear product table except for first row
                if ($('.product-row').length > 1) {
                    $('.product-row:not(:first)').remove();
                }
                
                // Clear first row
                const firstRow = $('.product-row:first');
                firstRow.find('select.product-select').val('').trigger('change');
                firstRow.find('input').val('');
                
                if (invoiceId) {
                    // Get invoice items via AJAX
                    $.ajax({
                        url: '/invoice-items/' + invoiceId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(items) {
                            if (items.length > 0) {
                                // Remove the blank first row if we have items
                                $('.product-row:first').remove();
                                
                                // Add each invoice item as a row
                                $.each(items, function(index, item) {
                                    const newRow = addProductRow(false);
                                    
                                    // Set the product and related fields
                                    newRow.find('.product-select').val(item.product_id).trigger('change');
                                    
                                    // We'll set these after the product details are loaded
                                    setTimeout(function() {
                                        newRow.find('.product-description').val(item.description);
                                        newRow.find('.product-quantity').val(item.quantity);
                                        newRow.find('.product-price').val(item.unit_price);
                                        newRow.find('.invoice-item-id').val(item.id);
                                        
                                        // Calculate totals
                                        calculateBoxesAndPieces(newRow);
                                        calculateRowTotal(newRow);
                                        calculateReturnTotal();
                                    }, 500);
                                });
                            }
                        }
                    });
                }
            });
        });

        // Initialize Select2 for new elements
        function initializeSelect2() {
            $('.select2').select2({
                width: '100%',
                dropdownParent: $('#return-form')
            });
        }

        // Add new product row
        function addProductRow(focusNewRow = true) {
            const newRow = $('.product-row:first').clone();
            
            // Clear values
            newRow.find('input').val('');
            newRow.find('select').val('').trigger('change');
            
            // Append to table
            $('#product-table tbody').append(newRow);
            
            // Reinitialize Select2 for the new row
            newRow.find('.select2').select2({
                width: '100%',
                dropdownParent: $('#return-form')
            });
            
            if (focusNewRow) {
                // Focus on the product select
                setTimeout(function() {
                    newRow.find('.select2-search__field').focus();
                }, 100);
            }
            
            return newRow;
        }

        // Calculate row total
        function calculateRowTotal(row) {
            const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
            const price = parseFloat(row.find('.product-price').val()) || 0;
            const total = quantity * price;
            
            row.find('.product-total').val(total.toFixed(2));
        }

        // Calculate boxes and pieces
        function calculateBoxesAndPieces(row) {
            const quantity = parseFloat(row.find('.product-quantity').val()) || 0;
            const boxPcs = parseFloat(row.data('box-pcs')) || 0;
            const piecesFeet = parseFloat(row.data('pieces-feet')) || 0;
            
            if (boxPcs > 0 && piecesFeet > 0) {
                // Calculate total pieces
                const totalPieces = Math.round(quantity / piecesFeet);
                
                // Calculate boxes (whole number)
                const boxes = Math.floor(totalPieces / boxPcs);
                
                // Calculate remaining pieces
                const pieces = totalPieces - (boxes * boxPcs);
                
                row.find('.product-boxes').val(boxes);
                row.find('.product-pieces').val(pieces);
            } else {
                row.find('.product-boxes').val('');
                row.find('.product-pieces').val('');
            }
        }

        // Calculate return totals
        function calculateReturnTotal() {
            let subtotal = 0;
            
            // Sum all row totals
            $('.product-total').each(function() {
                subtotal += parseFloat($(this).val()) || 0;
            });
            
            const tax = parseFloat($('#tax').val()) || 0;
            
            // Calculate final total
            const total = subtotal + tax;
            
            // Update fields
            $('#subtotal').val(subtotal.toFixed(2));
            $('#total').val(total.toFixed(2));
        }
    </script>
@stop

--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Product Return')

@section('content_header')
    <h1>Edit Product Return #{{ $return->return_number }}</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Return Details</h3>
        </div>
        <div class="card-body">
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif

            <form action="{{ route('returns.update', $return) }}" method="POST" id="return-form">
                @csrf
                @method('PUT')
                
                <!-- Rest of the form is similar to create view, 
                     but with pre-populated values from $return -->
                <div class="row">
                    <!-- Return Info Section -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <h3 class="card-title">Return Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="return_number">Return Number <span class="text-danger">*</span></label>
                                    <input type="text" name="return_number" id="return_number" class="form-control" value="{{ $return->return_number }}" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="return_date">Return Date <span class="text-danger">*</span></label>
                                    <input type="date" name="return_date" id="return_date" class="form-control" value="{{ $return->return_date->format('Y-m-d') }}" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Info Section -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Customer Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label for="customer_id">Customer <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <select name="customer_id" id="customer_id" class="form-control select2" required>
                                                    @foreach($customers as $customer)
                                                        <option value="{{ $customer->id }}" 
                                                            {{ $return->customer_id == $customer->id ? 'selected' : '' }}
                                                            data-phone="{{ $customer->phone }}" 
                                                            data-address="{{ $customer->address }}">
                                                            {{ $customer->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                                <div class="input-group-append">
                                                    <a href="{{ route('customers.create') }}" class="btn btn-success" id="new-customer-btn">
                                                        <i class="fas fa-plus"></i> New
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Outstanding Balance</label>
                                            <input type="text" id="customer_balance" class="form-control" readonly 
                                                value="{{ number_format($return->customer->outstanding_balance, 2) }}">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Rest of the customer section similar to create view -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="card mt-4">
                    <div class="card-header bg-success">
                        <h3 class="card-title">Products</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-sm btn-primary" id="add-product-row">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="product-table">
                                <thead>
                                    <tr>
                                        <th width="25%">Product</th>
                                        <th width="20%">Description</th>
                                        <th>Company</th>
                                        <th>Category</th>
                                        <th width="10%">Quantity</th>
                                        <th width="8%">Box</th>
                                        <th width="8%">Pieces</th>
                                        <th width="10%">Unit Price</th>
                                        <th width="10%">Total</th>
                                        <th width="5%">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($return->items as $item)
                                    <tr class="product-row">
                                        <td>
                                            <select name="product_id[]" class="form-control select2 product-select" required>
                                                @foreach($products as $product)
                                                    <option value="{{ $product->id }}"
                                                        {{ $item->product_id == $product->id ? 'selected' : '' }}
                                                        data-price="{{ $product->sale_price }}"
                                                        data-stock="{{ $product->current_stock }}"
                                                        data-purchase="{{ $product->purchase_price }}">
                                                        {{ $product->name }} (Stock: {{ $product->current_stock }})
                                                    </option>
                                                @endforeach
                                            </select>
                                            <input type="hidden" name="invoice_item_id[]" class="invoice-item-id" 
                                                value="{{ $item->invoice_item_id }}">
                                        </td>
                                        <td>
                                            <input type="text" name="description[]" class="form-control product-description" 
                                                value="{{ $item->description }}" required>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-company" 
                                                value="{{ $item->product->company->name ?? '' }}" readonly>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control product-category" 
                                                value="{{ $item->product->category->name ?? '' }}" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="quantity[]" class="form-control product-quantity" 
                                                step="0.01" min="0.01" value="{{ $item->quantity }}" required>
                                        </td>
                                        <td>
                                            <input type="number" name="boxes[]" class="form-control product-boxes" 
                                                value="{{ $item->boxes }}" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="pieces[]" class="form-control product-pieces" 
                                                value="{{ $item->pieces }}" readonly>
                                        </td>
                                        <td>
                                            <input type="number" name="unit_price[]" class="form-control product-price" 
                                                step="0.01" min="0" value="{{ $item->unit_price }}" required>
                                        </td>
                                        <td>
                                            <input type="number" name="item_total[]" class="form-control product-total" 
                                                step="0.01" min="0" value="{{ $item->total }}" readonly required>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger remove-row"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Totals and other sections similar to create view -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning">
                                <h3 class="card-title">Payment Information</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="payment_method">Payment Method <span class="text-danger">*</span></label>
                                    <select name="payment_method" id="payment_method" class="form-control" required>
                                        <option value="cash" {{ $return->payment_method == 'cash' ? 'selected' : '' }}>Cash</option>
                                        <option value="bank" {{ $return->payment_method == 'bank' ? 'selected' : '' }}>Bank Transfer</option>
                                        <option value="mobile_bank" {{ $return->payment_method == 'mobile_bank' ? 'selected' : '' }}>Mobile Banking</option>
                                        <option value="cheque" {{ $return->payment_method == 'cheque' ? 'selected' : '' }}>Cheque</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="notes">Notes</label>
                                    <textarea name="notes" id="notes" class="form-control" rows="3">{{ $return->notes }}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-danger">
                                <h3 class="card-title">Return Totals</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Subtotal:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="subtotal" id="subtotal" class="form-control" 
                                            step="0.01" min="0" value="{{ $return->subtotal }}" readonly required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Tax:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="tax" id="tax" class="form-control" 
                                            step="0.01" min="0" value="{{ $return->tax }}">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">Total:</label>
                                    <div class="col-sm-8">
                                        <input type="number" name="total" id="total" class="form-control" 
                                            step="0.01" min="0" value="{{ $return->total }}" readonly required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-4 text-center">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save"></i> Update Return
                    </button>
                    <a href="{{ route('returns.index') }}" class="btn btn-default btn-lg">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('js')
    <script>
        // Add the same JavaScript as in create view, 
        // but modify to handle pre-populated data
        $(document).ready(function() {
            // Initial calculations
            $('.product-row').each(function() {
                calculateRowTotal($(this));
            });
            calculateReturnTotal();

            // Rest of the JavaScript from create view
        });
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Product Returns')

@section('content_header')
    <h1>Product Returns</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Returns</h3>
            <div class="card-tools">
                <a href="{{ route('returns.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Return
                </a>
            </div>
        </div>
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif

            <div class="table-responsive">
                <table id="returns-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Return #</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($returns as $return)
                            <tr>
                                <td>{{ $return->return_number }}</td>
                                <td>{{ $return->customer->name }}</td>
                                <td>{{ $return->return_date->format('Y-m-d') }}</td>
                                <td>{{ number_format($return->total, 2) }}</td>
                                <td>{{ ucfirst($return->status) }}</td>
                                <td>
                                    <a href="{{ route('returns.show', $return) }}" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ route('returns.edit', $return) }}" class="btn btn-sm btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{{ route('returns.print', $return) }}" class="btn btn-sm btn-secondary" target="_blank">
                                        <i class="fas fa-print"></i>
                                    </a>
                                    <form action="{{ route('returns.destroy', $return) }}" method="POST" style="display: inline-block;">
                                        @csrf
                                        @method('DELETE')
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this return?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
@stop
@section('css')
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
@stop
@section('js')
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script>
    $(document).ready(function() {
        $('#returns-table').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
        });
    });
</script>
@stop

--- Contents of print.blade.php ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Invoice #{{ $return->return_number }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        
        .return-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        .return-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo-container {
            width: 80px;
            margin-right: 10px;
        }
        
        .logo-container img {
            width: 100%;
            height: auto;
        }
        
        .company-info {
            text-align: center;
            flex-grow: 1;
        }
        
        .company-info h1 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .bill-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .bill-to {
            width: 50%;
            text-align: left;
        }
        
        .bill-to h3 {
            margin: 0 0 3px 0;
            font-size: 12px;
        }
        
        .bill-to p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .return-title {
            width: 50%;
            text-align: right;
        }
        
        .return-title h2 {
            margin: 0;
            color: blue;
            font-size: 16px;
        }
        
        .return-title p {
            margin: 1px 0;
            font-size: 11px;
        }
        
        .return-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 5px;
        }
        
        .return-table th, .return-table td {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
            font-size: 11px;
        }
        
        .return-table th {
            background-color: #f2f2f2;
        }
        
        .words-total {
            text-align: left;
            font-style: italic;
            margin: 3px 0;
            font-size: 11px;
        }
        
        .words-total p {
            margin: 0;
        }
        
        .amount-totals {
            width: 40%;
            float: right;
            margin-top: 3px;
        }
        
        .amount-totals table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .amount-totals table th, .amount-totals table td {
            padding: 2px;
            text-align: right;
            border: none;
            font-size: 11px;
            line-height: 1.2;
        }
        
        .amount-totals table th {
            font-weight: normal;
            padding-right: 8px;
            white-space: nowrap;
        }
        
        .amount-totals table td {
            min-width: 80px;
        }
        
        .amount-totals table tr.total-row th,
        .amount-totals table tr.total-row td {
            font-weight: bold;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            padding-top: 3px;
            padding-bottom: 3px;
        }
        
        .disclaimer {
            clear: both;
            text-align: center;
            margin: 15px 0 10px 0;
            font-weight: bold;
            font-size: 11px;
        }
        
        .payment-info {
            font-size: 11px;
            margin: 15px 0;
        }
        
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-box {
            width: 45%;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 2px;
        }
        
        .signature-box p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        .footer-text {
            text-align: center;
            font-size: 10px;
            margin-top: 5px;
        }
        
        .paid-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 80px;
            color: rgba(255, 0, 0, 0.3);
            font-weight: bold;
            border: 10px solid rgba(255, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100;
            pointer-events: none;
        }
        
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="return-container">
        @if($return->total == 0)
        <div class="paid-stamp">PAID</div>
        @endif
        
        <div class="return-header">
            <div class="logo-container">
                <img src="{{ asset('logo/logo.png') }}" alt="RTS Logo">
            </div>
                <div class="company-info">
                    <h1>{{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</h1>
                    <p>Phone: {{ $businessSettings->phone ?? '01970-598 449 (Bikash),01795-833 166 (Bikash, Nagad)' }}</p>
                    <p>Email: {{ $businessSettings->email ?? 'rahmantilesbd@gmail.com' }}</p>
                    <p>{{ $businessSettings->address ?? 'Model Town, Sadar, Shariatpur' }} 
                    @if($businessSettings->bin_number) 
                        (BIN: {{ $businessSettings->bin_number }})
                    @else
                        (BIN: 004975254-0811)
                    @endif
                    </p>
                </div>
        </div>
        
        <div class="bill-section">
            <div class="bill-to">
                <h3>Customer Details</h3>
                <p><strong>{{ $return->customer->name }}</strong></p>
                <p>Address: {{ $return->customer->address }}</p>
                <p>Phone: {{ $return->customer->phone }}</p>
                @if(isset($return->customer->email) && $return->customer->email)
                <p>Email: {{ $return->customer->email }}</p>
                @endif
            </div>
            <div class="return-title">
                <h2>RETURN INVOICE</h2>
                <p>Date: {{ $return->return_date->format('Y-m-d') }}</p>
                <p>Return ID: #{{ $return->return_number }}</p>
                @if(isset($return->invoice_number) && $return->invoice_number)
                <p>Original Invoice: #{{ $return->invoice_number }}</p>
                @endif
            </div>
        </div>
        
        <table class="return-table">
            <thead>
                <tr>
                    <th>SL</th>
                    <th>Product</th>
                    <th>Description</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach($return->items as $index => $item)
                <tr>
                    <td>{{ $index + 1 }}</td>
                    <td>{{ $item->product->name }}</td>
                    <td>{{ $item->description }}
                        @if(isset($item->code) && $item->code)
                        <br><small>{{ $item->code }}</small>
                        @endif
                    </td>
                    <td>{{ number_format($item->quantity, 2) }}</td>
                    <td>{{ number_format($item->unit_price, 2) }}</td>
                    <td>{{ number_format($item->total, 2) }}</td>
                </tr>
                @endforeach
            </tbody>
        </table>
        
        <div class="amount-totals">
            <table>
                <tr>
                    <th>Sub Total:</th>
                    <td>{{ number_format($return->subtotal, 2) }}</td>
                </tr>
                @if(isset($return->tax) && $return->tax > 0)
                <tr>
                    <th>Tax:</th>
                    <td>{{ number_format($return->tax, 2) }}</td>
                </tr>
                @endif
                <tr class="total-row">
                    <th>Total Amount:</th>
                    <td>{{ number_format($return->total, 2) }}</td>
                </tr>
            </table>
        </div>
        
        <div style="clear: both;"></div>
        
        <div class="payment-info">
            <p><strong>Payment Method:</strong> {{ ucfirst(str_replace('_', ' ', $return->payment_method)) }}</p>
            @if(isset($return->notes) && $return->notes)
            <p><strong>Notes:</strong> {{ $return->notes }}</p>
            @endif
        </div>
        
        <div class="disclaimer">
            This document confirms the return of goods listed above.
        </div>
        
        <div class="signatures">
            <div class="signature-box">
                <p>Customer: {{ $return->customer->name }}</p>
                <p>Signature and Date</p>
            </div>
                <div class="signature-box">
                    <p>Issued By: {{ $businessSettings->business_name ?? 'RAHMAN TILES AND SANITARY' }}</p>
                    <p>Signature and Date</p>
                </div>
        </div>
        
        <div class="footer-text">
            Thanks for being with us.
        </div>
        
        <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 14px; border-radius: 4px;">
                Print Return Invoice
            </button>
            <button onclick="window.close()" style="padding: 8px 16px; background-color: #f44336; color: white; border: none; cursor: pointer; font-size: 14px; margin-left: 10px; border-radius: 4px;">
                Close
            </button>
        </div>
    </div>
    
    <script>
        window.onload = function() {
            // Uncomment to automatically print when the page loads
            // window.print();
        };
    </script>
</body>
</html>


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Return Details')

@section('content_header')
    <h1>Return #{{ $return->return_number }}</h1>
@stop

@section('content')
    <div class="row">
        <div class="col-12">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Return Information</h3>
                    <div class="card-tools">
                        <a href="{{ route('returns.edit', $return) }}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{{ route('returns.print', $return) }}" class="btn btn-secondary" target="_blank">
                            <i class="fas fa-print"></i> Print
                        </a>
                        <a href="{{ route('returns.index') }}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Return Details</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 30%">Return Number</th>
                                    <td>{{ $return->return_number }}</td>
                                </tr>
                                <tr>
                                    <th>Return Date</th>
                                    <td>{{ $return->return_date->format('Y-m-d') }}</td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>{{ ucfirst($return->status) }}</td>
                                </tr>
                                <tr>
                                    <th>Payment Method</th>
                                    <td>{{ ucfirst(str_replace('_', ' ', $return->payment_method)) }}</td>
                                </tr>
                                <tr>
                                    <th>Related Invoice</th>
                                    <td>
                                        @if($return->invoice_id)
                                            <a href="{{ route('invoices.show', $return->invoice_id) }}">
                                                {{ $return->invoice->invoice_number }}
                                            </a>
                                        @else
                                            No Related Invoice
                                        @endif
                                    </td>
                                </tr>
                                @if($return->notes)
                                <tr>
                                    <th>Notes</th>
                                    <td>{{ $return->notes }}</td>
                                </tr>
                                @endif
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5>Customer Information</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 30%">Name</th>
                                    <td>{{ $return->customer->name }}</td>
                                </tr>
                                <tr>
                                    <th>Phone</th>
                                    <td>{{ $return->customer->phone }}</td>
                                </tr>
                                <tr>
                                    <th>Address</th>
                                    <td>{{ $return->customer->address }}</td>
                                </tr>
                                <tr>
                                    <th>Current Balance</th>
                                    <td>{{ number_format($return->customer->outstanding_balance, 2) }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <h5 class="mt-4">Return Items</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Company</th>
                                    <th class="text-right">Quantity</th>
                                    <th class="text-right">Unit Price</th>
                                    <th class="text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($return->items as $item)
                                <tr>
                                    <td>{{ $item->product->name }}</td>
                                    <td>{{ $item->description }}</td>
                                    <td>{{ $item->product->category->name ?? 'N/A' }}</td>
                                    <td>{{ $item->product->company->name ?? 'N/A' }}</td>
                                    <td class="text-right">{{ number_format($item->quantity, 2) }}</td>
                                    <td class="text-right">{{ number_format($item->unit_price, 2) }}</td>
                                    <td class="text-right">{{ number_format($item->total, 2) }}</td>
                                </tr>
                                @endforeach
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="6" class="text-right">Subtotal:</th>
                                    <td class="text-right">{{ number_format($return->subtotal, 2) }}</td>
                                </tr>
                                @if($return->tax > 0)
                                <tr>
                                    <th colspan="6" class="text-right">Tax:</th>
                                    <td class="text-right">{{ number_format($return->tax, 2) }}</td>
                                </tr>
                                @endif
                                <tr>
                                    <th colspan="6" class="text-right">Total:</th>
                                    <td class="text-right">{{ number_format($return->total, 2) }}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
@stop

--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Role')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-shield text-primary"></i> Create New Role</h1>
        <a href="{{ route('roles.index') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Roles
        </a>
    </div>
@stop

@section('content')
<div class="card shadow-sm">
    <div class="card-body">
        @if (count($errors) > 0)
            <div class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5><i class="icon fas fa-ban"></i> Error!</h5>
                <ul class="list-unstyled mb-0">
                    @foreach ($errors->all() as $error)
                        <li><i class="fas fa-exclamation-circle mr-2"></i>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form method="POST" action="{{ route('roles.store') }}">
            @csrf
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="name" class="font-weight-bold">
                            <i class="fas fa-tag mr-1"></i> Role Name
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                            </div>
                            <input type="text" name="name" id="name" class="form-control" placeholder="Enter role name" value="{{ old('name') }}">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="font-weight-bold mb-0">
                                <i class="fas fa-key mr-1"></i> Assign Permissions
                            </label>
                            <button type="button" id="selectAllPermissions" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-check-square mr-1"></i> Select All Permissions
                            </button>
                        </div>
                        
                        <div class="accordion" id="permissionsAccordion">
                            @foreach($groupedPermissions as $group => $permissions)
                                <div class="card mb-2">
                                    <div class="card-header bg-light" id="heading{{ $group }}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link text-dark" type="button" data-toggle="collapse" data-target="#collapse{{ $group }}" aria-expanded="true" aria-controls="collapse{{ $group }}">
                                                    <i class="fas fa-layer-group mr-2"></i> {{ ucfirst($group) }}
                                                </button>
                                            </h5>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input group-selector" id="group_{{ $group }}" data-group="{{ $group }}">
                                                <label class="custom-control-label" for="group_{{ $group }}">Select All</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="collapse{{ $group }}" class="collapse" aria-labelledby="heading{{ $group }}" data-parent="#permissionsAccordion">
                                        <div class="card-body">
                                            <div class="row">
                                                @foreach($permissions as $value)
                                                    <div class="col-md-3 mb-2">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input permission-checkbox" data-group="{{ $group }}" id="permission_{{ $value->id }}" name="permission[]" value="{{ $value->id }}">
                                                            <label class="custom-control-label" for="permission_{{ $value->id }}">{{ str_replace($group.'-', '', $value->name) }}</label>
                                                        </div>
                                                    </div>
                                                @endforeach
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-5">
                    <i class="fas fa-save mr-2"></i> Create Role
                </button>
            </div>
        </form>
    </div>
</div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .form-control, .input-group-text {
        border-radius: 0.25rem;
    }
    .custom-checkbox .custom-control-label::before {
        border-radius: 0.25rem;
    }
    .btn-link {
        text-decoration: none;
    }
    .btn-link:hover {
        text-decoration: none;
    }
</style>
@stop

@section('js')
<script>
    $(document).ready(function() {
        // Handle "Select All Permissions" button
        $('#selectAllPermissions').click(function() {
            const allChecked = $('.permission-checkbox:checked').length === $('.permission-checkbox').length;
            
            // If all are checked, uncheck all. Otherwise, check all
            $('.permission-checkbox').prop('checked', !allChecked);
            
            // Update all group selectors
            updateAllGroupSelectors();
            
            // Update button text
            updateSelectAllButtonText();
        });
        
        // Handle "Select All" checkboxes for groups
        $('.group-selector').change(function() {
            const group = $(this).data('group');
            const isChecked = $(this).prop('checked');
            
            $(`input.permission-checkbox[data-group="${group}"]`).prop('checked', isChecked);
            
            // Update main button text
            updateSelectAllButtonText();
        });
        
        // Update group selector when individual permissions change
        $('.permission-checkbox').change(function() {
            const group = $(this).data('group');
            const totalInGroup = $(`input.permission-checkbox[data-group="${group}"]`).length;
            const checkedInGroup = $(`input.permission-checkbox[data-group="${group}"]:checked`).length;
            
            $(`#group_${group}`).prop('checked', totalInGroup === checkedInGroup);
            
            // Update main button text
            updateSelectAllButtonText();
        });
        
        // Function to update all group selectors
        function updateAllGroupSelectors() {
            $('.group-selector').each(function() {
                const group = $(this).data('group');
                const totalInGroup = $(`input.permission-checkbox[data-group="${group}"]`).length;
                const checkedInGroup = $(`input.permission-checkbox[data-group="${group}"]:checked`).length;
                
                $(this).prop('checked', totalInGroup === checkedInGroup && totalInGroup > 0);
            });
        }
        
        // Function to update the "Select All" button text
        function updateSelectAllButtonText() {
            const allChecked = $('.permission-checkbox:checked').length === $('.permission-checkbox').length;
            
            if (allChecked) {
                $('#selectAllPermissions').html('<i class="fas fa-times-circle mr-1"></i> Deselect All Permissions');
                $('#selectAllPermissions').removeClass('btn-outline-primary').addClass('btn-outline-danger');
            } else {
                $('#selectAllPermissions').html('<i class="fas fa-check-square mr-1"></i> Select All Permissions');
                $('#selectAllPermissions').removeClass('btn-outline-danger').addClass('btn-outline-primary');
            }
        }
        
        // Expand first accordion by default
        $('#permissionsAccordion .collapse:first').addClass('show');
        
        // Initialize button text
        updateSelectAllButtonText();
    });
</script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Role')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-edit text-info"></i> Edit Role</h1>
        <a href="{{ route('roles.index') }}" class="btn btn-outline-info">
            <i class="fas fa-arrow-left"></i> Back to Roles
        </a>
    </div>
@stop

@section('content')
<div class="card shadow-sm">
    <div class="card-header bg-light">
        <h3 class="card-title">
            <i class="fas fa-user-shield mr-2"></i> {{ $role->name }}
        </h3>
    </div>
    <div class="card-body">
        @if (count($errors) > 0)
            <div class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5><i class="icon fas fa-ban"></i> Error!</h5>
                <ul class="list-unstyled mb-0">
                    @foreach ($errors->all() as $error)
                        <li><i class="fas fa-exclamation-circle mr-2"></i>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form method="POST" action="{{ route('roles.update', $role->id) }}">
            @csrf
            @method('PATCH')
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="name" class="font-weight-bold">
                            <i class="fas fa-tag mr-1"></i> Role Name
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                            </div>
                            <input type="text" name="name" id="name" class="form-control" value="{{ $role->name }}">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="font-weight-bold mb-0">
                                <i class="fas fa-key mr-1"></i> Assign Permissions
                            </label>
                            <button type="button" id="selectAllPermissions" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-check-square mr-1"></i> Select All Permissions
                            </button>
                        </div>
                        
                        <div class="accordion" id="permissionsAccordion">
                            @foreach($groupedPermissions as $group => $permissions)
                                <div class="card mb-2">
                                    <div class="card-header bg-light" id="heading{{ $group }}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link text-dark" type="button" data-toggle="collapse" data-target="#collapse{{ $group }}" aria-expanded="true" aria-controls="collapse{{ $group }}">
                                                    <i class="fas fa-layer-group mr-2"></i> {{ ucfirst($group) }}
                                                </button>
                                            </h5>
                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input group-selector" id="group_{{ $group }}" data-group="{{ $group }}">
                                                <label class="custom-control-label" for="group_{{ $group }}">Select All</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="collapse{{ $group }}" class="collapse" aria-labelledby="heading{{ $group }}" data-parent="#permissionsAccordion">
                                        <div class="card-body">
                                            <div class="row">
                                                @foreach($permissions as $value)
                                                    <div class="col-md-3 mb-2">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input permission-checkbox" data-group="{{ $group }}" id="permission_{{ $value->id }}" name="permission[]" value="{{ $value->id }}" {{ in_array($value->id, $rolePermissions) ? 'checked' : '' }}>
                                                            <label class="custom-control-label" for="permission_{{ $value->id }}">{{ str_replace($group.'-', '', $value->name) }}</label>
                                                        </div>
                                                    </div>
                                                @endforeach
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-info px-5">
                    <i class="fas fa-save mr-2"></i> Update Role
                </button>
            </div>
        </form>
    </div>
</div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .form-control, .input-group-text {
        border-radius: 0.25rem;
    }
    .custom-checkbox .custom-control-label::before {
        border-radius: 0.25rem;
    }
    .btn-link {
        text-decoration: none;
    }
    .btn-link:hover {
        text-decoration: none;
    }
</style>
@stop

@section('js')
<script>
    $(document).ready(function() {
        // Handle "Select All Permissions" button
        $('#selectAllPermissions').click(function() {
            const allChecked = $('.permission-checkbox:checked').length === $('.permission-checkbox').length;
            
            // If all are checked, uncheck all. Otherwise, check all
            $('.permission-checkbox').prop('checked', !allChecked);
            
            // Update all group selectors
            updateAllGroupSelectors();
            
            // Update button text
            updateSelectAllButtonText();
        });
        
        // Handle "Select All" checkboxes for groups
        $('.group-selector').change(function() {
            const group = $(this).data('group');
            const isChecked = $(this).prop('checked');
            
            $(`input.permission-checkbox[data-group="${group}"]`).prop('checked', isChecked);
            
            // Update main button text
            updateSelectAllButtonText();
        });
        
        // Update group selector when individual permissions change
        $('.permission-checkbox').change(function() {
            const group = $(this).data('group');
            const totalInGroup = $(`input.permission-checkbox[data-group="${group}"]`).length;
            const checkedInGroup = $(`input.permission-checkbox[data-group="${group}"]:checked`).length;
            
            $(`#group_${group}`).prop('checked', totalInGroup === checkedInGroup);
            
            // Update main button text
            updateSelectAllButtonText();
        });
        
        // Function to update all group selectors
        function updateAllGroupSelectors() {
            $('.group-selector').each(function() {
                const group = $(this).data('group');
                const totalInGroup = $(`input.permission-checkbox[data-group="${group}"]`).length;
                const checkedInGroup = $(`input.permission-checkbox[data-group="${group}"]:checked`).length;
                
                $(this).prop('checked', totalInGroup === checkedInGroup && totalInGroup > 0);
            });
        }
        
        // Function to update the "Select All" button text
        function updateSelectAllButtonText() {
            const allChecked = $('.permission-checkbox:checked').length === $('.permission-checkbox').length;
            
            if (allChecked) {
                $('#selectAllPermissions').html('<i class="fas fa-times-circle mr-1"></i> Deselect All Permissions');
                $('#selectAllPermissions').removeClass('btn-outline-primary').addClass('btn-outline-danger');
            } else {
                $('#selectAllPermissions').html('<i class="fas fa-check-square mr-1"></i> Select All Permissions');
                $('#selectAllPermissions').removeClass('btn-outline-danger').addClass('btn-outline-primary');
            }
        }
        
        // Set initial state of group selectors
        updateAllGroupSelectors();
        
        // Initialize button text
        updateSelectAllButtonText();
        
        // Expand first accordion by default
        $('#permissionsAccordion .collapse:first').addClass('show');
    });
</script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Roles Management')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-tag text-primary"></i> Roles Management</h1>
        @can('role-create')
        <a href="{{ route('roles.create') }}" class="btn btn-primary">
            <i class="fas fa-plus-circle mr-1"></i> Create New Role
        </a>
        @endcan
    </div>
@stop

@section('content')
    @if ($message = Session::get('success'))
        <div class="alert alert-success alert-dismissible fade show">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <h5><i class="icon fas fa-check"></i> Success!</h5>
            <p>{{ $message }}</p>
        </div>
    @endif

    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th width="50">#</th>
                            <th>Name</th>
                            <th width="280">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($roles as $key => $role)
                        <tr>
                            <td>{{ ++$i }}</td>
                            <td>{{ $role->name }}</td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a href="{{ route('roles.show', $role->id) }}" class="btn btn-info btn-sm">
                                        <i class="fas fa-eye mr-1"></i> Show
                                    </a>
                                    @can('role-edit')
                                    <a href="{{ route('roles.edit', $role->id) }}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit mr-1"></i> Edit
                                    </a>
                                    @endcan
                                    @can('role-delete')
                                    <form action="{{ route('roles.destroy', $role->id) }}" method="POST" style="display:inline">
                                        @csrf
                                        @method('DELETE')
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this role?')">
                                            <i class="fas fa-trash mr-1"></i> Delete
                                        </button>
                                    </form>
                                    @endcan
                                </div>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
            
            <div class="d-flex justify-content-center mt-3">
                {!! $roles->render() !!}
            </div>
        </div>
    </div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .table {
        margin-bottom: 0;
    }
    .table th {
        border-top: none;
    }
</style>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Role Details')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-shield text-success"></i> Role Details</h1>
        <a href="{{ route('roles.index') }}" class="btn btn-outline-success">
            <i class="fas fa-arrow-left"></i> Back to Roles
        </a>
    </div>
@stop

@section('content')
<div class="row">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h3 class="card-title">
                    <i class="fas fa-tag mr-2"></i> {{ $role->name }}
                </h3>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h5 class="font-weight-bold mb-3">
                            <i class="fas fa-key mr-1"></i> Permissions:
                        </h5>
                        
                        @php
                            $groupedPermissions = [];
                            foreach($rolePermissions as $permission) {
                                $parts = explode('-', $permission->name);
                                $group = $parts[0];
                                
                                if (!isset($groupedPermissions[$group])) {
                                    $groupedPermissions[$group] = [];
                                }
                                
                                $groupedPermissions[$group][] = $permission;
                            }
                            ksort($groupedPermissions);
                        @endphp
                        
                        <div class="accordion" id="permissionsAccordion">
                            @foreach($groupedPermissions as $group => $permissions)
                                <div class="card mb-2">
                                    <div class="card-header bg-light" id="heading{{ $group }}">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link text-dark" type="button" data-toggle="collapse" data-target="#collapse{{ $group }}" aria-expanded="true" aria-controls="collapse{{ $group }}">
                                                <i class="fas fa-layer-group mr-2"></i> {{ ucfirst($group) }} ({{ count($permissions) }})
                                            </button>
                                        </h5>
                                    </div>

                                    <div id="collapse{{ $group }}" class="collapse" aria-labelledby="heading{{ $group }}" data-parent="#permissionsAccordion">
                                        <div class="card-body">
                                            <div class="d-flex flex-wrap">
                                                @foreach($permissions as $permission)
                                                    <span class="badge badge-success p-2 m-1">
                                                        <i class="fas fa-check-circle mr-1"></i> {{ str_replace($group.'-', '', $permission->name) }}
                                                    </span>
                                                @endforeach
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-white">
                <div class="d-flex justify-content-between">
                    @can('role-edit')
                    <a href="{{ route('roles.edit', $role->id) }}" class="btn btn-info">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </a>
                    @endcan
                    @can('role-delete')
                    <form action="{{ route('roles.destroy', $role->id) }}" method="POST">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this role?')">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </form>
                    @endcan
                </div>
            </div>
        </div>
    </div>
</div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .card-header {
        border-top-left-radius: 0.5rem;
        border-top-right-radius: 0.5rem;
    }
    .badge {
        font-size: 0.9rem;
    }
    .btn-link {
        text-decoration: none;
    }
    .btn-link:hover {
        text-decoration: none;
    }
</style>
@stop

@section('js')
<script>
    $(document).ready(function() {
        // Expand first accordion by default
        $('#permissionsAccordion .collapse:first').addClass('show');
    });
</script>
@stop


--- Contents of remaining_products.blade.php ---
@extends('adminlte::page')

@section('title', 'Remaining Products')

@section('content_header')
    <div class="d-flex justify-content-between">
        <h1>Remaining Products</h1>
        <div>
            <a href="{{ route('challans.create') }}" class="btn btn-primary">
                <i class="fas fa-truck"></i> Create New Challan
            </a>
        </div>
    </div>
@stop

@section('content')
    <!-- Filter Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Filter Options</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="customer_filter">Customer</label>
                        <select class="form-control select2" id="customer_filter">
                            <option value="">All Customers</option>
                            @foreach($customers as $customer)
                                <option value="{{ $customer->id }}">{{ $customer->name }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="button" id="filter_button" class="btn btn-primary form-control">
                            <i class="fas fa-filter"></i> Apply Filter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Challans Card -->
    <div class="card">
        <div class="card-header bg-warning">
            <h3 class="card-title">Pending Challans</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="pending-challans-table">
                    <thead>
                        <tr>
                            <th>Challan #</th>
                            <th>Customer</th>
                            <th>Invoice #</th>
                            <th>Date</th>
                            <th>Products</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Undelivered Invoice Items Card -->
    <div class="card">
        <div class="card-header bg-info">
            <h3 class="card-title">Undelivered Invoice Items</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped" id="undelivered-items-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Invoice #</th>
                            <th>Date</th>
                            <th>Product</th>
                            <th>Description</th>
                            <th>Ordered</th>
                            <th>Delivered</th>
                            <th>Remaining</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

    <!-- Status Update Confirmation Modal -->
    <div class="modal fade" id="confirmStatusModal" tabindex="-1" role="dialog" aria-labelledby="confirmStatusModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmStatusModalLabel">Confirm Status Update</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to mark this challan as delivered?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <a href="#" id="confirmStatusBtn" class="btn btn-success">Confirm</a>
                </div>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@x.x.x/dist/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <style>
        .table td, .table th {
            vertical-align: middle;
        }
        
        .btn-group .btn {
            margin-right: 2px;
        }
        
        .card-header {
            color: white;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script>
        $(function () {
            // Initialize Select2
            $('.select2').select2({
                theme: 'bootstrap4',
                width: '100%'
            });
            
            // Initialize DataTables for Pending Challans
            let pendingChallansTable = $('#pending-challans-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{{ route('sales.pending_challans.data') }}",
                    data: function(d) {
                        d.customer_id = $('#customer_filter').val();
                    }
                },
                columns: [
                    {data: 'challan_number', name: 'challan_number'},
                    {data: 'customer_name', name: 'customer_name'},
                    {data: 'invoice_number', name: 'invoice_number'},
                    {data: 'challan_date', name: 'challan_date'},
                    {data: 'products', name: 'products'},
                    {data: 'actions', name: 'actions', orderable: false, searchable: false}
                ],
                order: [[0, 'desc']]
            });
            
            // Initialize DataTables for Undelivered Items
            let undeliveredItemsTable = $('#undelivered-items-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{{ route('sales.undelivered_items.data') }}",
                    data: function(d) {
                        d.customer_id = $('#customer_filter').val();
                    }
                },
                columns: [
                    {data: 'customer_name', name: 'customer_name'},
                    {data: 'invoice_number', name: 'invoice_number'},
                    {data: 'invoice_date', name: 'invoice_date'},
                    {data: 'product_name', name: 'product_name'},
                    {data: 'description', name: 'description'},
                    {data: 'ordered_quantity', name: 'ordered_quantity'},
                    {data: 'delivered_quantity', name: 'delivered_quantity'},
                    {data: 'remaining_quantity', name: 'remaining_quantity'},
                    {data: 'actions', name: 'actions', orderable: false, searchable: false}
                ],
                order: [[0, 'asc']]
            });
            
            // Apply filters
            $('#filter_button').click(function() {
                pendingChallansTable.draw();
                undeliveredItemsTable.draw();
            });
            
            $(document).on('click', '.status-update', function(e) {
    e.preventDefault();
    let id = $(this).data('id');
    let status = $(this).data('status');
    
    // Store data in the modal for access when confirming
    $('#confirmStatusModal').data('challan-id', id);
    $('#confirmStatusModal').data('status', status);
});

// Handle the confirm button click with AJAX
$('#confirmStatusBtn').click(function(e) {
    e.preventDefault();
    
    let modal = $('#confirmStatusModal');
    let challanId = modal.data('challan-id');
    let status = modal.data('status');
    let button = $(this);
    
    // Disable button and show spinner
    button.prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Processing...');
    
    $.ajax({
        url: '/challans/' + challanId + '/update-status',
        type: 'POST',
        dataType: 'json',
        data: {
            status: status,
            _token: $('meta[name="csrf-token"]').attr('content')
        },
        success: function(response) {
            if (response.success) {
                // Hide modal
                modal.modal('hide');
                
                // Show success message
                toastr.success('Challan marked as delivered successfully');
                
                // Refresh both tables to reflect changes
                $('#pending-challans-table').DataTable().ajax.reload();
                $('#undelivered-items-table').DataTable().ajax.reload();
            } else {
                toastr.error(response.message || 'Failed to update status');
            }
        },
        error: function(xhr) {
            let errorMessage = 'Failed to update status';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            toastr.error(errorMessage);
        },
        complete: function() {
            // Reset button
            button.prop('disabled', false).html('Confirm');
        }
    });
});
        });
    </script>
@stop


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create Transaction')

@section('content_header')
    <h1><i class="fas fa-money-bill-wave mr-2"></i>Create New Transaction</h1>
@stop

@section('css')
    <style>
        .left-aligned-container {
            margin-left: 0;
            margin-right: auto;
            max-width: 100%;
        }
        .compact-card {
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-radius: 6px;
            border: none;
            margin-bottom: 15px;
        }
        .compact-card .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 6px 6px 0 0;
        }
        .compact-card .card-body {
            padding: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .required-label::after {
            content: " *";
            color: #dc3545;
        }
        .form-control {
            border-radius: 4px;
            border: 1px solid #ced4da;
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102,126,234,.25);
        }
        .customer-info-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .customer-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .customer-info-item:last-child {
            margin-bottom: 0;
        }
        .balance-positive {
            color: #28a745;
            font-weight: bold;
        }
        .balance-negative {
            color: #dc3545;
            font-weight: bold;
        }
        .discount-section {
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        .discount-type-selector {
            margin-bottom: 15px;
        }
        .discount-type-selector .btn {
            margin-right: 10px;
        }
        .payment-calculation {
            background: #e3f2fd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        .calculation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 4px 0;
        }
        .calculation-row.total {
            border-top: 2px solid #2196f3;
            font-weight: bold;
            color: #1976d2;
            padding-top: 8px;
        }
        .btn-compact {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 4px;
        }
        .select2-container .select2-selection--single {
            height: 36px;
            border-radius: 4px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 34px;
            padding-left: 8px;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
@stop

@section('content')
<div class="left-aligned-container">
    <div class="row">
        <!-- Customer Information Panel -->
        <div class="col-md-4">
            <div id="customer-info-panel" class="customer-info-card" style="display: none;">
                <h5><i class="fas fa-user mr-2"></i>Customer Information</h5>
                <div class="customer-info-item">
                    <span>Name:</span>
                    <span id="customer-name">-</span>
                </div>
                <div class="customer-info-item">
                    <span>Phone:</span>
                    <span id="customer-phone">-</span>
                </div>
                <div class="customer-info-item">
                    <span>Outstanding Balance:</span>
                    <span id="customer-balance">0.00</span>
                </div>
            </div>
        </div>

        <!-- Transaction Form -->
        <div class="col-md-8">
            <div class="compact-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-money-bill-wave mr-2"></i>Transaction Details</h5>
                </div>
                
                <form action="{{ route('transactions.store') }}" method="POST" id="transaction-form">
                    @csrf
                    <div class="card-body">
                        @if ($errors->any())
                            <div class="alert alert-danger alert-sm">
                                <ul class="mb-0">
                                    @foreach ($errors->all() as $error)
                                        <li>{{ $error }}</li>
                                    @endforeach
                                </ul>
                            </div>
                        @endif
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="customer_id" class="required-label">Customer</label>
                                    <select name="customer_id" id="customer_id" class="form-control select2 @error('customer_id') is-invalid @enderror" 
                                            required tabindex="1" autofocus>
                                        <option value="">Search and select a customer...</option>
                                        @foreach ($customers as $customer)
                                            <option value="{{ $customer->id }}" 
                                                data-name="{{ $customer->name }}" 
                                                data-phone="{{ $customer->phone }}" 
                                                data-balance="{{ $customer->outstanding_balance }}"
                                                {{ (old('customer_id', $selectedCustomer?->id) == $customer->id) ? 'selected' : '' }}>
                                                {{ $customer->name }} - {{ $customer->phone }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @error('customer_id')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="type" class="required-label">Type</label>
                                    <select name="type" id="type" class="form-control @error('type') is-invalid @enderror" 
                                            required tabindex="2">
                                        <option value="">Select Type</option>
                                        <option value="debit" @selected(old('type', 'debit') == 'debit')>Payment (Debit)</option>
                                        <option value="credit" @selected(old('type') == 'credit')>Charge (Credit)</option>
                                    </select>
                                    @error('type')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="amount" class="required-label">Amount</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"></span>
                                        </div>
                                        <input type="number" step="0.01" name="amount" id="amount" 
                                               class="form-control @error('amount') is-invalid @enderror" 
                                               value="{{ old('amount') }}" required tabindex="3">
                                    </div>
                                    @error('amount')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                            <input type="text" name="discount_reason" id="discount_reason" 
       class="form-control" placeholder="e.g., Early payment, Loyalty discount" tabindex="11">

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="method" class="required-label">Payment Method</label>
                                    <select name="method" id="method" class="form-control @error('method') is-invalid @enderror" 
                                            required tabindex="4">
                                        <option value="">Select Method</option>
                                        @foreach ($paymentMethods as $method)
                                            <option value="{{ $method }}" @selected(old('method', 'cash') == $method)>
                                                {{ ucfirst(str_replace('_', ' ', $method)) }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @error('method')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="purpose" class="required-label">Purpose</label>
                                    <input type="text" name="purpose" id="purpose" 
                                           class="form-control @error('purpose') is-invalid @enderror" 
                                           value="{{ old('purpose') }}" required placeholder="e.g., Monthly payment" tabindex="5">
                                    @error('purpose')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="invoice_id">Invoice (Optional)</label>
                                    <select name="invoice_id" id="invoice_id" 
                                            class="form-control select2 @error('invoice_id') is-invalid @enderror" tabindex="6">
                                        <option value="">Select Invoice</option>
                                    </select>
                                    @error('invoice_id')
                                        <span class="invalid-feedback">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="reference">Reference</label>
                            <input type="text" name="reference" id="reference" 
                                   class="form-control @error('reference') is-invalid @enderror" 
                                   value="{{ old('reference') }}" placeholder="Check number, bank reference, etc." tabindex="7">
                            @error('reference')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>

                        <!-- Enhanced Discount Section -->
                        <div id="discount-section" class="discount-section" style="display: none;">
                            <h6><i class="fas fa-percentage mr-2"></i>Apply Discount</h6>
                            <p class="text-muted mb-3">Remaining balance after payment: <span id="remaining-balance">0.00</span></p>
                            
                            <!-- Discount Type Selector -->
                            <div class="discount-type-selector">
                                <label class="form-label">Discount Type:</label><br>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="discount_type" id="discount_amount_type" value="amount" checked>
                                    <label class="btn btn-outline-primary btn-sm" for="discount_amount_type">Fixed Amount</label>
                                    
                                    <input type="radio" class="btn-check" name="discount_type" id="discount_percentage_type" value="percentage">
                                    <label class="btn btn-outline-primary btn-sm" for="discount_percentage_type">Percentage</label>
                                </div>
                            </div>
                            
                            <!-- Amount Discount -->
                            <div id="amount-discount-group" class="form-group">
                                <label for="discount_amount">Discount Amount</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"></span>
                                    </div>
                                    <input type="number" step="0.01" name="discount_amount" id="discount_amount" 
                                           class="form-control" value="0" min="0" tabindex="8">
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-outline-primary" id="apply-full-discount" tabindex="9">
                                            Apply Full
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Percentage Discount -->
                            <div id="percentage-discount-group" class="form-group" style="display: none;">
                                <label for="discount_percentage">Discount Percentage</label>
                                <div class="input-group">
                                    <input type="number" step="0.01" name="discount_percentage" id="discount_percentage" 
                                           class="form-control" value="0" min="0" max="100" tabindex="10">
                                    <div class="input-group-append">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                <small class="text-muted">Calculated amount: <span id="calculated-discount">0.00</span></small>
                            </div>
                            
                            <!-- Discount Reason -->
                            <div class="form-group">
                                <label for="discount_reason">Discount Reason</label>
                                <input type="text" name="discount_reason" id="discount_reason" 
                                       class="form-control" placeholder="e.g., Early payment, Loyalty discount" tabindex="11">
                            </div>
                        </div>

                        <!-- Payment Calculation -->
                        <div id="payment-calculation" class="payment-calculation" style="display: none;">
                            <h6><i class="fas fa-calculator mr-2"></i>Payment Summary</h6>
                            <div class="calculation-row">
                                <span>Outstanding Balance:</span>
                                <span id="calc-balance">0.00</span>
                            </div>
                            <div class="calculation-row">
                                <span>Payment Amount:</span>
                                <span id="calc-payment">0.00</span>
                            </div>
                            <div class="calculation-row">
                                <span>Discount Applied:</span>
                                <span id="calc-discount">0.00</span>
                            </div>
                            <div class="calculation-row total">
                                <span>Remaining Balance:</span>
                                <span id="calc-remaining">0.00</span>
                            </div>
                        </div>
                        
                        <div class="form-group mt-3 mb-0">
                            <label for="notes">Notes</label>
                            <textarea name="notes" id="notes" rows="2" 
                                      class="form-control @error('notes') is-invalid @enderror" 
                                      placeholder="Additional notes" tabindex="12">{{ old('notes') }}</textarea>
                            @error('notes')
                                <span class="invalid-feedback">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                    
                    <div class="card-footer text-right">
                        <a href="{{ route('transactions.index') }}" class="btn btn-secondary btn-compact mr-2" tabindex="14">
                            <i class="fas fa-times mr-1"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary btn-compact" tabindex="13">
                            <i class="fas fa-save mr-1"></i> Save Transaction
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(function() {
            let selectedCustomer = null;
            
            // Initialize Select2 with search enabled for customer
            $('#customer_id').select2({
                width: '100%',
                placeholder: 'Search and select a customer...',
                allowClear: true,
                matcher: function(params, data) {
                    // If there are no search terms, return all data
                    if ($.trim(params.term) === '') {
                        return data;
                    }
                    
                    // Skip if no text property
                    if (typeof data.text === 'undefined') {
                        return null;
                    }
                    
                    // Check if the text contains the search term (case insensitive)
                    if (data.text.toLowerCase().indexOf(params.term.toLowerCase()) > -1) {
                        return data;
                    }
                    
                    return null;
                }
            });
            
            $('#invoice_id').select2({
                width: '100%',
                placeholder: 'Select Invoice',
                minimumResultsForSearch: -1
            });
            
            // Auto-focus on customer select after page load
            setTimeout(function() {
                $('#customer_id').select2('open');
            }, 100);
            
            // Customer selection handler
            $('#customer_id').on('change', function() {
                const selectedOption = $(this).find('option:selected');
                if (selectedOption.val()) {
                    selectedCustomer = {
                        id: selectedOption.val(),
                        name: selectedOption.data('name'),
                        phone: selectedOption.data('phone'),
                        balance: parseFloat(selectedOption.data('balance')) || 0
                    };
                    
                    updateCustomerInfo();
                    loadCustomerInvoices(selectedOption.val());
                    calculatePayment();
                } else {
                    selectedCustomer = null;
                    updateCustomerInfo();
                    $('#invoice_id').html('<option value="">Select Invoice</option>');
                    $('#discount-section, #payment-calculation').hide();
                }
            });
            
            // Discount type toggle
            $('input[name="discount_type"]').on('change', function() {
                if ($(this).val() === 'amount') {
                    $('#amount-discount-group').show();
                    $('#percentage-discount-group').hide();
                    $('#discount_percentage').val(0);
                } else {
                    $('#amount-discount-group').hide();
                    $('#percentage-discount-group').show();
                    $('#discount_amount').val(0);
                }
                calculatePayment();
            });
            
            // Update customer information panel
            function updateCustomerInfo() {
                if (selectedCustomer) {
                    $('#customer-name').text(selectedCustomer.name);
                    $('#customer-phone').text(selectedCustomer.phone);
                    $('#customer-balance').text('' + formatCurrency(selectedCustomer.balance))
                        .removeClass('balance-positive balance-negative')
                        .addClass(selectedCustomer.balance >= 0 ? 'balance-positive' : 'balance-negative');
                    $('#customer-info-panel').show();
                } else {
                    $('#customer-info-panel').hide();
                }
            }
            
            // Load customer invoices
            function loadCustomerInvoices(customerId) {
                $('#invoice_id').html('<option value="">Loading invoices...</option>').prop('disabled', true);
                
                $.ajax({
                    url: `/customers/${customerId}/invoices`,
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        let options = '<option value="">Select Invoice</option>';
                        
                        if (data.length > 0) {
                            data.forEach(function(invoice) {
                                options += `<option value="${invoice.id}" data-amount="${invoice.due_amount}">
                                    #${invoice.invoice_number} - Due: ${formatCurrency(invoice.due_amount)}
                                </option>`;
                            });
                        } else {
                            options = '<option value="">No outstanding invoices found</option>';
                        }
                        
                        $('#invoice_id').html(options).prop('disabled', false);
                    },
                    error: function(xhr) {
                        console.error('Error loading invoices:', xhr);
                        $('#invoice_id').html('<option value="">Error loading invoices</option>').prop('disabled', false);
                    }
                });
            }
            
            // Invoice selection handler
            $('#invoice_id').on('change', function() {
                const selectedOption = $(this).find('option:selected');
                const dueAmount = selectedOption.data('amount');
                
                if (dueAmount) {
                    $('#amount').val(dueAmount);
                    $('#purpose').val('Payment for Invoice #' + selectedOption.text().split('#')[1].split(' -')[0].trim());
                }
                calculatePayment();
            });
            
            // Amount and discount calculation
            $('#amount, #discount_amount, #discount_percentage, #type').on('input change', function() {
                calculatePayment();
            });
            
            // Calculate payment and show discount options
            function calculatePayment() {
                if (!selectedCustomer || $('#type').val() !== 'debit') {
                    $('#discount-section, #payment-calculation').hide();
                    return;
                }
                
                const balance = selectedCustomer.balance;
                const payment = parseFloat($('#amount').val()) || 0;
                let discount = 0;
                
                // Calculate discount based on type
                if ($('input[name="discount_type"]:checked').val() === 'amount') {
                    discount = parseFloat($('#discount_amount').val()) || 0;
                } else {
                    const percentage = parseFloat($('#discount_percentage').val()) || 0;
                    discount = (balance * percentage) / 100;
                    $('#calculated-discount').text(formatCurrency(discount));
                }
                
                const remaining = balance - payment - discount;
                
                // Update calculation display
                $('#calc-balance').text('' + formatCurrency(balance));
                $('#calc-payment').text('' + formatCurrency(payment));
                $('#calc-discount').text('' + formatCurrency(discount));
                $('#calc-remaining').text('' + formatCurrency(remaining));
                
                // Show discount section if there's a remaining balance or payment is made
                if (payment > 0) {
                    $('#remaining-balance').text('' + formatCurrency(Math.max(0, remaining)));
                    $('#discount-section').show();
                } else {
                    $('#discount-section').hide();
                }
                
                $('#payment-calculation').show();
            }
            
            // Apply full discount button
            $('#apply-full-discount').on('click', function() {
                if (selectedCustomer) {
                    const balance = selectedCustomer.balance;
                    const payment = parseFloat($('#amount').val()) || 0;
                    const remaining = balance - payment;
                    
                    if (remaining > 0) {
                        $('#discount_amount').val(remaining.toFixed(2));
                        $('input[name="discount_type"][value="amount"]').prop('checked', true).trigger('change');
                        calculatePayment();
                    }
                }
            });
            
            // Format currency helper
            function formatCurrency(amount) {
                return parseFloat(amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            }
            
            // Initialize if customer is pre-selected
            @if($selectedCustomer)
                $('#customer_id').val({{ $selectedCustomer->id }}).trigger('change');
            @endif
            
            // Keyboard navigation enhancements
            $(document).on('keydown', function(e) {
                // Alt + C to focus customer field
                if (e.altKey && e.keyCode === 67) {
                    e.preventDefault();
                    $('#customer_id').select2('open');
                }
                
                // Alt + A to focus amount field
                if (e.altKey && e.keyCode === 65) {
                    e.preventDefault();
                    $('#amount').focus();
                }
                
                // Alt + S to submit form
                if (e.altKey && e.keyCode === 83) {
                    e.preventDefault();
                    $('#transaction-form').submit();
                }
            });
        });
    </script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit Transaction')

@section('content_header')
    <h1>Edit Transaction</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Edit Transaction #{{ $transaction->id }}</h3>
        </div>
        <div class="card-body">
            @if($errors->any())
                <div class="alert alert-danger">
                    <ul>
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            <form action="{{ route('transactions.update', $transaction) }}" method="POST">
                @csrf
                @method('PUT')
                
                <div class="form-group">
                    <label for="customer_id">Customer</label>
                    <select name="customer_id" id="customer_id" class="form-control select2" required>
                        <option value="">Select Customer</option>
                        @foreach($customers as $customer)
                            <option value="{{ $customer->id }}" 
                                    data-balance="{{ $customer->outstanding_balance }}"
                                    data-original-balance="{{ $customer->outstanding_balance + ($transaction->type == 'debit' ? $transaction->amount : -$transaction->amount) }}"
                                    {{ $transaction->customer_id == $customer->id ? 'selected' : '' }}>
                                {{ $customer->name }} (Balance: {{ number_format($customer->outstanding_balance, 2) }})
                            </option>
                        @endforeach
                    </select>
                </div>

                <div class="form-group">
                    <label for="type">Transaction Type</label>
                    <select name="type" id="type" class="form-control" required>
                        <option value="debit" {{ $transaction->type == 'debit' ? 'selected' : '' }}>Debit (Customer pays)</option>
                        <option value="credit" {{ $transaction->type == 'credit' ? 'selected' : '' }}>Credit (Customer receives)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="purpose">Purpose</label>
                    <input type="text" name="purpose" id="purpose" class="form-control" value="{{ $transaction->purpose }}" required>
                </div>

                <div class="form-group">
                    <label for="method">Payment Method</label>
                    <select name="method" id="method" class="form-control" required>
                        <option value="cash" {{ $transaction->method == 'cash' ? 'selected' : '' }}>Cash</option>
                        <option value="bank" {{ $transaction->method == 'bank' ? 'selected' : '' }}>Bank Transfer</option>
                        <option value="mobile_bank" {{ $transaction->method == 'mobile_bank' ? 'selected' : '' }}>Mobile Banking</option>
                        <option value="cheque" {{ $transaction->method == 'cheque' ? 'selected' : '' }}>Cheque</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" name="amount" id="amount" class="form-control" step="0.01" min="0" value="{{ $transaction->amount }}" required>
                </div>

                <div class="form-group">
                    <label for="reference">Reference (Optional)</label>
                    <input type="text" name="reference" id="reference" class="form-control" value="{{ $transaction->reference }}">
                </div>

                <div class="form-group">
                    <label for="note">Note (Optional)</label>
                    <textarea name="note" id="note" class="form-control" rows="3">{{ $transaction->note }}</textarea>
                </div>

                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Balance Preview</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <p>Original Balance: <span id="original-balance">0.00</span></p>
                            </div>
                            <div class="col-md-3">
                                <p>Current Balance: <span id="current-balance">0.00</span></p>
                            </div>
                            <div class="col-md-3">
                                <p>New Transaction: <span id="transaction-amount">0.00</span></p>
                            </div>
                            <div class="col-md-3">
                                <p>New Balance: <span id="new-balance">0.00</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update Transaction</button>
                    <a href="{{ route('transactions.index') }}" class="btn btn-default">Cancel</a>
                </div>
            </form>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4',
            });

            function updateBalancePreview() {
                let originalBalance = parseFloat($('#customer_id option:selected').data('original-balance') || 0);
                let currentBalance = parseFloat($('#customer_id option:selected').data('balance') || 0);
                let amount = parseFloat($('#amount').val() || 0);
                let type = $('#type').val();
                
                $('#original-balance').text(originalBalance.toFixed(2));
                $('#current-balance').text(currentBalance.toFixed(2));
                $('#transaction-amount').text(amount.toFixed(2));
                
                let newBalance;
                if (type === 'debit') {
                    newBalance = originalBalance - amount;
                } else {
                    newBalance = originalBalance + amount;
                }
                
                $('#new-balance').text(newBalance.toFixed(2));
            }
            
            $('#customer_id, #amount, #type').on('change input', updateBalancePreview);
            
            // Initialize
            updateBalancePreview();
        });
    </script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Transactions')

@section('content_header')
    <h1>Transactions</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">All Transactions</h3>
            <div class="card-tools">
                <a href="{{ route('transactions.create') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Transaction
                </a>
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                </button>
            </div>
        </div>
        
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('success') }}
                </div>
            @endif
            
            @if(session('error'))
                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                    {{ session('error') }}
                </div>
            @endif
            
            <!-- Filter Section -->
            <div class="filter-section mb-4">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-outline card-primary collapsed-card">
                            <div class="card-header">
                                <h3 class="card-title">Filter Transactions</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body" style="display: none;">
                                <form id="filter-form">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="date_from">From Date:</label>
                                                <input type="date" class="form-control form-control-sm" id="date_from" name="date_from">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="date_to">To Date:</label>
                                                <input type="date" class="form-control form-control-sm" id="date_to" name="date_to">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="customer_id">Customer:</label>
                                                <select class="form-control form-control-sm" id="customer_id" name="customer_id">
                                                    <option value="">All Customers</option>
                                                    @foreach($customers as $customer)
                                                        <option value="{{ $customer->id }}">{{ $customer->name }}</option>
                                                    @endforeach
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="type">Transaction Type:</label>
                                                <select class="form-control form-control-sm" id="type" name="type">
                                                    <option value="">All Types</option>
                                                    <option value="debit">Debit</option>
                                                    <option value="credit">Credit</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="method">Payment Method:</label>
                                                <select class="form-control form-control-sm" id="method" name="method">
                                                    <option value="">All Methods</option>
                                                    <option value="cash">Cash</option>
                                                    <option value="bank">Bank</option>
                                                    <option value="mobile_bank">Mobile Bank</option>
                                                    <option value="cheque">Cheque</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="purpose">Purpose:</label>
                                                <input type="text" class="form-control form-control-sm" id="purpose" name="purpose" placeholder="Search by purpose">
                                            </div>
                                        </div>
                                        <div class="col-md-6 d-flex align-items-end">
                                            <div class="form-group">
                                                <button type="button" id="apply-filter" class="btn btn-primary btn-sm mr-2">
                                                    <i class="fas fa-filter"></i> Apply Filter
                                                </button>
                                                <button type="button" id="reset-filter" class="btn btn-default btn-sm">
                                                    <i class="fas fa-sync"></i> Reset
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Transactions Table -->
            <div class="table-responsive">
                <table id="transactions-table" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Type</th>
                            <th>Purpose</th>
                            <th>Method</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded via AJAX -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap4.min.css">
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            // Initialize DataTable with server-side processing
            var table = $('#transactions-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: "{{ route('transactions.index') }}",
                    data: function(d) {
                        d.date_from = $('#date_from').val();
                        d.date_to = $('#date_to').val();
                        d.customer_id = $('#customer_id').val();
                        d.type = $('#type').val();
                        d.method = $('#method').val();
                        d.purpose = $('#purpose').val();
                    }
                },
                columns: [
                    { data: 'id', name: 'id' },
                    { data: 'date', name: 'created_at' },
                    { data: 'customer', name: 'customer_id' },
                    { 
                        data: 'type', 
                        name: 'type',
                        render: function(data) {
                            if (data === 'debit') {
                                return '<span class="badge badge-success">Debit</span>';
                            } else {
                                return '<span class="badge badge-danger">Credit</span>';
                            }
                        }
                    },
                    { data: 'purpose', name: 'purpose' },
                    { data: 'method', name: 'method' },
                    { data: 'amount', name: 'amount' },
                    { 
                        data: 'actions', 
                        name: 'actions', 
                        orderable: false, 
                        searchable: false 
                    }
                ],
                order: [[1, 'desc']],
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'copy',
                        className: 'btn btn-sm btn-secondary',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'csv',
                        className: 'btn btn-sm btn-secondary',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'excel',
                        className: 'btn btn-sm btn-secondary',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'pdf',
                        className: 'btn btn-sm btn-secondary',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'print',
                        className: 'btn btn-sm btn-secondary',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    }
                ],
                lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                pageLength: 10,
                language: {
                    processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>'
                }
            });
            
            // Apply filter button click
            $('#apply-filter').click(function() {
                table.draw();
            });
            
            // Reset filter button click
            $('#reset-filter').click(function() {
                $('#filter-form')[0].reset();
                table.draw();
            });
            
            // Handle delete confirmation with SweetAlert
            $(document).on('click', '.delete-btn', function(e) {
                e.preventDefault();
                var form = $(this).closest('form');
                var transactionId = $(this).data('id');
                
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
            
            // Set current date range by default (last 30 days)
            function setDefaultDateRange() {
                var today = new Date();
                var thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(today.getDate() - 30);
                
                var todayStr = today.toISOString().split('T')[0];
                var thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split('T')[0];
                
                $('#date_from').val(thirtyDaysAgoStr);
                $('#date_to').val(todayStr);
            }
            
            // Initialize with default date range
            setDefaultDateRange();
        });
    </script>
@stop

--- Contents of ledger-print.blade.php ---
<!DOCTYPE html>
<html>
<head>
    <title>Customer Ledger - {{ $customer->name }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            font-size: 12px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 15px;
        }
        .shop-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .shop-info {
            margin-bottom: 5px;
            font-size: 14px;
        }
        .ledger-title {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .customer-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .customer-details {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
            font-size: 11px;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .opening-balance {
            background-color: #e9ecef;
            font-weight: bold;
        }
        .discount-row {
            background-color: rgba(40, 167, 69, 0.1);
        }
        .discount-amount {
            color: #28a745;
            font-weight: bold;
        }
        .totals-row {
            background-color: #d1ecf1;
            font-weight: bold;
        }
        .summary-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        @media print {
            .no-print {
                display: none;
            }
            body {
                margin: 0;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    @php
        $runningBalance = $customer->opening_balance;
        $totalPayments = $transactions->where('type', 'debit')->sum('amount');
        $totalDiscounts = $transactions->where('type', 'debit')->sum('discount_amount');
        $totalCredits = $transactions->where('type', 'credit')->sum('amount');
        $totalEffectiveDebits = $transactions->where('type', 'debit')->sum(function($t) { 
            return $t->amount + ($t->discount_amount ?? 0); 
        });
    @endphp

    <div class="header">
        <div class="shop-name">Rahman Tiles and Sanitary</div>
        <div class="shop-info">Address: Model Town, Sadar, Shariatpur</div>
        <div class="shop-info">Phone: 01970598449, 0179583166</div>
    </div>

    <div class="ledger-title">
        Customer Ledger Report
    </div>

    <div class="customer-info">
        <h3>Customer Information</h3>
        <div class="customer-details">
            <div>
                <div><strong>Name:</strong> {{ $customer->name }}</div>
                <div><strong>Phone:</strong> {{ $customer->phone }}</div>
                @if($customer->address)
                <div><strong>Address:</strong> {{ $customer->address }}</div>
                @endif
            </div>
            <div>
                <div><strong>Opening Balance:</strong> {{ number_format($customer->opening_balance, 2) }}</div>
                <div><strong>Current Balance:</strong> {{ number_format($customer->outstanding_balance, 2) }}</div>
                <div><strong>Report Date:</strong> {{ now()->format('F d, Y h:i A') }}</div>
            </div>
        </div>
    </div>

    <div class="summary-box">
        <h4 style="margin-top: 0; margin-bottom: 15px;">Transaction Summary</h4>
        <div class="summary-row">
            <span><strong>Total Payments:</strong></span>
            <span>{{ number_format($totalPayments, 2) }}</span>
        </div>
        <div class="summary-row">
            <span><strong>Total Discounts Applied:</strong></span>
            <span class="discount-amount">{{ number_format($totalDiscounts, 2) }}</span>
        </div>
        <div class="summary-row">
            <span><strong>Total Effective Debits:</strong></span>
            <span>{{ number_format($totalEffectiveDebits, 2) }}</span>
        </div>
        <div class="summary-row">
            <span><strong>Total Credits:</strong></span>
            <span>{{ number_format($totalCredits, 2) }}</span>
        </div>
        <div class="summary-row">
            <span><strong>Transaction Count:</strong></span>
            <span>{{ $transactions->count() }} transactions</span>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Purpose</th>
                <th>Method</th>
                <th>Reference</th>
                <th>Payment</th>
                <th>Discount</th>
                <th>Total Debit</th>
                <th>Credit</th>
                <th>Running Balance</th>
            </tr>
        </thead>
        <tbody>
            @php
                $runningBalance = $customer->opening_balance;
            @endphp
            {{-- Opening Balance Row --}}
            <tr class="opening-balance">
                <td><strong>Opening</strong></td>
                <td><strong>Opening Balance</strong></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td><strong>{{ number_format($runningBalance, 2) }}</strong></td>
            </tr>
            {{-- Transactions --}}
            @foreach($transactions as $transaction)
    @php
        $hasDiscount = ($transaction->discount_amount ?? 0) > 0;
        if ($transaction->type == 'debit') {
            $effectiveAmount = $transaction->amount + ($transaction->discount_amount ?? 0);
            $runningBalance -= $effectiveAmount;
        } else {
            $runningBalance += $transaction->amount;
        }
    @endphp
    <tr class="{{ $hasDiscount ? 'discount-row' : '' }}">
        <td>{{ $transaction->created_at->format('Y-m-d') }}</td>
        <td>
            {{ $transaction->purpose }}
            @if($hasDiscount && $transaction->discount_reason)
                <br><small style="color: #28a745;">
                    <strong>Discount:</strong> {{ $transaction->discount_reason }}
                </small>
            @endif
        </td>
        <td>{{ ucfirst($transaction->method) }}</td>
        <td>{{ $transaction->reference ?? '-' }}</td>
        
        @if($transaction->type == 'debit')
            <td>{{ number_format($transaction->amount, 2) }}</td>
            <td class="discount-amount">
                @if($hasDiscount)
                    {{ number_format($transaction->discount_amount, 2) }}
                @else
                    -
                @endif
            </td>
            <td><strong>{{ number_format($effectiveAmount, 2) }}</strong></td>
            <td>-</td>
        @else
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>{{ number_format($transaction->amount, 2) }}</td>
        @endif
        
        <td><strong>{{ number_format($runningBalance, 2) }}</strong></td>
    </tr>
@endforeach

        </tbody>
        <tfoot>
            <tr class="totals-row">
                <th colspan="4"><strong>Totals</strong></th>
                <th>{{ number_format($totalPayments, 2) }}</th>
                <th class="discount-amount">{{ number_format($totalDiscounts, 2) }}</th>
                <th><strong>{{ number_format($totalEffectiveDebits, 2) }}</strong></th>
                <th>{{ number_format($totalCredits, 2) }}</th>
                <th><strong>{{ number_format($customer->outstanding_balance, 2) }}</strong></th>
            </tr>
        </tfoot>
    </table>

    @if($totalDiscounts > 0)
    <div style="background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; padding: 10px; margin: 15px 0; color: #155724;">
        <strong>Discount Summary:</strong> Total discounts of {{ number_format($totalDiscounts, 2) }} were applied across {{ $transactions->where('discount_amount', '>', 0)->count() }} transactions.
    </div>
    @endif

    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px;">
        <p>This is a computer-generated ledger report.</p>
        <p>Generated on: {{ now()->format('F d, Y h:i A') }}</p>
        <p>Rahman Tiles and Sanitary</p>
    </div>

    <div class="no-print" style="margin-top: 20px; text-align: center;">
        <button onclick="window.print();" style="padding: 10px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; margin-right: 10px;">
            Print Ledger
        </button>
        <button onclick="window.location='{{ route('customer.ledger', $customer->id) }}';" style="padding: 10px 20px; cursor: pointer; background-color: #6c757d; color: white; border: none; border-radius: 4px;">
            Back to Ledger
        </button>
    </div>
</body>
</html>


--- Contents of ledger.blade.php ---
@extends('adminlte::page')

@section('title', 'Customer Ledger')

@section('content_header')
    <h1>Customer Ledger: {{ $customer->name }}</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transaction History</h3>
            <div class="card-tools">
                <a href="{{ route('customers.ledger.print', $customer->id) }}" target="_blank" class="btn btn-default">
                    <i class="fas fa-print"></i> Print Ledger
                </a>
                <a href="{{ route('transactions.create', ['customer_id' => $customer->id]) }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Transaction
                </a>
                <a href="{{ route('transactions.index') }}" class="btn btn-default">
                    <i class="fas fa-list"></i> All Transactions
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-info">
                            <i class="fas fa-user"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">Customer</span>
                            <span class="info-box-number">{{ $customer->name }}</span>
                            <small>{{ $customer->phone }}</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-warning">
                            <i class="fas fa-money-bill"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">Opening Balance</span>
                            <span class="info-box-number">{{ number_format($customer->opening_balance, 2) }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon {{ $customer->outstanding_balance > 0 ? 'bg-danger' : 'bg-success' }}">
                            <i class="fas fa-chart-line"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">Outstanding Balance</span>
                            <span class="info-box-number">{{ number_format($customer->outstanding_balance, 2) }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Transaction Ledger</h3>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <form id="ledger-filter" class="form-inline">
                                        <div class="form-group mr-2">
                                            <label for="date-range" class="mr-1">Date Range:</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control date-picker" id="date-range-start" placeholder="Start Date">
                                                <div class="input-group-prepend input-group-append">
                                                    <span class="input-group-text">to</span>
                                                </div>
                                                <input type="text" class="form-control date-picker" id="date-range-end" placeholder="End Date">
                                            </div>
                                        </div>
                                        <div class="form-group mr-2">
                                            <label for="transaction-type" class="mr-1">Type:</label>
                                            <select class="form-control" id="transaction-type">
                                                <option value="">All Types</option>
                                                <option value="debit">Debit</option>
                                                <option value="credit">Credit</option>
                                            </select>
                                        </div>
                                        <div class="form-group mr-2">
                                            <label for="payment-method" class="mr-1">Method:</label>
                                            <select class="form-control" id="payment-method">
                                                <option value="">All Methods</option>
                                                <option value="cash">Cash</option>
                                                <option value="bank">Bank</option>
                                                <option value="mobile_bank">Mobile Bank</option>
                                                <option value="cheque">Cheque</option>
                                            </select>
                                        </div>
                                        <button type="button" id="apply-filter" class="btn btn-primary mr-1">Apply</button>
                                        <button type="reset" id="reset-filter" class="btn btn-default">Reset</button>
                                    </form>
                                </div>
                            </div>
                            
                            <table id="ledger-table" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Purpose</th>
                                        <th>Method</th>
                                        <th>Reference</th>
                                        <th>Payment</th>
                                        <th>Discount</th>
                                        <th>Total Debit</th>
                                        <th>Credit</th>
                                        <th>Running Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @php
                                        $runningBalance = $customer->opening_balance;
                                    @endphp
                                    {{-- Opening Balance Row - Always at the top --}}
                                    <tr class="table-secondary">
                                        <td><strong>Opening</strong></td>
                                        <td><strong>Opening Balance</strong></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td><strong>{{ number_format($runningBalance, 2) }}</strong></td>
                                        <td>-</td>
                                    </tr>
                                    {{-- Transactions in ascending order --}}
                                    @foreach($transactions as $transaction)
                                        @php
                                            // Calculate the effective amount for balance calculation
                                            if ($transaction->type == 'debit') {
                                                // For debit (payment), reduce balance by payment + discount
                                                $effectiveAmount = $transaction->amount + ($transaction->discount_amount ?? 0);
                                                $runningBalance -= $effectiveAmount;
                                            } else {
                                                // For credit (charge), increase balance by amount only
                                                $runningBalance += $transaction->amount;
                                            }
                                        @endphp
                                        <tr class="{{ $transaction->has_discount ? 'table-success' : '' }}">
                                            <td>{{ $transaction->created_at->format('Y-m-d') }}</td>
                                            <td>
                                                {{ $transaction->purpose }}
                                                @if($transaction->has_discount && $transaction->discount_reason)
                                                    <br><small class="text-success">
                                                        <i class="fas fa-tag"></i> {{ $transaction->discount_reason }}
                                                    </small>
                                                @endif
                                            </td>
                                            <td>{{ ucfirst($transaction->method) }}</td>
                                            <td>{{ $transaction->reference ?? '-' }}</td>
                                            
                                            @if($transaction->type == 'debit')
                                                <td>{{ number_format($transaction->amount, 2) }}</td>
                                                <td class="text-success">
                                                    @if($transaction->has_discount)
                                                        <i class="fas fa-tag"></i> {{ number_format($transaction->discount_amount, 2) }}
                                                    @else
                                                        -
                                                    @endif
                                                </td>
                                                <td><strong>{{ number_format($effectiveAmount, 2) }}</strong></td>
                                                <td>-</td>
                                            @else
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>{{ number_format($transaction->amount, 2) }}</td>
                                            @endif
                                            
                                            <td>
                                                <strong>{{ number_format($runningBalance, 2) }}</strong>
                                                @if($runningBalance > 0)
                                                    <small class="text-danger d-block">Due</small>
                                                @elseif($runningBalance < 0)
                                                    <small class="text-success d-block">Advance</small>
                                                @else
                                                    <small class="text-info d-block">Clear</small>
                                                @endif
                                            </td>
                                            <td>
                                                <a href="{{ route('transactions.show', $transaction) }}" class="btn btn-sm btn-info">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a href="{{ route('transactions.edit', $transaction) }}" class="btn btn-sm btn-warning">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                @if($transaction->has_discount)
                                                    <span class="badge badge-success" title="Discount Applied">
                                                        <i class="fas fa-tag"></i>
                                                    </span>
                                                @endif
                                            </td>
                                        </tr>
                                    @endforeach
                                </tbody>
                                <tfoot>
                                    <tr class="table-info">
                                        <th colspan="4"><strong>Totals</strong></th>
                                        <th>{{ number_format($transactions->where('type', 'debit')->sum('amount'), 2) }}</th>
                                        <th class="text-success">{{ number_format($transactions->where('type', 'debit')->sum('discount_amount'), 2) }}</th>
                                        <th><strong>{{ number_format($transactions->where('type', 'debit')->sum(function($t) { return $t->amount + ($t->discount_amount ?? 0); }), 2) }}</strong></th>
                                        <th>{{ number_format($transactions->where('type', 'credit')->sum('amount'), 2) }}</th>
                                        <th><strong>{{ number_format($customer->outstanding_balance, 2) }}</strong></th>
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="{{ route('customers.ledger.print', $customer->id) }}" target="_blank" class="btn btn-default">
    <i class="fas fa-print"></i> Print Ledger
</a>

@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <style>
        .table-success {
            background-color: rgba(40, 167, 69, 0.1) !important;
        }
    </style>
@stop

@section('js')
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.date-picker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true
            });
            
            var table = $('#ledger-table').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
                "dom": 'Bfrtip',
                "buttons": ['copy', 'csv', 'excel', 'pdf'],
                "order": [] // Disable default ordering to maintain our custom order
            });
            
            $.fn.dataTable.ext.search.push(
                function(settings, data, dataIndex) {
                    // Skip the opening balance row from filtering
                    if (data[1] === '<strong>Opening Balance</strong>') {
                        return true;
                    }
                    
                    var startDate = $('#date-range-start').val();
                    var endDate = $('#date-range-end').val();
                    var date = data[0];
                    
                    if ((startDate === '' && endDate === '') ||
                        (startDate === '' && date <= endDate) ||
                        (startDate <= date && endDate === '') ||
                        (startDate <= date && date <= endDate)) {
                    } else {
                        return false;
                    }
                    
                    var type = $('#transaction-type').val();
                    var isDebit = data[6] !== '-';
                    var isCredit = data[7] !== '-';
                    
                    if (type === '' || 
                        (type === 'debit' && isDebit) || 
                        (type === 'credit' && isCredit)) {
                    } else {
                        return false;
                    }
                    
                    var method = $('#payment-method').val();
                    var rowMethod = data[2].toLowerCase();
                    
                    if (method === '' || rowMethod === method) {
                        return true;
                    }
                    return false;
                }
            );
            
            $('#apply-filter').click(function() {
                table.draw();
            });
            
            $('#reset-filter').click(function() {
                $('#ledger-filter')[0].reset();
                table.draw();
            });
        });
    </script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'Transaction Details')

@section('content_header')
    <h1>Transaction Details</h1>
@stop

@section('content')
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transaction #{{ $transaction->id }}</h3>
            <div class="card-tools">
                <a href="{{ route('transactions.index') }}" class="btn btn-default">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
                <a href="{{ route('transactions.edit', $transaction) }}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Edit
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="info-box">
                        <span class="info-box-icon bg-info">
                            <i class="fas fa-user"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">Customer</span>
                            <span class="info-box-number">{{ $transaction->customer->name }}</span>
                            <a href="{{ route('customer.ledger', $transaction->customer_id) }}" class="btn btn-sm btn-outline-info mt-2">
                                View Customer Ledger
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-box">
                        <span class="info-box-icon {{ $transaction->type == 'debit' ? 'bg-success' : 'bg-danger' }}">
                            <i class="fas {{ $transaction->type == 'debit' ? 'fa-arrow-down' : 'fa-arrow-up' }}"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">Transaction Type</span>
                            <span class="info-box-number">{{ ucfirst($transaction->type) }}</span>
                            <small>{{ $transaction->type == 'debit' ? 'Customer paid' : 'Customer received' }}</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Transaction Details</h3>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <tr>
                                    <th style="width: 200px;">Transaction Date</th>
                                    <td>{{ $transaction->created_at->format('F d, Y h:i A') }}</td>
                                </tr>
                                <tr>
                                    <th>Purpose</th>
                                    <td>{{ $transaction->purpose }}</td>
                                </tr>
                                <tr>
                                    <th>Payment Method</th>
                                    <td>{{ ucfirst($transaction->method) }}</td>
                                </tr>
                                <tr>
                                    <th>Payment Amount</th>
                                    <td>{{ number_format($transaction->amount, 2) }}</td>
                                </tr>
                                @if($transaction->has_discount)
                                <tr>
                                    <th>Discount Amount</th>
                                    <td>
                                        <span class="text-success">
                                            <i class="fas fa-tag"></i> {{ number_format($transaction->discount_amount, 2) }}
                                        </span>
                                    </td>
                                </tr>
                                @if($transaction->discount_reason)
                                <tr>
                                    <th>Discount Reason</th>
                                    <td>{{ $transaction->discount_reason }}</td>
                                </tr>
                                @endif
                                <tr class="table-info">
                                    <th><strong>Total Amount (Payment + Discount)</strong></th>
                                    <td><strong>{{ number_format($transaction->total_amount, 2) }}</strong></td>
                                </tr>
                                @else
                                <tr>
                                    <th>Total Amount</th>
                                    <td>{{ number_format($transaction->amount, 2) }}</td>
                                </tr>
                                @endif
                                <tr>
                                    <th>Reference</th>
                                    <td>{{ $transaction->reference ?? 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <th>Note</th>
                                    <td>{{ $transaction->note ?? 'N/A' }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            @if($transaction->has_discount)
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="alert alert-info">
                        <h5><i class="icon fas fa-info"></i> Discount Applied!</h5>
                        A discount of <strong>{{ number_format($transaction->discount_amount, 2) }}</strong> was applied to this transaction.
                        @if($transaction->discount_reason)
                            <br><strong>Reason:</strong> {{ $transaction->discount_reason }}
                        @endif
                    </div>
                </div>
            </div>
            @endif
        </div>
    </div>
    <a href="{{ route('transactions.print', $transaction) }}" class="btn btn-primary" target="_blank">
        <i class="fas fa-print"></i> Print
    </a>
    
@stop

@section('css')
    <link rel="stylesheet" href="/css/admin_custom.css">
    <style>
        .table-info th {
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        .table-info td {
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
    </style>
@stop

@section('js')
    <script>
        console.log('Hi!');
    </script>
@stop


--- Contents of transaction-print.blade.php ---
<!DOCTYPE html>
<html>
<head>
    <title>Transaction #{{ $transaction->id }} - Print View</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .shop-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .shop-info {
            margin-bottom: 5px;
        }
        .transaction-title {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .balance-summary {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .balance-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .balance-label {
            font-weight: bold;
        }
        .discount-note {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 15px 0;
            color: #155724;
            font-size: 14px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        @media print {
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    @php
        // Calculate previous balance before this transaction
        $currentBalance = $transaction->customer->outstanding_balance;
        $transactionAmount = $transaction->amount + ($transaction->discount_amount ?? 0);
        
        if ($transaction->type == 'debit') {
            $previousBalance = $currentBalance + $transactionAmount;
        } else {
            $previousBalance = $currentBalance - $transaction->amount;
        }
    @endphp

    <div class="header">
        <div class="shop-name">Rahman Tiles and Sanitary</div>
        <div class="shop-info">Address: Model Town, Sadar, Shariatpur</div>
        <div class="shop-info">Phone: 01970598449, 0179583166</div>
    </div>

    <div class="transaction-title">
        Transaction Receipt #{{ $transaction->id }}
    </div>

    <table>
        <tr>
            <th>Customer Name</th>
            <td>{{ $transaction->customer->name }}</td>
            <th>Transaction Date</th>
            <td>{{ $transaction->created_at->format('F d, Y h:i A') }}</td>
        </tr>
        <tr>
            <th>Transaction Type</th>
            <td>{{ ucfirst($transaction->type) }}</td>
            <th>Payment Method</th>
            <td>{{ ucfirst($transaction->method) }}</td>
        </tr>
        <tr>
            <th>Purpose</th>
            <td colspan="3">{{ $transaction->purpose }}</td>
        </tr>
    </table>

    <div class="balance-summary">
        <h4 style="margin-top: 0; margin-bottom: 15px;">Balance Summary</h4>
        <div class="balance-row">
            <span class="balance-label">Previous Balance Due:</span>
            <span>{{ number_format($previousBalance, 2) }}</span>
        </div>
        @if($transaction->type == 'debit')
            <div class="balance-row">
                <span>Payment Amount:</span>
                <span>{{ number_format($transaction->amount, 2) }}</span>
            </div>
            @if($transaction->has_discount)
            <div class="balance-row" style="color: #28a745;">
                <span>Discount Applied:</span>
                <span>{{ number_format($transaction->discount_amount, 2) }}</span>
            </div>
            <div class="balance-row">
                <span>Total Reduction:</span>
                <span>{{ number_format($transactionAmount, 2) }}</span>
            </div>
            @endif
        @else
            <div class="balance-row">
                <span>Amount Charged:</span>
                <span>{{ number_format($transaction->amount, 2) }}</span>
            </div>
        @endif
        <hr style="margin: 10px 0;">
        <div class="balance-row" style="font-size: 16px; font-weight: bold;">
            <span class="balance-label">Current Balance Due:</span>
            <span>{{ number_format($currentBalance, 2) }}</span>
        </div>
    </div>

    @if($transaction->has_discount && $transaction->discount_reason)
    <div class="discount-note">
        <strong>Discount Reason:</strong> {{ $transaction->discount_reason }}
    </div>
    @endif

    @if($transaction->reference || $transaction->note)
    <table>
        @if($transaction->reference)
        <tr>
            <th style="width: 150px;">Reference</th>
            <td>{{ $transaction->reference }}</td>
        </tr>
        @endif
        @if($transaction->note)
        <tr>
            <th>Note</th>
            <td>{{ $transaction->note }}</td>
        </tr>
        @endif
    </table>
    @endif

    <div class="footer">
        <p>This is a computer-generated receipt and does not require a signature.</p>
        <p>Printed on: {{ now()->format('F d, Y h:i A') }}</p>
    </div>

    <div class="no-print" style="margin-top: 20px; text-align: center;">
        <button onclick="window.print();" style="padding: 10px 20px; cursor: pointer;">Print Receipt</button>
        <button onclick="window.location='{{ route('transactions.show', $transaction) }}';" style="padding: 10px 20px; margin-left: 10px; cursor: pointer;">Back</button>
    </div>
</body>
</html>


--- Contents of action-buttons.blade.php ---
<a href="{{ route('transactions.show', $transaction) }}" class="btn btn-sm btn-info">
    <i class="fas fa-eye"></i>
</a>
<a href="{{ route('transactions.edit', $transaction) }}" class="btn btn-sm btn-warning">
    <i class="fas fa-edit"></i>
</a>
<form action="{{ route('transactions.destroy', $transaction) }}" method="POST" style="display: inline-block;">
    @csrf
    @method('DELETE')
    <button type="submit" class="btn btn-sm btn-danger delete-btn" data-id="{{ $transaction->id }}">
        <i class="fas fa-trash"></i>
    </button>
</form>


--- Contents of create.blade.php ---
@extends('adminlte::page')

@section('title', 'Create User')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-plus text-primary"></i> Create New User</h1>
        <a href="{{ route('users.index') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back to Users
        </a>
    </div>
@stop

@section('content')
<div class="card shadow-sm">
    <div class="card-body">
        @if (count($errors) > 0)
            <div class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5><i class="icon fas fa-ban"></i> Error!</h5>
                <ul class="list-unstyled mb-0">
                    @foreach ($errors->all() as $error)
                        <li><i class="fas fa-exclamation-circle mr-2"></i>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form method="POST" action="{{ route('users.store') }}" class="form-horizontal">
            @csrf
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="name" class="font-weight-bold">
                            <i class="fas fa-user mr-1"></i> Full Name
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                            </div>
                            <input type="text" name="name" id="name" class="form-control" placeholder="Enter full name" value="{{ old('name') }}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="font-weight-bold">
                            <i class="fas fa-envelope mr-1"></i> Email Address
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            </div>
                            <input type="email" name="email" id="email" class="form-control" placeholder="Enter email address" value="{{ old('email') }}">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="password" class="font-weight-bold">
                            <i class="fas fa-lock mr-1"></i> Password
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input type="password" name="password" id="password" class="form-control" placeholder="Enter password">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password" class="font-weight-bold">
                            <i class="fas fa-check-circle mr-1"></i> Confirm Password
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-check-circle"></i></span>
                            </div>
                            <input type="password" name="confirm-password" id="confirm-password" class="form-control" placeholder="Confirm password">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="roles" class="font-weight-bold">
                            <i class="fas fa-user-tag mr-1"></i> Assign Roles
                        </label>
                        <select name="roles[]" id="roles" class="form-control select2"  data-placeholder="Select roles">
                            @foreach ($roles as $value => $label)
                                <option value="{{ $value }}">{{ $label }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-5">
                    <i class="fas fa-save mr-2"></i> Create User
                </button>
            </div>
        </form>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .form-control, .input-group-text {
        border-radius: 0.25rem;
    }
    .select2-container--bootstrap4 .select2-selection {
        height: calc(2.25rem + 2px);
        border-radius: 0.25rem;
    }
</style>
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function() {
        $('.select2').select2({
            theme: 'bootstrap4',
        });
    });
</script>
@stop


--- Contents of edit.blade.php ---
@extends('adminlte::page')

@section('title', 'Edit User')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-edit text-info"></i> Edit User</h1>
        <a href="{{ route('users.index') }}" class="btn btn-outline-info">
            <i class="fas fa-arrow-left"></i> Back to Users
        </a>
    </div>
@stop

@section('content')
<div class="card shadow-sm">
    <div class="card-header bg-light">
        <h3 class="card-title">
            <i class="fas fa-user-circle mr-2"></i> {{ $user->name }}
        </h3>
        <div class="card-tools">
            <span class="badge badge-info">{{ $user->email }}</span>
        </div>
    </div>
    <div class="card-body">
        @if (count($errors) > 0)
            <div class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5><i class="icon fas fa-ban"></i> Error!</h5>
                <ul class="list-unstyled mb-0">
                    @foreach ($errors->all() as $error)
                        <li><i class="fas fa-exclamation-circle mr-2"></i>{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form method="POST" action="{{ route('users.update', $user->id) }}" class="form-horizontal">
            @csrf
            @method('PATCH')
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="name" class="font-weight-bold">
                            <i class="fas fa-user mr-1"></i> Full Name
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                            </div>
                            <input type="text" name="name" id="name" class="form-control" value="{{ $user->name }}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="font-weight-bold">
                            <i class="fas fa-envelope mr-1"></i> Email Address
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            </div>
                            <input type="email" name="email" id="email" class="form-control" value="{{ $user->email }}">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="password" class="font-weight-bold">
                            <i class="fas fa-lock mr-1"></i> Password
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input type="password" name="password" id="password" class="form-control" placeholder="Leave blank to keep current password">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password" class="font-weight-bold">
                            <i class="fas fa-check-circle mr-1"></i> Confirm Password
                        </label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-check-circle"></i></span>
                            </div>
                            <input type="password" name="confirm-password" id="confirm-password" class="form-control" placeholder="Confirm password">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="roles" class="font-weight-bold">
                            <i class="fas fa-user-tag mr-1"></i> Assign Roles
                        </label>
                        <select name="roles[]" id="roles" class="form-control select2"  data-placeholder="Select roles">
                            @foreach ($roles as $value => $label)
                                <option value="{{ $value }}" {{ in_array($value, $userRole) ? 'selected' : '' }}>
                                    {{ $label }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-info px-5">
                    <i class="fas fa-save mr-2"></i> Update User
                </button>
            </div>
        </form>
    </div>
</div>
@stop

@section('css')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.0.0/dist/select2-bootstrap4.min.css">
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .form-control, .input-group-text {
        border-radius: 0.25rem;
    }
    .select2-container--bootstrap4 .select2-selection {
        height: calc(2.25rem + 2px);
        border-radius: 0.25rem;
    }
</style>
@stop

@section('js')
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function() {
        $('.select2').select2({
            theme: 'bootstrap4',
        });
    });
</script>
@stop


--- Contents of index.blade.php ---
@extends('adminlte::page')

@section('title', 'Users Management')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-users text-primary"></i> Users Management</h1>
        @can('user-create')
        <a href="{{ route('users.create') }}" class="btn btn-primary">
            <i class="fas fa-user-plus mr-1"></i> Create New User
        </a>
        @endcan
    </div>
@stop

@section('content')
    @if ($message = Session::get('success'))
        <div class="alert alert-success alert-dismissible fade show">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <h5><i class="icon fas fa-check"></i> Success!</h5>
            {{ $message }}
        </div>
    @endif

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="card-title">
                    <i class="fas fa-user-friends mr-2"></i> User List
                </h3>
                <div class="card-tools">
                    <div class="input-group input-group-sm" style="width: 250px;">
                        <input type="text" name="table_search" class="form-control float-right" placeholder="Search users...">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-default">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th width="50">#</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Roles</th>
                            <th width="280">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($data as $key => $user)
                            <tr>
                                <td>{{ ++$i }}</td>
                               <td>
    <span class="font-weight-bold">{{ $user->name }}</span>
</td>
                                <td>{{ $user->email }}</td>
                                <td>
                                    @if(!empty($user->getRoleNames()))
                                        @foreach($user->getRoleNames() as $role)
                                            <span class="badge badge-info">{{ $role }}</span>
                                        @endforeach
                                    @endif
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a href="{{ route('users.show', $user->id) }}" class="btn btn-sm btn-success">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                        @can('user-edit')
                                        <a href="{{ route('users.edit', $user->id) }}" class="btn btn-sm btn-info">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        @endcan
                                        @can('user-delete')
                                        <form action="{{ route('users.destroy', $user->id) }}" method="POST" class="d-inline">
                                            @csrf
                                            @method('DELETE')
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this user?')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                        @endcan
                                    </div>
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer bg-white">
            <div class="d-flex justify-content-center">
                {{ $data->links('pagination::bootstrap-4') }}
            </div>
        </div>
    </div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .table th {
        border-top: none;
    }
    .pagination {
        margin-bottom: 0;
    }
    .btn-group .btn {
        margin-right: 5px;
    }
    .btn-group .btn:last-child {
        margin-right: 0;
    }
</style>
@stop

@section('js')
<script>
    $(document).ready(function() {
        // Add animation to alerts
        $('.alert').addClass('animate__animated animate__fadeIn');
        
        // Table search functionality
        $('input[name="table_search"]').on('keyup', function() {
            var value = $(this).val().toLowerCase();
            $('table tbody tr').filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    });
</script>
@stop


--- Contents of show.blade.php ---
@extends('adminlte::page')

@section('title', 'User Details')

@section('content_header')
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-user-circle text-success"></i> User Details</h1>
        <a href="{{ route('users.index') }}" class="btn btn-outline-success">
            <i class="fas fa-arrow-left"></i> Back to Users
        </a>
    </div>
@stop

@section('content')
<div class="row">
    <div class="col-md-4">
        <div class="card card-widget widget-user shadow-sm">
            <div class="widget-user-header bg-success">
                <h3 class="widget-user-username">{{ $user->name }}</h3>
                <h5 class="widget-user-desc">{{ $user->email }}</h5>
            </div>

            <div class="card-footer">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="description-block">
                            <h5 class="description-header">ROLES</h5>
                            <div class="mt-3">
                                @if(!empty($user->getRoleNames()))
                                    @foreach($user->getRoleNames() as $role)
                                        <span class="badge badge-success p-2 mb-1">
                                            <i class="fas fa-user-tag mr-1"></i> {{ $role }}
                                        </span>
                                    @endforeach
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h3 class="card-title">
                    <i class="fas fa-info-circle mr-2"></i> User Information
                </h3>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <tbody>
                        <tr>
                            <th style="width: 30%"><i class="fas fa-id-card mr-2"></i> User ID</th>
                            <td>{{ $user->id }}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-user mr-2"></i> Full Name</th>
                            <td>{{ $user->name }}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-envelope mr-2"></i> Email</th>
                            <td>{{ $user->email }}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-calendar-alt mr-2"></i> Created At</th>
                            <td>{{ $user->created_at->format('F d, Y h:i A') }}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-edit mr-2"></i> Last Updated</th>
                            <td>{{ $user->updated_at->format('F d, Y h:i A') }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="card-footer bg-white">
                <div class="d-flex justify-content-between">
                    <a href="{{ route('users.edit', $user->id) }}" class="btn btn-info">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </a>
                    <form action="{{ route('users.destroy', $user->id) }}" method="POST">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?')">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@stop

@section('css')
<style>
    .card {
        border-radius: 0.5rem;
        border: none;
    }
    .widget-user .widget-user-header {
        height: 120px;
        border-top-left-radius: 0.5rem;
        border-top-right-radius: 0.5rem;
    }
    .widget-user .widget-user-image {
        top: 80px;
    }
    .badge {
        font-size: 0.9rem;
    }
</style>
@stop

